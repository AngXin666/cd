# 测试账号设置指南

## 概述

由于 Supabase Auth 的安全限制，我们无法直接在数据库中创建测试账号。测试账号需要通过正常的注册流程创建。

## 测试账号列表

系统已配置以下测试账号的快速填充功能：

| 账号名 | 手机号 | 密码 | 角色 | 说明 |
|--------|--------|------|------|------|
| admin | 13800000000 | admin123 | BOSS | 老板账号，拥有最高权限 |
| admin1 | 13800000001 | admin123 | DISPATCHER | 车队长账号，管理权限 |
| admin2 | 13800000002 | admin123 | DRIVER | 司机账号，基础权限 |
| admin3 | 13800000003 | admin123 | DISPATCHER | 平级账号，管理权限 |

## 创建测试账号步骤

### 方法一：通过注册流程创建（推荐）

1. **打开小程序登录页面**
   - 启动小程序或 H5 应用
   - 进入登录页面

2. **切换到验证码登录模式**
   - 点击"验证码登录"按钮

3. **注册第一个账号（admin - 老板）**
   - 输入手机号：`13800000000`
   - 点击"发送验证码"
   - 输入收到的验证码
   - 点击"验证码登录"
   - **注意**：第一个注册的用户会自动成为 BOSS（老板）

4. **设置密码**
   - 登录后，进入个人中心
   - 设置密码为：`admin123`

5. **重复步骤 3-4 创建其他测试账号**
   - admin1（13800000001）- 第二个用户，默认为 DISPATCHER
   - admin2（13800000002）- 第三个用户，默认为 DRIVER
   - admin3（13800000003）- 第四个用户，默认为 DISPATCHER

6. **调整用户角色（如需要）**
   - 使用 admin（老板）账号登录
   - 进入用户管理页面
   - 修改其他用户的角色

### 方法二：使用 SQL 脚本（需要先注册）

如果用户已经通过验证码注册，可以使用以下 SQL 脚本更新用户信息：

```sql
-- 更新用户信息
UPDATE users SET 
  name = 'admin（老板）',
  phone = '13800000000'
WHERE phone = '13800000000';

-- 更新用户角色
UPDATE user_roles SET role = 'BOSS'
WHERE user_id = (SELECT id FROM users WHERE phone = '13800000000');

-- 重复以上步骤为其他用户更新信息
```

## 使用快速填充功能

登录页面已集成快速填充功能，使用方法：

1. **展开测试账号面板**
   - 在登录页面找到"🧪 开发测试 - 快速登录"
   - 点击展开

2. **选择测试账号**
   - 点击任意测试账号卡片
   - 账号和密码会自动填充到输入框

3. **完成登录**
   - 点击"密码登录"按钮
   - 系统会自动登录

## 快速填充功能截图

```
┌─────────────────────────────────────┐
│  🧪 开发测试 - 快速登录  ▼ 展开    │
├─────────────────────────────────────┤
│  🚗 车队管家测试账号                │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ [老板] admin                  │ │
│  │ 13800000000 / admin123        │ │
│  │                  点击填充 →   │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ [车队长] admin1               │ │
│  │ 13800000001 / admin123        │ │
│  │                  点击填充 →   │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ [司机] admin2                 │ │
│  │ 13800000002 / admin123        │ │
│  │                  点击填充 →   │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ [平级账号] admin3             │ │
│  │ 13800000003 / admin123        │ │
│  │                  点击填充 →   │ │
│  └───────────────────────────────┘ │
│                                     │
│  💡 使用说明：                      │
│  1. 点击账号卡片自动填充账号密码    │
│  2. 点击"密码登录"按钮完成登录      │
│  3. 首次登录需要先注册账号          │
└─────────────────────────────────────┘
```

## 角色权限说明

### BOSS（老板）
- 拥有系统最高权限
- 可以管理所有用户
- 可以管理所有车辆、仓库、考勤等
- 可以审批请假申请
- 可以查看所有统计数据

### DISPATCHER（车队长/平级账号）
- 拥有管理权限
- 可以查看所有用户信息
- 可以管理车辆和仓库分配
- 可以审批请假申请
- 可以查看统计数据

### DRIVER（司机）
- 基础权限
- 只能查看和管理自己的信息
- 可以打卡考勤
- 可以提交计件记录
- 可以申请请假
- 可以查看自己的统计数据

## 注意事项

1. **首个用户自动成为 BOSS**
   - 系统会自动将第一个注册的用户设置为 BOSS 角色
   - 确保首先创建 admin 账号

2. **密码安全**
   - 测试账号使用简单密码（admin123）
   - 生产环境应使用强密码
   - 定期更换密码

3. **手机号验证**
   - 如果启用了短信验证，需要使用真实手机号
   - 开发环境可以配置跳过验证

4. **删除测试账号**
   - 生产环境部署前应删除所有测试账号
   - 或修改测试账号密码

## 故障排除

### 问题：无法发送验证码

**解决方案：**
- 检查 Supabase Auth 配置
- 确认短信服务已启用
- 检查手机号格式是否正确

### 问题：验证码登录失败

**解决方案：**
- 确认验证码输入正确
- 检查验证码是否过期（通常 5-10 分钟）
- 重新发送验证码

### 问题：密码登录失败

**解决方案：**
- 确认账号已注册
- 确认密码已设置
- 检查账号名映射是否正确

### 问题：角色权限不正确

**解决方案：**
- 使用 BOSS 账号登录
- 进入用户管理页面
- 手动调整用户角色

## 开发建议

1. **本地开发**
   - 使用测试账号进行功能测试
   - 不要在测试账号中存储重要数据

2. **团队协作**
   - 团队成员共享测试账号信息
   - 定期同步测试数据

3. **自动化测试**
   - 可以使用测试账号进行自动化测试
   - 建议创建专门的测试环境

4. **生产部署**
   - 部署前删除或禁用测试账号
   - 移除快速填充功能代码
   - 加强密码策略

## 相关文件

- 登录页面：`src/pages/login/index.tsx`
- 用户类型定义：`src/db/types.ts`
- 数据库迁移：`supabase/migrations/00468_step1_create_new_tables.sql`
- 权限检查：`src/contexts/TenantContext.tsx`

## 更新日志

- 2025-11-29：创建测试账号设置指南
- 2025-11-29：更新登录页面快速填充功能
- 2025-11-29：简化测试账号列表（从多租户改为单用户）
