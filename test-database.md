# 数据库测试指南

## 测试账户信息

### 1. 超级管理员账户
- **手机号**: `admin`
- **密码**: `123456`
- **角色**: super_admin
- **权限**: 
  - 查看和管理所有仓库
  - 查看和管理所有用户
  - 查看和管理所有考勤记录
  - 查看和管理所有计件记录
  - 审批所有请假和离职申请

### 2. 普通管理员账户
- **手机号**: `admin2`
- **密码**: `123456`
- **角色**: manager
- **管理仓库**: 东区仓库、西区仓库
- **权限**:
  - 只能查看和管理分配的仓库（东区、西区）
  - 可以查看所有司机档案
  - 可以修改司机档案
  - 可以审批分配仓库的请假和离职申请

### 3. 司机账户
- **手机号**: `admin1`
- **密码**: `123456`
- **角色**: driver
- **所属仓库**: 东区仓库
- **权限**:
  - 只能查看和修改自己的档案
  - 可以打卡考勤
  - 可以提交计件记录
  - 可以提交请假和离职申请

## 测试步骤

### 1. 登录测试

#### 测试超级管理员登录
```
手机号: admin
密码: 123456
预期结果: 登录成功，可以看到所有功能菜单
```

#### 测试普通管理员登录
```
手机号: admin2
密码: 123456
预期结果: 登录成功，只能看到东区和西区仓库的数据
```

#### 测试司机登录
```
手机号: admin1
密码: 123456
预期结果: 登录成功，只能看到自己的数据
```

### 2. 权限测试

#### 超级管理员权限测试
1. 查看所有仓库列表
2. 查看所有用户列表
3. 修改用户角色
4. 查看所有考勤记录
5. 查看所有计件记录

#### 普通管理员权限测试
1. 查看仓库列表（应该只看到东区和西区）
2. 查看司机列表
3. 尝试修改司机档案（应该成功）
4. 尝试修改管理员档案（应该失败）
5. 查看考勤记录（只能看到东区和西区的）

#### 司机权限测试
1. 查看自己的档案
2. 修改自己的档案
3. 尝试查看其他司机档案（应该失败）
4. 打卡考勤
5. 提交计件记录

### 3. 功能测试

#### 考勤功能
1. 司机打卡（使用 admin1 账户）
2. 管理员查看考勤记录（使用 admin2 账户）
3. 超级管理员查看所有考勤记录（使用 admin 账户）

#### 计件功能
1. 司机提交计件记录（使用 admin1 账户）
   - 选择计件类别：装卸货物、分拣包裹、搬运货物等
2. 管理员查看计件记录（使用 admin2 账户）
3. 超级管理员查看所有计件记录（使用 admin 账户）

#### 请假功能
1. 司机提交请假申请（使用 admin1 账户）
2. 管理员审批请假申请（使用 admin2 账户）
3. 超级管理员查看所有请假申请（使用 admin 账户）

#### 离职功能
1. 司机提交离职申请（使用 admin1 账户）
2. 管理员审批离职申请（使用 admin2 账户）
3. 超级管理员查看所有离职申请（使用 admin 账户）

## 数据验证

### 验证用户数据
```sql
SELECT id, phone, name, role FROM profiles ORDER BY role DESC;
```
预期结果：
- admin - 超级管理员 - super_admin
- admin2 - 普通管理员 - manager
- admin1 - 测试司机 - driver

### 验证仓库数据
```sql
SELECT id, name, is_active FROM warehouses;
```
预期结果：
- 总部仓库 - 激活
- 东区仓库 - 激活
- 西区仓库 - 激活

### 验证管理员仓库分配
```sql
SELECT p.name as manager_name, w.name as warehouse_name
FROM manager_warehouses mw
JOIN profiles p ON mw.manager_id = p.id
JOIN warehouses w ON mw.warehouse_id = w.id;
```
预期结果：
- 普通管理员 - 东区仓库
- 普通管理员 - 西区仓库

### 验证司机仓库分配
```sql
SELECT p.name as driver_name, w.name as warehouse_name
FROM driver_warehouses dw
JOIN profiles p ON dw.driver_id = p.id
JOIN warehouses w ON dw.warehouse_id = w.id;
```
预期结果：
- 测试司机 - 东区仓库

### 验证考勤规则
```sql
SELECT w.name as warehouse_name, ar.work_start_time, ar.work_end_time
FROM attendance_rules ar
JOIN warehouses w ON ar.warehouse_id = w.id;
```
预期结果：
- 总部仓库: 09:00 - 18:00
- 东区仓库: 08:00 - 17:00
- 西区仓库: 09:30 - 18:30

### 验证计件类别
```sql
SELECT name, is_active FROM piece_work_categories ORDER BY name;
```
预期结果：
- 冻品 - 激活
- 饮料 - 激活
- 东鹏 - 激活
- 分拣 - 未激活
- 装卸货物 - 激活
- 分拣包裹 - 激活
- 搬运货物 - 激活

## 常见问题

### 1. 无法登录
- 确认手机号和密码是否正确
- 检查 Supabase 配置是否正确
- 查看浏览器控制台是否有错误信息

### 2. 权限错误
- 确认用户角色是否正确
- 检查 RLS 策略是否正确配置
- 查看数据库日志

### 3. 数据不显示
- 确认数据是否已经创建
- 检查查询条件是否正确
- 验证用户权限是否足够

## 注意事项

1. **测试账户密码**: 所有测试账户的密码都是 `123456`，生产环境应该修改
2. **数据隔离**: 普通管理员只能看到分配的仓库数据，司机只能看到自己的数据
3. **权限验证**: 所有数据访问都经过 RLS 验证，确保数据安全
4. **时间格式**: 考勤时间使用 24 小时制
5. **状态管理**: 注意区分激活和未激活的数据

## 下一步

1. 完成所有功能测试
2. 验证权限控制是否正确
3. 测试边界情况
4. 准备生产环境部署
