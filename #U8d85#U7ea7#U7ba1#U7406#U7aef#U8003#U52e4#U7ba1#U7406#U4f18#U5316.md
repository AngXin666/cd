# 超级管理端考勤管理优化

## 修改概述
将超级管理端的"请假审批管理"页面优化为"考勤管理"页面，简化顶部统计卡片，优化司机统计显示，并在司机详情页面添加打卡记录标签页。

## 主要修改内容

### 1. 考勤管理页面 (src/pages/super-admin/leave-approval/index.tsx)

#### 1.1 页面标题修改
- 将页面标题从"请假审批管理"改为"考勤管理"
- 保持副标题显示用户角色（超级管理员/管理员工作台）

#### 1.2 顶部统计卡片优化
- **修改前**：显示3个统计卡片（司机总数、请假总天数、待审批）
- **修改后**：只显示2个统计卡片（司机总数、待审批）
- 移除了"请假总天数"统计，使页面更简洁

#### 1.3 司机统计列表优化
- **添加打卡次数统计**：
  - 新增打卡记录数据加载
  - 在司机统计中显示打卡次数
  - 使用绿色显示打卡次数，与其他统计数据区分

- **离职申请显示优化**：
  - 只在司机有离职申请时才显示离职申请次数
  - 没有离职申请的司机不显示该统计项
  - 统计卡片根据是否有离职申请动态调整为3列或4列布局

- **统计项显示顺序**：
  1. 请假天数（橙色）
  2. 请假次数（蓝色）
  3. 打卡次数（绿色）
  4. 离职申请（紫色，仅在有申请时显示）

### 2. 司机详情页面 (src/pages/super-admin/driver-leave-detail/index.tsx)

#### 2.1 标签页结构调整
- **修改前**：2个标签页（请假申请、离职申请）
- **修改后**：2-3个标签页
  - 请假申请（蓝色，始终显示）
  - 打卡记录（绿色，始终显示）
  - 离职申请（橙色，仅在司机有离职申请时显示）

#### 2.2 打卡记录标签页功能
- **月份筛选器**：
  - 提供最近12个月的月份选项
  - 默认选中当前月份
  - 支持切换查看不同月份的打卡记录

- **打卡统计数据**：
  - 总次数：该月总打卡记录数
  - 正常：正常打卡次数
  - 迟到：迟到次数
  - 早退：早退次数

- **打卡记录列表**：
  - 显示每条打卡记录的详细信息
  - 日期和打卡状态（正常/迟到/早退/缺勤）
  - 上班打卡时间
  - 下班打卡时间
  - 所属仓库
  - 按日期倒序排列（最新的在前）

#### 2.3 打卡状态显示
- **正常**：绿色背景，绿色文字
- **迟到**：橙色背景，橙色文字
- **早退**：黄色背景，黄色文字
- **缺勤**：红色背景，红色文字

## 技术实现细节

### 数据加载
- 添加了 `getAllAttendanceRecords()` 的调用
- 在 `loadData` 函数中加载打卡记录数据
- 使用 `useDidShow` 确保页面显示时数据刷新

### 状态管理
- 添加 `attendanceRecords` 状态存储打卡记录
- 添加 `filterMonth` 状态用于月份筛选
- 修改 `activeTab` 类型支持 'attendance' 选项

### 辅助函数
- `initCurrentMonth()`：初始化当前月份
- `formatTime()`：格式化时间显示（HH:mm）
- `getAttendanceStatusInfo()`：获取打卡状态的文本和样式
- `generateMonthOptions()`：生成最近12个月的选项
- `getVisibleAttendanceRecords()`：获取筛选后的打卡记录
- `calculateAttendanceStats()`：计算打卡统计数据

### 类型定义
- 修改 `DriverStats` 接口，添加 `attendanceCount` 字段
- 使用 `AttendanceRecord` 类型的 `status` 字段（'normal' | 'late' | 'early' | 'absent'）

## 用户体验优化

### 视觉设计
- 使用不同颜色区分不同类型的统计数据
- 打卡状态使用彩色标签，直观易懂
- 统计卡片根据数据动态调整布局

### 交互优化
- 月份筛选器使用 Picker 组件，操作便捷
- 标签页根据数据动态显示，避免空白页面
- 打卡记录按时间倒序排列，最新记录优先显示

### 信息展示
- 顶部统计卡片简化，突出重点数据
- 司机统计列表信息更全面，包含打卡数据
- 打卡记录详情完整，包含所有关键信息

## 测试建议

1. **考勤管理页面测试**：
   - 验证顶部只显示2个统计卡片
   - 验证司机统计中显示打卡次数
   - 验证只在有离职申请时显示离职申请次数
   - 测试仓库筛选功能

2. **司机详情页面测试**：
   - 验证标签页根据离职申请动态显示
   - 测试打卡记录的月份筛选功能
   - 验证打卡统计数据的准确性
   - 测试打卡记录列表的显示和排序

3. **数据准确性测试**：
   - 验证打卡次数统计的准确性
   - 验证打卡状态的正确显示
   - 验证月份筛选后的数据正确性

## 后续优化建议

1. 可以考虑添加打卡记录的导出功能
2. 可以添加打卡异常的提醒功能
3. 可以添加打卡趋势图表展示
4. 可以添加批量审批功能
