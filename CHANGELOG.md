# 更新日志

## [1.1.0] - 2025-11-05

### 新增功能

#### 司机端考勤打卡系统
- ✨ **上下班打卡功能**
  - 支持GPS定位打卡
  - 自动记录打卡位置（经纬度）
  - 自动计算工作时长
  - 每天只能打卡一次（上班+下班）
  - 实时显示当前时间和日期
  - 显示今日打卡记录详情

- ✨ **当月考勤统计**
  - 查看当月所有考勤记录
  - 支持选择年份和月份
  - 统计出勤天数、正常天数、迟到次数
  - 统计总工作时长
  - 显示每日详细打卡记录
  - 支持考勤状态标识（正常/迟到/早退/缺勤）

### 数据库变更

#### 新增表
- **attendance_records** - 考勤打卡记录表
  - 记录上下班打卡时间
  - 记录GPS位置信息（经纬度）
  - 自动计算工作时长
  - 支持考勤状态管理
  - 完整的RLS权限控制

### 页面更新

#### 司机工作台 (`/pages/driver/index`)
- 🔄 修改快捷功能
  - "行程记录" → "上下班打卡"（支持GPS定位）
  - "工作日程" → "当月考勤"（查看考勤统计）
- ✨ 新增页面导航功能

#### 新增页面
- 📄 `/pages/driver/clock-in/index` - 上下班打卡页面
- 📄 `/pages/driver/attendance/index` - 当月考勤页面

### API更新

#### 新增API函数 (`src/db/api.ts`)
- `createClockIn()` - 创建上班打卡记录
- `updateClockOut()` - 更新下班打卡记录
- `getTodayAttendance()` - 获取今日打卡记录
- `getMonthlyAttendance()` - 获取当月考勤记录
- `getAllAttendanceRecords()` - 获取所有考勤记录（管理员）

#### 新增类型定义 (`src/db/types.ts`)
- `AttendanceStatus` - 考勤状态类型
- `AttendanceRecord` - 考勤记录接口
- `AttendanceRecordInput` - 创建考勤记录输入接口
- `AttendanceRecordUpdate` - 更新考勤记录输入接口

### 文档更新

- 📖 新增 `docs/ATTENDANCE_GUIDE.md` - 考勤打卡功能使用指南
- 📖 更新 `README.md` - 添加考勤功能说明
- 📖 更新 `supabase/migrations/README.md` - 添加迁移文件说明

### 技术改进

- ✅ 使用Taro的`getLocation` API实现GPS定位
- ✅ 实现跨平台兼容（微信小程序 + H5）
- ✅ 完整的错误处理和用户提示
- ✅ 实时时间显示（每秒更新）
- ✅ 响应式设计，适配不同屏幕尺寸

### 权限控制

- 🔒 司机可以查看和创建自己的打卡记录
- 🔒 司机可以更新自己的打卡记录（下班打卡）
- 🔒 管理员可以查看所有打卡记录
- 🔒 超级管理员拥有完全权限（查看、修改、删除）

---

## [1.0.0] - 2025-11-05

### 初始版本

#### 核心功能
- ✨ 多角色权限管理系统
  - 司机端工作台
  - 普通管理端工作台
  - 超级管理端控制台

- ✨ 用户认证系统
  - 基于Supabase Auth的登录认证
  - 支持手机号+验证码登录
  - 支持账号/手机号+密码登录
  - 首位注册用户自动成为超级管理员

- ✨ 用户管理功能
  - 查看所有用户列表
  - 修改用户角色
  - 编辑用户信息
  - 完整的权限控制

#### 测试账号
- admin（超级管理员）- 密码：123456
- admin1（司机）- 密码：123456
- admin2（普通管理员）- 密码：123456

#### 技术栈
- 前端：Taro + React + TypeScript
- 样式：Tailwind CSS
- 后端：Supabase（数据库 + 认证）
- 包管理：pnpm

#### 数据库
- profiles表 - 用户档案管理
- 完整的RLS权限控制
- 自动触发器（首位用户成为管理员）

---

## 版本说明

### 版本号规则
遵循语义化版本规范（Semantic Versioning）：
- 主版本号：重大功能变更或不兼容的API修改
- 次版本号：新增功能，向下兼容
- 修订号：问题修复，向下兼容

### 图标说明
- ✨ 新增功能
- 🔄 功能修改
- 🐛 问题修复
- 📖 文档更新
- 🔒 安全相关
- ⚡ 性能优化
- 💄 UI/样式更新
- 📄 新增页面
- 🗑️ 删除功能
