# 月度达标率计算说明

## 一、单个司机的月度达标率计算

### 计算步骤：

#### 1. 计算本月天数
```
本月天数 = 从起始日期到今天的天数（包含起始日和今天）
起始日期 = max(本月1号, 入职日期)
```
- 如果司机是本月入职的，只计算入职后的天数
- 如果司机是之前入职的，计算从本月1号到今天的天数

**示例：**
- 本月1号入职：本月天数 = 今天是几号（例如今天是20号，则本月天数 = 20天）
- 本月10号入职：本月天数 = 今天日期 - 10 + 1（例如今天是20号，则本月天数 = 11天）

#### 2. 获取本月请假天数
从考勤记录中统计本月的请假天数

#### 3. 计算合规请假天数
```
合规请假天数 = min(实际请假天数, 仓库允许的最大请假天数)
```
- 只有在允许范围内的请假才会被扣除
- 超出允许范围的请假不影响目标计算

**示例：**
- 仓库允许请假3天，实际请假2天 → 合规请假 = 2天
- 仓库允许请假3天，实际请假5天 → 合规请假 = 3天

#### 4. 计算应工作天数
```
应工作天数 = 本月天数 - 合规请假天数
```

**示例：**
- 本月天数20天，合规请假2天 → 应工作天数 = 18天

#### 5. 计算本月目标
```
本月目标 = 每日指标 × 应工作天数
```

**示例：**
- 每日指标100件，应工作天数18天 → 本月目标 = 1800件

#### 6. 计算月度达标率
```
月度达标率 = (本月完成件数 / 本月目标) × 100%
```

**示例：**
- 本月完成1500件，本月目标1800件 → 月度达标率 = 83.3%

---

## 二、整体月度达标率计算

### 计算方式：
```
整体月度达标率 = Σ(每个司机的月度达标率) / 司机总数
```

这是所有司机月度达标率的**算术平均值**。

**示例：**
- 司机A：月度达标率 = 90%
- 司机B：月度达标率 = 80%
- 司机C：月度达标率 = 70%
- 整体月度达标率 = (90% + 80% + 70%) / 3 = 80%

---

## 三、计算逻辑的优点

1. **公平性**：考虑了新员工入职时间，不会因为月中入职而降低达标率
2. **合理性**：扣除合规请假天数，不会因为正常请假而影响达标率
3. **个性化**：每个司机的目标基于其实际应工作天数
4. **可控性**：超出允许范围的请假不会降低目标，激励司机控制请假天数

---

## 四、可能的问题和建议

### 当前计算方式的特点：
- 使用**算术平均值**计算整体达标率
- 每个司机的权重相同，无论其完成的件数多少

### 可能的替代方案：
如果希望更准确地反映整体完成情况，可以考虑使用**加权平均**：

```
整体月度达标率 = (所有司机的本月总完成件数 / 所有司机的本月总目标) × 100%
```

**对比示例：**
- 司机A：完成900件，目标1000件，达标率90%
- 司机B：完成80件，目标100件，达标率80%

**算术平均（当前方式）：**
- 整体达标率 = (90% + 80%) / 2 = 85%

**加权平均（替代方案）：**
- 整体达标率 = (900 + 80) / (1000 + 100) × 100% = 89.1%

---

## 五、代码位置

- **单个司机月度达标率计算**：
  - 管理端：`src/pages/manager/piece-work-report/index.tsx` 第516-551行
  - 超级管理端：`src/pages/super-admin/piece-work-report/index.tsx` 第540-575行

- **整体月度达标率计算**：
  - 管理端：`src/pages/manager/piece-work-report/index.tsx` 第821-847行
  - 超级管理端：`src/pages/super-admin/piece-work-report/index.tsx` 第851-877行
