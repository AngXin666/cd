# 租户创建指南

## 📝 超级管理员创建租户

### 操作步骤

1. **登录中央管理系统**
   ```
   用户名：admin
   密码：hye19911206
   ```

2. **进入租户配置管理页面**
   - 在超级管理员界面，点击"租户配置管理"
   - 点击"创建新租户"按钮

3. **填写租户信息**
   - **租户名称**：输入租户名称，例如"张三车队"
   - 系统会显示提示：Schema 名称、Supabase URL 和 Anon Key 将自动生成和配置

4. **提交创建**
   - 点击"创建"按钮
   - 系统自动完成以下操作：
     - 生成唯一的 Schema 名称（例如：tenant_a1b2c3d4_123456）
     - 使用中央 Supabase 配置
     - 创建独立的数据库 Schema
     - 创建基础表结构（profiles、warehouses、drivers、vehicles 等）
     - 配置 RLS 策略和权限函数
   - 创建成功后，租户会显示在列表中

5. **查看和管理租户**
   - 在租户列表中可以看到：
     - 租户名称
     - Schema 名称（自动生成）
     - 状态（活跃/暂停）
   - 可以进行的操作：
     - 编辑租户名称
     - 暂停租户
     - 激活租户
     - 删除租户

---

## 🎯 核心优势

### 极简操作
- **只需输入租户名称**
- 无需配置 Schema 名称
- 无需配置 Supabase URL
- 无需配置 Supabase Anon Key

### 自动化
- Schema 名称自动生成，保证唯一性
- Supabase 配置自动使用中央配置
- 数据库结构自动创建
- 权限策略自动配置

### 统一管理
- 所有租户共享同一个 Supabase 项目
- 通过 Schema 实现数据物理隔离
- 简化管理，降低成本

---

## 📊 租户架构

### 多租户架构
```
中央 Supabase 项目
├── public schema（租赁系统数据）
│   ├── tenant_configs（租户配置表）
│   └── profiles（超级管理员账号）
├── tenant_a1b2c3d4_123456（租户 A 的 Schema）
│   ├── profiles（租户 A 的用户）
│   ├── warehouses（租户 A 的仓库）
│   ├── drivers（租户 A 的司机）
│   └── vehicles（租户 A 的车辆）
└── tenant_e5f6g7h8_789012（租户 B 的 Schema）
    ├── profiles（租户 B 的用户）
    ├── warehouses（租户 B 的仓库）
    ├── drivers（租户 B 的司机）
    └── vehicles（租户 B 的车辆）
```

### 数据隔离
- 每个租户拥有独立的 Schema
- 数据物理隔离，无法跨租户访问
- 每个 Schema 包含完整的表结构和权限策略

---

## 🔧 技术细节

### Schema 名称生成规则
```
格式：tenant_<uuid前8位>_<timestamp后6位>
示例：tenant_a1b2c3d4_123456

优势：
- UUID 部分保证唯一性
- 时间戳部分提供时间顺序信息
- 长度适中（约 22 个字符）
```

### 自动创建的表结构
每个租户 Schema 自动包含以下表：
- **profiles**：用户信息表（老板、平级、车队长、司机）
- **warehouses**：仓库表
- **drivers**：司机详细信息表
- **vehicles**：车辆表
- **attendance_records**：考勤记录表
- **salary_records**：工资记录表

### 自动配置的权限
- 启用行级安全（RLS）
- 创建权限检查函数
- 配置 RLS 策略：
  - 老板拥有所有数据的完整权限
  - 平级账号根据权限级别拥有相应权限
  - 车队长拥有管辖范围内的权限
  - 司机只能查看和管理自己的数据

---

## ❓ 常见问题

### Q1: 为什么不需要输入 Supabase URL 和 Anon Key？
**A:** 所有租户共享同一个中央 Supabase 项目，系统会自动使用中央配置。这样可以：
- 简化操作流程
- 降低管理成本
- 避免配置错误

### Q2: 如何保证租户数据安全？
**A:** 通过独立的 Schema 实现物理隔离：
- 每个租户拥有独立的 Schema
- 数据在数据库层面物理隔离
- 无法跨租户访问数据
- RLS 策略进一步保护数据安全

### Q3: Schema 名称可以修改吗？
**A:** 不可以。Schema 名称在创建时自动生成，之后不能修改。这是为了：
- 保证系统稳定性
- 避免数据迁移问题
- 防止配置错误

### Q4: 可以创建多少个租户？
**A:** 理论上没有限制，但建议根据实际需求和 Supabase 项目的资源限制来规划。

### Q5: 如何删除租户？
**A:** 在租户列表中点击"删除"按钮。注意：
- 删除操作会删除租户配置
- 但不会自动删除 Schema 和数据
- 如需完全清理，需要手动删除 Schema

---

## 📖 相关文档

- [全自动租户创建功能总结](AUTO_SCHEMA_CREATION_SUMMARY.md) - 详细的技术实现说明
- [账号类型和权限体系](ACCOUNT_TYPES_AND_PERMISSIONS.md) - 权限说明
- [独立数据库隔离架构](SCHEMA_ISOLATION_SUMMARY.md) - 架构说明
- [README.md](README.md) - 项目主文档

---

**文档版本**：v1.0  
**更新日期**：2025-11-05  
**维护者**：开发团队
