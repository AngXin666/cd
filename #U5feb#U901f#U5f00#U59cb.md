# 车队管家 - 快速开始指南

## 🚀 快速开始

### 1. 创建测试租户（首次使用）

```bash
# 进入项目目录
cd /workspace/app-7cdqf07mbu9t

# 运行创建脚本
node scripts/create-test-tenants.js
```

脚本会自动创建2个测试租户，每个租户包含4个不同角色的账号。

### 2. 使用快捷登录功能

#### 方法1：快捷登录（推荐）

1. 打开登录页面
2. 点击"🧪 开发测试 - 快速登录"展开测试账号列表
3. 选择要测试的租户和角色
4. 点击对应的账号卡片（系统会自动填充账号和密码）
5. 点击"密码登录"按钮完成登录

#### 方法2：账号名登录

直接输入账号名和密码：

**租户1 测试账号：**
- 老板：`admin1` / `123456`
- 平级管理员：`admin11` / `123456`
- 车队长：`admin111` / `123456`
- 司机：`admin1111` / `123456`

**租户2 测试账号：**
- 老板：`admin2` / `123456`
- 平级管理员：`admin22` / `123456`
- 车队长：`admin222` / `123456`
- 司机：`admin2222` / `123456`

#### 方法3：手机号登录

使用完整的手机号登录：

**租户1：**
- 老板：`13800000001` / `123456`
- 平级管理员：`13800000011` / `123456`
- 车队长：`13800000111` / `123456`
- 司机：`13800001111` / `123456`

**租户2：**
- 老板：`13800000002` / `123456`
- 平级管理员：`13800000022` / `123456`
- 车队长：`13800000222` / `123456`
- 司机：`13800002222` / `123456`

## 🧪 测试场景

### 场景1：测试多租户数据隔离

```bash
# 步骤1：使用租户1的老板账号登录
账号：admin1
密码：123456

# 步骤2：创建一些测试数据
- 添加司机
- 添加车辆
- 创建考勤记录

# 步骤3：退出登录

# 步骤4：使用租户2的老板账号登录
账号：admin2
密码：123456

# 步骤5：验证数据隔离
- 确认看不到租户1的数据
- 租户2的数据是独立的
```

### 场景2：测试角色权限

```bash
# 测试老板权限
账号：admin1 / 123456
预期：可以访问所有功能

# 测试平级管理员权限
账号：admin11 / 123456
预期：可以管理车队长和司机，但看不到老板资料

# 测试车队长权限
账号：admin111 / 123456
预期：只能管理自己管辖范围内的司机

# 测试司机权限
账号：admin1111 / 123456
预期：只能查看和管理自己的数据
```

### 场景3：测试跨租户访问控制

```bash
# 步骤1：使用租户1的账号登录
账号：admin1 / 123456

# 步骤2：尝试访问租户2的数据
预期：无法访问（被 RLS 策略阻止）

# 步骤3：切换到租户2的账号
账号：admin2 / 123456

# 步骤4：验证只能看到租户2的数据
预期：看不到租户1的任何数据
```

## 📱 功能测试清单

### 司机端功能
- [ ] 打卡签到
- [ ] 查看考勤记录
- [ ] 提交计件工作
- [ ] 申请请假
- [ ] 管理车辆信息
- [ ] 查看个人资料

### 车队长功能
- [ ] 查看司机列表
- [ ] 审批请假申请
- [ ] 查看计件工作报表
- [ ] 管理仓库分类
- [ ] 查看数据汇总

### 平级管理员功能
- [ ] 管理车队长
- [ ] 管理司机
- [ ] 查看所有数据（除老板资料）
- [ ] 审批请假
- [ ] 查看报表

### 老板功能
- [ ] 管理所有用户
- [ ] 查看所有数据
- [ ] 配置系统权限
- [ ] 管理仓库
- [ ] 管理车辆
- [ ] 查看完整报表

## 🔧 开发调试

### 启动开发服务器

```bash
# 小程序开发
pnpm run dev:weapp

# H5 开发
pnpm run dev:h5
```

### 构建生产版本

```bash
# 构建小程序
pnpm run build:weapp

# 构建 H5
pnpm run build:h5
```

### 代码检查

```bash
# 运行 lint 检查
pnpm run lint
```

## 📚 相关文档

- [测试租户创建说明](./测试租户创建说明.md) - 详细的测试租户创建和使用说明
- [多租户架构说明](./MULTI_TENANT_ARCHITECTURE.md) - 多租户系统架构文档
- [账号类型和权限](./ACCOUNT_TYPES_AND_PERMISSIONS.md) - 角色权限说明
- [开发者指南](./docs/DEVELOPER_GUIDE.md) - 开发者文档
- [用户手册](./docs/USER_MANUAL.md) - 用户使用手册

## ⚠️ 重要提示

### 开发环境
- ✅ 可以使用快捷登录功能
- ✅ 可以使用测试账号
- ✅ 可以使用账号名登录

### 生产环境
- ❌ 必须删除快捷登录功能
- ❌ 必须删除测试租户和测试账号
- ❌ 必须删除账号名映射配置
- ✅ 只允许使用手机号或邮箱登录

## 🐛 常见问题

### Q1：创建租户失败怎么办？
**A**：检查以下几点：
1. 确认 `.env` 文件中的环境变量配置正确
2. 确认 `create-tenant` Edge Function 已部署
3. 检查数据库连接是否正常
4. 查看控制台错误信息

### Q2：登录后看不到数据？
**A**：可能的原因：
1. 租户 schema 未正确创建
2. RLS 策略配置错误
3. 用户的 tenant_id 不正确
4. 数据库权限问题

### Q3：快捷登录不显示账号列表？
**A**：检查：
1. 测试租户是否已创建
2. 数据库连接是否正常
3. 浏览器控制台是否有错误信息

### Q4：账号名登录失败？
**A**：确认：
1. 账号名拼写是否正确
2. 密码是否为 `123456`
3. 账号映射配置是否正确
4. 账号是否已创建

## 📞 技术支持

如果遇到问题，请：
1. 查看相关文档
2. 检查控制台错误信息
3. 查看数据库日志
4. 联系开发团队

---

**最后更新**：2025-11-29  
**维护团队**：车队管家开发团队
