# 计件报表完成率显示优化

## 更新时间
2025-11-05

## 功能描述

优化双管理端（普通管理端和超级管理端）计件报表页面中"司机汇总"部分的百分比统计显示方式，根据不同的完成率区间，为单元格设置不同的背景色和文字颜色进行视觉区分，并添加状态说明文字。

## 修改内容

### 1. 新增完成率状态判断函数

在两个文件中都添加了 `getCompletionRateStatus` 函数：
- `src/pages/manager/piece-work-report/index.tsx`
- `src/pages/super-admin/piece-work-report/index.tsx`

```typescript
// 完成率状态判断和样式配置
interface CompletionRateStatus {
  label: string // 状态文字
  bgColor: string // 背景色
  textColor: string // 文字颜色
  ringColor: string // 圆环颜色
  badgeBgColor: string // 徽章背景色
}

const getCompletionRateStatus = (rate: number): CompletionRateStatus => {
  if (rate > 110) {
    // 超额完成
    return {
      label: '超额完成',
      bgColor: '#dcfce7', // green-100
      textColor: '#15803d', // green-700
      ringColor: '#10b981', // green-500
      badgeBgColor: 'linear-gradient(135deg, #10b981, #059669)' // green-500 to green-600
    }
  }
  if (rate >= 100) {
    // 达标
    return {
      label: '达标',
      bgColor: '#dbeafe', // blue-100
      textColor: '#1e40af', // blue-700
      ringColor: '#3b82f6', // blue-500
      badgeBgColor: 'linear-gradient(135deg, #3b82f6, #2563eb)' // blue-500 to blue-600
    }
  }
  if (rate >= 70) {
    // 不达标
    return {
      label: '不达标',
      bgColor: '#fed7aa', // orange-200
      textColor: '#c2410c', // orange-700
      ringColor: '#f97316', // orange-500
      badgeBgColor: 'linear-gradient(135deg, #f97316, #ea580c)' // orange-500 to orange-600
    }
  }
  // 严重不达标
  return {
    label: '严重不达标',
    bgColor: '#fecaca', // red-200
    textColor: '#b91c1c', // red-700
    ringColor: '#ef4444', // red-500
    badgeBgColor: 'linear-gradient(135deg, #ef4444, #dc2626)' // red-500 to red-600
  }
}
```

### 2. 优化司机汇总卡片显示

#### 修改前
- 只有达标（≥100%）的司机显示绿色徽章
- 圆环颜色只有三种：绿色（≥100%）、橙色（≥80%）、红色（<80%）
- 百分比显示在圆环中心，格式为"数字"和"%"分开显示
- 没有明确的状态文字说明

#### 修改后
- **状态徽章**：所有司机都显示状态徽章，根据完成率显示不同颜色和图标
  - 超额完成（>110%）：绿色渐变 + 奖杯图标
  - 达标（100%-110%）：蓝色渐变 + 对勾图标
  - 不达标（70%-99%）：橙色渐变 + 警告图标
  - 严重不达标（<70%）：红色渐变 + 严重警告图标

- **圆环进度**：颜色与状态对应
  - 超额完成：绿色（#10b981）
  - 达标：蓝色（#3b82f6）
  - 不达标：橙色（#f97316）
  - 严重不达标：红色（#ef4444）

- **完成率状态卡片**（新增）：
  - 显示完成率百分比（保留一位小数）
  - 显示状态文字说明
  - 背景色和文字颜色与状态对应

## 状态划分标准

### 1. 超额完成（> 110%）
- **视觉标识**：绿色系
- **徽章背景**：绿色渐变（#10b981 → #059669）
- **徽章图标**：奖杯（i-mdi-trophy）
- **状态卡片背景**：浅绿色（#dcfce7）
- **状态卡片文字**：深绿色（#15803d）
- **圆环颜色**：绿色（#10b981）
- **状态文字**："超额完成"

### 2. 达标（100% - 110%）
- **视觉标识**：蓝色系
- **徽章背景**：蓝色渐变（#3b82f6 → #2563eb）
- **徽章图标**：对勾（i-mdi-check-circle）
- **状态卡片背景**：浅蓝色（#dbeafe）
- **状态卡片文字**：深蓝色（#1e40af）
- **圆环颜色**：蓝色（#3b82f6）
- **状态文字**："达标"

### 3. 不达标（70% - 99%）
- **视觉标识**：橙色系
- **徽章背景**：橙色渐变（#f97316 → #ea580c）
- **徽章图标**：警告圆圈（i-mdi-alert-circle）
- **状态卡片背景**：橙色（#fed7aa）
- **状态卡片文字**：深橙色（#c2410c）
- **圆环颜色**：橙色（#f97316）
- **状态文字**："不达标"

### 4. 严重不达标（< 70%）
- **视觉标识**：红色系
- **徽章背景**：红色渐变（#ef4444 → #dc2626）
- **徽章图标**：严重警告八边形（i-mdi-alert-octagon）
- **状态卡片背景**：浅红色（#fecaca）
- **状态卡片文字**：深红色（#b91c1c）
- **圆环颜色**：红色（#ef4444）
- **状态文字**："严重不达标"

## 界面效果

### 司机汇总卡片布局

```
┌─────────────────────────────────────────────┐
│  👤 张三                    [超额完成 🏆]    │  ← 司机信息 + 状态徽章
│     138****1234                             │
│     仓库A、仓库B                             │
├─────────────────────────────────────────────┤
│  ⭕ 120%    ┌─────────────────────┐         │  ← 圆环进度 + 状态卡片
│             │ 完成率      120.5%  │         │
│             │ 超额完成            │         │
│             └─────────────────────┘         │
│             完成件数  121 / 100 件          │
├─────────────────────────────────────────────┤
│  [出勤天数]  [迟到天数]  [请假天数]         │  ← 考勤统计
│     22          1          0               │
└─────────────────────────────────────────────┘
```

### 不同状态的视觉效果

#### 超额完成（120%）
```
┌─────────────────────────────────────────────┐
│  👤 张三                    [超额完成 🏆]    │  ← 绿色渐变徽章
│  ⭕ 120%    ┌─────────────────────┐         │  ← 绿色圆环
│             │ 完成率      120.5%  │         │  ← 浅绿色背景
│             │ 超额完成            │         │     深绿色文字
│             └─────────────────────┘         │
└─────────────────────────────────────────────┘
```

#### 达标（105%）
```
┌─────────────────────────────────────────────┐
│  👤 李四                    [达标 ✓]        │  ← 蓝色渐变徽章
│  ⭕ 105%    ┌─────────────────────┐         │  ← 蓝色圆环
│             │ 完成率      105.0%  │         │  ← 浅蓝色背景
│             │ 达标                │         │     深蓝色文字
│             └─────────────────────┘         │
└─────────────────────────────────────────────┘
```

#### 不达标（85%）
```
┌─────────────────────────────────────────────┐
│  👤 王五                    [不达标 ⚠]      │  ← 橙色渐变徽章
│  ⭕ 85%     ┌─────────────────────┐         │  ← 橙色圆环
│             │ 完成率       85.0%  │         │  ← 橙色背景
│             │ 不达标              │         │     深橙色文字
│             └─────────────────────┘         │
└─────────────────────────────────────────────┘
```

#### 严重不达标（50%）
```
┌─────────────────────────────────────────────┐
│  👤 赵六                [严重不达标 ⛔]      │  ← 红色渐变徽章
│  ⭕ 50%     ┌─────────────────────┐         │  ← 红色圆环
│             │ 完成率       50.0%  │         │  ← 浅红色背景
│             │ 严重不达标          │         │     深红色文字
│             └─────────────────────┘         │
└─────────────────────────────────────────────┘
```

## 设计理念

### 1. 视觉层次清晰
- **徽章**：最醒目，一眼看出司机状态
- **圆环**：直观显示完成进度
- **状态卡片**：详细显示完成率和状态说明
- **考勤数据**：补充信息

### 2. 颜色语义明确
- **绿色**：超额完成，表示优秀
- **蓝色**：达标，表示正常
- **橙色**：不达标，表示预警
- **红色**：严重不达标，表示警示

### 3. 信息完整性
- **百分比格式**：数值与%直接相连（如"95%"）
- **状态文字**：明确说明当前状态
- **完成件数**：显示具体完成情况
- **考勤数据**：提供出勤背景信息

### 4. 用户体验优化
- **快速识别**：通过颜色和图标快速识别司机状态
- **详细信息**：点击卡片查看详细记录
- **一致性**：普通管理端和超级管理端保持一致

## 技术实现

### 1. 状态判断逻辑
```typescript
const status = getCompletionRateStatus(summary.completionRate || 0)
```

### 2. 动态样式应用
```typescript
// 徽章背景
style={{background: status.badgeBgColor}}

// 圆环颜色
style={{
  background: `conic-gradient(${status.ringColor} ${Math.min(summary.completionRate || 0, 100) * 3.6}deg, #e5e7eb 0deg)`
}}

// 状态卡片
style={{backgroundColor: status.bgColor}}
style={{color: status.textColor}}
```

### 3. 图标动态选择
```typescript
className={`${
  status.label === '超额完成'
    ? 'i-mdi-trophy'
    : status.label === '达标'
      ? 'i-mdi-check-circle'
      : status.label === '不达标'
        ? 'i-mdi-alert-circle'
        : 'i-mdi-alert-octagon'
} text-white text-sm`}
```

## 使用场景

### 1. 普通管理端
- 管理员可以快速识别哪些司机超额完成、达标、不达标或严重不达标
- 通过颜色编码，一眼看出整体完成情况
- 帮助管理员及时发现需要关注的司机

### 2. 超级管理端
- 超级管理员可以跨仓库查看司机完成情况
- 通过统一的颜色标准，对比不同仓库的司机表现
- 为人员调配和绩效管理提供数据支持

## 边界情况处理

### 1. 完成率为 0%
- 状态：严重不达标
- 显示：红色系，"0.0%"

### 2. 完成率为 100%
- 状态：达标
- 显示：蓝色系，"100.0%"

### 3. 完成率为 110%
- 状态：达标（边界值）
- 显示：蓝色系，"110.0%"

### 4. 完成率为 111%
- 状态：超额完成
- 显示：绿色系，"111.0%"

### 5. 完成率超过 200%
- 状态：超额完成
- 圆环：显示为满圆（100%）
- 百分比：显示实际值（如"250.0%"）

## 测试建议

### 测试场景

1. **超额完成测试**
   - 完成率 = 111% → 验证显示绿色系 + "超额完成"
   - 完成率 = 150% → 验证显示绿色系 + "超额完成"
   - 完成率 = 200% → 验证圆环满圆 + 百分比显示"200.0%"

2. **达标测试**
   - 完成率 = 100% → 验证显示蓝色系 + "达标"
   - 完成率 = 105% → 验证显示蓝色系 + "达标"
   - 完成率 = 110% → 验证显示蓝色系 + "达标"

3. **不达标测试**
   - 完成率 = 70% → 验证显示橙色系 + "不达标"
   - 完成率 = 85% → 验证显示橙色系 + "不达标"
   - 完成率 = 99% → 验证显示橙色系 + "不达标"

4. **严重不达标测试**
   - 完成率 = 0% → 验证显示红色系 + "严重不达标"
   - 完成率 = 50% → 验证显示红色系 + "严重不达标"
   - 完成率 = 69% → 验证显示红色系 + "严重不达标"

5. **视觉一致性测试**
   - 验证普通管理端和超级管理端显示一致
   - 验证颜色、图标、文字与设计规范一致
   - 验证不同状态之间的视觉区分度

6. **交互测试**
   - 点击卡片，验证能正确跳转到司机详情页
   - 验证状态徽章、圆环、状态卡片的显示正确

## 相关功能

### 计件报表系统
- 司机汇总统计
- 完成率计算
- 考勤数据关联

### 绩效管理
- 完成率评估
- 状态分类
- 绩效预警

### 数据可视化
- 圆环进度图
- 颜色编码
- 状态徽章

## 未来优化建议

### 1. 完成率趋势
- 显示完成率的变化趋势（上升/下降箭头）
- 与上周或上月对比

### 2. 自定义阈值
- 允许管理员自定义各状态的百分比阈值
- 例如：将"达标"阈值从100%调整为95%

### 3. 批量操作
- 按状态筛选司机
- 批量导出不同状态的司机列表

### 4. 通知提醒
- 当司机状态变为"严重不达标"时，自动发送通知
- 提醒管理员及时关注

### 5. 历史记录
- 查看司机历史完成率变化
- 生成完成率趋势图表

## 总结

✅ **功能完成**
- 普通管理端计件报表已优化完成率显示
- 超级管理端计件报表已优化完成率显示
- 实现了四种状态的视觉区分

✅ **代码质量**
- 代码结构清晰，易于维护
- 状态判断逻辑统一
- 样式配置集中管理

✅ **用户体验**
- 视觉层次清晰
- 颜色语义明确
- 信息完整准确
- 快速识别状态

✅ **设计规范**
- 颜色使用符合设计规范
- 图标选择恰当
- 布局合理美观

---

**修改人员**: AI 助手
**修改时间**: 2025-11-05
**修改状态**: ✅ 完成
