# 如何创建测试租户

由于 Edge Function 存在一些问题，我们建议通过中央管理系统的界面来创建测试租户。

## 方法一：通过中央管理系统界面创建（推荐）

### 步骤 1：登录中央管理系统

1. 打开登录页面
2. 使用中央管理员账号登录：
   - 账号：`admin` 或 `13800000001`
   - 密码：`123456`

### 步骤 2：创建租户1

1. 进入中央管理系统
2. 点击"租户管理"
3. 点击"创建租户"按钮
4. 填写租户信息：
   - **公司名称**：测试租户1
   - **老板姓名**：老板1
   - **老板手机号**：13900000001
   - **老板账号**：admin1（系统会自动生成）
   - **密码**：123456
   - **确认密码**：123456
5. 点击"创建租户"按钮
6. 等待创建完成

### 步骤 3：创建租户2

重复步骤 2，使用以下信息：
- **公司名称**：测试租户2
- **老板姓名**：老板2
- **老板手机号**：13900000002
- **老板账号**：admin2（系统会自动生成）
- **密码**：123456
- **确认密码**：123456

### 步骤 4：为每个租户添加其他用户

#### 租户1 的用户

1. 使用 `admin1` / `123456` 登录
2. 进入"用户管理"页面
3. 添加以下用户：

**平级管理员1**：
- 姓名：平级管理员1
- 手机号：13900000011
- 角色：平级管理员（peer_admin）
- 密码：123456

**车队长1**：
- 姓名：车队长1
- 手机号：13900000111
- 角色：车队长（manager）
- 密码：123456

**司机1**：
- 姓名：司机1
- 手机号：13900001111
- 角色：司机（driver）
- 密码：123456

#### 租户2 的用户

1. 退出登录
2. 使用 `admin2` / `123456` 登录
3. 进入"用户管理"页面
4. 添加以下用户：

**平级管理员2**：
- 姓名：平级管理员2
- 手机号：13900000022
- 角色：平级管理员（peer_admin）
- 密码：123456

**车队长2**：
- 姓名：车队长2
- 手机号：13900000222
- 角色：车队长（manager）
- 密码：123456

**司机2**：
- 姓名：司机2
- 手机号：13900002222
- 角色：司机（driver）
- 密码：123456

### 步骤 5：更新登录页面的账号映射

创建完所有用户后，需要更新登录页面的账号映射配置，使快捷登录功能可以使用账号名登录。

编辑 `src/pages/login/index.tsx` 文件，找到 `accountMapping` 对象，添加以下映射：

```typescript
const accountMapping: Record<string, string> = {
  admin: '13800000001', // 中央管理系统管理员
  // 租户1 测试账号
  admin1: '13900000001',
  admin11: '13900000011',
  admin111: '13900000111',
  admin1111: '13900001111',
  // 租户2 测试账号
  admin2: '13900000002',
  admin22: '13900000022',
  admin222: '13900000222',
  admin2222: '13900002222'
}
```

## 方法二：通过数据库直接创建（高级用户）

如果你熟悉数据库操作，可以直接在 Supabase 控制台中执行 SQL 语句来创建租户和用户。

### 创建租户1

```sql
-- 1. 创建租户记录
INSERT INTO public.tenants (company_name, tenant_code, schema_name, status)
VALUES ('测试租户1', 'tenant-test1', 'tenant_test1', 'active')
RETURNING id;

-- 记录返回的 tenant_id，例如：'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'

-- 2. 创建租户 Schema
SELECT create_tenant_schema('tenant_test1');

-- 3. 创建老板账号（需要使用 Supabase Auth Admin API）
-- 这一步需要通过界面或 API 完成，无法直接通过 SQL 创建
```

### 创建用户

创建租户后，需要通过界面或 API 创建用户账号。

## 测试账号列表

创建完成后，你将拥有以下测试账号：

### 中央管理系统
- 账号：`admin` / `13800000001`
- 密码：`123456`
- 角色：中央管理员

### 租户1：测试租户1
- 老板：`admin1` / `13900000001` / `123456`
- 平级管理员：`admin11` / `13900000011` / `123456`
- 车队长：`admin111` / `13900000111` / `123456`
- 司机：`admin1111` / `13900001111` / `123456`

### 租户2：测试租户2
- 老板：`admin2` / `13900000002` / `123456`
- 平级管理员：`admin22` / `13900000022` / `123456`
- 车队长：`admin222` / `13900000222` / `123456`
- 司机：`admin2222` / `13900002222` / `123456`

## 使用快捷登录

创建完所有账号后，你可以使用登录页面的"🧪 开发测试 - 快速登录"功能：

1. 打开登录页面
2. 点击"🧪 开发测试 - 快速登录"展开测试账号列表
3. 选择要测试的租户和角色
4. 点击对应的账号卡片
5. 系统会自动填充账号和密码
6. 点击"密码登录"按钮完成登录

## 常见问题

### Q1：创建租户时提示"手机号已被注册"
**A**：请使用不同的手机号，或者先删除已存在的账号。

### Q2：创建租户失败
**A**：可能的原因：
1. 数据库连接问题
2. Edge Function 未正确部署
3. 权限配置问题

建议通过界面创建，系统会提供更详细的错误信息。

### Q3：无法登录测试账号
**A**：确认：
1. 账号是否已创建成功
2. 密码是否正确（默认：123456）
3. 账号映射配置是否正确

### Q4：快捷登录不显示账号列表
**A**：检查：
1. 是否已展开快捷登录区域
2. 浏览器控制台是否有错误信息
3. 账号列表配置是否正确

## 下一步

创建完测试租户后，你可以：

1. 测试多租户数据隔离
2. 测试不同角色的权限
3. 测试跨租户访问控制
4. 开发和调试新功能

详细的测试场景请参考 [快速开始指南](./快速开始.md)。

---

**最后更新**：2025-11-29  
**维护团队**：车队管家开发团队
