# 如何创建测试租户

## ✅ 第一步：创建租户和 Schema（已完成）

租户记录和 Schema 已经通过脚本创建成功：

- **租户1**：测试租户1 (tenant_test1)
  - 租户 ID: 26d10bc2-d13b-44b0-ac9f-dec469cfadc9
  
- **租户2**：测试租户2 (tenant_test2)
  - 租户 ID: 52ff28a4-5edc-46eb-bc94-69252cadaf97

## 📝 第二步：创建用户账号

### 方法一：通过中央管理系统界面创建（推荐）⭐

这是最简单、最安全的方法。

#### 1. 登录中央管理系统

1. 打开登录页面
2. 使用中央管理员账号登录：
   - 账号：`admin` 或 `13800000001`
   - 密码：`123456`

#### 2. 为租户1创建老板账号

1. 进入"租户管理"页面
2. 找到"测试租户1"
3. 点击"创建老板账号"或"编辑"按钮
4. 填写老板信息：
   - **姓名**：老板1
   - **手机号**：13900000001
   - **密码**：123456
   - **确认密码**：123456
5. 点击"创建"按钮

#### 3. 为租户2创建老板账号

重复步骤2，使用以下信息：
- **姓名**：老板2
- **手机号**：13900000002
- **密码**：123456
- **确认密码**：123456

#### 4. 为租户1添加其他用户

1. 退出中央管理系统
2. 使用租户1老板账号登录：
   - 账号：`admin1` 或 `13900000001`
   - 密码：`123456`
3. 进入"用户管理"页面
4. 点击"添加用户"按钮
5. 依次创建以下用户：

**平级管理员1**：
- 姓名：平级管理员1
- 手机号：13900000011
- 角色：平级管理员（peer_admin）
- 密码：123456

**车队长1**：
- 姓名：车队长1
- 手机号：13900000111
- 角色：车队长（manager）
- 密码：123456

**司机1**：
- 姓名：司机1
- 手机号：13900001111
- 角色：司机（driver）
- 密码：123456

#### 5. 为租户2添加其他用户

1. 退出登录
2. 使用租户2老板账号登录：
   - 账号：`admin2` 或 `13900000002`
   - 密码：`123456`
3. 进入"用户管理"页面
4. 依次创建以下用户：

**平级管理员2**：
- 姓名：平级管理员2
- 手机号：13900000022
- 角色：平级管理员（peer_admin）
- 密码：123456

**车队长2**：
- 姓名：车队长2
- 手机号：13900000222
- 角色：车队长（manager）
- 密码：123456

**司机2**：
- 姓名：司机2
- 手机号：13900002222
- 角色：司机（driver）
- 密码：123456

### 方法二：通过 Supabase Dashboard 创建

如果中央管理系统的创建功能有问题，可以直接在 Supabase Dashboard 中创建用户。

#### 1. 打开 Supabase Dashboard

1. 访问 Supabase 项目控制台
2. 进入 Authentication > Users

#### 2. 创建租户1的老板账号

1. 点击"Add user"按钮
2. 选择"Create new user"
3. 填写信息：
   - **Phone**：13900000001
   - **Password**：123456
   - **Email**：admin1@fleet.local（可选）
   - **Auto Confirm User**：✅ 勾选
4. 点击"Create user"
5. 记录创建的用户 ID

#### 3. 在租户 Schema 中创建 profile

创建用户后，需要在租户的 Schema 中创建对应的 profile 记录。

在 SQL Editor 中执行：

```sql
-- 替换 USER_ID 为实际的用户 ID
INSERT INTO tenant_test1.profiles (id, name, phone, role, status)
VALUES (
  'USER_ID',  -- 替换为实际的用户 ID
  '老板1',
  '13900000001',
  'boss',
  'active'
);
```

#### 4. 更新租户记录

```sql
UPDATE public.tenants
SET 
  boss_user_id = 'USER_ID',  -- 替换为实际的用户 ID
  boss_name = '老板1',
  boss_phone = '13900000001'
WHERE id = '26d10bc2-d13b-44b0-ac9f-dec469cfadc9';
```

#### 5. 重复步骤2-4创建其他用户

对于每个用户，都需要：
1. 在 Authentication 中创建用户
2. 在对应租户的 Schema 中创建 profile
3. 如果是老板，更新租户记录

### 方法三：使用 SQL 批量创建（高级用户）

如果你熟悉 SQL，可以使用以下脚本批量创建用户。

⚠️ **注意**：此方法需要手动处理密码哈希，比较复杂，不推荐使用。

建议使用方法一或方法二。

## 测试账号列表

创建完成后，你将拥有以下测试账号：

### 中央管理系统
- 账号：`admin` / `13800000001`
- 密码：`123456`
- 角色：中央管理员

### 租户1：测试租户1
- 老板：`admin1` / `13900000001` / `123456`
- 平级管理员：`admin11` / `13900000011` / `123456`
- 车队长：`admin111` / `13900000111` / `123456`
- 司机：`admin1111` / `13900001111` / `123456`

### 租户2：测试租户2
- 老板：`admin2` / `13900000002` / `123456`
- 平级管理员：`admin22` / `13900000022` / `123456`
- 车队长：`admin222` / `13900000222` / `123456`
- 司机：`admin2222` / `13900002222` / `123456`

## 使用快捷登录

创建完所有账号后，你可以使用登录页面的"🧪 开发测试 - 快速登录"功能：

1. 打开登录页面
2. 点击"🧪 开发测试 - 快速登录"展开测试账号列表
3. 选择要测试的租户和角色
4. 点击对应的账号卡片
5. 系统会自动填充账号和密码
6. 点击"密码登录"按钮完成登录

## 常见问题

### Q1：创建租户时提示"手机号已被注册"
**A**：请使用不同的手机号，或者先删除已存在的账号。

### Q2：创建租户失败
**A**：可能的原因：
1. 数据库连接问题
2. Edge Function 未正确部署
3. 权限配置问题

建议通过界面创建，系统会提供更详细的错误信息。

### Q3：无法登录测试账号
**A**：确认：
1. 账号是否已创建成功
2. 密码是否正确（默认：123456）
3. 账号映射配置是否正确

### Q4：快捷登录不显示账号列表
**A**：检查：
1. 是否已展开快捷登录区域
2. 浏览器控制台是否有错误信息
3. 账号列表配置是否正确

## 下一步

创建完测试租户后，你可以：

1. 测试多租户数据隔离
2. 测试不同角色的权限
3. 测试跨租户访问控制
4. 开发和调试新功能

详细的测试场景请参考 [快速开始指南](./快速开始.md)。

---

**最后更新**：2025-11-29  
**维护团队**：车队管家开发团队
