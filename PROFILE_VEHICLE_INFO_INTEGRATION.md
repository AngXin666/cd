# 个人信息与车辆证件信息整合说明

## 修改概述

1. 司机个人信息页面增强
**文件**: `src/pages/driver/profile/index.tsx`

#### 新增功能
1. **加载车辆信息**
   - 同时加载个人资料和车辆信息
   - 使用 `getDriverVehicles` API 获取司机的所有车辆
   - 显示第一辆车的证件信息

2. **证件信息卡片**
   - 显示来自行驶证的证件信息
   - 包含字段：
     - 车主姓名
     - 车牌号
     - 车辆识别代号（VIN）
     - 注册日期
     - 发证日期
     - 检验有效期

3. **行驶证照片卡片**
   - 显示行驶证主页照片
   - 显示行驶证副页照片
   - 显示行驶证副页背页照片
   - 使用 Supabase Storage 获取图片公共URL

#### 技术实现
```typescript
// 加载车辆信息
const vehicleData = await getDriverVehicles(user.id)
setVehicles(vehicleData)

// 获取第一辆车的信息
const firstVehicle = vehicles.length > 0 ? vehicles[0] : null

// 获取图片公共URL
const getImageUrl = (path: string | null): string => {
  if (!path) return ''
  const {data} = supabase.storage
    .from(process.env.TARO_APP_APP_ID + '_vehicle_images')
    .getPublicUrl(path)
  return data.publicUrl
}
```

### 2. 车辆详情页面简化
**文件**: `src/pages/driver/vehicle-detail/index.tsx`

#### 移除内容
1. **基本信息卡片中移除**
   - 删除"所有人"信息行

2. **完全移除的卡片**
   - 驾驶员信息卡片（包含身份证信息、驾驶证信息、证件照片）
   - 约130行代码被移除

#### 保留内容
- 车辆基本信息（车辆类型、VIN、使用性质、注册日期、发证日期）
- 车辆照片（7个角度）
- 行驶证照片（主页、副页、副页背页）
- 技术参数
- 其他车辆相关信息

## 用户体验改进

### 个人信息页面
1. **信息集中化**
   - 所有个人相关信息集中在一个页面
   - 包括基本信息、证件信息和证件照片
   - 便于司机查看和管理个人资料

2. **数据来源说明**
   - 明确标注证件信息来自车辆行驶证
   - 避免用户混淆数据来源

3. **视觉层次清晰**
   - 使用不同颜色的图标区分不同类型的信息
   - 基本信息（蓝色）
   - 证件信息（绿色）
   - 行驶证照片（紫色）

### 车辆详情页面
1. **内容聚焦**
   - 专注于车辆本身的信息
   - 移除与司机个人相关的信息
   - 页面更加简洁清晰

2. **减少冗余**
   - 避免在多个页面重复显示相同信息
   - 提升页面加载速度

## 数据流程

```
>

tUserProfile)
  ↓
 ↓

git config --global user.name  Supabase Storage 获取）
```

## 页面布局

### 个人信息页面结构
```

  页面标题卡片                    │
  - 个人信息                      │
  - 返回按钮                      │



  基本信息卡片                    │
  - 姓名（可编辑）                │
  - 手机号（可编辑）              │
  - 邮箱（可编辑）                │
  - 角色（只读）                  │
  - 注册时间（只读）              │



  证件信息卡片                    │
  （来自车辆行驶证）              │
  - 车主姓名                      │
  - 车牌号                        │
  - 车辆识别代号                  │
  - 注册日期                      │
  - 发证日期                      │
  - 检验有效期                    │



  行驶证照片卡片                  │
  - 行驶证主页                    │
  - 行驶证副页                    │
  - 行驶证副页背页                │



  温馨提示                        │

```

### 车辆详情页面结构（简化后）
```

  页面标题卡片                    │
  - 车牌号                        │
  - 品牌型号                      │



  基本信息卡片                    │
  - 车辆类型                      │
  - 车辆识别代号                  │
  - 使用性质                      │
  - 注册日期                      │
  - 发证日期                      │
  （移除：所有人）                │


                  │
  - 7个角度的车辆照片             │



  行驶证照片卡片                  │
  - 行驶证主页、副页、副页背页    │



  其他信息...                     │

```

## 注意事项

1. **数据依赖**
   - 证件信息依赖于车辆数据
   - 如果司机没有添加车辆，证件信息卡片不会显示

2. **图片加载**
   - 使用 Supabase Storage 的公共URL
   - 确保图片路径正确
   - 图片加载失败时不会影响页面其他功能

3. **性能优化**
   - 使用 `useCallback` 包装异步函数
   - 避免不必要的重新渲染

4. **用户引导**
   - 在证件信息卡片标题旁标注"（来自车辆行驶证）"
   - 帮助用户理解数据来源

## 测试建议

1. **功能测试**
   - 测试有车辆的司机能否正确显示证件信息
   - 测试无车辆的司机页面是否正常
   - 测试图片加载是否正常

2. **UI测试**
   - 验证页面布局是否美观
   - 验证信息层次是否清晰
   - 验证响应式设计是否正常

3. **性能测试**
   - 测试页面加载速度
   - 测试图片加载性能
   - 测试数据刷新是否流畅
