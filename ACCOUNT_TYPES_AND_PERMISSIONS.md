# 账号类型和权限体系

本文档详细说明了车队管家小程序中的五种账号类型及其权限范围。

---

## 账号类型概览

| 账号类型 | 角色代码 | 权限范围 | 主要职责 |
|---------|---------|---------|---------|
| 超级管理员 | `super_admin` | 中央管理系统 | 管理所有租户 |
| 老板 | `boss` | 租户系统全部 | 租户最高权限 |
| 平级账号 | `peer` | 租户系统全部/部分 | 协助老板管理 |
| 车队长 | `manager` | 指定仓库范围 | 管理车队和司机 |
| 司机 | `driver` | 个人数据 | 日常操作 |

---

## 1. 超级管理员（super_admin）

### 权限范围
- ✅ 管理所有租户（创建、编辑、停用、删除）
- ✅ 查看所有租户的基本信息
- ✅ 管理租户配置（Supabase URL、Anon Key）
- ❌ 不能直接操作租户的业务数据

### 主要功能
1. **租户管理**
   - 创建新租户
   - 编辑租户信息
   - 停用/激活租户
   - 删除租户

2. **系统监控**
   - 查看租户列表
   - 查看租户状态
   - 管理租户配置

### 登录方式
- 手机号：13800000001
- 密码：hye19911206
- 快捷账号：admin

### 使用场景
- 系统管理员
- 平台运营人员
- 技术支持人员

---

## 2. 老板（boss）

### 权限范围
- ✅ 租户系统的最高权限
- ✅ 管理所有仓库、车队、司机
- ✅ 创建和管理平级账号（最多3个）
- ✅ 创建和管理车队长账号
- ✅ 创建和管理司机账号
- ✅ 查看和审批所有请假、离职申请
- ✅ 查看所有数据统计和报表

### 主要功能
1. **账号管理**
   - 创建平级账号（最多3个）
   - 创建车队长账号
   - 创建司机账号
   - 编辑和删除账号
   - 设置账号权限

2. **业务管理**
   - 管理所有仓库
   - 管理所有车队
   - 管理所有司机
   - 审批请假申请
   - 审批离职申请

3. **数据查看**
   - 查看所有统计数据
   - 查看所有报表
   - 查看所有考勤记录
   - 查看所有计件记录

### 创建方式
- 创建租户时自动创建老板账号
- 每个租户只有一个老板账号

### 使用场景
- 车队老板
- 公司负责人
- 最高决策者

---

## 3. 平级账号（peer）

### 权限类型

#### 3.1 完整权限（full_access）
- ✅ 拥有与老板相同的所有权限
- ✅ 管理所有仓库、车队、司机
- ✅ 创建和管理车队长账号
- ✅ 创建和管理司机账号
- ✅ 查看和审批所有请假、离职申请
- ✅ 查看所有数据统计和报表
- ❌ 不能管理平级账号

#### 3.2 只读权限（read_only）
- ✅ 查看所有仓库、车队、司机信息
- ✅ 查看所有请假、离职申请
- ✅ 查看所有数据统计和报表
- ❌ 不能创建、编辑、删除任何数据
- ❌ 不能审批申请

### 主要功能
1. **完整权限账号**
   - 与老板权限相同（除了管理平级账号）
   - 可以独立管理业务
   - 可以审批申请

2. **只读权限账号**
   - 只能查看数据
   - 不能修改任何数据
   - 适合监督和审计

### 创建方式
- 由老板创建
- 每个租户最多3个平级账号
- 创建时指定权限类型

### 使用场景
- **完整权限**：合伙人、副总经理、业务负责人
- **只读权限**：财务人员、审计人员、监督人员

---

## 4. 车队长（manager）

### 权限类型

#### 4.1 完整权限（full_access）
- ✅ 管理指定仓库范围内的所有数据
- ✅ 创建和管理司机账号
- ✅ 审批管辖范围内的请假、离职申请
- ✅ 查看管辖范围内的所有数据
- ✅ 编辑和删除管辖范围内的数据

#### 4.2 只读权限（read_only）
- ✅ 查看管辖范围内的所有数据
- ❌ 不能创建、编辑、删除任何数据
- ❌ 不能审批申请

### 主要功能
1. **完整权限车队长**
   - 管理指定仓库的司机
   - 审批请假和离职申请
   - 管理考勤和计件数据
   - 查看统计报表

2. **只读权限车队长**
   - 查看指定仓库的数据
   - 监督业务运营
   - 不能修改数据

### 管辖范围
- 由老板或平级账号（完整权限）指定
- 可以管理一个或多个仓库
- 只能操作管辖范围内的数据

### 创建方式
- 由老板或平级账号（完整权限）创建
- 创建时指定管辖仓库
- 创建时指定权限类型

### 使用场景
- **完整权限**：车队长、仓库主管、区域经理
- **只读权限**：培训人员、实习主管

---

## 5. 司机（driver）

### 权限范围
- ✅ 查看和编辑自己的个人信息
- ✅ 提交请假申请
- ✅ 提交离职申请
- ✅ 查看自己的考勤记录
- ✅ 查看自己的计件记录
- ✅ 查看自己的统计数据
- ❌ 不能查看其他司机的数据
- ❌ 不能管理任何数据

### 主要功能
1. **个人信息管理**
   - 查看个人信息
   - 编辑个人信息

2. **申请提交**
   - 提交请假申请
   - 提交离职申请
   - 查看申请状态

3. **数据查看**
   - 查看自己的考勤记录
   - 查看自己的计件记录
   - 查看自己的统计数据

### 创建方式
- 由老板、平级账号（完整权限）或车队长（完整权限）创建
- 创建时指定所属仓库

### 使用场景
- 司机
- 基层操作人员
- 一线员工

---

## 权限矩阵

### 账号管理权限

| 操作 | 超级管理员 | 老板 | 平级（完整） | 平级（只读） | 车队长（完整） | 车队长（只读） | 司机 |
|-----|-----------|------|------------|------------|--------------|--------------|-----|
| 创建租户 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 创建平级账号 | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 创建车队长 | ❌ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 创建司机 | ❌ | ✅ | ✅ | ❌ | ✅ | ❌ | ❌ |
| 编辑账号 | ❌ | ✅ | ✅ | ❌ | ✅* | ❌ | ❌ |
| 删除账号 | ❌ | ✅ | ✅ | ❌ | ✅* | ❌ | ❌ |

*车队长只能编辑/删除管辖范围内的司机账号

### 业务管理权限

| 操作 | 超级管理员 | 老板 | 平级（完整） | 平级（只读） | 车队长（完整） | 车队长（只读） | 司机 |
|-----|-----------|------|------------|------------|--------------|--------------|-----|
| 管理仓库 | ❌ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 审批请假 | ❌ | ✅ | ✅ | ❌ | ✅* | ❌ | ❌ |
| 审批离职 | ❌ | ✅ | ✅ | ❌ | ✅* | ❌ | ❌ |
| 管理考勤 | ❌ | ✅ | ✅ | ❌ | ✅* | ❌ | ❌ |
| 管理计件 | ❌ | ✅ | ✅ | ❌ | ✅* | ❌ | ❌ |
| 提交请假 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| 提交离职 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |

*车队长只能管理管辖范围内的数据

### 数据查看权限

| 操作 | 超级管理员 | 老板 | 平级（完整） | 平级（只读） | 车队长（完整） | 车队长（只读） | 司机 |
|-----|-----------|------|------------|------------|--------------|--------------|-----|
| 查看所有数据 | ❌ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| 查看管辖数据 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| 查看个人数据 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看统计报表 | ❌ | ✅ | ✅ | ✅ | ✅* | ✅* | ✅** |

*车队长只能查看管辖范围内的统计报表  
**司机只能查看自己的统计数据

---

## 权限设计原则

### 1. 最小权限原则
- 每个账号只拥有完成其职责所需的最小权限
- 避免权限过度授予
- 降低安全风险

### 2. 分层管理原则
- 超级管理员 → 老板 → 平级账号 → 车队长 → 司机
- 上级可以管理下级
- 下级不能管理上级

### 3. 范围限制原则
- 车队长只能管理指定仓库范围内的数据
- 司机只能操作自己的数据
- 平级账号（只读）只能查看数据

### 4. 灵活配置原则
- 平级账号和车队长支持完整权限和只读权限
- 车队长可以管理多个仓库
- 权限可以根据业务需求调整

---

## 常见问题

### Q1: 如何创建第一个老板账号？
A: 创建租户时会自动创建老板账号，无需手动创建。

### Q2: 平级账号和老板有什么区别？
A: 平级账号（完整权限）拥有与老板相同的权限，但不能管理其他平级账号。

### Q3: 车队长可以管理多个仓库吗？
A: 可以，创建车队长时可以指定多个管辖仓库。

### Q4: 如何修改账号权限？
A: 由老板或平级账号（完整权限）在账号管理页面修改。

### Q5: 司机可以查看其他司机的数据吗？
A: 不可以，司机只能查看和操作自己的数据。

### Q6: 只读权限账号可以做什么？
A: 只读权限账号只能查看数据，不能创建、编辑、删除任何数据，也不能审批申请。

---

## 总结

车队管家小程序的权限体系设计遵循最小权限原则和分层管理原则，确保每个账号只拥有完成其职责所需的权限。通过灵活的权限配置，可以满足不同规模和不同管理模式的车队需求。

**关键特性**：
- ✅ 五种账号类型，满足不同角色需求
- ✅ 灵活的权限配置（完整权限/只读权限）
- ✅ 范围限制（车队长管辖仓库）
- ✅ 分层管理（上级管理下级）
- ✅ 安全可靠（最小权限原则）
