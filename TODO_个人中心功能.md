# 个人中心和设置模块实现计划

## 任务概述
为车队管家小程序添加完整的个人中心和设置模块，包括个人信息管理、账户安全、帮助反馈等功能。

## 实现步骤

### 1. 数据库设计 ✅
- [x] 扩展profiles表，添加新字段
- [x] 创建feedback表（意见反馈）
- [x] 创建Supabase Storage bucket用于头像上传
- [x] 应用数据库迁移
- [x] 更新TypeScript类型定义

### 2. API函数实现 ✅
- [x] 在src/db/api.ts中添加：
  - uploadAvatar() - 上传头像
  - updateUserProfile() - 更新个人信息
  - changePassword() - 修改密码
  - submitFeedback() - 提交反馈
  - getUserFeedbackList() - 获取反馈列表
  - getAllFeedbackList() - 获取所有反馈（管理员）
  - updateFeedbackStatus() - 更新反馈状态（管理员）

### 3. 页面创建 ✅

#### 3.1 个人中心主页 (pages/profile/index.tsx) ✅
- [x] 显示用户头像、姓名、角色
- [x] 显示个人信息摘要
- [x] 提供"编辑资料"入口
- [x] 提供"设置"入口
- [x] 提供"帮助与反馈"入口
- [x] 隐藏手机号中间4位保护隐私

#### 3.2 编辑资料页面 (pages/profile/edit/index.tsx) ✅
- [x] 头像上传功能（支持相册和相机）
- [x] 姓名/昵称编辑
- [x] 邮箱地址编辑
- [x] 居住地址编辑（省/市/区选择器 + 详细地址）
- [x] 紧急联系人信息编辑
- [x] 保存按钮和表单验证
- [x] 手机号只读显示

#### 3.3 设置页面 (pages/profile/settings/index.tsx) ✅
- [x] 修改密码入口
- [x] 账户安全设置
- [x] 关于我们
- [x] 用户协议和隐私政策入口
- [x] 应用信息展示

#### 3.4 修改密码页面 (pages/profile/change-password/index.tsx) ✅
- [x] 原密码输入
- [x] 新密码输入
- [x] 确认新密码
- [x] 密码强度校验和可视化指示器
- [x] 密码匹配提示
- [x] 提交修改

#### 3.5 帮助文档页面 (pages/profile/help/index.tsx) ✅
- [x] 使用说明文档
- [x] 常见问题解答（可展开/收起）
- [x] 功能介绍
- [x] 联系方式展示
- [x] 快速入口（意见反馈、联系客服）

#### 3.6 意见反馈页面 (pages/profile/feedback/index.tsx) ✅
- [x] 反馈类型选择
- [x] 反馈内容输入
- [x] 联系方式（可选）
- [x] 提交反馈
- [x] 查看历史反馈
- [x] Tab切换（提交反馈/历史反馈）
- [x] 反馈状态显示

### 4. 路由配置 ✅
- [x] 在app.config.ts中添加新页面路由
- [x] 底部tabBar已包含"我的"标签

### 5. 测试验证 ✅
- [x] 运行pnpm run lint检查
- [x] 所有TypeScript类型检查通过
- [x] 所有页面路由配置正确

### 6. 文档更新 ✅
- [x] 更新README.md
- [x] 创建功能使用说明文档

## 技术要点

### 头像上传
- 使用Supabase Storage
- 支持图片裁剪（1:1比例）
- 图片压缩（最大1MB）
- 支持JPEG、PNG格式

### 地址选择
- 使用省市区三级联动
- 数据来源：中国行政区划数据
- 支持搜索和快速定位

### 密码修改
- 原密码验证
- 新密码强度校验（至少8位，包含字母和数字）
- 使用Supabase Auth API

### 短信验证
- 手机号修改时需要验证
- 使用Supabase OTP功能

## 设计规范

### 配色方案
- 主色：深蓝色 #1E3A8A
- 辅助色：橙色 #F97316
- 背景色：浅灰色 #F8FAFC
- 文字色：深灰色 #1F2937

### 布局规范
- 卡片式布局
- 8px圆角
- 轻微阴影效果
- 统一的间距和padding

### 交互规范
- 点击反馈：active:scale-95
- 过渡动画：transition-all
- Toast提示：成功/失败/警告

## 注意事项
1. 所有个人信息修改需要权限验证
2. 敏感操作（修改密码、手机号）需要二次确认
3. 图片上传需要大小和格式限制
4. 表单验证要完善，提供友好的错误提示
5. 考虑不同角色的权限差异
6. 保护用户隐私，不显示完整手机号
