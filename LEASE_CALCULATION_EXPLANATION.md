# 租期计算说明

## 数据库验证结果

查询结果显示，**计算完全正确**：

```sql
SELECT 
  start_date,
  end_date,
  duration_months,
  -- PostgreSQL 计算的实际月份差
  EXTRACT(YEAR FROM AGE(end_date, start_date)) * 12 + 
  EXTRACT(MONTH FROM AGE(end_date, start_date)) as actual_months_diff
FROM leases;
```

结果：
| start_date | end_date | duration_months | actual_months_diff |
|------------|----------|-----------------|-------------------|
| 2025-11-25 | 2026-02-25 | 3 | **3** ✅ |

## 为什么从 2025-11-25 到 2026-02-25 是 3 个月？

### 逐月计算

```
起点：2025年11月25日
  ↓ 加1个月
第1个月后：2025年12月25日
  ↓ 加1个月
第2个月后：2026年1月25日
  ↓ 加1个月
第3个月后：2026年2月25日 ← 终点
```

### 日历对照

```
2025年11月
日 一 二 三 四 五 六
                  1  2
 3  4  5  6  7  8  9
10 11 12 13 14 15 16
17 18 19 20 21 22 23
24 [25] 26 27 28 29 30  ← 开始

2025年12月
日 一 二 三 四 五 六
 1  2  3  4  5  6  7
 8  9 10 11 12 13 14
15 16 17 18 19 20 21
22 23 24 [25] 26 27 28  ← 第1个月
29 30 31

2026年1月
日 一 二 三 四 五 六
          1  2  3  4
 5  6  7  8  9 10 11
12 13 14 15 16 17 18
19 20 21 22 23 24 [25]  ← 第2个月
26 27 28 29 30 31

2026年2月
日 一 二 三 四 五 六
                   1
 2  3  4  5  6  7  8
 9 10 11 12 13 14 15
16 17 18 19 20 21 22
23 24 [25] 26 27 28     ← 第3个月（结束）
```

## 常见误解

### 误解1：只看月份数字
❌ 错误理解：11月 → 12月 → 1月 → 2月，只变化了3次，所以是3个月？
✅ 正确理解：从11月25日到2月25日，经过了完整的3个月

### 误解2：跨年混淆
❌ 错误理解：2025年到2026年，跨年了，所以计算不对
✅ 正确理解：跨年不影响月份计算，仍然是按照日期来计算

### 误解3：数月份名称
❌ 错误理解：11月、12月、1月、2月，只有4个月份名称
✅ 正确理解：要看具体日期，从25日到25日才是完整的一个月

## 实际例子

假设今天是 **2025年11月25日**：

| 时间点 | 日期 | 说明 |
|--------|------|------|
| 今天 | 2025-11-25 | 开始日期 |
| 1个月后 | 2025-12-25 | 第1个月结束 |
| 2个月后 | 2026-01-25 | 第2个月结束 |
| 3个月后 | 2026-02-25 | 第3个月结束 ✅ |

## JavaScript 日期计算验证

```javascript
const startDate = new Date('2025-11-25');
console.log('开始日期:', startDate.toLocaleDateString('zh-CN'));
// 输出: 2025/11/25

const endDate = new Date(startDate);
endDate.setMonth(endDate.getMonth() + 3);
console.log('结束日期:', endDate.toLocaleDateString('zh-CN'));
// 输出: 2026/2/25

// 验证月份差
const monthsDiff = (endDate.getFullYear() - startDate.getFullYear()) * 12 
                 + (endDate.getMonth() - startDate.getMonth());
console.log('月份差:', monthsDiff);
// 输出: 3
```

## 结论

**计算完全正确，没有任何问题！**

- ✅ 前端传递的数据：duration_months = 3
- ✅ 后端接收的数据：duration_months = 3
- ✅ 数据库存储的数据：duration_months = 3
- ✅ 日期计算结果：2025-11-25 + 3个月 = 2026-02-25
- ✅ PostgreSQL 验证：actual_months_diff = 3

**从 2025年11月25日 到 2026年2月25日，正好是 3 个月！**
