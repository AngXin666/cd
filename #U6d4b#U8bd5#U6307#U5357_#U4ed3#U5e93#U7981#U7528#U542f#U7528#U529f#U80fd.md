# 测试指南：仓库禁用/启用功能

## 📋 测试目标
验证超管端仓库管理中，禁用的仓库可以正常显示并重新启用。

---

## 🧪 测试环境

### 测试账号
- **角色**：超级管理员
- **权限**：完全访问所有仓库管理功能

### 测试数据
当前数据库中有5个仓库：

| 仓库名称 | 状态 | ID |
|---------|------|-----|
| 番禺 | ✅ 启用 | b4e421f0-2736-4f0a-9ea7-a4cbb8c51759 |
| 佛山 | ✅ 启用 | 400fdf77-b072-4be4-bb11-0465e8a7268e |
| 西区仓库 | ❌ 禁用 | 0a25b0b0-6b2c-407b-8f28-54749500c384 |
| 总部仓库 | ❌ 禁用 | 6f403c5a-4e76-46b0-a5e7-39f95b93144d |
| 东区仓库 | ❌ 禁用 | 8c606984-7602-44e4-b9f6-3dcbab81a2e3 |

---

## 🔍 测试场景

### 场景1：查看所有仓库（包括禁用的）

#### 测试步骤
1. 使用超级管理员账号登录
2. 进入"仓库管理"页面

#### 预期结果
✅ **显示所有5个仓库**

**启用的仓库（番禺、佛山）**：
- 白色背景
- 蓝色图标
- 深色文字
- 状态显示"启用中"

**禁用的仓库（西区仓库、总部仓库、东区仓库）**：
- 灰色背景
- 灰色图标
- 灰色文字
- 红色"已禁用"标签
- 状态显示"已禁用"
- 整体透明度降低

#### 验证点
- [ ] 列表中显示5个仓库
- [ ] 启用和禁用的仓库视觉区分明显
- [ ] 禁用的仓库有红色"已禁用"标签
- [ ] 所有仓库都有"详情"、"编辑"、"删除"按钮

---

### 场景2：重新启用禁用的仓库

#### 测试步骤
1. 在仓库列表中找到"西区仓库"（禁用状态）
2. 点击"编辑"按钮
3. 在编辑对话框中，找到"启用状态"开关
4. 将开关从关闭切换到打开
5. 输入密码验证
6. 点击"保存"

#### 预期结果
✅ **仓库成功重新启用**

**保存前**：
- 编辑对话框显示当前状态为"禁用"
- 启用状态开关为关闭状态

**保存后**：
- 显示"保存成功"提示
- 列表自动刷新
- "西区仓库"背景变为白色
- 图标变为蓝色
- 文字变为深色
- "已禁用"标签消失
- 状态显示"启用中"

#### 验证点
- [ ] 可以找到并编辑禁用的仓库
- [ ] 启用状态开关可以正常切换
- [ ] 需要密码验证
- [ ] 保存成功后列表更新
- [ ] 仓库状态正确显示为"启用中"
- [ ] 视觉样式正确更新

---

### 场景3：禁用启用的仓库

#### 测试步骤
1. 在仓库列表中找到"番禺"（启用状态）
2. 点击"编辑"按钮
3. 在编辑对话框中，找到"启用状态"开关
4. 将开关从打开切换到关闭
5. 输入密码验证
6. 点击"保存"

#### 预期结果
✅ **仓库成功禁用，但仍显示在列表中**

**保存前**：
- 编辑对话框显示当前状态为"启用"
- 启用状态开关为打开状态

**保存后**：
- 显示"保存成功"提示
- 列表自动刷新
- "番禺"仍然显示在列表中（不会消失）
- 背景变为灰色
- 图标变为灰色
- 文字变为灰色
- 显示红色"已禁用"标签
- 状态显示"已禁用"

#### 验证点
- [ ] 可以禁用启用的仓库
- [ ] 需要密码验证
- [ ] 保存成功后列表更新
- [ ] 禁用的仓库仍然显示在列表中（不会消失）
- [ ] 仓库状态正确显示为"已禁用"
- [ ] 视觉样式正确更新

---

### 场景4：编辑禁用仓库的其他信息

#### 测试步骤
1. 在仓库列表中找到"总部仓库"（禁用状态）
2. 点击"编辑"按钮
3. 修改仓库名称为"总部仓库（测试）"
4. 修改考勤规则：
   - 上班时间：08:30
   - 下班时间：17:30
   - 迟到阈值：10分钟
5. **不修改启用状态**（保持禁用）
6. 输入密码验证
7. 点击"保存"

#### 预期结果
✅ **禁用仓库的信息可以正常修改**

**保存后**：
- 显示"保存成功"提示
- 列表自动刷新
- 仓库名称更新为"总部仓库（测试）"
- 考勤规则显示更新后的时间
- 仓库仍然保持禁用状态
- 视觉样式保持灰色（禁用样式）

#### 验证点
- [ ] 可以修改禁用仓库的名称
- [ ] 可以修改禁用仓库的考勤规则
- [ ] 可以修改禁用仓库的其他设置
- [ ] 保存成功
- [ ] 仓库状态保持不变（仍然禁用）

---

### 场景5：查看禁用仓库的详情

#### 测试步骤
1. 在仓库列表中找到"东区仓库"（禁用状态）
2. 点击"详情"按钮

#### 预期结果
✅ **可以正常查看禁用仓库的详情**

**详情页显示**：
- 仓库基本信息
- 考勤规则
- 关联的司机列表
- 关联的管理员列表
- 所有信息正常显示

#### 验证点
- [ ] 可以查看禁用仓库的详情
- [ ] 详情页正常加载
- [ ] 所有信息正确显示

---

### 场景6：删除禁用的仓库

#### 测试步骤
1. 在仓库列表中找到一个禁用的仓库
2. 点击"删除"按钮
3. 确认删除操作
4. 输入密码验证

#### 预期结果
✅ **禁用的仓库可以正常删除**

**删除后**：
- 显示"删除成功"提示
- 列表自动刷新
- 该仓库从列表中移除
- 相关数据被删除

#### 验证点
- [ ] 可以删除禁用的仓库
- [ ] 需要确认操作
- [ ] 需要密码验证
- [ ] 删除成功后列表更新

---

## 🔄 回归测试

### 验证其他功能不受影响

#### 1. 司机端打卡
**验证点**：
- [ ] 司机端只能看到启用的仓库
- [ ] 司机端看不到禁用的仓库
- [ ] 打卡功能正常

#### 2. 管理员端仓库列表
**验证点**：
- [ ] 管理员只能看到他们管理的启用仓库
- [ ] 管理员看不到禁用的仓库
- [ ] 管理功能正常

#### 3. 仓库分配功能
**验证点**：
- [ ] 分配司机到仓库时，只显示启用的仓库
- [ ] 分配管理员到仓库时，只显示启用的仓库
- [ ] 分配功能正常

---

## 📊 测试结果记录

### 测试执行记录

| 场景 | 测试日期 | 测试人员 | 结果 | 备注 |
|-----|---------|---------|------|------|
| 场景1：查看所有仓库 | | | ⬜ 待测试 | |
| 场景2：重新启用禁用的仓库 | | | ⬜ 待测试 | |
| 场景3：禁用启用的仓库 | | | ⬜ 待测试 | |
| 场景4：编辑禁用仓库信息 | | | ⬜ 待测试 | |
| 场景5：查看禁用仓库详情 | | | ⬜ 待测试 | |
| 场景6：删除禁用的仓库 | | | ⬜ 待测试 | |
| 回归测试：司机端打卡 | | | ⬜ 待测试 | |
| 回归测试：管理员端 | | | ⬜ 待测试 | |
| 回归测试：仓库分配 | | | ⬜ 待测试 | |

### 问题记录

| 问题ID | 场景 | 问题描述 | 严重程度 | 状态 | 解决方案 |
|-------|------|---------|---------|------|---------|
| | | | | | |

---

## 🎯 验收标准

### 功能完整性
- [ ] 超管可以查看所有仓库（包括禁用的）
- [ ] 禁用的仓库可以重新启用
- [ ] 启用的仓库可以禁用
- [ ] 禁用的仓库可以编辑
- [ ] 禁用的仓库可以查看详情
- [ ] 禁用的仓库可以删除

### 视觉效果
- [ ] 启用和禁用的仓库有明显的视觉区分
- [ ] 禁用的仓库有红色"已禁用"标签
- [ ] 禁用的仓库背景为灰色
- [ ] 禁用的仓库图标为灰色
- [ ] 禁用的仓库文字为灰色

### 用户体验
- [ ] 操作流程流畅
- [ ] 提示信息清晰
- [ ] 状态变更及时反馈
- [ ] 列表自动刷新

### 安全性
- [ ] 所有修改操作需要密码验证
- [ ] 删除操作需要二次确认
- [ ] 权限控制正确

### 兼容性
- [ ] 不影响司机端功能
- [ ] 不影响管理员端功能
- [ ] 不影响其他现有功能

---

## 📝 测试注意事项

### 测试前准备
1. ✅ 确保有超级管理员测试账号
2. ✅ 确保数据库中有启用和禁用的仓库
3. ✅ 备份重要数据

### 测试过程中
1. ✅ 记录每个步骤的结果
2. ✅ 截图保存关键界面
3. ✅ 记录任何异常情况

### 测试后
1. ✅ 恢复测试数据
2. ✅ 整理测试报告
3. ✅ 提交问题反馈

---

## 🆘 问题排查

### 如果禁用的仓库仍然不显示

#### 检查1：确认使用了正确的函数
```typescript
// 检查 src/pages/super-admin/warehouse-management/index.tsx
// 应该使用 getAllWarehousesWithRules()
const data = await getAllWarehousesWithRules()
```

#### 检查2：确认数据库中有禁用的仓库
```sql
SELECT id, name, is_active 
FROM warehouses 
WHERE is_active = false;
```

#### 检查3：检查浏览器控制台
- 查看是否有错误信息
- 查看网络请求是否成功
- 查看返回的数据

#### 检查4：清除缓存
- 清除浏览器缓存
- 重新加载页面
- 重新登录

---

## 📞 支持联系

**测试负责人**：[待填写]  
**开发负责人**：[待填写]  
**测试日期**：2025-11-05  
**文档版本**：v1.0

---

**🎯 测试目标：确保超管端仓库管理功能完整，禁用的仓库可以正常显示和管理！**
