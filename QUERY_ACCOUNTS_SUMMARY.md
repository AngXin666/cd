# 查询所有账号总结

## 📋 查询结果

### 当前数据库状态

**数据库中目前没有任何账号数据**：
- ❌ 没有老板账号（super_admin）
- ❌ 没有车队长（manager）
- ❌ 没有司机（driver）
- ❌ 没有租赁管理员（lease_admin）

## 🔍 已创建的查询脚本

### 1. 查询所有账号（推荐）

**脚本文件**：`scripts/list-all-accounts.ts`

**功能**：
- 查询所有角色的账号
- 按角色分组显示
- 显示详细的账号信息
- 按租户分组统计

**使用方法**：
```bash
cd /workspace/app-7cdqf07mbu9t
npx tsx scripts/list-all-accounts.ts
```

**输出信息**：
- 角色统计（老板账号、车队长、司机等）
- 每个账号的详细信息：
  - 姓名、手机号、邮箱
  - 登录账号、用户ID
  - 所属租户信息
  - 角色特有信息（如司机类型、车牌号等）
- 按租户分组统计

### 2. 查询司机和车队长

**脚本文件**：`scripts/list-drivers-and-managers.ts`

**功能**：
- 专门查询司机和车队长
- 显示详细的账号信息
- 按租户分组统计

**使用方法**：
```bash
cd /workspace/app-7cdqf07mbu9t
npx tsx scripts/list-drivers-and-managers.ts
```

### 3. 查询所有用户

**脚本文件**：`scripts/list-all-users.ts`

**功能**：
- 查询所有用户
- 按角色统计
- 显示基本信息

**使用方法**：
```bash
cd /workspace/app-7cdqf07mbu9t
npx tsx scripts/list-all-users.ts
```

### 4. 查询所有租户

**脚本文件**：`scripts/list-tenants.ts`

**功能**：
- 查询所有租户（主账号）
- 显示租户下的用户统计

**使用方法**：
```bash
cd /workspace/app-7cdqf07mbu9t
npx tsx scripts/list-tenants.ts
```

## 📊 账号类型说明

### 1. 老板账号（super_admin）

**分类**：
- **主账号**：`main_account_id` 为 `NULL`
  - 租户的主要管理账号
  - 可以添加平级账号、车队长、司机
  - 拥有最高权限
- **平级账号**：`main_account_id` 不为 `NULL`
  - 与主账号平级的管理账号
  - 权限与主账号相同或略低
  - 最多可以有 3 个平级账号

**特有字段**：
- `company_name`：公司名称
- `lease_start_date`：租赁开始日期
- `lease_end_date`：租赁结束日期
- `monthly_fee`：月租费用
- `main_account_id`：主账号ID（平级账号专用）

### 2. 车队长（manager）

**说明**：
- 车队管理员
- 负责管理司机和车辆
- 属于某个租户

**特有字段**：
- `boss_id`：所属租户ID
- `manager_permissions_enabled`：权限是否启用

### 3. 司机（driver）

**说明**：
- 普通司机
- 属于某个租户
- 可以打卡、请假等

**特有字段**：
- `boss_id`：所属租户ID
- `driver_type`：司机类型
- `vehicle_plate`：车牌号
- `join_date`：入职日期

### 4. 租赁管理员（lease_admin）

**说明**：
- 租赁业务管理员
- 管理租赁相关业务

## 🚀 如何添加账号

### 方法 1：通过小程序注册

1. 打开车队管家小程序
2. 点击"注册"按钮
3. 输入手机号和验证码
4. 第一个注册的用户自动成为老板账号（super_admin）

### 方法 2：通过管理后台添加

1. 老板账号登录系统
2. 进入"用户管理"页面
3. 点击"添加用户"按钮
4. 选择角色（车队长或司机）
5. 填写用户信息并保存

### 方法 3：通过数据库直接插入（开发测试用）

```sql
-- 插入老板账号（主账号）
INSERT INTO profiles (
  id, name, phone, email, role, 
  boss_id, main_account_id, 
  company_name, status, created_at
) VALUES (
  gen_random_uuid(),
  '张三',
  '13800000001',
  'zhangsan@example.com',
  'super_admin',
  NULL,
  NULL,
  '测试公司',
  'active',
  NOW()
);

-- 插入车队长
INSERT INTO profiles (
  id, name, phone, email, role, 
  boss_id, status, created_at
) VALUES (
  gen_random_uuid(),
  '李四',
  '13800000002',
  'lisi@example.com',
  'manager',
  '老板账号的ID',
  'active',
  NOW()
);

-- 插入司机
INSERT INTO profiles (
  id, name, phone, email, role, 
  boss_id, driver_type, vehicle_plate, 
  status, created_at
) VALUES (
  gen_random_uuid(),
  '王五',
  '13800000003',
  'wangwu@example.com',
  'driver',
  '老板账号的ID',
  'full_time',
  '京A12345',
  'active',
  NOW()
);
```

## 📝 查询示例输出

### 示例 1：有数据时的输出

```
========================================
📋 查询所有账号
========================================

✅ 找到 15 个账号

📊 角色统计：
  老板账号：3 名
  车队长：5 名
  司机：7 名

========================================
【老板账号】共 3 名
========================================

1. 张三
   角色：老板账号
   手机号：13800000001
   邮箱：zhangsan@example.com
   登录账号：zhangsan
   用户ID：xxx-xxx-xxx
   公司名称：测试公司
   账号类型：主账号
   租赁开始日期：2024-01-01
   租赁结束日期：2025-12-31
   月租费用：5000 元
   账号状态：active
   创建时间：2024-01-01 10:00:00

2. 李四
   角色：老板账号
   手机号：13800000002
   ...

========================================
【车队长】共 5 名
========================================

3. 王五
   角色：车队长
   手机号：13800000003
   ...
   所属租户：张三 (13800000001)
   所属公司：测试公司

========================================
【司机】共 7 名
========================================

8. 赵六
   角色：司机
   手机号：13800000008
   ...
   所属租户：张三 (13800000001)
   所属公司：测试公司
   司机类型：full_time
   车牌号：京A12345
   入职日期：2024-01-15

========================================
📊 按租户分组统计
========================================

1. 租户：张三 (13800000001)
   公司：测试公司
   主账号：1 个
   平级账号：2 个
   车队长：5 名
   司机：7 名
   小计：15 个账号

========================================
✅ 查询完成
========================================
```

## 💡 提示

### 当前状态

由于数据库中目前没有任何账号，您需要：

1. **注册第一个账号**：
   - 通过小程序注册
   - 第一个注册的账号会自动成为老板账号（super_admin）

2. **添加其他账号**：
   - 使用老板账号登录系统
   - 在用户管理页面添加车队长和司机

3. **再次查询**：
   - 添加账号后，再次运行查询脚本
   - 就可以看到所有账号信息

### 快速测试

如果您想快速测试查询功能，可以：

1. 使用 Supabase Dashboard 的 SQL Editor
2. 执行上面的 SQL 插入语句
3. 创建一些测试账号
4. 再次运行查询脚本

## 📚 相关文档

- [用户迁移功能总结](USER_MIGRATION_SUMMARY.md)
- [迁移脚本使用说明](scripts/README_MIGRATION.md)
- [用户管理系统架构](docs/USER_MANAGEMENT_ARCHITECTURE.md)

## 🎯 总结

✅ **已完成**：
- 创建了完整的账号查询脚本
- 支持查询所有角色的账号
- 支持按角色分组显示
- 支持按租户分组统计
- 显示详细的账号信息

⏳ **当前状态**：
- 数据库中没有任何账号
- 需要先注册账号或添加测试数据

📝 **下一步**：
- 注册第一个账号（自动成为老板账号）
- 添加车队长和司机
- 再次运行查询脚本查看结果

---

**创建日期**：2025-11-05  
**最后更新**：2025-11-05  
**维护人员**：秒哒 AI  
**状态**：✅ 查询脚本已就绪，等待数据库有数据后使用
