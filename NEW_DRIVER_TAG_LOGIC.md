# 新司机标签自动移除逻辑说明

## 功能说明

### 当前实现逻辑

**新司机标签显示规则**：
- ✅ 在职天数 < 7天：显示"新司机"标签
- ✅ 在职天数 ≥ 7天：自动移除标签（不显示）

### 代码实现

**位置1：普通管理端**
- 文件：`src/pages/manager/piece-work-report/index.tsx`
- 代码：
```typescript
{/* 新司机标签 */}
{summary.daysEmployed < 7 && (
  <View className="px-2 py-0.5 rounded bg-orange-100 flex items-center">
    <Text className="text-xs text-orange-600 font-bold">新司机</Text>
  </View>
)}
```

**位置2：超级管理端**
- 文件：`src/pages/super-admin/piece-work-report/index.tsx`
- 代码：
```typescript
{/* 新司机标签 */}
{summary.daysEmployed < 7 && (
  <View className="px-2 py-0.5 rounded bg-orange-100 flex items-center">
    <Text className="text-xs text-orange-600 font-bold">新司机</Text>
  </View>
)}
```

### 工作原理

1. **在职天数计算**
   - 系统自动计算司机从入职日期到今天的天数
   - 计算公式：`daysEmployed = Math.floor((今天 - 入职日期) / (1000 * 60 * 60 * 24)) + 1`

2. **标签显示判断**
   - 使用条件渲染：`{summary.daysEmployed < 7 && (...)}`
   - 只有当在职天数小于7天时，才会渲染标签组件
   - 当在职天数达到7天或以上时，条件为 false，标签自动不显示

3. **自动更新**
   - 每次打开司机汇总页面时，系统会重新计算在职天数
   - 标签状态会自动更新，无需手动操作

### 示例场景

#### 场景1：新入职司机（第1天）
```
入职日期：2025-11-15
今天：2025-11-15
在职天数：1天
标签显示：✅ 显示"新司机"标签
```

#### 场景2：入职第6天
```
入职日期：2025-11-10
今天：2025-11-15
在职天数：6天
标签显示：✅ 显示"新司机"标签
```

#### 场景3：入职第7天
```
入职日期：2025-11-09
今天：2025-11-15
在职天数：7天
标签显示：❌ 不显示标签（自动移除）
```

#### 场景4：入职第8天及以后
```
入职日期：2025-11-08
今天：2025-11-15
在职天数：8天
标签显示：❌ 不显示标签（自动移除）
```

### 视觉效果

**入职未满7天的司机**：
```
┌─────────────────────────────────────────────────────────┐
│  👤  张三  [新司机]  [纯司机]                           │
│      13800138000                                        │
│      北京仓库                                           │
│      入职天数：3天                                      │
└─────────────────────────────────────────────────────────┘
```

**入职满7天或以上的司机**：
```
┌─────────────────────────────────────────────────────────┐
│  👤  李四  [纯司机]                                     │
│      13900139000                                        │
│      北京仓库                                           │
│      入职天数：15天                                     │
└─────────────────────────────────────────────────────────┘
```

### 技术细节

1. **条件渲染**
   - 使用 React 的条件渲染语法：`{condition && <Component />}`
   - 当条件为 true 时，渲染组件
   - 当条件为 false 时，不渲染任何内容

2. **性能优化**
   - 标签组件只在需要时才渲染
   - 不会创建隐藏的 DOM 元素

3. **数据来源**
   - `daysEmployed` 字段在司机汇总数据中计算
   - 基于司机的入职日期（`join_date`）和当前日期

### 测试建议

#### 测试用例1：新入职司机
1. 创建一个入职日期为今天的司机
2. 查看司机汇总页面
3. 验证：显示"新司机"标签 ✅

#### 测试用例2：入职第6天的司机
1. 创建一个入职日期为6天前的司机
2. 查看司机汇总页面
3. 验证：显示"新司机"标签 ✅

#### 测试用例3：入职第7天的司机
1. 创建一个入职日期为7天前的司机
2. 查看司机汇总页面
3. 验证：不显示"新司机"标签 ✅

#### 测试用例4：入职超过7天的司机
1. 创建一个入职日期为30天前的司机
2. 查看司机汇总页面
3. 验证：不显示"新司机"标签 ✅

#### 测试用例5：标签自动更新
1. 创建一个入职日期为6天前的司机
2. 第一天查看：显示"新司机"标签 ✅
3. 第二天查看：不显示"新司机"标签 ✅
4. 验证：标签自动移除 ✅

### 注意事项

1. **时间计算**
   - 在职天数包含入职当天（+1）
   - 例如：今天入职，在职天数为1天

2. **自动更新**
   - 标签状态会在每次打开页面时自动更新
   - 无需手动刷新或重新登录

3. **跨时区**
   - 系统使用本地时间计算在职天数
   - 确保服务器和客户端时间同步

4. **边界条件**
   - 在职天数 = 7天时，不显示标签
   - 使用 `<` 而不是 `<=` 来判断

### 总结

✅ **功能已正确实现**
- 在职天数 < 7天：显示"新司机"标签
- 在职天数 ≥ 7天：自动移除标签

✅ **自动化处理**
- 无需手动操作
- 系统自动计算和更新

✅ **两端同步**
- 普通管理端：已实现
- 超级管理端：已实现

---

**文档创建时间**: 2025-11-15  
**功能状态**: ✅ 已实现并正常工作  
**影响范围**: 普通管理端 + 超级管理端  
**核心逻辑**: 条件渲染 + 自动计算在职天数  
**重要性**: ⭐⭐⭐⭐ 核心功能，自动化管理新司机标识
