# 测试司机账号信息

## 账号详情

### 基本信息
- **姓名**: angxin
- **手机号**: 13800000003
- **角色**: 司机 (driver)
- **账号ID**: f5889b11-6a1d-4469-8eff-4fb59cb12b16
- **创建时间**: 2025-11-08 23:50:27

### 登录方式
1. 打开小程序或H5页面
2. 选择"司机端"入口
3. 输入手机号：**13800000003**
4. 点击"获取验证码"
5. 输入收到的验证码登录

### 可用功能

#### ✅ 司机工作台
- 查看个人工作统计
- 本月考勤天数
- 本月计件收入
- 本月请假天数
- 关联仓库数量

#### ✅ 考勤打卡
- 上班打卡
- 下班打卡
- 查看打卡记录
- 打卡提醒功能

#### ✅ 计件录入
- 录入计件数据
- 查看计件记录
- 统计计件收入

#### ✅ 请假管理
- 提交请假申请
- 查看请假记录
- 撤销待审批的请假
- 查看审批状态

#### ✅ 离职申请
- 提交离职申请
- 查看离职申请状态
- 撤销待审批的离职申请

#### ✅ 个人中心
- 查看个人信息
- 修改个人资料
- 退出登录

### 测试撤销功能

#### 请假申请撤销测试
1. **提交请假申请**
   - 进入"请假与离职"页面
   - 点击"请假申请"
   - 填写请假信息并提交
   - 状态变为"待审批"

2. **撤销请假申请**
   - 在请假列表中找到待审批的申请
   - 点击"撤销请假"按钮
   - 确认撤销操作
   - 状态立即变为"已撤销"

3. **验证撤销结果**
   - ✅ 申请状态显示为"已撤销"（灰色标签）
   - ✅ 显示撤销时间
   - ✅ "撤销请假"按钮消失
   - ✅ 管理端看到撤销记录（撤销人、撤销时间）

#### 离职申请撤销测试
1. **提交离职申请**
   - 进入"请假与离职"页面
   - 点击"离职申请"
   - 填写离职信息并提交
   - 状态变为"待审批"

2. **撤销离职申请**
   - 在离职申请列表中找到待审批的申请
   - 点击"撤销申请"按钮
   - 确认撤销操作
   - 状态立即变为"已撤销"

3. **验证撤销结果**
   - ✅ 申请状态显示为"已撤销"（灰色标签）
   - ✅ 显示撤销时间
   - ✅ "撤销申请"按钮消失
   - ✅ 管理端看到撤销记录（撤销人、撤销时间）

### 撤销功能优化验证清单

#### 数据同步验证
- [x] 撤销操作后，数据库状态立即更新为 'cancelled'
- [x] 记录 cancelled_by 字段（操作人ID）
- [x] 记录 cancelled_at 字段（撤销时间）
- [x] 前端状态与数据库状态保持一致

#### UI状态联动验证
- [x] 已撤销的申请不显示"撤销"按钮
- [x] 状态标签正确显示"已撤销"
- [x] 状态颜色为灰色（text-gray-600）
- [x] 显示撤销时间信息

#### 逻辑验证
- [x] 只有待审批状态的离职申请可以撤销
- [x] 待审批或已批准且假期未过的请假可以撤销
- [x] 已撤销的申请不能再次撤销
- [x] 管理端不能审批已撤销的申请

#### 管理端验证
- [x] 详情页显示完整的撤销记录
- [x] 显示撤销人姓名
- [x] 显示撤销时间（格式化）
- [x] 显示撤销原因
- [x] 已撤销申请不显示审批按钮

### 注意事项

1. **首次登录**
   - 需要通过手机验证码登录
   - 验证码会发送到注册的手机号
   - 如果是测试环境，可能需要配置测试验证码

2. **权限限制**
   - 司机账号只能查看和操作自己的数据
   - 不能访问管理端功能
   - 不能查看其他司机的数据

3. **数据隔离**
   - 每个司机只能看到自己的考勤、计件、请假记录
   - 需要先分配到仓库才能进行相关操作

### 相关文档

- [撤销功能优化总结](./CANCELLATION_OPTIMIZATION_SUMMARY.md)
- [用户指南 - 请假系统](./USER_GUIDE_LEAVE_SYSTEM_V2.md)
- [快速测试指南](./QUICK_TEST_GUIDE.md)

## 技术细节

### 数据库记录
```sql
-- 查看账号信息
SELECT id, phone, name, role, created_at 
FROM profiles 
WHERE phone = '13800000003';

-- 查看该司机的请假记录
SELECT id, type, start_date, end_date, status, cancelled_at
FROM leave_applications
WHERE user_id = 'f5889b11-6a1d-4469-8eff-4fb59cb12b16'
ORDER BY created_at DESC;

-- 查看该司机的离职申请
SELECT id, expected_date, status, cancelled_at
FROM resignation_applications
WHERE user_id = 'f5889b11-6a1d-4469-8eff-4fb59cb12b16'
ORDER BY created_at DESC;
```

### 撤销操作追踪
```sql
-- 查看所有撤销操作
SELECT 
  la.id,
  la.type,
  la.status,
  la.cancelled_at,
  p.name as cancelled_by_name
FROM leave_applications la
LEFT JOIN profiles p ON la.cancelled_by = p.id
WHERE la.status = 'cancelled'
ORDER BY la.cancelled_at DESC;
```

## 测试完成标准

- ✅ 能够成功登录司机端
- ✅ 能够提交请假申请
- ✅ 能够撤销待审批的请假申请
- ✅ 撤销后状态正确显示为"已撤销"
- ✅ 撤销后按钮正确隐藏
- ✅ 管理端能看到完整的撤销记录
- ✅ 数据库记录完整（cancelled_by 和 cancelled_at）
