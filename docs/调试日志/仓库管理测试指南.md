# 仓库管理功能测试指南

## 📋 测试前准备

1. 打开浏览器开发者工具 (F12)
2. 切换到 Console 标签页
3. (可选) 在 Console 设置中勾选 "保留日志" 以避免页面刷新后日志丢失

## 🎯 功能测试清单

### 1. 编辑仓库 (warehouse-edit)

#### 测试步骤:

**1.1 进入编辑仓库页面**
```
✅ 预期日志:
[仓库管理-编辑仓库] 开始加载仓库信息
[仓库管理-编辑仓库] 加载仓库数据成功
[仓库管理-编辑仓库] 仓库状态设置完成
[仓库管理-品类价格] 开始加载品类和价格
[仓库管理-品类价格] 加载所有品类成功
[仓库管理-品类价格] 加载仓库品类价格成功
[仓库管理-品类价格] 品类价格映射完成
[仓库管理-仓库分配] 开始加载管理员
[仓库管理-仓库分配] 加载管理员成功
[仓库管理-仓库分配] 当前用户是管理员
[仓库管理-仓库分配] 加载仓库已分配管理员

✅ 验证点:
- 仓库名称正确显示
- 品类列表正确加载
- 已选品类带有价格
- 管理员列表正确显示
- 已分配管理员被选中
```

**1.2 修改仓库基本信息**
```
操作: 修改仓库名称、状态、规则等
预期: 界面正常响应,无错误
```

**1.3 新建品类**
```
操作: 
1. 点击"新建品类"按钮
2. 输入品类名称和价格
3. 点击"创建"

✅ 预期日志:
[仓库管理-品类操作] 开始创建新品类
[仓库管理-品类操作] 调用创建品类API
[仓库管理-品类操作] 品类创建成功
[仓库管理-品类操作] 创建品类价格记录
[仓库管理-品类操作] 品类价格创建成功
[仓库管理-品类操作] 品类已自动选中并设置价格
[仓库管理-品类价格] 开始加载品类和价格 (刷新列表)

✅ 验证点:
- 新品类出现在列表中
- 新品类自动被选中
- 价格已填充
```

**1.4 导入其他仓库品类**
```
操作:
1. 点击"导入品类"按钮
2. 选择一个仓库
3. 点击"导入"

✅ 预期日志:
[仓库管理-导入品类] 开始导入品类配置
[仓库管理-导入品类] 获取源仓库品类价格
[仓库管理-导入品类] 品类配置合并完成
[仓库管理-导入品类] 品类导入成功

✅ 验证点:
- 导入的品类出现在列表中
- 价格正确填充
- 原有品类保留
```

**1.5 保存仓库信息**
```
操作: 点击底部"保存设置"按钮

✅ 预期日志:
[仓库管理-保存操作] 开始保存仓库信息
[仓库管理-保存操作] 开始验证品类价格
[仓库管理-保存操作] 验证通过,开始保存
[仓库管理-保存操作] 步骤1: 更新仓库基本信息
[仓库管理-保存操作] 步骤1完成: 仓库基本信息更新成功
[仓库管理-保存操作] 步骤2: 开始更新品类价格
[仓库管理-保存操作] 品类价格输入数据
[仓库管理-保存操作] 步骤2完成: 品类价格更新成功
[仓库管理-保存操作] 步骤3: 开始更新管理员分配
[仓库管理-保存操作] 管理员分配变更
[仓库管理-保存操作] 步骤3完成: 管理员分配更新成功
[仓库管理-保存操作] 步骤4: 开始更新考勤规则
[仓库管理-保存操作] 步骤4完成: 考勤规则更新成功
[仓库管理-保存操作] 清除缓存
[仓库管理-保存操作] 所有步骤完成,保存成功

✅ 验证点:
- 显示"保存成功"提示
- 所有4个步骤都成功执行
- 页面自动返回
```

### 2. 司机仓库分配 (driver-warehouse-assignment)

#### 测试步骤:

**2.1 进入司机仓库分配页面**
```
✅ 预期: 司机列表加载显示
```

**2.2 选择司机**
```
操作: 点击一个司机

✅ 预期日志:
[仓库管理-司机仓库分配] 选择司机
[仓库管理-司机仓库分配] 加载司机的仓库分配
[仓库管理-司机仓库分配] 司机已分配仓库

✅ 验证点:
- 司机被高亮选中
- 仓库分配区域显示
- 已分配的仓库被勾选
```

**2.3 修改仓库分配**
```
操作: 勾选/取消勾选仓库

✅ 预期日志:
[仓库管理-司机仓库分配] 仓库选择变化 (每次勾选变化)

✅ 验证点:
- 复选框状态正确更新
- 已选数量正确显示
```

**2.4 保存分配**
```
操作: 点击"保存分配"按钮

✅ 预期日志:
[仓库管理-司机仓库分配] 开始保存仓库分配
[仓库管理-司机仓库分配] 之前的仓库分配
[仓库管理-司机仓库分配] 仓库分配保存成功
[仓库管理-司机仓库分配] 准备发送通知

✅ 验证点:
- 显示"分配成功"弹窗
- 弹窗内容包含分配的仓库名称
- 提示司机需要重新进入页面
```

### 3. 管理员仓库分配 (manager-warehouse-assignment)

#### 测试步骤:

**3.1 进入管理员仓库分配页面**
```
✅ 预期: 管理员列表加载显示
```

**3.2 选择管理员**
```
操作: 点击一个管理员

✅ 预期日志:
[仓库管理-管理员仓库分配] 选择管理员
[仓库管理-管理员仓库分配] 加载管理员的仓库分配
[仓库管理-管理员仓库分配] 管理员已分配仓库

✅ 验证点:
- 管理员被高亮选中
- 仓库分配区域显示
- 已分配的仓库被勾选
```

**3.3 修改仓库分配**
```
操作: 勾选/取消勾选仓库

✅ 预期日志:
[仓库管理-管理员仓库分配] 仓库选择变化

✅ 验证点:
- 复选框状态正确更新
- 已选数量正确显示
```

**3.4 保存分配**
```
操作: 点击"保存分配"按钮

✅ 预期日志:
[仓库管理-管理员仓库分配] 开始保存仓库分配
[仓库管理-管理员仓库分配] 保存成功

✅ 验证点:
- 显示"分配成功"提示
- 显示提示管理员下次登录同步的弹窗
```

## 🐛 异常场景测试

### 1. 表单验证测试

**测试1: 保存空仓库名称**
```
操作: 清空仓库名称后保存

✅ 预期日志:
[仓库管理-保存操作] 开始保存仓库信息
[仓库管理-保存操作] 仓库名称为空

✅ 验证点:
- 显示"请输入仓库名称"错误提示
- 保存操作中止
```

**测试2: 未选择管理员**
```
操作: 取消所有管理员选择后保存

✅ 预期日志:
[仓库管理-保存操作] 未选择管理员

✅ 验证点:
- 显示"请至少选择一个管理员"错误提示
- 保存操作中止
```

**测试3: 品类价格无效**
```
操作: 选择品类但不填写价格或填写负数

✅ 预期日志:
[仓库管理-保存操作] 品类纯司机单价无效

✅ 验证点:
- 显示具体品类的价格错误提示
- 保存操作中止
```

### 2. 网络错误测试

**测试4: 加载失败**
```
操作: 断网后进入编辑页面

✅ 预期日志:
[仓库管理-编辑仓库] 加载仓库信息失败

✅ 验证点:
- 显示"加载失败"错误提示
```

**测试5: 保存失败**
```
操作: 断网后保存

✅ 预期日志:
[仓库管理-保存操作] 保存失败: [错误详情]

✅ 验证点:
- 显示"保存失败"错误提示
```

## 📊 日志筛选技巧

### Console 筛选器使用:

```javascript
// 查看所有仓库管理日志
[仓库管理

// 查看编辑仓库相关
[仓库管理-编辑仓库]

// 查看品类操作相关
[仓库管理-品类

// 查看仓库分配相关
[仓库管理-仓库分配]
仓库分配]

// 查看保存操作
[仓库管理-保存操作]

// 只看错误
error
```

### 查看特定操作流程:

```javascript
// 创建品类完整流程
[仓库管理-品类操作]

// 保存仓库完整流程
[仓库管理-保存操作]

// 司机分配完整流程
[仓库管理-司机仓库分配]
```

## ✅ 测试完成标准

### 基本功能测试通过标准:

- [x] 所有页面能正常加载,日志无错误
- [x] 所有表单能正常填写和提交
- [x] 所有保存操作都有完整的步骤日志
- [x] 所有错误场景都有相应的警告或错误日志
- [x] 所有成功操作都有成功提示

### 日志完整性检查:

- [x] 每个主要操作都有开始日志
- [x] 每个主要操作都有成功/失败结果日志  
- [x] 关键数据都有输出(如ID、名称、数量等)
- [x] 错误信息包含足够的调试信息

## 📝 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: 
测试环境: [开发/测试/生产]
浏览器: [Chrome/Firefox/Safari等]

### 测试结果:

#### 1. 编辑仓库功能
- [ ] 加载仓库信息: 通过/失败 - [备注]
- [ ] 加载品类价格: 通过/失败 - [备注]
- [ ] 加载管理员: 通过/失败 - [备注]
- [ ] 新建品类: 通过/失败 - [备注]
- [ ] 导入品类: 通过/失败 - [备注]
- [ ] 保存仓库: 通过/失败 - [备注]

#### 2. 司机仓库分配
- [ ] 选择司机: 通过/失败 - [备注]
- [ ] 修改分配: 通过/失败 - [备注]
- [ ] 保存分配: 通过/失败 - [备注]

#### 3. 管理员仓库分配
- [ ] 选择管理员: 通过/失败 - [备注]
- [ ] 修改分配: 通过/失败 - [备注]
- [ ] 保存分配: 通过/失败 - [备注]

#### 4. 异常场景测试
- [ ] 表单验证: 通过/失败 - [备注]
- [ ] 网络错误: 通过/失败 - [备注]

### 发现的问题:
1. [问题描述]
   - 重现步骤:
   - 相关日志:
   - 严重程度: [高/中/低]

### 测试总结:
[整体评价和建议]
```

---

**测试指南版本**: v1.0  
**更新时间**: 2025-12-11
