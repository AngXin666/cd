# 普通管理端司机管理UI优化

## 更新日期
2025-11-05

## 更新历史
- **2025-11-05 初版**：添加司机详细信息展示、司机类型标签
- **2025-11-05 更新1**：添加入职时间和在职天数显示
- **2025-11-05 更新2**：重构按钮布局和仓库分配功能

## 更新内容

### 1. 新增功能
- **司机详细信息展示**：在司机列表中直接显示司机的详细信息
- **司机类型标签**：从数据库 `driver_type` 字段读取并显示"纯司机"或"带车司机"标签
- **司机类型切换**：管理员可以直接切换司机类型（纯司机 ⇄ 带车司机）
- **内联仓库分配**：点击"仓库分配"按钮后，在司机卡片下方展开仓库选择面板
- **完整信息展示**：包括年龄、手机号、车牌、驾驶证类型、驾龄、住址、入职时间、在职天数等

### 2. UI优化
- **卡片式设计**：采用圆角卡片布局，带有渐变色和阴影效果
- **信息分组**：将司机信息分为头部信息、详细信息和操作按钮三个区域
- **视觉层次**：使用不同的背景色和图标区分不同类型的信息
- **响应式布局**：信息卡片采用网格布局，自动适应屏幕大小
- **按钮布局**：2x2网格布局，包含个人信息、车辆管理、仓库分配、司机类型切换四个按钮

### 3. 技术实现

#### 3.1 新增API函数
```typescript
// src/db/api.ts
export async function getDriverDetailInfo(driverId: string)
export async function getVehiclesByDriverId(driverId: string)
export async function getWarehouseAssignmentsByDriver(driverId: string)
export async function deleteWarehouseAssignmentsByDriver(driverId: string)
export async function insertWarehouseAssignment(input: DriverWarehouseInput)
```

`getDriverDetailInfo` 函数获取司机的完整信息，包括：
- 基本资料（profile）
- 驾驶证信息（license）
- 车辆信息（vehicles）
- 计算得出的年龄（age）
- 计算得出的驾龄（drivingYears）
- 司机类型（driverType）- **从 profile.driver_type 字段读取**
- 入职时间（joinDate）
- 在职天数（workDays）

#### 3.2 司机类型判断逻辑（已修正）
- **司机类型不再根据车辆数量判断**
- **司机类型从 `profile.driver_type` 字段读取**：
  - `driver_with_vehicle` → "带车司机"
  - `driver` → "纯司机"
  - 其他 → "未设置"
- **管理员可以通过切换按钮修改司机类型**

#### 3.3 信息展示规则
- **年龄**：从身份证出生日期计算得出
- **驾龄**：从驾驶证初次领证日期计算得出
- **入职时间**：优先使用 `join_date` 字段，如果没有则使用 `created_at` 字段
- **在职天数**：从入职时间到当前日期的天数差
- **车牌号**：如果有多辆车，用顿号（、）分隔显示
- **住址**：显示身份证上的地址信息

### 4. 显示的信息字段

#### 4.1 头部信息
- 司机姓名（优先显示实名）
- 实名认证状态标签
- 司机类型标签（纯司机/带车司机）
- 手机号码

#### 4.2 详细信息（网格布局）
- **年龄**：显示岁数（如果有身份证信息）
- **驾龄**：显示年数（如果有驾驶证信息）
- **准驾车型**：显示驾驶证类型（如C1、B2等）
- **车辆数量**：显示拥有的车辆数量
- **入职时间**：显示司机的入职日期
- **在职天数**：显示从入职到当前的天数

#### 4.3 附加信息
- **车牌号**：橙色渐变背景，显示所有车辆的车牌号
- **住址**：蓝色背景，显示身份证上的详细地址

#### 4.4 操作按钮（2x2网格）
1. **个人信息**（蓝色）：查看司机的详细个人信息
2. **车辆管理**（绿色）：查看和管理司机的车辆
3. **仓库分配**（紫色）：展开/收起仓库分配面板
4. **司机类型切换**（橙色）：切换纯司机/带车司机

### 5. 仓库分配功能改进

#### 5.1 交互方式
- 点击"仓库分配"按钮，在司机卡片下方展开仓库选择面板
- 再次点击"仓库分配"按钮，收起面板
- 面板内包含所有可用仓库的复选框列表
- 显示已选择的仓库数量

#### 5.2 操作流程
1. 点击司机卡片上的"仓库分配"按钮
2. 面板展开，自动加载该司机已分配的仓库
3. 勾选或取消勾选仓库
4. 点击"保存"按钮保存修改
5. 点击"取消"按钮放弃修改并收起面板

#### 5.3 移除的功能
- 移除了独立的仓库分配模块
- 移除了"选择司机"的概念
- 移除了底部的"保存分配"按钮
- 移除了操作提示面板

### 6. 视觉设计

#### 6.1 颜色方案
- **主色调**：蓝色（#1E3A8A）- 用于主要元素
- **辅助色**：
  - 绿色 - 实名认证标签、驾龄图标、车辆管理按钮
  - 橙色 - 带车司机标签、车辆相关信息、司机类型切换按钮
  - 紫色 - 驾驶证类型图标、仓库分配按钮
  - 青色 - 入职时间图标
  - 靛蓝色 - 在职天数图标
  - 灰色 - 背景和边框

#### 6.2 图标使用
- 账户图标（i-mdi-account）：司机头像
- 蛋糕图标（i-mdi-cake-variant）：年龄
- 方向盘图标（i-mdi-steering）：驾龄
- 卡片图标（i-mdi-card-account-details）：驾驶证类型
- 汽车图标（i-mdi-car）：车辆信息
- 日历勾选图标（i-mdi-calendar-check）：入职时间
- 时钟图标（i-mdi-clock-outline）：在职天数
- 地图标记图标（i-mdi-home-map-marker）：住址
- 账户卡片图标（i-mdi-account-card）：个人信息按钮
- 仓库图标（i-mdi-warehouse）：仓库分配按钮
- 交换图标（i-mdi-swap-horizontal）：司机类型切换按钮

### 7. 性能优化
- 在加载司机列表时，同时加载所有司机的详细信息
- 使用Map数据结构存储司机详细信息，提高查询效率
- 详细信息缓存在组件状态中，避免重复请求
- 仓库分配面板按需加载，只在展开时加载数据

## 效果展示

### 司机卡片布局
```
┌─────────────────────────────────────────┐
│ 👤 张三 [已实名] [带车司机]              │
│    13800138000                          │
├─────────────────────────────────────────┤
│ 🎂 年龄    🚗 驾龄                       │
│   35岁        10年                      │
│                                         │
│ 📋 准驾车型  🚙 车辆                     │
│   C1          2辆                       │
│                                         │
│ 📅 入职时间  ⏰ 在职天数                 │
│   2024-01-15   295天                    │
│                                         │
│ 🚗 车牌号：京A12345、京B67890            │
│                                         │
│ 📍 住址：北京市朝阳区xxx街道xxx号         │
├─────────────────────────────────────────┤
│ [个人信息]  [车辆管理]                   │
│ [仓库分配]  [切换为纯司机]               │
├─────────────────────────────────────────┤
│ （仓库分配面板 - 展开时显示）            │
│ ✓ 北京仓库                              │
│ ✓ 上海仓库                              │
│ ☐ 广州仓库                              │
│ [取消] [保存]                           │
└─────────────────────────────────────────┘
```

## 注意事项
1. 如果司机没有录入驾驶证信息，将不显示年龄、驾龄、准驾车型等字段
2. 司机类型由管理员在 `driver_type` 字段中设置，不再根据车辆数量自动判断
3. 纯司机也可以开公司的车，类型由管理员指定
4. 所有信息都是只读的，不能在列表页面直接编辑
5. 需要修改司机信息时，点击"个人信息"或"车辆管理"按钮进入详情页面
6. 仓库分配功能已集成到司机卡片中，无需单独的分配模块

## 后续优化建议
1. 可以考虑添加司机照片显示
2. 可以添加司机工作状态（在岗/休假）
3. 可以添加司机评分或评价信息
4. 可以添加司机最近工作记录摘要
5. 可以添加批量操作功能（批量分配仓库、批量修改类型等）
