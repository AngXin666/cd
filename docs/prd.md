# 车队管理小程序需求文档（技术重构版 - 手机号登录功能增强 + 智能考勤打卡提醒与请假管理 + 考勤管理界面 + 权限配置优化与仓库管理模块重构 + 超级管理员司机资料管理权限优化 + 多端消息同步与提醒数据库 + 管理端请假审批管理优化 + 司机打卡记录查看界面）

## 1. 小程序概述
### 1.1 小程序名称
车队管家

### 1.2 小程序描述
一款专为车队管理打造的微信小程序，提供多角色权限管理和多层级数据仪表盘数据库，包含超级管理员、超级管理员和驾驶员姓名三个不同界面，满足车队运营的分层管理需求。本次进行注册、登录功能的数据库性重构，采用现代化技术架构，提升数据库的可维护性、安全性和管理员体验。新增手机号直接登录功能，支持管理员使用手机号码等11位手机号直接登录数据库。所有页面均支持下拉手动刷新功能，提升管理员交互体验。新增智能化考勤打卡提醒与请假管理数据库，实现司机每日首次登录自动检测打卡状态、启动计件前二次检测、请假状态豁免逻辑以及假期主动撤销功能，全面提升考勤管理的智能化水平。新增管理员工作台仪表盘考勤管理功能，支持从工作台直接进入考勤管理界面查看车辆总数和待审批信息。优化超级管理员对超级管理员的权限配置逻辑，实现细粒度权限控制和功能模块内同等操作权限。重构错误管理端功能模块，将品类管理升级为仓库管理，整合司机分配、品类管理和考勤规则设置三大功能区。优化超级管理员权限，增加对司机基本资料的修改权限，提升管理效率和操作便利性。新增多端消息同步与提醒数据库，实现跨角色的智能消息推送、滚动提醒和信息中心管理，确保重要信息的及时传达和有效管理。优化管理端请假审批管理功能，提供更便捷的审批操作和状态跟踪。新增司机打卡记录查看界面，支持详细的考勤数据查看和统计分析。

## 2. 技术架构设计
### 2.1 多层架构设计
- **表现层（Presentation Layer）**
  - 管理员界面组件：登录界面、注册表单、管理员管理界面、考勤打卡界面、请假管理界面、考勤管理界面、权限配置界面、仓库管理界面、司机资料管理界面、消息中心界面、滚动提醒组件、管理端请假审批管理界面、司机打卡记录查看界面
  - 前端路由管理：页面跳转和状态管理
  - 管理员交互处理：表单验证、按钮响应、动画效果、下拉刷新交互、打卡提醒弹窗、请假状态提示、考勤管理操作交互、权限配置交互、仓库管理操作、司机资料编辑交互、消息滚动提醒交互、信息中心操作、管理端审批操作交互、打卡记录查看交互
  - 数据绑定：双向数据绑定和状态同步
- **业务逻辑层（Business Logic Layer）**
  - 管理员注册服务：注册流程控制、信息验证、自动激活
  - 登录认证服务：多渠道登录处理、会话管理、权限验证、手机号直接登录
  - 权限控制服务：角色权限分配、操作权限验证、安全策略执行、细粒度权限配置
  - 管理员管理服务：管理员信息修改、账号麻麻重置、批量管理、司机资料管理
  - 数据刷新服务：页面数据更新、缓存管理、实时同步
  - 考勤管理服务：打卡状态检测、每日首次登录检测、计件前检测、打卡提醒逻辑
  - 请假管理服务：请假申请处理、请假状态管理、豁免逻辑控制、假期撤销处理
  - 考勤管理服务：车辆总数统计、待审批统计、考勤数据报表、打卡次数统计
  - 仓库管理服务：司机分配管理、品类设置管理、考勤规则配置、仓库数据统计
  - 司机资料管理服务：司机基本信息管理、资料修改权限控制、数据验证和更新
  - 消息同步服务：跨角色消息推送、消息路由分发、消息状态管理、实时同步机制
  - 提醒管理服务：滚动提醒生成、提醒显示控制、提醒停止逻辑、提醒优先级管理
  - 信息中心服务：消息存储管理、已读未读状态、消息分类筛选、批量操作处理
  - 管理员端审批管理服务：管理端审批权限控制、审批流程优化、审批状态跟踪
  - 打卡记录查看服务：考勤数据查询、统计分析、记录筛选、数据导出
  - 离职申请管理服务：离职申请处理、离职申请跟踪、离职次数统计、条件显示控制
- **数据访问层（Data Access Layer）**
  - 管理员数据访问：管理员信息CRUD操作、账号麻麻管理、状态更新
  - 日志数据访问：操作日志记录、安全日志存储、审计追踪
  - 缓存管理：会话缓存、验证码缓存、临时数据存储
  - 考勤数据访问：打卡记录CRUD操作、考勤状态查询、统计分析
  - 请假数据访问：请假记录管理、请假状态更新、假期计算
  - 考勤管理数据访问：员工统计数据、待审批数据、签到统计、离职申请数据
  - 权限数据访问：权限配置管理、角色权限映射、权限验证查询
  - 仓库数据访问：仓库信息管理、司机分配记录、品类数据管理、考勤规则存储
  - 司机资料数据访问：司机基本信息CRUD操作、资料修改记录、数据完整性验证
  - 消息数据访问：消息记录CRUD操作、消息状态管理、消息队列处理
  - 提醒数据访问：提醒记录管理、提醒状态跟踪、提醒历史存储
  - 信息中心数据访问：消息中心数据管理、消息分类存储、批量操作处理
  - 管理端审批数据访问：管理员端审批记录管理、审批权限验证、审批状态同步
  - 打卡记录数据访问：考勤记录查询、统计数据计算、历史记录管理
  - 离职申请数据访问：离职申请记录、离职状态管理、离职统计数据

### 2.2 核心模块架构
- **认证授权模块**
  - JWT令牌管理：令牌生成、验证、刷新机制
  - 会话管理：管理员会话创建、维护、销毁
  - 权限控制：基于角色的访问控制（RBAC）
  - 安全策略：登录失败保护、异常行为检测
  - 手机号登录：11位手机号直接登录验证
- **管理员管理模块**
  - 管理员注册：多渠道注册支持、信息验证、自动激活
  - 管理员认证：多种登录方式、账号麻麻验证、二次验证、手机号直接登录
  - 管理员信息：个人信息管理、账号麻麻重置、状态更新
  - 批量管理：批量管理员信息修改、账号麻麻重置、权限分配
  - 司机资料管理：司机基本信息修改、资料完整性验证、操作权限控制
- **页面刷新模块**
  - 下拉刷新：所有页面支持下拉手动刷新功能
  - 数据更新：实时获取最新数据并更新页面显示
  - 加载状态：刷新过程中显示加载动画和状态提示
  - 错误处理：网络异常时的重试机制和错误提示
- **智能考勤管理模块**
  - 打卡状态检测：实时检测管理员当日打卡状态
  - 登录检测：每日首次登录自动触发打卡状态检查
  - 计件检测：启动计件工作前的二次打卡状态验证
  - 提醒机制：智能弹窗提醒和引导跳转
- **请假管理模块**
  - 请假状态管理：请假申请、审批、状态更新
  - 豁免逻辑：请假期间打卡和计件功能的智能豁免
  - 状态提示：请假状态的可视化展示和功能限制
  - 假期撤销：管理员主动撤销已批准假期的完整流程
- **考勤管理模块（新增）**
  - 车辆总数统计：实时统计数据库中的车辆总数
  - 待审批统计：统计待审批的请假申请数量
  - 打卡次数统计：统计司机的打卡次数和考勤情况
  - 离职申请管理：管理司机离职申请和流程跟踪（条件显示）
  - 详细记录管理：请假申请记录和打卡记录的综合管理
- **权限配置优化模块**
  - 细粒度权限控制：超级管理员对超级管理员的特定权限配置
  - 功能模块权限映射：权限开启后的功能模块内同等操作权限
  - 权限验证机制：实时权限验证和动态权限分配
  - 权限配置界面：直观的权限开关和配置管理
- **仓库管理模块**
  - 司机分配管理：为司机分配负责的仓库，支持多仓库分配
  - 品类管理：设置、添加、修改品类信息和分类规则
  - 考勤规则设置：管理仓库考勤相关规则和时间配置
  - 数据统计分析：仓库运营数据统计和分析报表
- **司机资料管理模块**
  - 司机信息查看：查看司机完整基本资料和工作信息
  - 司机资料修改：修改司机个人信息、联系方式、车辆信息等
  - 权限控制：基于角色的司机资料修改权限管理
  - 操作日志：记录司机资料修改的详细操作日志
- **多端消息同步与提醒模块**
  - 消息路由分发：基于角色和操作类型的智能消息路由
  - 滚动提醒数据库：跑马灯式滚动提醒显示和自动停止机制
  - 信息中心管理：集中化消息管理、分类筛选和批量操作
  - 实时同步机制：跨端消息实时同步和状态一致性保障
- **管理端请假审批管理模块**
  - 审批权限优化：管理端审批权限的精细化控制和管理
  - 审批流程简化：简化管理端审批操作流程，提升审批效率
  - 审批状态跟踪：实时跟踪审批进度和状态变更
  - 审批通知优化：优化审批结果通知机制和管理员体验
- **司机打卡记录查看模块**
  - 打卡记录查询：支持按时间、司机、仓库等条件查询打卡记录
  - 考勤数据统计：提供详细的考勤统计分析和报表功能
  - 记录筛选功能：支持多维度筛选和排序打卡记录
  - 数据导出功能：支持考勤数据的导出和备份功能

## 3. 多端消息同步与提醒数据库
### 3.1 数据库角色与消息同步规则
- **角色定义与权限层级**
  - **超级管理员（admin）**：数据库最高权限，可管理所有超级管理员和司机，拥有完整的数据库管理功能
  - **超级管理员（admin123）**：普通管理权限，可管理特定司机和超级管理员，权限范围受限制
  - **驾驶员姓名（angxin）**：驾驶员姓名专用权限，仅限驾驶员姓名相关功能访问
  - **司机（angxin）**：司机专用权限，司机相关功能访问
  - **超级管理员（账号）**：超级管理员权限，基础功能访问

- **核心同步原则与消息路由规则**
  - **操作关联性原则**：一项操作的通知只发送给与该操作直接相关的角色
  - **权限层级原则**：消息同步遵循权限层级，上级管理员接收下级相关操作通知
  - **操作影响范围原则**：根据操作的影响范围确定消息接收者

- **具体同步规则设计**
  - **权限变更操作**：
    + 触发条件：超级管理员调整了超级管理员的权限配置
    + 消息接收者：被调整权限的超级管理员 + 执行操作的超级管理员
    + 消息内容：「您的[权限类型]权限已被[操作人]调整为[新状态]」
    + 同步方式：实时推送 + 滚动提醒
  - **司机信息修改操作**：
    + 触发条件：任何管理员修改了司机个人信息、车辆信息、联系方式等
    + 消息接收者：被修改信息的司机 + 执行操作的管理员 + 该司机的直接管理者
    + 消息内容：「您的[信息类型]已被[操作人]修改」/「您已修改司机[驾驶员姓名]的[信息类型]」
    + 同步方式：实时推送 + 滚动提醒（管理端）+ 静默记录（管理端）
  - **新增司机操作**：
    + 超级管理员新增司机：消息发送给超级管理员和操作者本人
    + 超级管理员新增司机：消息发送给管辖权限内的超级管理员和超级管理员本人
    + 消息内容：「新司机[驾驶员姓名]已加入数据库」
    + 同步方式：实时推送 + 滚动提醒
  - **日常审批操作**：
    + 触发条件：请假审批、加班申请审批等日常审批操作
    + 消息接收者：仅涉及操作双方（申请人和审批人）
    + 消息内容：「您的[申请类型]已被[审批人][审批结果]」/「您已[审批结果]了[申请人]的[申请类型]」
    + 同步方式：实时推送 + 滚动提醒（申请人端）+ 静默记录（审批人端）
  - **数据库重要变更**：
    + 触发条件：数据库配置变更、重要功能上线、安全策略调整等
    + 消息接收者：所有相关角色管理员
    + 消息内容：「数据库[变更类型]通知：[具体内容]」
    + 同步方式：全端推送 + 强制滚动提醒

### 3.2 滚动提醒逻辑设计
- **提醒触发条件**
  - **全局性通知触发**：权限变更、人员变动、数据库重要变更等全局性操作
  - **个人重要通知触发**：个人信息被修改、重要审批结果、紧急工作安排等
  - **未读消息累积触发**：未读重要消息数量达到3条时自动触发滚动提醒
  - **时间敏感触发**：具有时效性的消息（如紧急通知、临时安排）立即触发

- **滚动提醒展示设计**
  - **显示位置**：各端工作台顶部固定区域，数据权限表下方
  - **展示方式**：跑马灯形式水平滚动，从右向左匀速移动
  - **内容格式**：「[操作人][操作时间][操作内容]」，如「管理员名字于14:年龄修改了司机紧急联系人姓名的联系方式」
  - **视觉设计**：
    + 背景色：浅橙色(#FFF7ED)突出提醒重要性
    + 文字颜色：深橙色(#C2410C)确保可读性
    + 滚动速度：每秒年龄像素，确保管理员能够阅读
    + 字体大小：14px，适中的可读性

- **滚动频率与循环机制**
  - **持续显示**：提醒内容保持常亮显示，不间断滚动
  - **循环周期**：单条消息滚动完成后，间隔2秒重新开始滚动
  - **多消息轮播**：多条提醒消息时，按时间顺序轮播显示，每条消息显示年龄秒
  - **优先级排序**：紧急消息优先显示，数据库消息次之，日常消息最后

- **提醒停止逻辑**
  - **自动停止机制**：
    + 时间停止：单条提醒首次出现后持续滚动显示5分钟后自动停止并消失
    + 过期停止：超过24小时的消息自动停止滚动提醒
    + 数据库停止：数据库检测到管理员长时间未活跃时暂停滚动提醒
  - **手动停止机制**：
    + 关闭按钮：提醒区域右侧显示「×」关闭按钮，点击立即停止当前滚动提醒
    + 确认按钮：提供「知道了」按钮，点击后停止提醒并标记消息为已读
    + 暂停功能：提供「暂停提醒」选项，暂停1小时后自动恢复
  - **已读停止机制**：
    + 点击跳转：管理员点击滚动提醒内容，自动跳转至信息中心对应消息详情
    + 自动标记：跳转后自动将该条消息标记为已读状态
    + 立即停止：标记为已读后，该条消息的滚动提醒立即停止

### 3.3 信息中心设计
- **信息中心入口设计**
  - **位置布局**：各端工作台右上角显眼位置设置「信息中心」图标入口
  - **图标设计**：铃铛图标，未读消息时显示红色数字徽章
  - **快速访问**：支持从滚动提醒直接点击跳转到信息中心
  - **权限控制**：所有角色管理员均可访问，但仅显示与自己相关的消息

- **信息中心界面功能**
  - **消息列表展示**：
    + 时间排序：按消息接收时间倒序显示，最新消息在顶部
    + 状态标识：清晰区分已读（灰色）和未读（蓝色背景）消息
    + 消息预览：显示消息标题、发送时间、消息类型图标
    + 详情展开：点击消息可展开查看完整内容和相关操作记录
  - **消息分类筛选**：
    + 数据库通知：数据库配置变更、功能更新、安全提醒等
    + 审批结果：请假审批、加班申请、权限申请等审批结果
    + 人员变动：新增管理员、信息修改、权限变更等人员相关通知
    + 工作安排：任务分配、仓库调整、考勤规则变更等工作相关通知
    + 紧急通知：需要立即处理或关注的重要消息
  - **消息状态管理**：
    + 已读/未读标识：清晰的视觉区分和状态切换
    + 重要性标记：重要消息显示红色感叹号标识
    + 时效性提示：临时性消息显示倒计时或有效期
  - **批量操作功能**：
    + 全部标记为已读：一键将所有未读消息标记为已读
    + 批量删除：选择多条消息进行批量删除操作
    + 分类操作：按消息类型进行批量标记或删除
    + 导出功能：重要消息支持导出为文本或PDF格式

- **消息详情页面**
  - **详细信息显示**：
    + 消息完整内容：显示消息的详细描述和相关背景信息
    + 操作记录：显示相关的操作历史和变更记录
    + 相关人员：显示消息涉及的所有相关人员信息
    + 时间轴：显示消息产生的完整时间线和处理过程
  - **相关操作**：
    + 标记重要：将消息标记为重要，优先显示
    + 转发分享：将消息转发给其他相关人员
    + 添加备注：为消息添加个人备注和处理记录
    + 关联查看：查看与该消息相关的其他消息和操作记录

### 3.4 整体流程示例
- **权限变更流程示例**
  - **事件**：超级管理员A为超级管理员B开启了「司机资料管理权限」
  - **消息生成**：数据库自动生成两条消息
    + 给超级管理员B：「您的司机资料管理权限已被管理员A开启，现在您可以修改司机的基本资料信息」
    + 给超级管理员A：「您已为管理员B开启司机资料管理权限」
  - **同步流程**：
    1. 消息立即发送到超级管理员B的消息队列
    2. 超级管理员B端触发滚动提醒：「管理员A于15:20为您开启了司机资料管理权限」
    3. 超级管理员A端信息中心静默记录操作日志，不触发滚动提醒
    4. 超级管理员B看到滚动提醒后可选择：
       - 忽略：5分钟后自动消失，信息中心保留未读红点
       - 点击关闭：立即停止滚动，消息保持未读状态
       - 点击内容：跳转信息中心查看详情，自动标记已读，停止滚动

- **司机信息修改流程示例**
  - **事件**：超级管理员A修改了司机C的联系方式
  - **消息生成**：数据库生成三条消息
    + 给司机C：「您的联系方式已被管理员A修改，请确认新的联系信息」
    + 给超级管理员A：「您已成功修改司机C的联系方式」
    + 给超级管理员（如果司机C归其管理）：「司机C的联系方式已被管理员A修改」
  - **同步流程**：
    1. 司机C端立即触发滚动提醒显示修改通知
    2. 超级管理员A端信息中心静默记录操作确认
    3. 相关错误管理端根据管理关系决定是否触发提醒
    4. 所有相关人员的信息中心都保留完整的操作记录

- **请假审批流程示例**
  - **事件**：超级管理员A通过了司机B的请假申请
  - **消息生成**：
    + 给司机B：「您的请假申请已被管理员A批准，请假时间：2025年11月15日-16日」
    + 给超级管理员A：「您已批准司机B的请假申请」
  - **同步流程**：
    1. 司机B端立即触发滚动提醒：「管理员A于16:45批准了您的请假申请」
    2. 超级管理员A端信息中心静默记录审批操作，不触发滚动提醒
    3. 司机B可通过点击提醒查看详细的请假批准信息
    4. 数据库同时更新司机B的考勤状态，启用请假豁免逻辑

## 4. 权限配置优化数据库
### 4.1 超级管理员对超级管理员权限配置逻辑
- **管理员信息修改权限配置**
  - 权限开关：超级管理员可为超级管理员开启「允许管理员信息修改权」
  - 权限效果：开启后，该超级管理员在「司机管理」功能中拥有与超级管理员同等的完整司机管理权限
  - 具体权限：
    + 查看所有司机信息：紧急联系人姓名、手机号、工号、车牌号、状态等完整信息
    + 修改司机基本信息：个人资料、联系方式、车辆信息等
    + 司机状态管理：激活、禁用、锁定司机账户
    + 司机权限分配：为司机分配仓库、路线、车辆等资源
    + 司机数据导出：导出司机信息报表和统计数据
  - 权限验证：每次操作前验证该超级管理员是否具有此项权限

- **管理员计件数据修改权限配置**
  - 权限开关：超级管理员可为超级管理员开启「管理员计件数据修改权」
  - 权限效果：开启后，该超级管理员拥有与超级管理员同等的完整计件记录管理权限
  - 具体权限：
    + 添加计件记录：为任意司机添加新的计件工作记录
    + 修改计件数据：修改已有计件记录的数量、时间、备注等信息
    + 删除计件记录：删除错误或无效的计件记录
    + 计件数据审核：审核司机提交的计件申请和数据
    + 计件统计分析：查看和导出计件数据计件报表
    + 计件规则设置：设置计件单价、奖励规则、考核标准等
  - 数据权限：可操作所有司机的计件数据，不受部门或层级限制

- **考勤规则管理权限配置**
  - 权限开关：超级管理员可为超级管理员开启「考勤规则管理权」
  - 权限效果：开启后，该超级管理员拥有与超级管理员同等的完整仓库考勤规则设置权限
  - 具体权限：
    + 考勤时间设置：设置各仓库的上下班时间、休息时间
    + 考勤规则配置：设置迟到早退规则、加班规则、请假规则
    + 特殊考勤处理：设置节假日考勤、轮班制度、弹性工作时间
    + 考勤地点管理：设置考勤打卡的有效地理位置范围
    + 考勤异常处理：设置异常考勤的处理流程和审批机制
    + 考勤报表配置：设置考勤计件报表的生成规则和周期
  - 适用范围：权限覆盖该超级管理员管理范围内的所有仓库

### 4.2 权限配置界面设计
- **权限配置入口**
  - 位置：管理员工作台「管理员管理」模块内
  - 显示：权限配置卡片，显示当前已配置权限数量
  - 访问控制：仅超级管理员可见和操作

- **权限配置操作界面**
  - 管理员选择：选择需要配置权限的超级管理员
  - 权限开关：三个主要权限的开关控制
    + 管理员信息修改权：绿色开关，开启后显示「已授权司机管理权限」
    + 管理员计件数据修改权：蓝色开关，开启后显示「已授权计件数据管理权限」
    + 考勤规则管理权：橙色开关，开启后显示「已授权考勤规则设置权限」
  - 权限说明：每个权限开关下方显示详细的权限说明和影响范围
  - 保存确认：权限配置修改需要二次确认，显示权限变更影响

### 4.3 权限验证与生效机制
- **实时权限验证**
  - 登录验证：管理员登录时加载最新权限配置
  - 操作验证：每次功能操作前验证当前管理员权限
  - 权限缓存：权限信息缓存年龄分钟，变更后立即刷新

- **权限生效流程**
  - 即时生效：权限配置保存后立即生效
  - 通知机制：权限变更后通知相关管理员
  - 日志记录：详细记录权限配置变更的操作日志

- **权限冲突处理**
  - 优先级规则：超级管理员权限 > 配置权限 > 默认权限
  - 权限继承：下级权限不能超越上级权限范围
  - 异常处理：权限冲突时采用最小权限原则

## 5. 仓库管理模块重构
### 5.1 模块概述与功能整合
- **模块重命名**
  - 原名称：品类管理
  - 新名称：仓库管理
  - 功能gps：综合性仓库运营管理中心
  - 适用角色：超级管理员（完整权限）、超级管理员（根据权限配置）

- **功能区域整合**
  - 司机分配：为司机分配负责的仓库和工作区域
  - 品类管理：设置、添加、修改商品品类和分类规则
  - 考勤规则设置：管理仓库考勤相关规则和时间配置
  - 数据统计：仓库运营数据统计和分析报表

### 5.2 司机分配功能区
- **司机仓库分配管理**
  - 分配界面：显示所有司机和仓库的分配关系矩阵
  - 分配操作：
    + 单个分配：为单个司机分配一个或多个仓库
    + 批量分配：为多个司机批量分配相同仓库
    + 取消分配：取消司机的仓库分配关系
    + 临时分配：设置临时性的仓库分配（带有效期）
  - 分配规则：
    + 一个司机可以分配多个仓库
    + 一个仓库可以分配多个司机
    + 支持主要仓库和辅助仓库的区分
    + 支持分配优先级设置

- **分配状态管理**
  - 状态显示：实时显示司机的仓库分配状态
  - 状态类型：
    + 主要负责：司机主要负责的仓库（绿色标识）
    + 辅助支持：司机辅助支持的仓库（蓝色标识）
    + 临时分配：临时分配的仓库（橙色标识，显示到期时间）
    + 暂停分配：暂时停止的分配关系（灰色标识）
  - 状态变更：支持分配状态的实时变更和历史记录

- **分配数据统计**
  - 司机工作量统计：按仓库统计司机的工作分配情况
  - 仓库人员配置：统计各仓库的司机配置和人员充足度
  - 分配效率分析：分析司机仓库分配的合理性和效率
  - 分配历史记录：查看司机仓库分配的历史变更记录

### 5.3 品类管理功能区
- **品类信息管理**
  - 品类列表：显示所有商品品类的层级结构
  - 品类操作：
    + 添加品类：新增一级品类或子品类
    + 修改品类：编辑品类名称、描述、属性等信息
    + 删除品类：删除无用品类（需确认无关联数据）
    + 品类排序：调整品类在列表中的显示顺序
  - 品类属性：
    + 品类编码：数据库自动生成或手动设置的唯一编码
    + 品类名称：品类的中文名称和英文名称
    + 品类描述：详细的品类说明和特征描述
    + 计件单价：该品类商品的计件工作单价
    + 存储要求：品类商品的存储条件和要求

- **品类层级管理**
  - 层级结构：支持多级品类层级结构（最多5级）
  - 层级操作：
    + 创建子品类：在现有品类下创建子分类
    + 移动品类：调整品类在层级结构中的位置
    + 合并品类：将多个相似品类合并为一个
    + 拆分品类：将一个品类拆分为多个子品类
  - 层级显示：树形结构显示品类层级关系

- **品类规则设置**
  - 计件规则：设置不同品类的计件标准和计算方式
  - 存储规则：设置品类商品的存储位置和存储方式
  - 操作规则：设置品类商品的装卸、搬运、分拣等操作规范
  - 质量标准：设置品类商品的质量检查标准和要求

### 5.4 考勤规则设置功能区
- **仓库考勤时间配置**
  - 基础时间设置：
    + 正常工作时间：设置各仓库的标准上下班时间
    + 休息时间：设置午休时间和其他休息时间段
    + 加班时间：设置加班开始时间和加班费计算规则
    + 弹性时间：设置允许的弹性上下班时间范围
  - 特殊时间配置：
    + 节假日安排：设置法定节假日和公司假期的考勤安排
    + 轮班制度：设置多班次轮班的时间安排和交接规则
    + 夜班安排：设置夜班工作时间和夜班津贴规则

- **考勤规则配置**
  - 迟到早退规则：
    + 迟到容忍时间：设置不计为迟到的容忍时间（如5分钟）
    + 迟到处罚规则：设置迟到的扣款或处罚标准
    + 早退认定标准：设置早退的时间认定和处理方式
  - 请假规则：
    + 请假类型：设置不同类型请假的审批流程和扣款规则
    + 请假时长限制：设置各类请假的最长时间限制
    + 请假审批权限：设置不同级别请假的审批人员
  - 异常考勤处理：
    + 忘记打卡：设置忘记打卡的补卡流程和时间限制
    + 设备故障：设置考勤设备故障时的应急处理方案
    + 外出工作：设置外出工作时的考勤认定标准

- **考勤地点管理**
  - 打卡地点设置：
    + 仓库位置：设置各仓库的gps坐标和打卡有效范围
    + 范围调整：根据实际情况调整打卡有效范围大小
    + 多点打卡：设置一个仓库多个打卡点的情况
  - 地点验证规则：
    + 位置偏差容忍：设置gpsgps偏差的容忍范围
    + 网络异常处理：设置网络异常时的打卡验证方式
    + 特殊情况处理：设置特殊情况下的打卡地点豁免规则

### 5.5 仓库管理数据统计
- **综合数据仪表盘**
  - 实时数据显示：
    + 当前在线司机数量和分布情况
    + 各仓库的工作状态和人员配置
    + 今日考勤统计和异常情况汇总
    + 品类操作量统计和效率分析
  - 数据可视化：采用图表形式展示关键数据指标

- **司机分配统计**
  - 分配效率统计：统计司机仓库分配的合理性和工作效率
  - 工作量平衡分析：分析各司机工作量分配的均衡性
  - 仓库人员充足度：统计各仓库的人员配置充足程度
  - 分配变更趋势：分析司机仓库分配的变更趋势和原因

- **品类管理统计**
  - 品类操作量统计：统计各品类的操作频次和工作量
  - 品类效率分析：分析不同品类的操作效率和时间消耗
  - 品类收益统计：统计各品类的计件收益和成本分析
  - 品类趋势分析：分析品类操作量的时间趋势和季节性变化

- **考勤数据统计**
  - 考勤合规率：统计各仓库的考勤合规情况和改善趋势
  - 异常考勤分析：分析考勤异常的类型、频次和处理情况
  - 加班统计：统计各仓库的加班情况和加班费用
  - 请假统计：统计请假申请的类型、频次和审批情况

## 6. 管理员注册模块重构
### 6.1 多渠道注册支持
- **手机号注册**
  - 手机号格式验证：正则表达式验证、运营商号段检查
  - 验证码发送：短信验证码生成、发送、验证
  - 重复性检查：数据库唯一性约束、实时查重
  - 安全机制：发送频率限制、验证码有效期控制
- **邮箱注册**
  - 邮箱格式验证：邮箱格式检查、域名有效性验证
  - 邮件验证：验证邮件发送、链接验证、激活确认
  - 重复性检查：邮箱唯一性验证、黑名单过滤

### 6.2 账号麻麻强度校验规则
- **账号麻麻复杂度要求**
  - 长度要求：最少8位，最多20位字符
  - 字符类型：必须包含大小写字母、数字，建议包含特殊字符
  - 弱账号麻麻检测：常见账号麻麻黑名单、个人信息相关账号麻麻检测
  - 强度评分：实时计算账号麻麻强度分数（弱/中/强）
- **账号麻麻安全存储**
  - 加密算法：使用bcrypt进行账号麻麻哈希
  - 盐值生成：随机盐值生成和存储
  - 存储分离：账号麻麻哈希与管理员信息分表存储

### 6.3 注册流程优化
- **分步骤注册**
  - 第一步：基础信息填写（紧急联系人姓名、手机号/邮箱）
  - 第二步：身份验证（验证码验证）
  - 第三步：账号麻麻设置（账号麻麻创建、确认）
  - 第四步：补充信息（车牌号等可选信息）
  - 第五步：信息确认（最终确认提交）
- **实时验证机制**
  - 前端验证：输入格式实时检查、管理员体验优化
  - 后端验证：数据完整性验证、安全性检查
  - 异步验证：管理员名/手机号可用性异步检查
- **自动激活机制**
  - 注册完成后管理员状态自动设置为active
  - 无需等待审核，可立即登录使用
  - 数据库自动分配默认权限

## 7. 登录认证模块重构（新增手机号直接登录）
### 7.1 多种登录方式实现
- **手机号+验证码登录**
  - 验证码生成：6位数字验证码、5分钟有效期
  - 发送机制：短信服务集成、发送状态跟踪
  - 验证流程：验证码校验、登录状态创建
- **手机号+账号麻麻登录（新增功能）**
  - 手机号直接登录：支持11位手机号（如手机号码）直接作为登录凭据
  - 输入验证：11位数字格式验证，无需格式转换或特殊处理
  - 账号麻麻验证：哈希比对、登录尝试记录
  - 数据库查询：直接使用输入的手机号匹配管理员表phone字段
  - 安全检查：异常登录检测、IP地址验证
- **工号+账号麻麻登录**
  - 工号验证：工号格式检查、有效性验证
  - 兼容性支持：传统登录方式保持兼容

### 7.2 手机号登录技术实现方案
- **前端界面修改**
  - 登录表单：添加手机号输入选项，支持11位数字直接输入
  - 输入验证：实时验证手机号格式（11位数字）
  - 管理员体验：提供登录方式切换（管理员名/手机号/工号）
  - 错误提示：针对手机号登录的专门错误提示
- **后端验证逻辑**
  - 登录类型识别：自动识别输入类型（手机号/管理员名/工号）
  - 手机号验证：与注册时相同的11位数字验证规则
  - 数据库查询：SELECT * FROM users WHERE phone = \\'手机号码\\'
  - 兼容性处理：与现有登录方式并行运作，不影响原有功能
- **数据兼容性保障**
  - 现有数据：已有管理员手机号数据保持不变，直接可用
  - 无需迁移：不对现有管理员数据进行任何转换操作
  - 向后兼容：确保原有管理员名和邮箱登录方式正常运作

### 7.3 安全会话管理
- **JWT令牌机制**
  - 令牌生成：管理员信息加密、过期时间设置
  - 令牌验证：每次请求验证、权限检查
  - 令牌刷新：自动刷新机制、无感知更新
- **会话安全策略**
  - 会话超时：年龄分钟无操作自动登出
  - 单点登录：同一测试账号限制并发登录数量
  - 异地登录：异常登录地点检测和通知

### 7.4 登录失败保护机制
- **失败次数限制**
  - 测试账号锁定：5次失败后锁定测试账号 年龄分钟
  - IP限制：同一IP 10次失败后限制1小时
  - 验证码强制：3次失败后强制图形验证码
- **异常行为检测**
  - 登录频率监控：异常高频登录检测
  - 设备指纹：设备信息收集和异常设备检测
  - 行为分析：登录时间、地点异常分析

## 8. 智能考勤打卡提醒与请假管理数据库
### 8.1 每日首次登录检测机制
- **登录状态识别**
  - 首次登录判断：基于当日登录记录判断是否为首次登录
  - 时间窗口计算：以自然日（00:00-23:59）为计算周期
  - 登录记录追踪：记录每次登录时间和设备信息
  - 状态缓存机制：缓存当日首次登录状态，避免重复检测

- **打卡状态检测逻辑**
  - 当日打卡查询：SELECT * FROM attendance WHERE user_id = ? AND DATE(check_time) = CURDATE()
  - 打卡类型验证：检查上班打卡、下班打卡的完成状态
  - 请假状态优先级：优先检查当日是否有已批准的请假记录
  - 异常状态处理：处理跨日打卡、补卡等特殊情况

- **智能提醒弹窗机制**
  - 弹窗触发条件：首次登录 + 未打卡 + 非请假状态
  - 提醒内容设计：「您今日尚未打卡，是否立即去打卡？」
  - 按钮交互设计：
    + 「是」按钮：wx.navigateTo跳转至考勤打卡页面
    + 「否」按钮：关闭弹窗，正常进入数据库主界面
  - 弹窗样式设计：模态弹窗，背景半透明遮罩，圆角卡片设计

### 8.2 启动计件工作前的二次检测
- **计件功能入口检测**
  - 功能按钮监听：监听「开始计件」、「接单工作」等相关按钮点击事件
  - 权限预检查：验证管理员是否具有计件操作权限
  - 状态前置验证：在执行计件逻辑前进行打卡状态二次验证

- **二次检测逻辑实现**
  - 实时状态查询：重新查询当前管理员的打卡状态和请假状态
  - 状态变更检测：检测自首次登录后是否有新的打卡或请假记录
  - 缓存失效机制：清除相关缓存，确保获取最新状态

- **阻断机制与管理员引导**
  - 未打卡阻断：未打卡状态下阻止计件功能执行
  - 提醒弹窗复用：使用与首次登录相同的提醒弹窗样式和交互逻辑
  - 操作流程引导：提供清晰的操作路径，引导管理员完成打卡后返回计件功能

### 8.3 请假状态的豁免逻辑
- **请假状态判断机制**
  - 请假记录查询：SELECT * FROM leave_requests WHERE user_id = ? AND DATE(?) BETWEEN start_date AND end_date AND status = \\'approved\\'
  - 请假类型识别：区分全天请假、半天请假、小时请假等不同类型
  - 请假时间计算：精确计算请假时间范围，支持跨日请假
  - 状态优先级：请假状态优先于打卡检测，已请假则跳过所有打卡相关检测

- **工作台状态提示设计**
  - 休息状态标识：在超级管理员工作台右侧显示醒目的「今天您休息」提示
  - 视觉设计规范：
    + 背景色：温和的蓝绿色(#E0F7FA)
    + 文字颜色：深蓝色(#01579B)
    + 图标设计：休息图标或日历图标
    + 位置布局：工作台右上角固gps置显示
  - 动态更新机制：请假状态变更时实时更新提示内容

- **功能权限限制实现**
  - 打卡功能禁用：
    + 打卡按钮置灰处理
    + 点击时显示「您今日已请假，无需打卡」提示
    + 禁用打卡相关的所有交互功能
  - 计件功能禁用：
    + 计件相关按钮全部禁用
    + 显示「休息期间无法进行计件操作」提示
    + 阻止所有与工作计件相关的功能访问
  - 其他功能保持：
    + 个人信息查看和修改功能正常
    + 数据库设置和配置功能可用
    + 历史记录查询功能开放
    + 请假管理功能（包括撤销请假）保持可用

### 8.4 假期的主动撤销与打卡功能
- **撤销权限与入口设计**
  - 撤销权限控制：仅允许管理员撤销自己的已批准请假
  - 撤销时间限制：仅允许撤销当日及未来的请假（不可撤销历史请假）
  - 功能入口设计：
    + 请假管理页面：显示可撤销的请假记录列表
    + 工作台快捷入口：在「今天您休息」提示旁添加「撤销请假」按钮
    + 个人中心入口：在个人中心添加请假管理快捷入口

- **撤销流程与确认机制**
  - 撤销确认弹窗：
    + 提示内容：「确定要撤销今日的请假吗？撤销后需要正常打卡上班。」
    + 按钮设计：「确定撤销」（红色警告色）、「取消」（灰色）
  - 二次确认机制：重要操作需要管理员再次确认
  - 撤销原因记录：可选填写撤销原因，便于后续管理和统计

- **状态更新与数据库响应**
  - 请假状态更新：UPDATE leave_requests SET status = \\'cancelled\\', cancel_time = NOW() WHERE id = ?
  - 实时状态同步：
    + 立即更新管理员的请假状态缓存
    + 刷新工作台显示状态
    + 恢复打卡和计件功能的正常访问权限
  - 数据库通知机制：
    + 撤销成功后显示「请假已撤销，请及时打卡上班」提示
    + 可选择发送短信或数据库通知给相关管理人员

- **撤销后的智能引导**
  - 打卡状态重新检测：撤销请假后立即触发打卡状态检测逻辑
  - 自动跳转引导：撤销成功后询问是否立即跳转到打卡页面
  - 计件功能恢复：确保撤销后管理员可以正常访问计件和工作相关功能
  - 状态提示更新：工作台的「今天您休息」提示立即消失，恢复正常工作状态显示

## 9. 管理员工作台仪表盘考勤管理功能（修改后）
### 9.1 工作台仪表盘设计
- **考勤管理入口**
  - 入口位置：工作台仪表盘主要功能区域，显著位置展示
  - 显示内容：「考勤管理」功能卡片，包含车辆总数和待审批信息
  - 车辆总数显示：实时显示数据库中的车辆总数，如「车辆总数：125人」
  - 待审批显示：实时显示待审批请假申请数量，如「待审批：3件」
  - 视觉设计：采用蓝色主色调(#3B82F6)体现管理功能的专业性
  - 权限控制：仅具有审批权限的管理员（超级管理员、超级管理员）可见此入口

- **快速跳转机制**
  - 点击响应：点击「考勤管理」卡片直接跳转至考勤管理界面
  - 页面路由：wx.navigateTo({ url: \\'/pages/attendance/management\\' })
  - 状态传递：跳转时传递当前管理员权限和管理范围参数
  - 返回机制：管理完成后可快速返回工作台仪表盘

### 9.2 考勤管理界面设计
- **车辆总数统计区域**
  - 统计显示：显示数据库中所有员工的总数统计
  - 分类统计：按角色分类显示（超级管理员、司机、超级管理员等）
  - 状态统计：按员工状态分类显示（在职、离职、暂停等）
  - 实时更新：司机数据变更时实时更新统计信息

- **待审批管理区域**
  - 审批列表：按申请时间倒序显示所有待审批请假申请
  - 信息展示：申请人紧急联系人姓名、请假类型、请假时间、请假天数、申请原因
  - 状态标识：清晰标识「待审批」状态，使用黄色标签(#FCD34D)
  - 快速审批：提供「批准」和「驳回」快速操作按钮

- **司机统计区域（修改后）**
  - 打卡次数统计：显示司机的打卡次数和考勤情况
  - 离职申请次数：仅在司机有离职申请时显示离职申请次数
  - 条件显示逻辑：
    + 有离职申请：显示「离职申请：2次」
    + 无离职申请：显示「打卡次数：156次」
  - 详细记录入口：提供「详细记录」按钮，跳转至详细记录页面

### 9.3 详细记录页面设计（修改后）
- **页面结构调整**
  - 原有结构：请假申请 + 离职申请（2个页面）
  - 修改后结构：请假申请 + 打卡记录（2个页面）
  - 离职申请页面：仅在司机有离职申请时显示

- **请假申请页面**
  - 申请列表：显示司机的所有请假申请记录
  - 状态筛选：支持按审批状态筛选（待审批、已批准、已驳回、已撤销）
  - 时间筛选：支持按申请时间范围筛选
  - 详情查看：点击记录可查看详细的请假信息和审批过程

- **打卡记录页面（新增）**
  - 打卡列表：显示司机的所有打卡记录
  - 记录信息：打卡时间、打卡地点、打卡状态（正常、迟到、早退等）
  - 统计信息：显示出勤率、迟到次数、早退次数等统计数据
  - 筛选功能：支持按时间范围、打卡状态等条件筛选

- **离职申请页面（条件显示）**
  - 显示条件：仅在司机有离职申请时显示此页面
  - 流程记录：显示离职申请的完整流程和当前状态
  - 审批进度：显示离职审批的各个环节和处理情况
  - 相关文档：显示离职相关的文档和材料

### 9.4 权限控制与数据范围
- **角色权限设置**
  - 超级管理员权限：可查看所有员工的考勤管理信息
  - 超级管理员权限：可查看管理范围内员工的考勤管理信息
  - 司机权限：无考勤管理权限，仅能查看自己的考勤记录
  - 超级管理员权限：无考勤管理权限，仅能查看自己的考勤记录

- **数据范围限制**
  - 部门限制：根据管理员所属部门限制可查看的数据范围
  - 级别限制：下级不能查看上级的考勤管理信息
  - 权限验证：每次访问前验证当前管理员的查看权限
  - 数据脱敏：对敏感信息进行适当的脱敏处理

## 10. 管理员管理功能模块（优化超级管理员司机资料管理权限）
### 10.1 超级管理员管理权限（新增司机资料管理）
- **管理员信息修改权限**
  - 查看所有管理员：超级管理员可查看数据库中所有管理员的基本信息
  - 修改管理员信息：可修改任意管理员的个人信息，包括紧急联系人姓名、手机号、邮箱、工号、车牌号等
  - 管理员状态管理：可激活、禁用、锁定任意管理员测试账号
  - 权限分配：可为管理员分配或修改角色权限

- **司机基本资料管理权限（新增功能）**
  - 司机资料查看：可查看所有司机的完整基本资料信息
    + 个人信息：紧急联系人姓名、身份证号、联系电话、家庭地址等
    + 工作信息：工号、入职时间、所属部门、岗位职责等
    + 车辆信息：车牌号、驾驶证号、车辆类型、保险信息等
    + 紧急联系人：联系人紧急联系人姓名、关系、联系方式等
  - 司机资料修改：可修改司机的基本资料信息
    + 个人资料修改：更新司机的个人信息、联系方式、家庭地址等
    + 工作资料修改：调整工号、部门分配、岗位设置等
    + 车辆资料修改：更新车牌号、驾驶证信息、车辆状态等
    + 紧急联系人修改：更新紧急联系人信息和联系方式
  - 资料完整性检查：确保司机资料信息的完整性和准确性
  - 修改权限控制：基于超级管理员角色的司机资料修改权限验证

### 10.2 超级管理员司机资料管理权限
- **司机资料查看权限**
  - 基础信息查看：可查看司机的基本个人信息和工作信息
  - 车辆信息查看：可查看司机的车辆相关信息和状态
  - 联系信息查看：可查看司机的联系方式和紧急联系人
  - 历史记录查看：可查看司机的工作历史和变更记录

- **司机资料修改权限（新增功能）**
  - 个人信息修改：可修改司机的个人基本信息
    + 紧急联系人姓名修改：更新司机的中文紧急联系人姓名和英文紧急联系人姓名
    + 联系方式修改：更新手机号、邮箱、家庭地址等联系信息
    + 身份信息修改：更新身份证号、出生日期等身份信息
  - 工作信息修改：可修改司机的工作相关信息
    + 工号调整：更新司机的工号和员工编码
    + 部门分配：调整司机所属部门和工作组
    + 岗位设置：更新司机的岗位职责和工作范围
  - 车辆信息修改：可修改司机的车辆相关信息
    + 车牌号更新：更新司机负责的车辆车牌号
    + 驾驶证信息：更新驾驶证号、有效期、准驾车型等
    + 车辆状态：更新车辆的使用状态和维护信息
  - 紧急联系人修改：可修改司机的紧急联系人信息
    + 联系人信息：更新紧急联系人的紧急联系人姓名、关系、联系方式
    + 多联系人管理：支持添加、修改、删除多个紧急联系人

### 10.3 司机资料管理界面设计
- **司机列表管理**
  - 司机搜索：支持按紧急联系人姓名、工号、车牌号、部门等条件搜索司机
  - 司机筛选：按司机状态、部门、入职时间等条件筛选
  - 批量操作：支持批量选择司机进行资料修改或状态更新
  - 列表显示：显示司机基本信息、工作状态、车辆信息等关键信息

- **司机资料编辑界面**
  - 分类编辑：将司机资料分为个人信息、工作信息、车辆信息、联系信息四个模块
  - 表单验证：实时验证输入信息的格式和有效性
  - 必填项标识：明确标识必填项和可选项
  - 保存确认：重要信息修改需要二次确认
  - 修改历史：显示司机资料的修改历史记录

- **权限控制界面**
  - 权限验证：根据当前管理员角色显示可编辑的字段
  - 只读字段：对于无权限修改的字段显示为只读状态
  - 操作提示：对于权限不足的操作显示相应提示信息
  - 审批流程：重要资料修改可能需要上级审批确认

### 10.4 账号麻麻重置功能
- **统一账号麻麻重置**
  - 重置规则：超级管理员可将任意管理员的登录账号麻麻重置为统一账号麻麻「123456」
  - 重置流程：选择目标管理员 → 确认重置操作 → 数据库自动将账号麻麻重置为123456
  - 安全验证：执行账号麻麻重置前需要输入当前超级管理员的账号麻麻进行二次确认
  - 通知机制：账号麻麻重置后数据库自动通知目标管理员（短信/邮件）
- **批量账号麻麻重置**
  - 批量选择：支持选择多个管理员进行批量账号麻麻重置
  - 批量确认：批量操作前显示影响管理员列表，需要确认后执行
  - 操作日志：详细记录每次账号麻麻重置操作，包括操作人、目标管理员、操作时间

### 10.5 个人信息管理界面
- **管理员列表管理**
  - 管理员搜索：支持按紧急联系人姓名、手机号、工号、角色等条件搜索管理员
  - 管理员筛选：按管理员状态、角色类型、注册时间等条件筛选
  - 批量操作：支持批量选择管理员进行信息修改或账号麻麻重置
- **管理员信息编辑**
  - 信息修改表单：提供完整的管理员信息编辑表单
  - 实时验证：修改过程中实时验证信息格式和唯一性
  - 修改确认：重要信息修改需要二次确认
- **操作权限控制**
  - 权限验证：每次操作前验证当前管理员是否具有超级管理员权限
  - 操作限制：超级管理员不能修改其他超级管理员的权限级别
  - 审计追踪：所有管理员管理操作都记录详细的审计日志

### 10.6 司机资料管理操作日志
- **操作记录追踪**
  - 修改日志：详细记录司机资料的每次修改操作
  - 操作人记录：记录执行修改操作的管理员信息
  - 修改内容：记录修改前后的具体内容变化
  - 操作时间：精确记录操作的时间戳

- **审计功能**
  - 操作审计：提供司机资料修改的完整审计追踪
  - 权限审计：记录权限验证和授权过程
  - 异常监控：监控异常的资料修改操作
  - 报表导出：支持操作日志的报表导出功能

## 11. 页面刷新功能模块
### 11.1 下拉刷新功能实现
- **全页面支持**
  - 登录页面：支持下拉刷新重新加载登录状态和配置信息
  - 注册页面：支持下拉刷新重置表单状态和验证信息
  - 管理员管理页面：支持下拉刷新更新管理员列表和状态信息
  - 数据统计页面：支持下拉刷新获取最新统计数据和图表
  - 个人信息页面：支持下拉刷新更新个人资料和权限信息
  - 数据库设置页面：支持下拉刷新加载最新配置和数据库状态
  - 考勤打卡页面：支持下拉刷新更新打卡记录和状态
  - 请假管理页面：支持下拉刷新获取最新请假记录和审批状态
  - 考勤管理页面：支持下拉刷新获取最新车辆总数、待审批和司机统计信息
  - 权限配置页面：支持下拉刷新更新权限配置状态和管理员列表
  - 仓库管理页面：支持下拉刷新更新仓库数据、司机分配和品类信息
  - 司机资料管理页面：支持下拉刷新更新司机资料列表和详细信息
  - 信息中心页面：支持下拉刷新获取最新消息和通知状态
  - 管理端请假审批管理页面：支持下拉刷新更新审批列表和状态信息
  - 司机打卡记录查看页面：支持下拉刷新获取最新打卡记录和统计数据
  - 详细记录页面：支持下拉刷新更新请假申请和打卡记录信息

### 11.2 刷新交互设计
- **下拉手势识别**
  - 触发距离：下拉距离超过80px时触发刷新准备状态
  - 释放刷新：下拉距离超过120px后释放手指触发刷新
  - 手势反馈：下拉过程中提供实时视觉反馈和触觉反馈
- **刷新状态提示**
  - 准备状态：显示「下拉刷新」文字和向下箭头图标
  - 可刷新状态：显示「释放刷新」文字和向上箭头图标
  - 刷新中状态：显示「正在刷新」文字和旋转加载图标
  - 完成状态：显示「刷新完成」文字和成功图标，1秒后自动隐藏

### 11.3 数据更新机制
- **实时数据获取**
  - API调用：刷新时重新调用相关数据接口获取最新信息
  - 缓存清理：清除页面相关的本地缓存数据
  - 状态同步：更新页面组件状态和数据绑定
- **增量更新优化**
  - 差异对比：对比新旧数据，仅更新发生变化的部分
  - 动画过渡：数据更新时提供平滑的动画过渡效果
  - 性能优化：避免全量重新渲染，提升刷新性能

### 11.4 异常处理机制
- **网络异常处理**
  - 超时处理：刷新请求超时（10秒）后显示超时提示
  - 重试机制：网络失败时提供重试按钮，最多重试3次
  - 离线提示：检测到网络断开时显示离线状态提示
- **错误状态显示**
  - 错误提示：刷新失败时显示具体错误信息和解决建议
  - 降级处理：刷新失败时保持原有数据显示，不影响管理员操作
  - 日志记录：记录刷新失败的详细日志用于问题排查

## 12. 管理端请假审批管理优化
### 12.1 管理端审批权限优化
- **审批权限细化管理**
  - 权限层级控制：根据管理员角色细化审批权限范围
    + 超级管理员：可审批所有级别管理员的请假申请，无权限限制
    + 超级管理员：可审批超级管理员和司机的请假申请，不能审批同级或上级管理员
    + 部门负责人：可审批本部门内所有管理员的请假申请
    + 项目负责人：可审批项目组内成员的请假申请
  - 审批范围动态配置：支持根据组织架构动态调整审批权限范围
  - 权限验证机制：每次审批操作前进行实时权限验证和范围检查

- **审批流程简化**
  - 一键审批：支持批量选择多个请假申请进行统一审批操作
  - 快速审批：常见请假类型提供预设审批模板和快速操作按钮
  - 审批预览：审批前提供完整的申请信息预览和影响分析
  - 审批撤回：支持审批人在特定时间内撤回已完成的审批操作

### 12.2 审批界面管理员体验优化
- **审批列表优化**
  - 智能排序：根据申请紧急程度、申请时间、申请人重要性等多维度智能排序
  - 分类筛选：支持按请假类型、申请部门、紧急程度、申请时间等条件筛选
  - 批量操作：支持批量选择、批量审批、批量驳回等批量操作功能
  - 状态标识：使用不同颜色和图标清晰标识各种审批状态和优先级

- **审批操作界面优化**
  - 滑动操作：支持左滑快速审批、右滑快速驳回的手势操作
  - 审批理由模板：提供常用审批理由模板，减少重复输入
  - 审批历史：显示申请人的历史请假记录和审批情况，辅助决策
  - 实时通知：审批完成后立即推送通知给申请人，提升沟通效率

### 12.3 审批状态跟踪数据库
- **审批进度可视化**
  - 进度条显示：使用进度条直观显示审批流程的当前进度
  - 时间轴展示：以时间轴形式展示审批的完整流程和各节点时间
  - 状态实时更新：审批状态变更时实时更新界面显示和通知相关人员
  - 审批路径追踪：清晰显示审批经过的路径和各级审批人信息

- **审批结果统计**
  - 审批效率统计：统计各审批人的审批速度和处理效率
  - 审批通过率：统计不同类型请假的审批通过率和驳回原因分析
  - 部门审批分析：按部门统计请假申请频次和审批情况
  - 趋势分析报告：生成审批趋势分析报告，辅助管理决策

### 12.4 审批通知优化
- **多渠道通知机制**
  - 小程序内通知：审批结果通过小程序内消息中心实时推送
  - 短信通知：重要审批结果支持短信通知功能（可配置开关）
  - 邮件通知：支持邮件通知审批结果和详细信息（可选功能）
  - 滚动提醒：审批结果触发滚动提醒，确保申请人及时知晓

- **通知内容优化**
  - 个性化通知：根据审批结果和申请类型生成个性化通知内容
  - 详细信息：通知中包含审批人、审批时间、审批意见等详细信息
  - 后续指引：审批通过后提供后续操作指引，驳回后提供申诉渠道
  - 通知历史：保存完整的通知发送历史，支持查询和追溯

## 13. 司机打卡记录查看界面
### 13.1 打卡记录查询功能
- **多维度查询条件**
  - 时间范围查询：支持按日期、周、月、季度、年等时间范围查询打卡记录
  - 司机筛选查询：支持按司机紧急联系人姓名、工号、部门、车辆车牌号等条件筛选
  - 仓库地点查询：支持按仓库名称、仓库编码、地理位置等条件查询
  - 打卡状态查询：支持按正常、迟到、早退、缺勤、补卡等状态筛选
  - 组合条件查询：支持多个查询条件的组合使用，提供精确查询结果

- **高级搜索功能**
  - 模糊搜索：支持司机紧急联系人姓名、仓库名称等字段的模糊搜索
  - 范围搜索：支持工作时长、迟到时间等数值范围搜索
  - 快速筛选：提供「今日」、「本周」、「本月」等快速时间筛选按钮
  - 搜索历史：保存管理员常用的搜索条件，支持快速重复查询

### 13.2 考勤数据统计分析
- **基础统计数据**
  - 出勤率统计：按司机、部门、仓库等维度统计出勤率
  - 迟到早退统计：统计迟到、早退的次数、时长和趋势分析
  - 加班时长统计：统计各司机的加班时长和加班费用计算
  - 异常考勤统计：统计缺勤、忘记打卡、设备异常等异常情况

- **数据可视化展示**
  - 图表展示：使用柱状图、折线图、饼图等形式展示考勤数据
  - 趋势分析：显示考勤数据的时间趋势和变化规律
  - 对比分析：支持不同时间段、不同司机、不同部门的数据对比
  - 排行榜：显示出勤率、准时率等指标的排行榜

### 13.3 记录筛选和排序功能
- **多维度筛选**
  - 状态筛选：按正常、异常、待处理等状态筛选打卡记录
  - 类型筛选：按上班打卡、下班打卡、加班打卡等类型筛选
  - 地点筛选：按打卡地点、仓库区域等地理位置筛选
  - 时间筛选：按工作日、周末、节假日等时间类型筛选

- **灵活排序功能**
  - 时间排序：支持按打卡时间正序或倒序排列
  - 状态排序：优先显示异常状态的打卡记录
  - 司机排序：按司机紧急联系人姓名、工号等字段排序
  - 自定义排序：支持管理员自定义排序规则和优先级

### 13.4 数据导出和报表功能
- **数据导出功能**
  - Excel导出：支持将查询结果导出为Excel格式文件
  - PDF报表：生成格式化的PDF考勤报表
  - CSV格式：支持CSV格式导出，便于数据分析
  - 自定义字段：支持选择需要导出的字段和数据范围

- **报表生成功能**
  - 日报生成：自动生成每日考勤汇总报表
  - 周报月报：定期生成周报、月报等周期性报表
  - 异常报告：生成考勤异常情况的专项报告
  - 统计分析报告：生成包含趋势分析的综合统计报告

### 13.5 界面设计和管理员体验
- **界面布局设计**
  - 列表视图：以表格形式展示打卡记录的详细信息
  - 卡片视图：以卡片形式展示打卡记录，便于移动端查看
  - 日历视图：以日历形式展示考勤情况，直观显示出勤状态
  - 统计视图：专门的统计分析界面，展示图表和数据分析结果

- **交互体验优化**
  - 下拉刷新：支持下拉刷新获取最新打卡记录
  - 无限滚动：支持无限滚动加载更多历史记录
  - 快速gps：提供快速gps到特定日期或记录的功能
  - 详情查看：点击记录可查看详细的打卡信息和相关数据

### 13.6 权限控制和数据安全
- **查看权限控制**
  - 角色权限：根据管理员角色控制可查看的打卡记录范围
    + 超级管理员：可查看所有司机的打卡记录
    + 超级管理员：可查看管理范围内司机的打卡记录
    + 司机：仅可查看自己的打卡记录
    + 超级管理员：仅可查看自己的打卡记录
  - 部门权限：按部门限制可查看的打卡记录范围
  - 时间权限：限制可查看的历史记录时间范围

- **数据安全保护**
  - 敏感信息保护：对敏感的个人信息进行脱敏处理
  - 操作日志：记录所有查看和导出操作的详细日志
  - 数据加密：对导出的数据文件进行加密保护
  - 访问审计：定期审计数据访问情况，确保合规使用

## 14. 测试账号管理配置
### 14.1 数据库测试账号重建流程
- **初始化操作**
  - 清除现有测试账号：删除数据库中所有现有管理员测试账号数据
  - 数据库清理：清空管理员表、权限表、会话表相关数据
  - 缓存清理：清除Redis中所有管理员相关缓存信息
  - 日志记录：记录测试账号清理操作的完整审计日志

### 14.2 预设测试账号配置
- **超级管理员测试账号（admin）**
  - 管理员名：admin
  - 手机号：手机号码（支持直接登录）
  - 权限级别：数据库最高权限
  - 功能权限：完整数据库管理功能，包括管理员管理、数据库配置、数据统计、日志查看、管理员信息修改、账号麻麻重置、考勤管理、请假审批、权限配置、仓库管理、司机资料管理、消息同步管理、管理端请假审批管理、司机打卡记录查看等全部功能模块
  - 操作权限：创建/删除管理员、修改数据库配置、查看所有数据、执行敏感操作、修改所有管理员信息、重置任意管理员账号麻麻、管理所有考勤和请假记录、审批所有请假申请、配置所有管理员权限、管理所有仓库和品类、修改所有司机基本资料、管理消息同步规则和提醒设置、优化管理端审批管理、查看所有司机打卡记录
  - 备注：具备完整数据库管理功能的超级管理员测试账号，包含管理员管理权限、考勤管理权限、请假审批权限、权限配置权限、仓库管理权限、司机资料管理权限、消息同步管理权限、管理端请假审批管理权限和司机打卡记录查看权限

- **超级管理员测试账号（admin123）**
  - 管理员名：admin123
  - 权限级别：普通管理权限
  - 功能权限：管理员管理、数据查看、基础管理功能、考勤数据查看、请假审批（限制范围）、部分仓库管理功能、司机资料管理功能、消息接收和信息中心访问、管理端请假审批管理（限制范围）、司机打卡记录查看（限制范围），限制数据库配置和敏感操作权限
  - 操作权限：管理超级管理员、查看统计数据、查看考勤记录、审批超级管理员和司机请假申请、管理分配的仓库和品类、修改司机基本资料、接收相关消息通知、管理个人信息中心、进行管理端请假审批管理、查看管理范围内司机打卡记录，无法修改数据库配置或删除重要数据
  - 权限配置：可根据超级管理员的权限配置获得对应的扩展权限
  - 司机资料管理：可查看和修改所有司机的基本资料信息
  - 消息权限：可接收管理范围内的消息通知，可访问信息中心，无法配置消息同步规则
  - 管理端审批权限：可进行管理端请假审批管理，审批范围限制在管理权限内
  - 打卡记录查看权限：可查看管理范围内司机的打卡记录和考勤统计
  - 备注：限制部分敏感操作权限的超级管理员测试账号，具备有限的请假审批权限、可配置的仓库管理权限、完整的司机资料管理权限、消息接收权限、管理端请假审批管理权限和限制范围的司机打卡记录查看权限

- **驾驶员姓名测试账号（angxin）**
  - 管理员名：angxin
  - 权限级别：驾驶员姓名专用权限
  - 功能权限：仅限驾驶员姓名相关功能访问，包括个人信息管理、车辆信息查看、任务接收、考勤打卡、请假申请、分配仓库查看、消息接收和信息中心访问、个人打卡记录查看等
  - 操作权限：查看个人数据、更新车辆状态、接收派单任务、进行考勤打卡、申请请假、查看分配的仓库信息、接收个人相关消息通知、管理个人信息中心、查看个人打卡记录和考勤统计，无法访问管理功能和审批功能
  - 消息权限：可接收个人相关的消息通知（如个人信息修改、请假审批结果等），可访问个人信息中心，无法接收管理类消息
  - 打卡记录权限：仅可查看个人的打卡记录和考勤统计，无法查看其他司机信息
  - 备注：仅限驾驶员姓名相关功能访问的专用测试账号，具备完整的考勤和请假功能，可查看分配的仓库信息，具备个人消息接收权限和个人打卡记录查看权限，无审批权限和资料修改权限

- **司机测试账号（angxin）**
  - 管理员名：angxin
  - 权限级别：司机专用权限
  - 功能权限：司机相关功能访问，包括个人信息管理、车辆信息查看、任务接收、考勤打卡、请假申请、分配仓库查看、消息接收和信息中心访问、个人打卡记录查看等
  - 操作权限：查看个人数据、更新车辆状态、接收派单任务、进行考勤打卡、申请请假、查看分配的仓库信息、接收个人相关消息通知、管理个人信息中心、查看个人打卡记录和考勤统计，无法访问管理功能和审批功能
  - 消息权限：可接收个人相关的消息通知，可访问个人信息中心，无法接收管理类消息
  - 打卡记录权限：仅可查看个人的打卡记录和考勤统计，无法查看其他司机信息
  - 备注：司机专用测试账号，具备完整的考勤和请假功能，可查看分配的仓库信息，具备个人消息接收权限和个人打卡记录查看权限，无审批权限和资料修改权限

- **超级管理员测试账号（账号）**
  - 管理员名：账号
  - 权限级别：超级管理员权限
  - 功能权限：基础功能访问，包括个人信息管理、数据查看、基本操作、考勤打卡、请假申请、分配仓库查看、消息接收和信息中心访问、个人打卡记录查看等
  - 操作权限：查看个人数据、更新个人信息、使用基础功能、进行考勤打卡、申请请假、查看分配的仓库信息、接收个人相关消息通知、管理个人信息中心、查看个人打卡记录和考勤统计，无法访问管理功能、敏感操作和审批功能
  - 消息权限：可接收个人相关的消息通知，可访问个人信息中心，无法接收管理类消息
  - 打卡记录权限：仅可查看个人的打卡记录和考勤统计，无法查看其他管理员信息
  - 备注：标准超级管理员权限的账户，具备基础的考勤和请假功能，可查看分配的仓库信息，具备个人消息接收权限和个人打卡记录查看权限，无审批权限和资料修改权限

### 14.3 权限验证机制
- **权限隔离验证**
  - 测试账号间权限隔离：确保不同测试账号只能访问授权范围内的功能和数据
  - 跨权限访问阻止：数据库自动阻止超出权限范围的操作请求
  - 权限边界测试：验证各测试账号权限边界设置的准确性
- **登录可用性验证**
  - 测试账号登录测试：验证五个预设测试账号的登录功能正常
  - 手机号登录测试：验证手机号码等手机号直接登录功能
  - 权限功能测试：确认各测试账号登录后能正常访问对应权限功能
  - 异常处理测试：验证权限不足时的错误提示和处理机制
  - 考勤功能测试：验证各角色的考勤打卡和请假管理功能正常运作
  - 考勤管理功能测试：验证具有管理权限的角色能正常访问考勤管理界面和功能
  - 权限配置测试：验证超级管理员的权限配置功能和权限生效机制
  - 仓库管理测试：验证各角色的仓库管理功能访问权限和操作范围
  - 司机资料管理测试：验证超级管理员和超级管理员的司机资料管理权限和操作功能
  - 消息同步测试：验证各角色的消息接收权限、滚动提醒显示和信息中心访问功能
  - 管理员端请假审批管理测试：验证具有审批权限的角色能正常进行管理员端请假审批管理
  - 司机打卡记录查看测试：验证各角色的司机打卡记录查看权限和数据访问范围
  - 详细记录页面测试：验证请假申请和打卡记录页面的正常显示，以及离职申请页面的条件显示逻辑

## 15. 数据库设计说明
### 15.1 管理员表设计
```sql
-- 管理员基础信息表
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT \\'管理员名\\',
    phone VARCHAR(11) UNIQUE COMMENT \\'手机号（支持直接登录）\\',
    email VARCHAR(100) UNIQUE COMMENT \\'邮箱\\',
    real_name VARCHAR(20) NOT NULL COMMENT \\'真实紧急联系人姓名\\',
    employee_id VARCHAR(20) UNIQUE COMMENT \\'工号\\',
    license_plate VARCHAR(10) COMMENT \\'车牌号\\',
    role ENUM(\\'admin\\', \\'manager\\', \\'driver\\', \\'user\\') NOT NULL COMMENT \\'管理员角色\\',
    status ENUM(\\'active\\', \\'inactive\\', \\'locked\\') DEFAULT \\'active\\' COMMENT \\'管理员状态\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_password_reset TIMESTAMP NULL COMMENT \\'最后账号麻麻重置时间\\',
    password_reset_by BIGINT NULL COMMENT \\'账号麻麻重置操作人ID\\',
    INDEX idx_phone (phone),
    INDEX idx_email (email),
    INDEX idx_employee_id (employee_id),
    FOREIGN KEY (password_reset_by) REFERENCES users(id)
);

-- 预设测试账号数据插入（包含手机号和新增司机测试账号）
INSERT INTO users (username, phone, role, status, real_name) VALUES 
(\\'admin\\', \\'手机号码\\', \\'admin\\', \\'active\\', \\'超级管理员\\'),
(\\'admin123\\', NULL, \\'manager\\', \\'active\\', \\'超级管理员\\'),
(\\'angxin\\', NULL, \\'driver\\', \\'active\\', \\'驾驶员姓名管理员\\'),
(\\'angxin\\', NULL, \\'driver\\', \\'active\\', \\'司机管理员\\'),
(\\'账号\\', NULL, \\'user\\', \\'active\\', \\'超级管理员\\');

-- 管理员账号麻麻表（分离存储）
CREATE TABLE user_passwords (
    user_id BIGINT PRIMARY KEY,
    password_hash VARCHAR(255) NOT NULL COMMENT \\'账号麻麻哈希\\',
    salt VARCHAR(32) NOT NULL COMMENT \\'盐值\\',
    is_default_password BOOLEAN DEFAULT FALSE COMMENT \\'是否为默认账号麻麻123456\\',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### 15.2 考勤管理表设计（新增）
```sql
-- 员工统计缓存表
CREATE TABLE employee_statistics_cache (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    stat_date DATE NOT NULL COMMENT \\'统计日期\\',
    total_employees INT DEFAULT 0 COMMENT \\'车辆总数\\',
    active_employees INT DEFAULT 0 COMMENT \\'在职司机数\\',
    inactive_employees INT DEFAULT 0 COMMENT \\'离职司机数\\',
    admin_count INT DEFAULT 0 COMMENT \\'超级管理员数量\\',
    manager_count INT DEFAULT 0 COMMENT \\'超级管理员数量\\',
    driver_count INT DEFAULT 0 COMMENT \\'司机数量\\',
    user_count INT DEFAULT 0 COMMENT \\'超级管理员数量\\',
    pending_approvals INT DEFAULT 0 COMMENT \\'待审批数量\\',
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_stat_date (stat_date),
    INDEX idx_stat_date (stat_date)
);

-- 司机签到统计表
CREATE TABLE driver_checkin_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    driver_id BIGINT NOT NULL COMMENT \\'司机ID\\',
    stat_date DATE NOT NULL COMMENT \\'统计日期\\',
    checkin_count INT DEFAULT 0 COMMENT \\'打卡次数\\',
    resignation_process_count INT DEFAULT 0 COMMENT \\'离职申请次数\\',
    has_resignation_application BOOLEAN DEFAULT FALSE COMMENT \\'是否有离职申请\\',
    last_checkin_time TIMESTAMP NULL COMMENT \\'最后签到时间\\',
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (driver_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_driver_date (driver_id, stat_date),
    INDEX idx_driver_id (driver_id),
    INDEX idx_stat_date (stat_date)
);

-- 离职申请表
CREATE TABLE resignation_applications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    applicant_id BIGINT NOT NULL COMMENT \\'申请人ID\\',
    application_date DATE NOT NULL COMMENT \\'申请日期\\',
    expected_resignation_date DATE NOT NULL COMMENT \\'预期离职日期\\',
    resignation_reason TEXT NOT NULL COMMENT \\'离职原因\\',
    status ENUM(\\'pending\\', \\'approved\\', \\'rejected\\', \\'withdrawn\\') DEFAULT \\'pending\\' COMMENT \\'申请状态\\',
    approver_id BIGINT COMMENT \\'审批人ID\\',
    approved_at TIMESTAMP NULL COMMENT \\'审批时间\\',
    approval_comment TEXT COMMENT \\'审批意见\\',
    process_step INT DEFAULT 1 COMMENT \\'当前流程步骤\\',
    total_steps INT DEFAULT 5 COMMENT \\'总流程步骤数\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (applicant_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (approver_id) REFERENCES users(id),
    INDEX idx_applicant_id (applicant_id),
    INDEX idx_status (status),
    INDEX idx_application_date (application_date)
);

-- 离职申请记录表
CREATE TABLE resignation_process_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    resignation_id BIGINT NOT NULL COMMENT \\'离职申请ID\\',
    process_step INT NOT NULL COMMENT \\'流程步骤\\',
    step_name VARCHAR(50) NOT NULL COMMENT \\'步骤名称\\',
    step_description TEXT COMMENT \\'步骤描述\\',
    status ENUM(\\'pending\\', \\'completed\\', \\'skipped\\') DEFAULT \\'pending\\' COMMENT \\'步骤状态\\',
    handler_id BIGINT COMMENT \\'处理人ID\\',
    handled_at TIMESTAMP NULL COMMENT \\'处理时间\\',
    handling_comment TEXT COMMENT \\'处理意见\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (resignation_id) REFERENCES resignation_applications(id) ON DELETE CASCADE,
    FOREIGN KEY (handler_id) REFERENCES users(id),
    INDEX idx_resignation_id (resignation_id),
    INDEX idx_process_step (process_step),
    INDEX idx_status (status)
);
```

### 15.3 消息同步与提醒数据库表设计
```sql
-- 消息记录表
CREATE TABLE system_messages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_type ENUM(\\'system_notice\\', \\'approval_result\\', \\'personnel_change\\', \\'work_arrangement\\', \\'emergency_notice\\') NOT NULL COMMENT \\'消息类型\\',
    title VARCHAR(100) NOT NULL COMMENT \\'消息标题\\',
    content TEXT NOT NULL COMMENT \\'消息内容\\',
    sender_id BIGINT COMMENT \\'发送人ID\\',
    priority ENUM(\\'low\\', \\'normal\\', \\'high\\', \\'urgent\\') DEFAULT \\'normal\\' COMMENT \\'消息优先级\\',
    is_global BOOLEAN DEFAULT FALSE COMMENT \\'是否为全局消息\\',
    trigger_scroll BOOLEAN DEFAULT FALSE COMMENT \\'是否触发滚动提醒\\',
    expire_time TIMESTAMP NULL COMMENT \\'消息过期时间\\',
    related_operation_id BIGINT COMMENT \\'关联操作ID\\',
    related_operation_type VARCHAR(50) COMMENT \\'关联操作类型\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (sender_id) REFERENCES users(id),
    INDEX idx_message_type (message_type),
    INDEX idx_priority (priority),
    INDEX idx_created_at (created_at),
    INDEX idx_expire_time (expire_time)
);

-- 消息接收记录表
CREATE TABLE message_recipients (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id BIGINT NOT NULL COMMENT \\'消息ID\\',
    recipient_id BIGINT NOT NULL COMMENT \\'接收人ID\\',
    is_read BOOLEAN DEFAULT FALSE COMMENT \\'是否已读\\',
    read_time TIMESTAMP NULL COMMENT \\'阅读时间\\',
    is_important BOOLEAN DEFAULT FALSE COMMENT \\'是否标记为重要\\',
    is_deleted BOOLEAN DEFAULT FALSE COMMENT \\'是否已删除\\',
    scroll_reminder_shown BOOLEAN DEFAULT FALSE COMMENT \\'是否已显示滚动提醒\\',
    scroll_reminder_stopped BOOLEAN DEFAULT FALSE COMMENT \\'滚动提醒是否已停止\\',
    scroll_stop_time TIMESTAMP NULL COMMENT \\'滚动提醒停止时间\\',
    scroll_stop_reason ENUM(\\'auto_timeout\\', \\'manual_close\\', \\'read_click\\', \\'system_stop\\') COMMENT \\'滚动停止原因\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (message_id) REFERENCES system_messages(id) ON DELETE CASCADE,
    FOREIGN KEY (recipient_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_message_recipient (message_id, recipient_id),
    INDEX idx_recipient_id (recipient_id),
    INDEX idx_is_read (is_read),
    INDEX idx_scroll_reminder (scroll_reminder_shown, scroll_reminder_stopped)
);

-- 滚动提醒配置表
CREATE TABLE scroll_reminder_config (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'管理员ID\\',
    reminder_enabled BOOLEAN DEFAULT TRUE COMMENT \\'是否启用滚动提醒\\',
    auto_stop_minutes INT DEFAULT 5 COMMENT \\'自动停止时间（分钟）\\',
    max_concurrent_reminders INT DEFAULT 3 COMMENT \\'最大并发提醒数量\\',
    scroll_speed INT DEFAULT 年龄 COMMENT \\'滚动速度（像素/秒）\\',
    pause_until TIMESTAMP NULL COMMENT \\'暂停提醒直到指定时间\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_id (user_id)
);

-- 消息操作日志表
CREATE TABLE message_operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id BIGINT NOT NULL COMMENT \\'消息ID\\',
    user_id BIGINT NOT NULL COMMENT \\'操作管理员ID\\',
    operation_type ENUM(\\'send\\', \\'read\\', \\'mark_important\\', \\'delete\\', \\'stop_scroll\\', \\'forward\\') NOT NULL COMMENT \\'操作类型\\',
    operation_detail JSON COMMENT \\'操作详情\\',
    ip_address VARCHAR(45) COMMENT \\'操作IP地址\\',
    user_agent TEXT COMMENT \\'管理员代理\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (message_id) REFERENCES system_messages(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_message_id (message_id),
    INDEX idx_user_id (user_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_created_at (created_at)
);
```

### 15.4 司机资料管理表设计
```sql
-- 司机详细资料表
CREATE TABLE driver_profiles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'司机管理员ID\\',
    id_card_number VARCHAR(18) COMMENT \\'身份证号\\',
    birth_date DATE COMMENT \\'出生日期\\',
    gender ENUM(\\'male\\', \\'female\\') COMMENT \\'性别\\',
    home_address TEXT COMMENT \\'家庭地址\\',
    emergency_contact_name VARCHAR(20) COMMENT \\'紧急联系人紧急联系人姓名\\',
    emergency_contact_relationship VARCHAR(20) COMMENT \\'紧急联系人关系\\',
    emergency_contact_phone VARCHAR(11) COMMENT \\'紧急联系人电话号码\\',
    driver_license_number VARCHAR(20) COMMENT \\'驾驶证号\\',
    driver_license_type VARCHAR(10) COMMENT \\'准驾车型\\',
    driver_license_expire_date DATE COMMENT \\'驾驶证有效期\\',
    hire_date DATE COMMENT \\'入职日期\\',
    department VARCHAR(50) COMMENT \\'所属部门\\',
    position VARCHAR(50) COMMENT \\'岗位职责\\',
    vehicle_plate_number VARCHAR(10) COMMENT \\'负责车辆车牌号\\',
    vehicle_type VARCHAR(20) COMMENT \\'车辆类型\\',
    vehicle_insurance_expire_date DATE COMMENT \\'车辆保险到期日期\\',
    work_status ENUM(\\'active\\', \\'inactive\\', \\'suspended\\') DEFAULT \\'active\\' COMMENT \\'工作状态\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by BIGINT NOT NULL COMMENT \\'创建人ID\\',
    updated_by BIGINT COMMENT \\'最后修改人ID\\',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id),
    FOREIGN KEY (updated_by) REFERENCES users(id),
    UNIQUE KEY uk_user_id (user_id),
    INDEX idx_id_card (id_card_number),
    INDEX idx_driver_license (driver_license_number),
    INDEX idx_vehicle_plate (vehicle_plate_number),
    INDEX idx_department (department)
);

-- 司机资料修改日志表
CREATE TABLE driver_profile_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    driver_user_id BIGINT NOT NULL COMMENT \\'司机管理员ID\\',
    operator_id BIGINT NOT NULL COMMENT \\'操作人ID\\',
    operation_type ENUM(\\'create\\', \\'update\\', \\'delete\\') NOT NULL COMMENT \\'操作类型\\',
    field_name VARCHAR(50) COMMENT \\'修改字段名\\',
    old_value TEXT COMMENT \\'修改前值\\',
    new_value TEXT COMMENT \\'修改后值\\',
    operation_reason TEXT COMMENT \\'操作原因\\',
    ip_address VARCHAR(45) COMMENT \\'操作IP地址\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (driver_user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (operator_id) REFERENCES users(id),
    INDEX idx_driver_user (driver_user_id),
    INDEX idx_operator (operator_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_created_at (created_at)
);
```

### 15.5 权限配置表设计
```sql
-- 管理员权限配置表
CREATE TABLE user_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'被配置权限的管理员ID\\',
    granted_by BIGINT NOT NULL COMMENT \\'授权人ID（超级管理员）\\',
    permission_type ENUM(\\'user_info_modify\\', \\'piecework_data_modify\\', \\'attendance_rule_manage\\', \\'driver_profile_manage\\') NOT NULL COMMENT \\'权限类型\\',
    is_granted BOOLEAN DEFAULT FALSE COMMENT \\'是否已授权\\',
    granted_at TIMESTAMP NULL COMMENT \\'授权时间\\',
    revoked_at TIMESTAMP NULL COMMENT \\'撤销时间\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id),
    UNIQUE KEY uk_user_permission (user_id, permission_type),
    INDEX idx_user_id (user_id),
    INDEX idx_granted_by (granted_by),
    INDEX idx_permission_type (permission_type)
);

-- 权限操作日志表
CREATE TABLE permission_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'被操作管理员ID\\',
    operator_id BIGINT NOT NULL COMMENT \\'操作人ID\\',
    permission_type ENUM(\\'user_info_modify\\', \\'piecework_data_modify\\', \\'attendance_rule_manage\\', \\'driver_profile_manage\\') NOT NULL COMMENT \\'权限类型\\',
    action ENUM(\\'grant\\', \\'revoke\\') NOT NULL COMMENT \\'操作类型\\',
    reason TEXT COMMENT \\'操作原因\\',
    ip_address VARCHAR(45) COMMENT \\'操作IP地址\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (operator_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_operator_id (operator_id),
    INDEX idx_action (action)
);
```

### 15.6 仓库管理表设计
```sql
-- 仓库基础信息表
CREATE TABLE warehouses (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    warehouse_code VARCHAR(20) UNIQUE NOT NULL COMMENT \\'仓库编码\\',
    warehouse_name VARCHAR(50) NOT NULL COMMENT \\'仓库名称\\',
    warehouse_address TEXT COMMENT \\'仓库地址\\',
    warehouse_type ENUM(\\'main\\', \\'branch\\', \\'temporary\\') DEFAULT \\'main\\' COMMENT \\'仓库类型\\',
    gps_latitude DECIMAL(10,8) COMMENT \\'gps纬度\\',
    gps_longitude DECIMAL(11,8) COMMENT \\'gps经度\\',
    check_in_radius INT DEFAULT 100 COMMENT \\'打卡有效范围（米）\\',
    status ENUM(\\'active\\', \\'inactive\\', \\'maintenance\\') DEFAULT \\'active\\' COMMENT \\'仓库状态\\',
    manager_id BIGINT COMMENT \\'仓库负责人ID\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (manager_id) REFERENCES users(id),
    INDEX idx_warehouse_code (warehouse_code),
    INDEX idx_manager_id (manager_id),
    INDEX idx_status (status)
);

-- 司机仓库分配表
CREATE TABLE driver_warehouse_assignments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    driver_id BIGINT NOT NULL COMMENT \\'司机ID\\',
    warehouse_id BIGINT NOT NULL COMMENT \\'仓库ID\\',
    assignment_type ENUM(\\'primary\\', \\'secondary\\', \\'temporary\\') DEFAULT \\'primary\\' COMMENT \\'分配类型\\',
    priority_level INT DEFAULT 1 COMMENT \\'优先级（1-10）\\',
    start_date DATE NOT NULL COMMENT \\'分配开始日期\\',
    end_date DATE COMMENT \\'分配结束日期（临时分配用）\\',
    status ENUM(\\'active\\', \\'paused\\', \\'expired\\') DEFAULT \\'active\\' COMMENT \\'分配状态\\',
    assigned_by BIGINT NOT NULL COMMENT \\'分配操作人ID\\',
    assignment_reason TEXT COMMENT \\'分配原因\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (driver_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id) ON DELETE CASCADE,
    FOREIGN KEY (assigned_by) REFERENCES users(id),
    UNIQUE KEY uk_driver_warehouse_type (driver_id, warehouse_id, assignment_type),
    INDEX idx_driver_id (driver_id),
    INDEX idx_warehouse_id (warehouse_id),
    INDEX idx_assignment_type (assignment_type),
    INDEX idx_status (status)
);

-- 商品品类表
CREATE TABLE product_categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    category_code VARCHAR(20) UNIQUE NOT NULL COMMENT \\'品类编码\\',
    category_name VARCHAR(50) NOT NULL COMMENT \\'品类名称\\',
    category_name_en VARCHAR(50) COMMENT \\'品类英文名称\\',
    parent_id BIGINT COMMENT \\'父品类ID\\',
    category_level INT DEFAULT 1 COMMENT \\'品类层级（1-5）\\',
    category_path VARCHAR(200) COMMENT \\'品类路径（如：1/2/3）\\',
    category_description TEXT COMMENT \\'品类描述\\',
    piecework_unit_price DECIMAL(8,2) DEFAULT 0.00 COMMENT \\'计件单价\\',
    storage_requirements TEXT COMMENT \\'存储要求\\',
    operation_standards TEXT COMMENT \\'操作规范\\',
    quality_standards TEXT COMMENT \\'质量标准\\',
    sort_order INT DEFAULT 0 COMMENT \\'排序序号\\',
    status ENUM(\\'active\\', \\'inactive\\') DEFAULT \\'active\\' COMMENT \\'品类状态\\',
    created_by BIGINT NOT NULL COMMENT \\'创建人ID\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES product_categories(id),
    FOREIGN KEY (created_by) REFERENCES users(id),
    INDEX idx_category_code (category_code),
    INDEX idx_parent_id (parent_id),
    INDEX idx_category_level (category_level),
    INDEX idx_status (status)
);

-- 仓库考勤规则表
CREATE TABLE warehouse_attendance_rules (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    warehouse_id BIGINT NOT NULL COMMENT \\'仓库ID\\',
    rule_name VARCHAR(50) NOT NULL COMMENT \\'规则名称\\',
    work_start_time TIME NOT NULL COMMENT \\'上班时间\\',
    work_end_time TIME NOT NULL COMMENT \\'下班时间\\',
    break_start_time TIME COMMENT \\'休息开始时间\\',
    break_end_time TIME COMMENT \\'休息结束时间\\',
    overtime_start_time TIME COMMENT \\'加班开始时间\\',
    flexible_minutes INT DEFAULT 0 COMMENT \\'弹性时间（分钟）\\',
    late_tolerance_minutes INT DEFAULT 0 COMMENT \\'迟到容忍时间（分钟）\\',
    late_penalty_amount DECIMAL(6,2) DEFAULT 0.00 COMMENT \\'迟到扣款金额\\',
    early_leave_penalty_amount DECIMAL(6,2) DEFAULT 0.00 COMMENT \\'早退扣款金额\\',
    overtime_rate DECIMAL(3,2) DEFAULT 1.50 COMMENT \\'加班费率\\',
    night_shift_allowance DECIMAL(6,2) DEFAULT 0.00 COMMENT \\'夜班津贴\\',
    weekend_work_rate DECIMAL(3,2) DEFAULT 2.00 COMMENT \\'周末工作费率\\',
    holiday_work_rate DECIMAL(3,2) DEFAULT 3.00 COMMENT \\'节假日工作费率\\',
    effective_date DATE NOT NULL COMMENT \\'生效日期\\',
    expiry_date DATE COMMENT \\'失效日期\\',
    status ENUM(\\'active\\', \\'inactive\\', \\'draft\\') DEFAULT \\'active\\' COMMENT \\'规则状态\\',
    created_by BIGINT NOT NULL COMMENT \\'创建人ID\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id),
    INDEX idx_warehouse_id (warehouse_id),
    INDEX idx_effective_date (effective_date),
    INDEX idx_status (status)
);
```

### 15.7 考勤管理表设计
```sql
-- 考勤打卡记录表
CREATE TABLE attendance_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'管理员ID\\',
    warehouse_id BIGINT COMMENT \\'仓库ID\\',
    check_date DATE NOT NULL COMMENT \\'打卡日期\\',
    check_in_time TIMESTAMP NULL COMMENT \\'上班打卡时间\\',
    check_out_time TIMESTAMP NULL COMMENT \\'下班打卡时间\\',
    check_in_location VARCHAR(200) COMMENT \\'上班打卡地点\\',
    check_out_location VARCHAR(200) COMMENT \\'下班打卡地点\\',
    work_hours DECIMAL(4,2) DEFAULT 0 COMMENT \\'工作时长（小时）\\',
    status ENUM(\\'normal\\', \\'late\\', \\'early_leave\\', \\'absent\\', \\'makeup\\') DEFAULT \\'normal\\' COMMENT \\'考勤状态\\',
    remark TEXT COMMENT \\'备注信息\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    UNIQUE KEY uk_user_date (user_id, check_date),
    INDEX idx_check_date (check_date),
    INDEX idx_user_id (user_id),
    INDEX idx_warehouse_id (warehouse_id)
);

-- 请假申请记录表
CREATE TABLE leave_requests (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'申请人ID\\',
    leave_type ENUM(\\'sick\\', \\'personal\\', \\'annual\\', \\'maternity\\', \\'other\\') NOT NULL COMMENT \\'请假类型\\',
    start_date DATE NOT NULL COMMENT \\'请假开始日期\\',
    end_date DATE NOT NULL COMMENT \\'请假结束日期\\',
    start_time TIME COMMENT \\'请假开始时间（半天请假用）\\',
    end_time TIME COMMENT \\'请假结束时间（半天请假用）\\',
    leave_days DECIMAL(3,1) NOT NULL COMMENT \\'请假天数\\',
    reason TEXT NOT NULL COMMENT \\'请假原因\\',
    status ENUM(\\'pending\\', \\'approved\\', \\'rejected\\', \\'cancelled\\') DEFAULT \\'pending\\' COMMENT \\'审批状态\\',
    approver_id BIGINT COMMENT \\'审批人ID\\',
    approved_at TIMESTAMP NULL COMMENT \\'审批时间\\',
    approval_remark TEXT COMMENT \\'审批备注\\',
    cancel_time TIMESTAMP NULL COMMENT \\'撤销时间\\',
    cancel_reason TEXT COMMENT \\'撤销原因\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (approver_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_date_range (start_date, end_date),
    INDEX idx_status (status),
    INDEX idx_approver_id (approver_id)
);

-- 每日登录记录表（用于首次登录检测）
CREATE TABLE daily_login_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'管理员ID\\',
    login_date DATE NOT NULL COMMENT \\'登录日期\\',
    first_login_time TIMESTAMP NOT NULL COMMENT \\'首次登录时间\\',
    login_count INT DEFAULT 1 COMMENT \\'当日登录次数\\',
    attendance_checked BOOLEAN DEFAULT FALSE COMMENT \\'是否已检查考勤状态\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_date (user_id, login_date),
    INDEX idx_login_date (login_date)
);
```

### 15.8 管理端请假审批管理表设计
```sql
-- 管理端审批权限配置表
CREATE TABLE user_approval_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'管理员ID\\',
    approval_scope ENUM(\\'department\\', \\'project\\', \\'warehouse\\', \\'all\\') DEFAULT \\'department\\' COMMENT \\'审批范围\\',
    max_leave_days INT DEFAULT 7 COMMENT \\'可审批的最大请假天数\\',
    can_approve_types JSON COMMENT \\'可审批的请假类型列表\\',
    approval_level INT DEFAULT 1 COMMENT \\'审批级别（1-5）\\',
    is_enabled BOOLEAN DEFAULT TRUE COMMENT \\'是否启用审批权限\\',
    granted_by BIGINT NOT NULL COMMENT \\'授权人ID\\',
    granted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT \\'授权时间\\',
    expires_at TIMESTAMP NULL COMMENT \\'权限过期时间\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id),
    UNIQUE KEY uk_user_id (user_id),
    INDEX idx_approval_scope (approval_scope),
    INDEX idx_approval_level (approval_level)
);

-- 管理端审批操作记录表
CREATE TABLE user_approval_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    leave_request_id BIGINT NOT NULL COMMENT \\'请假申请ID\\',
    approver_id BIGINT NOT NULL COMMENT \\'审批人ID\\',
    approval_action ENUM(\\'approve\\', \\'reject\\', \\'forward\\', \\'withdraw\\') NOT NULL COMMENT \\'审批动作\\',
    approval_comment TEXT COMMENT \\'审批意见\\',
    approval_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT \\'审批时间\\',
    forwarded_to BIGINT NULL COMMENT \\'转发给的管理员ID\\',
    approval_source ENUM(\\'web\\', \\'mobile\\', \\'api\\') DEFAULT \\'mobile\\' COMMENT \\'审批来源\\',
    ip_address VARCHAR(45) COMMENT \\'操作IP地址\\',
    device_info JSON COMMENT \\'设备信息\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (leave_request_id) REFERENCES leave_requests(id) ON DELETE CASCADE,
    FOREIGN KEY (approver_id) REFERENCES users(id),
    FOREIGN KEY (forwarded_to) REFERENCES users(id),
    INDEX idx_leave_request (leave_request_id),
    INDEX idx_approver (approver_id),
    INDEX idx_approval_time (approval_time)
);

-- 审批流程模板表
CREATE TABLE approval_workflow_templates (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    template_name VARCHAR(50) NOT NULL COMMENT \\'模板名称\\',
    leave_type ENUM(\\'sick\\', \\'personal\\', \\'annual\\', \\'maternity\\', \\'other\\') NOT NULL COMMENT \\'请假类型\\',
    max_days INT NOT NULL COMMENT \\'最大天数\\',
    approval_steps JSON NOT NULL COMMENT \\'审批步骤配置\\',
    auto_approve_conditions JSON COMMENT \\'自动审批条件\\',
    notification_settings JSON COMMENT \\'通知设置\\',
    is_active BOOLEAN DEFAULT TRUE COMMENT \\'是否启用\\',
    created_by BIGINT NOT NULL COMMENT \\'创建人ID\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id),
    INDEX idx_leave_type (leave_type),
    INDEX idx_is_active (is_active)
);
```

### 15.9 司机打卡记录查看表设计
```sql
-- 打卡记录查看权限表
CREATE TABLE attendance_view_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'管理员ID\\',
    view_scope ENUM(\\'self\\', \\'department\\', \\'warehouse\\', \\'all\\') DEFAULT \\'self\\' COMMENT \\'查看范围\\',
    can_view_details BOOLEAN DEFAULT TRUE COMMENT \\'是否可查看详细信息\\',
    can_export_data BOOLEAN DEFAULT FALSE COMMENT \\'是否可导出数据\\',
    can_view_statistics BOOLEAN DEFAULT TRUE COMMENT \\'是否可查看统计信息\\',
    max_history_days INT DEFAULT 90 COMMENT \\'最大历史查看天数\\',
    granted_by BIGINT NOT NULL COMMENT \\'授权人ID\\',
    granted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT \\'授权时间\\',
    expires_at TIMESTAMP NULL COMMENT \\'权限过期时间\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id),
    UNIQUE KEY uk_user_id (user_id),
    INDEX idx_view_scope (view_scope)
);

-- 打卡记录查看日志表
CREATE TABLE attendance_view_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    viewer_id BIGINT NOT NULL COMMENT \\'查看人ID\\',
    target_user_id BIGINT COMMENT \\'被查看管理员ID（为空表示查看多人）\\',
    view_type ENUM(\\'list\\', \\'detail\\', \\'statistics\\', \\'export\\') NOT NULL COMMENT \\'查看类型\\',
    query_conditions JSON COMMENT \\'查询条件\\',
    view_date_range JSON COMMENT \\'查看的日期范围\\',
    record_count INT DEFAULT 0 COMMENT \\'查看的记录数量\\',
    export_format VARCHAR(10) COMMENT \\'导出格式（如果是导出操作）\\',
    ip_address VARCHAR(45) COMMENT \\'操作IP地址\\',
    user_agent TEXT COMMENT \\'管理员代理\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (viewer_id) REFERENCES users(id),
    FOREIGN KEY (target_user_id) REFERENCES users(id),
    INDEX idx_viewer_id (viewer_id),
    INDEX idx_target_user_id (target_user_id),
    INDEX idx_view_type (view_type),
    INDEX idx_created_at (created_at)
);

-- 考勤统计缓存表
CREATE TABLE attendance_statistics_cache (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT \\'管理员ID\\',
    stat_date DATE NOT NULL COMMENT \\'统计日期\\',
    stat_type ENUM(\\'daily\\', \\'weekly\\', \\'monthly\\', \\'yearly\\') NOT NULL COMMENT \\'统计类型\\',
    total_work_days INT DEFAULT 0 COMMENT \\'总工作天数\\',
    actual_work_days INT DEFAULT 0 COMMENT \\'实际工作天数\\',
    late_count INT DEFAULT 0 COMMENT \\'迟到次数\\',
    early_leave_count INT DEFAULT 0 COMMENT \\'早退次数\\',
    absent_count INT DEFAULT 0 COMMENT \\'缺勤次数\\',
    overtime_hours DECIMAL(6,2) DEFAULT 0.00 COMMENT \\'加班小时数\\',
    total_work_hours DECIMAL(8,2) DEFAULT 0.00 COMMENT \\'总工作小时数\\',
    attendance_rate DECIMAL(5,2) DEFAULT 0.00 COMMENT \\'出勤率\\',
    punctuality_rate DECIMAL(5,2) DEFAULT 0.00 COMMENT \\'准时率\\',
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \\'最后更新时间\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_date_type (user_id, stat_date, stat_type),
    INDEX idx_stat_date (stat_date),
    INDEX idx_stat_type (stat_type)
);
```

### 15.10 安全日志表设计
```sql
-- 登录日志表（新增手机号登录类型）
CREATE TABLE login_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    login_type ENUM(\\'phone_code\\', \\'phone_password\\', \\'phone_direct\\', \\'employee_password\\') NOT NULL,
    login_identifier VARCHAR(50) NOT NULL COMMENT \\'登录标识（手机号/管理员名/工号）\\',
    ip_address VARCHAR(45) NOT NULL,
    user_agent TEXT,
    device_info JSON,
    login_result ENUM(\\'success\\', \\'failed\\', \\'locked\\') NOT NULL,
    failure_reason VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_ip (ip_address),
    INDEX idx_result (login_result),
    INDEX idx_login_identifier (login_identifier)
);

-- 操作日志表
CREATE TABLE operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    operation_type VARCHAR(50) NOT NULL,
    operation_detail JSON,
    target_user_id BIGINT NULL COMMENT \\'被操作的管理员ID\\',
    ip_address VARCHAR(45),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (target_user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_type (operation_type),
    INDEX idx_target_user (target_user_id)
);

-- 页面刷新日志表
CREATE TABLE refresh_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    page_name VARCHAR(50) NOT NULL COMMENT \\'页面名称\\',
    refresh_type ENUM(\\'pull_down\\', \\'auto\\', \\'manual\\') NOT NULL COMMENT \\'刷新类型\\',
    refresh_result ENUM(\\'success\\', \\'failed\\', \\'timeout\\') NOT NULL,
    response_time INT COMMENT \\'响应时间（毫秒）\\',
    error_message TEXT COMMENT \\'错误信息\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_page (page_name),
    INDEX idx_result (refresh_result)
);

-- 审批操作日志表
CREATE TABLE approval_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    leave_request_id BIGINT NOT NULL COMMENT \\'请假申请ID\\',
    approver_id BIGINT NOT NULL COMMENT \\'审批人ID\\',
    approval_action ENUM(\\'approve\\', \\'reject\\') NOT NULL COMMENT \\'审批动作\\',
    approval_remark TEXT COMMENT \\'审批备注\\',
    approval_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT \\'审批时间\\',
    ip_address VARCHAR(45) COMMENT \\'审批IP地址\\',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (leave_request_id) REFERENCES leave_requests(id) ON DELETE CASCADE,
    FOREIGN KEY (approver_id) REFERENCES users(id),
    INDEX idx_leave_request (leave_request_id),
    INDEX idx_approver (approver_id),
    INDEX idx_approval_time (approval_time)
);
```

## 16. 设计风格
### 16.1 配色方案
主色调采用蓝色(#3B82F6)，辅助色为橙色(#F97316)，背景色为浅灰色(#F8FAFC)，警告色为红色(#EF4444)，成功色为绿色(#10B981)，注册功能采用清新的蓝绿色调(#06B6D4)突出便捷性和安全性，技术架构图采用专业的深蓝色(#1E3A8A)体现技术感，安全机制采用橙红色(#DC2626)强调重要性，管理员管理功能采用紫色(#8B5CF6)突出管理权限的重要性，手机号登录功能采用青色(#0891B2)突出新功能特性，页面刷新功能采用清新的薄荷绿(#34D399)体现流畅的交互体验，智能考勤功能采用活力橙色(#FB923C)突出智能化特性，请假管理功能采用温和的蓝紫色(#6366F1)体现人性化管理，考勤管理功能采用专业的深蓝色(#1D4ED8)体现管理功能的权威性和可靠性，权限配置功能采用金色(#F59E0B)突出权限管理的重要性和专业性，仓库管理功能采用深绿色(#059669)体现仓储管理的稳重和高效，司机资料管理功能采用深蓝色(#1D4ED8)体现资料管理的专业性和可靠性，消息同步功能采用活力紫色(#A855F7)突出智能通信的现代感，滚动提醒采用醒目的橙色(#F97316)确保重要信息的及时传达，管理端请假审批管理功能采用优雅的靛蓝色(#4F46E5)体现审批流程的专业性和高效性，司机打卡记录查看功能采用稳重的石墨色(#374151)体现数据查看的严谨性和可靠性

### 16.2 视觉细节
技术架构图采用分层卡片式设计，模块间连接线采用渐变色彩，代码示例采用深色主题语法高亮，接口文档采用清晰的JSON格式展示，流程图采用圆角矩形和箭头连接，测试用例采用代码块格式突出技术性，安全机制采用盾牌图标和警告色彩，管理员管理界面采用表格布局和操作按钮组合，手机号登录界面采用现代化输入框设计和实时验证提示，下拉刷新采用流畅的动画效果和渐变色加载指示器，刷新状态提示采用圆角气泡设计和柔和的阴影效果，考勤打卡提醒弹窗采用模态设计和半透明遮罩，请假状态提示采用卡片式设计和图标标识，撤销请假按钮采用警告色和确认机制设计，工作台考勤管理入口采用醒目的卡片设计和统计数据展示，考勤管理界面采用分区布局和数据可视化图表，司机统计区域采用条件显示逻辑和动态内容更新，详细记录页面采用标签页切换设计和条件显示机制，权限配置界面采用开关切换设计和权限说明卡片，仓库管理界面采用标签页布局和数据可视化图表，司机分配采用矩阵表格和状态色彩标识，品类管理采用树形结构和层级缩进显示，考勤规则设置采用表单分组和时间选择器，司机资料管理界面采用分类标签页设计和表单验证提示，资料编辑采用模块化布局和实时保存机制，滚动提醒采用跑马灯动画效果和渐变背景，信息中心采用消息卡片布局和状态标签设计，消息详情采用时间轴布局和操作按钮组合，管理端请假审批管理界面采用流程化布局和进度指示器设计，审批操作采用滑动手势和快捷按钮组合，审批状态跟踪采用时间轴可视化和实时更新机制，司机打卡记录查看界面采用多视图切换设计和智能筛选功能，数据统计采用图表可视化和交互式分析工具，记录列表采用虚拟滚动和懒加载优化性能

### 16.3 整体布局
文档采用技术文档标准布局：目录导航固定左侧，正文内容居中展示，代码示例独立区块显示，架构图采用横向流程布局，数据库设计采用表格形式展示，接口规范采用请求-响应对比布局，实施计划采用时间轴布局展示，管理员管理功能采用功能模块分组布局，手机号登录功能采用突出显示的专门章节布局，页面刷新功能采用交互流程图和状态转换图的组合布局，智能考勤功能采用流程图和状态机结合的布局方式，请假管理功能采用业务流程和权限控制相结合的布局设计，考勤管理功能采用工作台集成和独立管理界面相结合的布局方式，权限配置功能采用权限矩阵和配置流程相结合的布局，仓库管理功能采用多标签页和功能区域分组的综合布局，司机资料管理功能采用信息分类和操作流程相结合的布局设计，消息同步功能采用数据库架构图和交互流程图相结合的布局方式，滚动提醒功能采用界面示意图和逻辑流程图的组合布局，信息中心功能采用功能模块图和管理员界面设计相结合的布局，管理端请假审批管理功能采用审批流程图和权限控制矩阵相结合的布局设计，司机打卡记录查看功能采用数据展示界面和统计分析图表相结合的布局方式，突出管理员操作的连贯性和数据库响应的及时性，体现管理流程的专业性和高效性，强调权限控制的精细化、仓库管理的一体化、司机资料管理的规范化、消息同步的智能化、考勤管理的便捷化、管理端审批管理的便捷化和打卡记录查看的直观化

## 参考文件
1. 管理员上传图片：360a63143beb1b9afd2a6205fc978年龄2.jpg
2. 管理员上传图片：image.png
3. 管理员上传图片：d068cb52cf29b439e498d46cf571b206.jpg