# 车队管理小程序需求文档（技术重构版 - 手机号登录功能增强 + 智能考勤打卡提醒与请假管理 + 考勤管理界面优化 + 权限配置优化与仓库管理模块重构 + 数据库管理员管理员资料管理权限优化 + 多端消息同步与提醒数据库 + 车辆管理端请假审批管理优化 + 管理员打卡记录查看界面 + 管理员管理模块编辑页面优化 + 登录邮箱自动添加与管理员创建优化 + 管理员出勤计件仪表盘功能 + 管理员管理模块仓库切换与权限管理架构 + 错误管理端管理员详情页面权限控制功能增强 + 全界面滑动返回功能 + 品类管理仓库切换与价格设置功能 + 车辆管理端管理员类型识别与价格控制功能 + 仪表盘智能优化与动态排序数据库 + 车辆管理功能 + 管理员客户端智能车辆管理模块 + 信息录入数据库功能完善版 + 智能照片判断与验证数据库 + 管理员管理员界面分离版 + 调试日志功能 + 管理员类型选择与默认密码配置功能 + 全数据智能缓存与实时同步数据库 + 仓库管理每日指标数设置功能 + 计件报表UI功能优化版 + 手机号一键拨号功能 + 环形图达标率可视化展示功能 + 请假天数与达标率计算逻辑优化 + 新司机标签自动移除功能 + 车辆管理端车辆管理功能迭代升级版 + 资产审核闭环管理数据库 + 车辆管理端车辆删除功能 + 审核端一键锁定功能 + 车辆管理照片要求优化与车损特写功能 + 照片位置标注与补录界面优化）

## 1. 小程序概述
### 1.1 小程序名称
车队管家

### 1.2 小程序描述
一款专为车队管理打造的微信小程序，提供多角色权限管理和多层级数据仪表盘数据库，包含超级管理员、数据库管理员和管理员三个不同界面，满足车队运营的分层管理需求。本次进行注册、登录功能的数据库性重构，采用现代化技术架构，提升数据库的可维护性、安全性和管理员体验。新增手机号直接登录功能，支持管理员使用11位手机号直接登录数据库，登录时自动添加邮箱功能。所有页面均支持下拉手动刷新功能，提升交互体验。新增智能化考勤打卡提醒与请假管理数据库，实现管理员每日首次登录自动检测打卡状态、启动计件前二次检测、请假状态豁免逻辑以及假期主动撤销功能，全面提升考勤管理的智能化水平。新增管理工作台仪表盘考勤管理功能，支持从工作台直接进入考勤管理界面查看车辆总数和待审批信息，并优化交互体验和数据展示方式。优化数据库管理员对数据库管理员的权限配置逻辑，实现细粒度权限控制和功能模块内同等操作权限。重构错误管理端功能模块，将品类管理升级为仓库管理，整合品类管理和考勤规则设置两大功能区。优化超级管理员权限，增加对管理员基本资料的修改权限，提升管理效率和操作便利性。新增多端消息同步与提醒数据库，实现跨角色的智能消息推送、滚动提醒和信息中心管理，确保重要信息的及时传达和有效管理。优化车辆管理端请假审批管理功能，提供更便捷的审批操作和状态跟踪。新增管理员打卡记录查看界面，支持详细的考勤数据查看和计件分析。优化超级管理员后台管理员管理模块中的编辑管理员信息页面，调整字段配置和角色选择，提升信息管理的针对性和实用性。新增登录邮箱自动添加功能和管理员创建成功提示优化，提升管理员体验和操作便利性。新增管理员出勤计件仪表盘功能，提供全面的员工达标率计件、个人出勤数据分析、满勤标记识别和可视化图表展示，实现数据驱动的考勤管理决策支持。新增管理员管理模块仓库切换与权限管理架构，采用左右滑动切换仓库方式，支持对应仓库在职管理员管理，并提供界面显示管理员信息、管理仓库和权限范围。新增错误管理端管理员详情页面权限控制功能增强，实现基于权限的管理员信息修改功能，包括权限判断、编辑按钮显示控制和完整的修改功能实现，提供与超级管理员同等的管理员信息编辑能力。新增全界面滑动返回功能，支持所有界面通过右滑手势返回上一层，提供统一的导航体验和便捷的操作方式。新增品类管理仓库切换与价格设置功能，支持双车辆管理端为不同仓库的纯司机和带车司机设置对应价格，实现精细化的仓库级别价格管理。新增管理员端管理员类型识别与价格控制功能，实现管理员类型自动识别、管理员设置价格的自动读取应用以及价格录入权限的智能控制，确保计件录入的规范性和准确性。新增仪表盘智能优化与动态排序数据库，实现数据驱动的界面展示优化、智能化的功能排序和个性化的管理员体验定制，全面提升数据库的易用性和操作效率。新增车辆管理功能，实现分角色的车辆信息管理，车辆管理端可录入和管理自己的车辆信息，车辆管理端可查看管辖仓库的车辆信息，错误管理端可查看所有仓库的车辆信息，提供完整的车辆档案管理和计件分析功能。新增管理员客户端智能车辆管理模块，集成OCR智能识别技术，支持车辆信息自主录入、驾驶证智能识别、车辆实体验证拍照、驾驶员证件信息采集等全流程车辆管理功能，提供即时拍照和相册选择双重媒体输入方式，实现车辆管理端车辆信息的智能化、便捷化管理。新增管理员信息管理功能，支持个人头像上传和从车辆管理模块中已保存的身份证件信息自动读取个人基本信息，实现个人档案的完整性管理和数据复用。完善信息录入数据库功能，强化证件识别准确性、保存控制机制、管理员引导提示和技术实现要求，确保信息录入的准确性和管理员体验的流畅性。新增智能照片判断与验证数据库，实现照片类型自动识别、证件匹配验证和错误照片自动拦截功能，确保上传照片与预期证件类型完全匹配，提升数据录入的准确性和数据库的可靠性。新增管理员管理员界面分离功能，将车辆管理端和车辆管理端界面完全分离，提供专属的界面设计和功能模块，确保不同角色的管理员获得最适合的操作体验和功能权限。新增调试日志功能，提供完整的数据库运行日志记录、错误追踪和调试信息管理，帮助开发者和管理员快速gps和解决数据库问题，提升数据库的可维护性和稳定性。新增管理员类型选择与默认密码配置功能，在添加管理员时先选择管理员类型，然后为管理员配置默认密码，提升账号管理的规范性和安全性。新增全数据智能缓存与实时同步数据库，覆盖所有业务数据模块，实现数据的智能缓存、实时更新传递和跨端同步，显著提升数据库响应速度、管理员体验和数据一致性保障。新增仓库管理每日指标数设置功能，支持为每个管理员设置每天需要完成的指标数量，该字段为选填项，便于管理员进行绩效管理和工作量计件。新增计件报表UI功能优化，去除总金额显示，新增目标完成率计算与展示，实现双车辆管理端统一的数据计件和可视化分析功能。新增手机号一键拨号功能，在双车辆管理端的管理员管理列表和管理员信息详情页面中，为手机号字段添加一键拨号按钮，支持点击直接调起数据库拨号界面，提升联系效率和操作便利性。新增环形图达标率可视化展示功能，通过三个独立环形图分别展示当天、本周和本月的达标率，提供直观的绩效数据可视化和达标情况分析。新增请假天数与达标率计算逻辑优化，实现基于仓库配置的允许请假天数的智能计算，区分合规请假与超标请假，确保达标率计算的准确性和公平性。新增新司机标签自动移除功能，实现入职日期超过7天后自动移除新司机标识，优化管理员身份管理和界面展示逻辑。对车辆管理端车辆管理功能进行迭代升级，优化车辆录入流程、新增操作时间自动记录、重构车辆详情页面、调整操作状态与状态逻辑，提升车辆管理的便捷性和规范性。新增资产审核闭环管理数据库，建立从管理员录入到数据库管理员审核的完整流程，强化图片审核机制，实现状态流转闭环管理，提升车辆信息的准确性和规范性。新增车辆管理端车辆删除功能，方便测试优化过程中的多次录入操作。新增审核端一键锁定功能，支持管理员在审核时除了标记为需补录的图片外，一键锁定其他所有图片，提升审核效率。**本次优化车辆管理照片要求，统一提车和还车场景均需要7张照片，并新增车损特写图片上传功能，支持添加多张车损特写照片。同时优化照片上传与审核界面，在管理员补录界面和审核页面中清晰标注每张照片对应的标准位置，简化操作流程，去除不必要的照片编辑功能。**

## 2. 资产审核闭环管理数据库（全新功能 - 照片位置标注与补录界面优化版）
### 2.1 功能概述
- **功能gps**
  - 建立从管理员录入到超级管理员审核的闭环车辆管理流程
  - 重点强化图片审核机制，确保车辆信息的准确性和规范性
  - 实现车辆管理端与车辆管理端的状态协同，提供清晰的流程追踪
  - 支持图片锁定与删除功能，提升审核效率和信息质量
  - 支持一键锁定功能，除标记为需补录的图片外，一键锁定其他所有图片
  - **新增车损特写图片上传功能，支持添加多张车损特写照片**
  - **优化照片上传与审核界面，清晰标注每张照片对应的标准位置**
  - **简化操作流程，去除照片编辑功能，仅保留原始照片上传**

- **适用范围**
  - 管理员端〔我的车辆〕模块
  - 管理员端〔车辆管理〕模块下的〔车辆信息审核〕专属页面
  - 所有管理员和超级管理员

### 2.2 车辆管理端功能需求
#### 2.2.1 车辆录入功能
- **录入场景**
  - **提车录入场景（提车）**：管理员首次添加车辆信息，包含车辆基本信息、驾驶证拍照识别、车辆实体验证拍照等
  - **还车录入场景（还车）**：管理员还车车辆时，拍摄还车照片并填写还车说明

- **录入流程**
  - **步骤1：填写车辆基本信息**
    + 填写车牌号、车辆品牌、车辆型号等基本信息
    + 支持手动输入或从历史记录中选择

  - **步骤2：驾驶证拍照识别**
    + 拍摄或上传行驶证照片
    + 数据库自动识别行驶证信息并填充到对应字段
    + 支持手动修正识别错误的信息

  - **步骤3：车辆实体验证拍照（提车场景）**
    + **必须拍摄7张照片，每张照片对应固gps置**：
      * 照片1：车辆正面（标注：〔车辆正面〕）
      * 照片2：左前45度（标注：〔左前45度〕）
      * 照片3：左侧面（标注：〔左侧面〕）
      * 照片4：左后45度（标注：〔左后45度〕）
      * 照片5：后面（标注：〔车辆后面〕）
      * 照片6：右后45度（标注：〔右后45度〕）
      * 照片7：右侧面（标注：〔右侧面〕）
    + **界面设计要求**：
      * 采用网格式布局，每行3张照片
      * 每个照片位置上方显示对应的位置标注文字（如〔车辆正面〕〔左前45度〕等）
      * 未上传的照片位置显示〔+〕按钮和位置标注
      * 已上传的照片显示缩略图和位置标注
    + 照片数量要求：必须7张，不可多不可少
    + 数据库自动保存照片到〔车辆照片〕标签页
    + **不提供照片编辑功能**：仅支持拍照或从相册选择，不提供裁剪、滤镜、旋转等编辑功能

  - **步骤4：车损特写照片上传（新增功能）**
    + 在车辆照片下方新增〔车损特写〕上传区域
    + 支持添加多张车损特写照片（无数量上限）
    + 每张照片需标注车损位置说明（如〔左前门划痕〕〔右后保险杠凹陷〕等）
    + 支持即时拍照和相册选择两种方式
    + 车损特写照片为选填项，如无车损可不上传
    + **不提供照片编辑功能**：仅支持原始照片上传

  - **步骤5：车辆还车照片拍摄（还车场景）**
    + **必须拍摄7张照片，每张照片对应固gps置**：
      * 照片1：车辆正面（标注：〔车辆正面〕）
      * 照片2：左前45度（标注：〔左前45度〕）
      * 照片3：左侧面（标注：〔左侧面〕）
      * 照片4：左后45度（标注：〔左后45度〕）
      * 照片5：后面（标注：〔车辆后面〕）
      * 照片6：右后45度（标注：〔右后45度〕）
      * 照片7：右侧面（标注：〔右侧面〕）
    + **界面设计要求**：
      * 采用网格式布局，每行3张照片
      * 每个照片位置上方显示对应的位置标注文字
      * 未上传的照片位置显示〔+〕按钮和位置标注
      * 已上传的照片显示缩略图和位置标注
    + 照片数量要求：必须7张，不可多不可少
    + 填写还车说明（如车辆状况、油量等）
    + 数据库自动保存照片到〔还车照片〕标签页
    + **不提供照片编辑功能**：仅支持原始照片上传

  - **步骤6：车损特写照片上传（还车场景，新增功能）**
    + 在还车照片下方新增〔车损特写〕上传区域
    + 支持添加多张车损特写照片（无数量上限）
    + 每张照片需标注车损位置说明
    + 支持即时拍照和相册选择两种方式
    + 车损特写照片为选填项，如无车损可不上传
    + **不提供照片编辑功能**：仅支持原始照片上传

  - **步骤7：提交审核**
    + 检查填写信息和上传照片的完整性
    + 数据库自动验证7张必拍照片是否齐全
    + 点击〔提交审核〕按钮
    + 数据库自动记录提交时间，车辆状态更新为〔待审核〕

#### 2.2.2 车辆状态展示
- **状态类别**
  - **录入中**：信息尚未提交，管理员可继续编辑
  - **待审核**：信息已提交，等待管理员审核
  - **需补录**：管理员审核后发现部分图片不符合要求，退回给管理员补充
  - **审核通过**：所有信息符合要求，管理员审核通过，管理员可进行后续操作（如更新为〔还车〕或标记为〔完结〕）

- **状态显示位置**
  - **车辆列表页面**：在每个车辆条目的右上角显示状态标签
    + 〔录入中〕：灰色标签
    + 〔待审核〕：橙色标签
    + 〔需补录〕：红色标签
    + 〔审核通过〕：绿色标签

  - **车辆详情页面**：在页面顶部显示当前状态，并提供状态说明
    + 示例：〔当前状态：待审核 - 您的车辆信息已提交，请耐心等待管理员审核〕

#### 2.2.3 需补录状态处理
- **补录触发条件**
  - 管理员在审核过程中删除了部分不符合要求的图片
  - 数据库自动将车辆状态更新为〔需补录〕
  - 数据库自动记录需补拍的图片项（如〔车辆正面照〕〔左前45度〕〔车损特写〕等）

- **补录操作流程**
  - **步骤1：查看补录要求**
    + 管理员进入车辆详情页面，数据库显示需补录的图片项列表
    + 示例：〔需补录图片：车辆正面照、左前45度、车损特写照片1〕

  - **步骤2：上传补录图片**
    + **界面设计要求**：
      * 采用网格式布局，每行3张照片
      * **需补录的照片位置显示〔需补录〕标识和位置标注**（如〔车辆正面 - 需补录〕）
      * 需补录的照片位置显示〔+〕按钮，点击可重新上传
      * 已锁定的照片显示〔已锁定〕标识和位置标注，不可修改
    + 管理员只能重新上传被管理员删除的相应图片
    + 已锁定的图片不可修改，显示〔已锁定〕标识
    + 支持即时拍照和相册选择两种方式
    + 车损特写照片可单独补录，无需重新上传所有车损照片
    + **不提供照片编辑功能**：仅支持原始照片上传

  - **步骤3：重新提交审核**
    + 管理员完成图片补录后，点击〔重新提交审核〕按钮
    + 数据库自动将车辆状态更新为〔待审核〕
    + 车辆再次进入管理员审核队列

- **补录限制**
  - 管理员在〔需补录〕状态下，只能上传被删除的图片，无法修改已锁定的图片
  - 管理员无法修改车辆基本信息（如车牌号、车辆品牌等），如需修改需联系管理员

#### 2.2.4 审核通过后操作
- **可执行操作**
  - **还车录入**：管理员可进入还车录入流程，拍摄还车照片并填写还车说明
  - **标记完结**：管理员确认车辆信息无需再更新，标记为〔完结〕状态

- **操作入口**
  - 在车辆详情页面底部显示操作按钮
  - 〔还车录入〕按钮：蓝色背景+白色文字
  - 〔标记完结〕按钮：灰色背景+白色文字

#### 2.2.5 车辆删除功能（测试优化专用）
- **功能gps**
  - 为方便测试优化过程中的多次录入操作，临时提供车辆删除功能
  - 仅管理员端可使用，车辆管理端不提供删除功能

- **删除入口**
  - 在车辆管理端〔我的车辆〕模块的车辆列表页面，每个车辆条目右侧显示〔删除〕按钮
  - 在车辆详情页面底部显示〔删除车辆〕按钮

- **删除操作流程**
  - **步骤1：点击删除按钮**
    + 管理员点击〔删除〕按钮
    + 数据库弹出二次确认弹窗：〔确认删除车辆【车牌号】吗？删除后数据将无法恢复〕

  - **步骤2：确认删除**
    + 管理员点击〔确认删除〕按钮
    + 数据库执行删除操作，删除车辆信息及关联的所有照片
    + 数据库显示删除成功提示：〔车辆【车牌号】已删除〕
    + 页面自动返回车辆列表页面

  - **步骤3：取消删除**
    + 管理员点击〔取消〕按钮
    + 数据库关闭确认弹窗，不执行删除操作

- **删除限制**
  - 所有状态的车辆均可删除（录入中、待审核、需补录、审核通过）
  - 删除操作不可撤销，删除后数据无法恢复
  - 删除车辆时，数据库自动删除关联的所有照片和审核记录

- **权限控制**
  - 仅车辆管理端可删除自己录入的车辆
  - 车辆管理端不提供删除功能，如需删除需联系超级管理员

### 2.3 车辆管理端功能需求
#### 2.3.1 车辆信息审核专属页面
- **页面位置**
  - 在车辆管理端〔车辆管理〕模块下，创建独立的〔车辆信息审核〕专属页面
  - 页面入口：车辆管理端首页〔车辆管理〕卡片中显示〔待审核〕数量，点击进入审核页面

- **页面布局**
  - **顶部筛选区域**
    + 支持按仓库、提交时间、车牌号等条件筛选待审核车辆
    + 显示待审核车辆总数

  - **车辆列表区域**
    + 展示所有状态为〔待审核〕的车辆记录
    + 每个车辆条目显示：车牌号、车辆品牌、提交时间、提交人
    + 点击车辆条目进入审核详情页面

#### 2.3.2 审核操作功能
- **图片审核**
  - **逐张审查**
    + **界面设计要求**：
      * 采用网格式布局，每行3张照片
      * **每张照片上方显示对应的位置标注文字**（如〔车辆正面〕〔左前45度〕〔左侧面〕等）
      * 照片按固定顺序排列：车辆正面、左前45度、左侧面、左后45度、后面、右后45度、右侧面
      * 支持点击图片查看大图
    + **车损特写照片单独展示**：在7张必拍照片下方，单独展示车损特写照片区域，每张照片显示对应的车损位置说明

  - **删除功能**
    + 对于不符合要求的图片，管理员可点击图片右上角的〔删除〕按钮
    + 删除后，数据库自动记录该图片类型到〔需补录项〕列表
    + 示例：删除〔车辆正面照〕后，数据库自动记录〔需补录：车辆正面照〕
    + 车损特写照片可单独删除，删除后记录〔需补录：车损特写照片X〕

  - **锁定功能**
    + 对于符合要求的图片，管理员可点击图片右上角的〔锁定〕按钮
    + 锁定后，图片右上角显示〔已锁定〕标识
    + 车辆管理端无法再修改已锁定的图片

  - **一键锁定功能**
    + 在审核页面顶部或底部显示〔一键锁定〕按钮
    + 点击〔一键锁定〕按钮后，数据库自动锁定除标记为需补录的图片外的所有其他图片
    + 锁定后，所有符合要求的图片右上角显示〔已锁定〕标识
    + 提升审核效率，避免逐张点击锁定

- **审核结果处理**
  - **情况A：存在被删除的图片**
    + 管理员点击〔退回补录〕按钮
    + 数据库自动将车辆状态更新为〔需补录〕
    + 数据库自动发送通知给管理员，提示需补录的图片项

  - **情况B：所有图片均符合要求**
    + 管理员点击〔通过审核〕按钮
    + 数据库自动将车辆状态更新为〔审核通过〕
    + 数据库自动发送通知给管理员，告知审核通过

#### 2.3.3 审核记录管理
- **审核历史记录**
  - 数据库自动记录每次审核操作的详细信息
  - 记录内容包括：审核时间、审核人、审核结果、删除的图片项、锁定的图片项

- **审核记录查看**
  - 管理员可在车辆详情页面查看完整的审核历史记录
  - 支持按时间倒序排列，最新的审核记录显示在最上方

### 2.4 流程协同要求
#### 2.4.1 状态流转逻辑
- **状态流转路径**
  - 录入中 → 待审核 → 审核通过
  - 录入中 → 待审核 → 需补录 → 待审核 → 审核通过

- **状态流转规则**
  - **录入中 → 待审核**：管理员点击〔提交审核〕按钮后自动流转
  - **待审核 → 审核通过**：管理员点击〔通过审核〕按钮后自动流转
  - **待审核 → 需补录**：管理员点击〔退回补录〕按钮后自动流转
  - **需补录 → 待审核**：管理员完成图片补录并点击〔重新提交审核〕按钮后自动流转

#### 2.4.2 通知机制
- **车辆管理端通知**
  - **审核通过通知**：〔您的车辆【车牌号】已通过审核，可进行后续操作〕
  - **需补录通知**：〔您的车辆【车牌号】需补录图片，请尽快完成补录并重新提交〕

- **车辆管理端通知**
  - **新增待审核通知**：〔管理员【姓名】提交了车辆【车牌号】的车辆信息，请及时审核〕
  - **重新提交审核通知**：〔管理员【姓名】已完成车辆【车牌号】的图片补录，请重新审核〕

- **通知方式**
  - 小程序内消息推送
  - 信息中心消息记录
  - 支持消息已读/未读状态管理

#### 2.4.3 数据同步
- **实时同步**
  - 车辆管理端提交审核后，车辆管理端立即显示待审核车辆
  - 车辆管理端审核操作后，车辆管理端立即更新车辆状态
  - 通过WebSocket实现实时数据推送

- **缓存更新**
  - 审核操作完成后立即更新车辆信息缓存
  - 确保所有端的数据一致性

### 2.5 数据库设计
#### 2.5.1 车辆信息表（vehicle_info表）字段调整
- **新增字段**
  - audit_status（字符串型）：审核状态（drafting录入中/pending待审核/need_reupload需补录/approved审核通过）
  - submit_time（日期时间型）：提交审核时间
  - audit_time（日期时间型）：审核完成时间
  - auditor_id（外键）：审核人ID
  - reupload_items（JSON数组）：需补录的图片项列表
  - locked_photos（JSON数组）：已锁定的图片路径列表
  - damage_photos（JSON数组）：车损特写照片路径列表，每个元素包含照片路径和车损位置说明
  - photo_positions（JSON对象）：7张必拍照片的位置标注和路径映射，格式如：{〔车辆正面〕: 〔photo_url〕, 〔左前45度〕: 〔photo_url〕, ...}

#### 2.5.2 审核记录表（vehicle_audit_log表）
- **表结构**
  - id（主键）：审核记录ID
  - vehicle_id（外键）：车辆ID
  - auditor_id（外键）：审核人ID
  - audit_time（日期时间型）：审核时间
  - audit_result（字符串型）：审核结果（approved通过/rejected退回）
  - deleted_photos（JSON数组）：删除的图片路径列表
  - locked_photos（JSON数组）：锁定的图片路径列表
  - remark（文本型）：审核备注

### 2.6 技术实现要求
#### 2.6.1 前端实现
- **图片审核组件**
  - 使用微信小程序原生组件实现图片网格布局
  - **每张照片上方显示对应的位置标注文字**（如〔车辆正面〕〔左前45度〕等）
  - 支持图片点击查看大图
  - 支持图片删除和锁定操作
  - 删除和锁定按钮位于图片右上角，采用浮动按钮样式
  - **车损特写照片展示**：在7张必拍照片下方，单独展示车损特写照片区域，每张照片显示对应的车损位置说明

- **管理员补录界面**
  - 采用网格式布局，每行3张照片
  - **需补录的照片位置显示〔需补录〕标识和位置标注**（如〔车辆正面 - 需补录〕）
  - 需补录的照片位置显示〔+〕按钮，点击可重新上传
  - 已锁定的照片显示〔已锁定〕标识和位置标注，不可修改

- **一键锁定功能实现**
  - 在审核页面顶部或底部显示〔一键锁定〕按钮
  - 点击按钮后，数据库自动遍历所有图片，锁定除标记为需补录的图片外的所有其他图片
  - 锁定后，图片右上角显示〔已锁定〕标识
  - 提供操作反馈提示：〔已成功锁定X张图片〕

- **状态标签组件**
  - 根据车辆状态动态显示不同颜色的标签
  - 标签样式：圆角矩形，字体加粗，字号14px

- **通知推送**
  - 使用WebSocket实现实时消息推送
  - 支持消息已读/未读状态管理
  - 消息显示在信息中心，支持点击查看详情

- **删除功能实现**
  - 使用微信小程序原生弹窗组件实现二次确认
  - 删除操作调用后端API，传递车辆ID
  - 删除成功后刷新车辆列表页面

- **车损特写照片上传功能实现**
  - 在车辆照片下方新增〔车损特写〕上传区域
  - 支持添加多张车损特写照片（无数量上限）
  - 每张照片需填写车损位置说明（文本输入框）
  - 支持即时拍照和相册选择两种方式
  - 车损特写照片为选填项，如无车损可不上传

- **照片编辑功能限制**
  - 不提供照片编辑功能（如裁剪、滤镜、旋转等）
  - 仅支持即时拍照和相册选择两种方式上传原始照片

#### 2.6.2 后端实现
- **状态流转控制**
  - 在审核接口中实现状态流转逻辑
  - 状态流转时自动记录操作时间和操作人
  - 状态流转后立即推送通知给相关管理员

- **图片管理**
  - 图片上传到云存储服务（如腾讯云COS）
  - 图片路径保存到车辆信息表的对应字段
  - 删除图片时不删除云存储中的文件，仅从数据库中移除路径

- **一键锁定功能实现**
  - 提供一键锁定API接口，接收车辆ID参数
  - 后端自动查询该车辆的所有图片，筛选出未标记为需补录的图片
  - 将筛选出的图片路径批量添加到locked_photos字段
  - 返回锁定成功的图片数量

- **审核记录管理**
  - 每次审核操作自动生成审核记录
  - 审核记录保存到审核记录表（vehicle_audit_log表）
  - 支持查询车辆的完整审核历史

- **删除功能实现**
  - 提供删除车辆API接口，接收车辆ID参数
  - 删除车辆时，同步删除关联的所有照片路径和审核记录
  - 删除操作记录到数据库日志，便于追溯

- **车损特写照片管理**
  - 车损特写照片路径和车损位置说明保存到damage_photos字段（JSON数组）
  - 支持单独删除和补录车损特写照片
  - 车损特写照片不计入7张必拍照片数量

- **照片位置标注管理**
  - 7张必拍照片的位置标注和路径映射保存到photo_positions字段（JSON对象）
  - 格式如：{〔车辆正面〕: 〔photo_url〕, 〔左前45度〕: 〔photo_url〕, ...}
  - 支持根据位置标注快速查询对应照片

#### 2.6.3 缓存更新
- **实时同步**
  - 审核操作完成后立即更新车辆信息缓存
  - 通过WebSocket推送更新通知到车辆管理端和车辆管理端
  - 确保所有端的数据一致性

- **删除操作缓存更新**
  - 删除车辆后立即清除相关缓存
  - 通知所有相关端更新数据

## 3. 车辆管理端车辆管理功能迭代升级
（保持原需求文档内容不变）

## 4. 新司机标签自动移除功能
（保持原需求文档内容不变）

## 5. 环形图打卡率可视化展示功能
（保持原需求文档内容不变）

## 6. 手机号一键拨号功能
（保持原需求文档内容不变）

## 7. 计件报表UI功能优化
（保持原需求文档内容不变）

## 8. 仓库管理每日指标数设置功能
（保持原需求文档内容不变）

## 9. 全数据智能缓存与实时同步数据库
（保持原需求文档内容不变）

## 参考文件
1. 管理员上传图片：image.png
2. 管理员上传图片：image.png
3. 管理员上传图片：image.png
4. 管理员上传图片：image.png
5. 管理员上传图片：image.png
6. 管理员上传图片：image.png
7. 管理员上传图片：image.png
8. 管理员上传图片：image-2.png
9. 管理员上传图片：image.png
10. 管理员上传图片：image.png
11. 管理员上传图片：image.png