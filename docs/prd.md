# 车队管家小程序管理系统需求文档

## 1. 系统概述

### 1.1 系统名称\n车队管家小程序管理系统

### 1.2 系统描述
专为车队管理打造的微信小程序管理系统，提供基础的车队运营管理和数据统计功能，支持便捷的移动管理和操作。升级版系统采用增强型多租户架构，为不同老板客户提供完全独立的数据库或数据表环境，确保数据彻底隔离。租赁系统作为独立管理端，专门用于管理租用车队管理小程序的租赁业务。

### 1.3 项目目标
快速开发一个可登录的车队管理小程序，实现基础的车辆、司机管理和数据统计功能，并基于增强型多租户架构确保数据完全隔离。新增租赁系统管理端，专门用于租赁业务的管理功能，为每个老板分配独立数据库或数据表。

## 2. 核心功能模块

### 2.1 用户管理功能
- **用户登录**：账号密码登录验证
- **用户注册**：基础用户信息注册
- **用户信息管理**：个人信息编辑和更新
- **角色管理**：管理员、司机、车队长、老板、租赁老板等角色分配
- **租赁端登录**：15766121960为租赁端终极登陆账号，必须通过验证码方式进行登录验证

### 2.2 车辆管理功能
- **车辆信息管理**：车辆基本信息录入和查询
- **车辆状态监控**：车辆使用状态跟踪
- **车辆分配管理**：司机与车辆匹配管理

### 2.3 司机管理功能
- **司机档案管理**：司机个人信息录入和管理
- **司机状态管理**：出勤状态和工作排班
- **绩效查看**：司机工作效率统计

### 2.4 数据统计功能
- **关键数据统计**：出勤人数、总件数、完成件数等统计
- **车辆使用率统计**：车辆使用情况分析
- **司机工作效率统计**：司机绩效数据展示

### 2.5 租赁系统管理功能
租赁系统是一个管理租用车队管理小程序的独立管理端，提供以下功能：

#### 2.5.1 租赁系统用户管理
- **创建租赁系统用户**：新增租赁系统的管理用户
- **查看所有租赁系统用户**：列表展示所有租赁系统用户信息
- **编辑租赁系统用户信息**：修改租赁系统用户的基本信息和权限

#### 2.5.2 租赁核销功能
- **核销操作**：对租赁业务进行核销处理
- **核销记录查询**：查看历史核销记录

#### 2.5.3 老板账号管理
每个老板账号视为单独的租赁用户，仅需管理老板账号，不需要查看每个老板下面的所有用户。
- **新增老板账号**：创建新的老板账号，自动为该老板创建独立的数据库和数据表
- **修改老板账号**：编辑老板账号的基本信息
- **停用老板账号**：暂时停用老板账号的使用权限
- **删除老板账号**：永久删除老板账号及相关数据库和数据表
- **老板账号列表**：查看所有老板账号的基本信息和状态

## 3. 系统逻辑流程

### 3.1 小程序登录流程
1. 用户打开小程序
2. 进入登录页面
3. 输入账号和密码
4. 系统验证账号有效性
5. 验证密码正确性
6. 检查用户角色
7. 自动获取当前用户ID作为租户标识
8. 跳转到对应管理首页

### 3.2 租赁端登录特殊流程
1. 用户使用15766121960账号登录
2. 系统强制要求进行验证码验证
3. 验证通过后自动识别为租赁端角色
4. 跳转到租赁系统管理首页

### 3.3 仪表盘访问流程
1. 用户登录成功后自动跳转到仪表盘
2. 系统基于当前用户ID过滤数据
3. 显示对应租户的关键数据概览
4. 支持数据详情查看

### 3.4 租赁系统管理流程
1. 租赁端管理员登录后进入租赁系统管理首页
2. 可选择进入租赁系统用户管理、核销功能或老板账号管理
3. 执行相应的创建、查看、编辑、停用、删除等操作
4. 系统记录操作日志并更新数据状态

## 4. 用户界面布局

### 4.1 登录页面布局
- **账号输入框**：支持邮箱或手机号登录
- **密码输入框**
- **验证码输入框**（租赁端专用）
- **登录按钮**
- **注册入口**\n
### 4.2 仪表盘界面布局
- **顶部导航栏**：包含用户信息和基础菜单
- **数据看板区域**：关键指标卡片展示
- **统计图表区**：基础图表展示

### 4.3 车辆管理界面
- **车辆列表**：显示车辆基本信息
- **筛选功能**
- **详情页面**：查看车辆完整档案

### 4.4 司机管理界面
- **司机列表**：显示司机基本信息
- **筛选功能**
- **详情页面**：查看司机完整档案

### 4.5 租赁系统管理界面

#### 4.5.1 租赁系统用户管理界面
- **用户列表**：显示所有租赁系统用户的基本信息
- **创建用户按钮**：新增租赁系统用户入口
- **编辑功能**：点击用户可进入编辑页面
- **搜索筛选**：支持按用户名、角色等条件筛选

#### 4.5.2 租赁核销界面
- **核销操作区**：输入核销信息并提交
- **核销记录列表**：展示历史核销记录
- **筛选功能**：按时间、状态等条件筛选核销记录

#### 4.5.3 老板账号管理界面
- **老板账号列表**：显示所有老板账号的基本信息和状态（正常/停用）
- **新增按钮**：创建新的老板账号，自动创建独立数据库和数据表
- **操作菜单**：每个老板账号提供修改、停用、删除操作入口
- **搜索筛选**：支持按账号名称、状态等条件筛选

## 5. 安全配置要求

### 5.1 用户认证
- **登录机制**：基于用户名密码的用户认证
- **密码安全**：密码加密存储
- **登录失败处理**：登录失败次数限制
- **验证码验证**：租赁端强制要求验证码验证

### 5.2 权限校验
- **角色权限**：基于角色的权限控制
- **功能授权**：粗粒度的功能访问控制
- **租赁端权限**：15766121960账号拥有最高租赁管理权限

### 5.3 增强型多租户安全隔离\n- **独立数据库/数据表**：为每个老板创建独立的数据库和数据表
- **数据完全隔离**：确保老板间数据彻底隔离，无任何交叉访问
- **多层次隔离机制**：在数据库层、应用层实现多重数据隔离防护

## 6. 增强型多租户架构设计

### 6.1 核心目标
为每个老板客户提供完全独立的数据库和数据表环境，确保所有租户数据在存储和访问时实现彻底隔离，防止数据泄露和越权访问。

### 6.2 数据隔离策略
采用独立数据库和数据表的物理隔离机制，在数据库层面为每个老板的数据建立完全独立的存储空间。

### 6.3 实现层面要求
- **独立数据库/数据表**：为每个老板创建独立的数据库和数据表
- **数据完全隔离**：确保老板间数据无任何共享和交叉
- **租户上下文管理**：在应用层实现老板级租户上下文管理机制
- **请求识别**：确保在每次请求中能正确识别并提供当前请求的老板标识

### 6.4 技术实现步骤

#### 6.4.1 租户上下文管理
- 在应用启动时初始化老板级租户上下文管理模块
- 基于用户登录信息自动加载当前老板标识
- 为每个HTTP请求绑定老板租户上下文信息
- 实现在不同中间件间传递老板ID

#### 6.4.2 数据访问层改造
- 为每个老板创建独立的数据库和数据表
- 修改数据库查询模板，自动适应不同老板的数据存储结构
- 实现数据访问的默认安全策略
- 测试数据隔离的有效性

#### 6.4.3 安全验证增强
- 在控制器层验证数据归属
- 实施细粒度的权限检查
- 监控并阻止潜在的越权访问尝试
- 定期审计数据访问日志

#### 6.4.4 租户数据迁移
- 设计老板级数据初始化流程
- 实现数据导入导出功能
- 确保数据迁移过程中的完整性

### 6.5 关键技术点

#### 6.5.1 全局老板ID管理
- 请求拦截器自动提取老板ID
- 中央服务提供老板信息
- 跨服务老板上下文传播

#### 6.5.2 数据库查询增强
- 自动适配不同老板的数据存储结构
- 支持批量操作的安全性
- 查询性能优化策略

#### 6.5.3 安全防护机制
- 老板间数据隔离验证
- 异常访问日志记录
- 定期安全扫描

## 7. 系统部署要求

### 7.1 多租户环境配置
- **独立数据库实例**：为每个老板创建独立的数据库实例
- **独立数据表架构**：普通租户采用独立数据表方案
- **配置管理**：统一管理不同老板的环境参数

### 7.2 性能优化
- **缓存策略**：基于老板ID的缓存分区
- **索引优化**：针对老板数据表建立高效索引
- **查询优化**：减少不必要的数据扫描

### 7.3 监控与运维
- **老板用量统计**：监控各老板资源使用情况
- **告警系统**：异常访问和性能问题实时通知
- **备份恢复**：定期数据备份和快速恢复机制

## 8. 小程序特性

### 8.1 微信生态集成
- **消息推送**：支持微信消息通知
- **小程序分享**：支持好友分享和群分享
- **收藏功能**：支持小程序收藏

### 8.2 移动端优化
- **适配屏幕**：支持多种手机屏幕尺寸
- **手势操作**：优化滑动和点击体验
- **下拉刷新**：列表页面支持下拉刷新

## 9. 设计风格

### 9.1 配色方案
- **主色调**：蓝色系渐变（#1890ff到#4a90e2）
- **强调色**：橙色（#ff7a45）
- **背景色**：浅灰色（#f5f5f5）

### 9.2 视觉细节
- **圆角设计**：统一使用4px圆角
- **卡片阴影**：轻微阴影效果
- **图标风格**：线性图标配合填充图标

### 9.3 整体布局
- **布局方式**：卡片式布局
- **导航结构**：底部标签栏导航
- **数据展示**：表格和卡片形式

## 10. 参考界面

### 10.1 司机工作台界面
使用用户提供的图片image.png作为司机工作台界面参考

### 10.2 数据仪表盘界面
使用用户提供的图片image.png作为数据仪表盘界面参考

### 10.3 管理员信息界面
使用用户提供的图片image.png作为管理员信息界面参考

### 10.4 用户管理界面
使用用户提供的图片image.png作为用户管理界面参考

### 10.5 技术调试界面
使用用户提供的图片image.png作为技术调试界面参考

### 10.6 错误页面界面
使用用户提供的图片image.png作为错误页面界面参考

### 10.7 通知中心界面
使用用户提供的图片image.png作为通知中心界面参考

### 10.8 租赁系统管理界面
使用用户提供的图片image.png作为租赁系统管理界面参考