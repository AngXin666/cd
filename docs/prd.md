# 车队管家小程序需求文档（考勤状态优化版）

## 1. 小程序概述
### 1.1 小程序名称
车队管家

### 1.2 小程序描述
一款专为车队管理打造的微信小程序，提供多角色权限管理和多层级数据仪表盘数据库，包含超级管理员、数据库管理员和管理员三个不同界面，满足车队运营的分层管理需求。本次优化重点完善考勤管理功能，为每个管理员添加详细的考勤状态标识，实现更精准的出勤跟踪和管理。

## 2. 考勤状态优化功能
### 2.1 功能概述
- **核心目标**：为双管理端（车辆管理端和车辆管理端）的考勤管理添加用户状态标识
- **状态分类**：
  - 休假中：处于请假状态的管理员
  - 正常上班：按时打卡或未超出迟到阈值的管理员
  - 上班迟到：超过规定打卡时间的管理员
- **适用范围**：
  - 车辆管理端考勤管理页面
  - 车辆管理端考勤管理页面
  - 管理员详细记录页面
  - 考勤报表展示界面

### 2.2 功能需求
#### 2.2.1 考勤状态自动判定
- **休假中状态**
  - 当管理员处于有效请假状态时自动标识为「休假中」
  - 包含事假、病假、年假等各种假期类型
  - 请假结束时间未到时保持「休假中」状态

- **正常上班状态**
  - 按时打卡或虽未打卡但未超出迟到阈值时标识为「正常上班」
  - 无请假记录且出勤状态正常的管理员

- **上班迟到状态**
  - 超过规定打卡时间但仍在补救时间内打卡时标识为「上班迟到」
  - 记录迟到分钟数和相应扣分/扣款规则

#### 2.2.2 状态实时更新
- **状态同步**
  - 考勤打卡后实时更新考勤状态
  - 请假申请批准后自动更新为「休假中」状态
  - 请假结束时间到达后自动恢复原状态

- **状态有效期**
  - 「休假中」状态持续至请假结束时间
  - 「正常上班」「上班迟到」状态每日刷新

### 2.3 界面展示优化
#### 2.3.1 管理员列表页面\n- **状态标识**
  - 在管理员姓名右侧显示状态标签
  - 不同状态使用不同颜色标识：
    + 休假中：蓝色标签
    + 正常上班：绿色标签
    + 上班迟到：橙色标签

- **状态tooltip**
  - 鼠标悬停显示详细状态说明
  - 如「休假中：事假，至2025年11月22日」

#### 2.3.2 考勤管理页面
- **状态列展示**
  - 在管理员列表中新增「当前状态」列
  - 实时显示每位管理员的考勤状态

- **状态筛选功能**
  - 提供状态筛选器，支持按状态快速筛选管理员
  - 筛选选项：全部、休假中、正常上班、上班迟到

#### 2.3.3 考勤报表界面
- **状态统计**
  - 按状态分类统计当日/当周/当月的管理员分布
  - 生成状态分布饼状图或柱状图

- **状态趋势**
  - 展示各状态的变化趋势图表
  - 支持按日、周、月维度查看状态变化

### 2.4 技术实现要求
#### 2.4.1 数据模型优化
- **状态字段添加**
  - 在管理员表中新增`attendance_status`字段
  - 状态值：`vacation`（休假中）、`normal`（正常上班）、`late`（上班迟到）

- **状态更新逻辑**
  - 打卡系统调用状态更新API
  - 请假系统调用状态更新API
  - 每日定时任务重置日状态

#### 2.4.2 接口优化
- **状态查询接口**
  - 提供批量查询状态的API
  - 支持按时间范围查询历史状态

- **状态筛选接口**
  - 支持按状态字段筛选管理员列表
  - 支持组合筛选条件

#### 2.4.3 前端实现
- **状态组件封装**
  - 封装状态标签组件，根据状态动态渲染样式
  - 统一状态显示规范

- **实时更新机制**
  - 使用WebSocket或定时轮询获取状态更新
  - 状态变更时自动刷新界面显示

### 2.5 测试与验证
#### 2.5.1 功能验证
- **状态转换测试**
  - 测试请假状态转换为「休假中」
  - 测试打卡后状态转换为「正常上班」「上班迟到」
  - 测试状态自动重置逻辑

- **界面显示验证**
  - 验证各页面状态显示的一致性
  - 验证状态颜色标识的准确性
  - 验证状态tooltip信息的完整性

- **数据准确性**
  - 验证状态统计报表的准确性
  - 验证状态趋势图表的正确性
  - 验证状态筛选功能的有效性

## 3. 参考文件
1. 管理员管理界面截图：image.png
2. 管理员详情页面截图：image.png
3. 数据仪表盘截图：image.png
4. 管理员汇总界面截图：image.png
5. 管理员详情页面截图：image.png
6. 计件记录界面截图：image.png
7. 考勤管理界面截图：image.png
8. 管理员出勤计件截图：image.png
9. 车辆录入界面截图：image.png
10. 车辆档案界面截图：image.png
11. 提车照片界面截图：Screenshot_20251116_141609.jpg
12. 提车照片界面截图：Screenshot_20251116_141609.jpg
13. 提车照片界面截图：image.png
14. 车辆档案详情截图：mmexport8ce6e6823a453236f06cf083a564c7b7_1763294143129.png
15. 车辆录入记录列表截图：image.png
16. 车辆历史详细记录追溯页面截图：Screenshot_20251118_031125.jpg
17. 车辆租赁管理界面参考：Screenshot_20251118_111139.jpg
18. 考勤管理界面参考：image.png