# 仓库考勤系统使用指南

## 📋 功能概述

车队管家小程序的仓库考勤系统提供了完整的定位打卡和考勤管理功能。司机必须在管理员设置的仓库范围内才能打卡，系统会自动判定考勤状态（正常/迟到/早退）。

---

## 🏢 仓库管理（超级管理员）

### 功能特点

- ✅ 添加、编辑、删除仓库信息
- ✅ 设置仓库GPS坐标和打卡有效范围
- ✅ 配置考勤规则（上下班时间、迟到阈值等）
- ✅ 启用或禁用仓库
- ✅ 实时查看仓库状态和规则

### 使用步骤

#### 1. 进入仓库管理页面

1. 使用超级管理员账号登录
2. 在超级管理员控制台点击"仓库管理"按钮
3. 进入仓库管理页面

#### 2. 添加仓库

1. 点击页面顶部的"+ 添加仓库"按钮
2. 填写仓库信息：
   - **仓库名称**：如"总部仓库"、"东区仓库"
   - **仓库地址**：详细地址
   - **纬度**：仓库GPS纬度（如：39.9042）
   - **经度**：仓库GPS经度（如：116.4074）
   - **打卡范围**：有效打卡范围（米），默认500米
3. 设置考勤规则：
   - **上班时间**：如"09:00"
   - **下班时间**：如"18:00"
   - **迟到阈值**：允许迟到的分钟数，默认15分钟
   - **早退阈值**：允许早退的分钟数，默认15分钟
4. 点击"保存"按钮

#### 3. 编辑仓库

1. 在仓库列表中找到要编辑的仓库
2. 点击"编辑"按钮
3. 修改仓库信息
4. 点击"保存"按钮

**注意**：编辑仓库时只能修改仓库基本信息，不能修改考勤规则。如需修改考勤规则，请联系技术支持。

#### 4. 启用/禁用仓库

1. 在仓库列表中找到要操作的仓库
2. 点击"启用"或"禁用"按钮
3. 禁用的仓库将不会出现在司机的打卡选项中

#### 5. 删除仓库

1. 在仓库列表中找到要删除的仓库
2. 点击"删除"按钮
3. 确认删除操作

**警告**：删除仓库后，该仓库的所有考勤规则也会被删除，且无法恢复！

### 仓库信息说明

#### GPS坐标获取方法

1. **使用地图应用**：
   - 打开高德地图或百度地图
   - 搜索仓库地址
   - 长按地图标记点
   - 复制显示的经纬度坐标

2. **使用在线工具**：
   - 访问 https://lbs.amap.com/tools/picker
   - 搜索或点击地图选择位置
   - 获取经纬度坐标

#### 打卡范围设置建议

| 场景 | 建议范围 | 说明 |
|------|---------|------|
| 小型仓库 | 100-300米 | 适合单栋建筑 |
| 中型仓库 | 300-500米 | 适合园区或多栋建筑 |
| 大型仓库 | 500-1000米 | 适合大型物流园区 |
| 特殊情况 | 自定义 | 根据实际需求调整 |

#### 考勤规则设置建议

| 规则 | 建议值 | 说明 |
|------|--------|------|
| 上班时间 | 09:00 | 根据公司制度设置 |
| 下班时间 | 18:00 | 根据公司制度设置 |
| 迟到阈值 | 15分钟 | 允许的迟到时间 |
| 早退阈值 | 15分钟 | 允许的早退时间 |

---

## 📍 GPS定位打卡（司机）

### 功能特点

- ✅ 自动获取GPS位置
- ✅ 自动选择最近的仓库
- ✅ 检查是否在打卡范围内
- ✅ 自动判定考勤状态
- ✅ 记录打卡位置和时间
- ✅ 自动计算工作时长

### 使用步骤

#### 1. 上班打卡

1. 到达仓库后，打开小程序
2. 在司机工作台点击"上下班打卡"
3. 确保手机GPS定位已开启
4. 点击"上班打卡"按钮
5. 系统会自动：
   - 获取当前GPS位置
   - 查找最近的仓库
   - 检查是否在打卡范围内
   - 判定考勤状态（正常/迟到）
   - 保存打卡记录

#### 2. 下班打卡

1. 下班时，再次进入打卡页面
2. 点击"下班打卡"按钮
3. 系统会自动：
   - 获取当前GPS位置
   - 检查是否在打卡范围内
   - 计算工作时长
   - 保存打卡记录

### 打卡规则

#### 位置要求

- ✅ 必须在仓库打卡范围内
- ✅ 系统自动选择最近的仓库
- ❌ 超出范围无法打卡

#### 时间要求

- ✅ 每天只能打卡一次（上班+下班）
- ✅ 必须先上班打卡，才能下班打卡
- ❌ 不能重复打卡

#### 考勤状态判定

| 状态 | 判定条件 | 说明 |
|------|---------|------|
| 正常 | 在规定时间内打卡 | 上班时间 ± 迟到阈值 |
| 迟到 | 超过迟到阈值 | 晚于上班时间+迟到阈值 |
| 早退 | 早于下班时间 | 早于下班时间-早退阈值 |
| 缺勤 | 未打卡 | 当天未打卡记录 |

### 打卡失败处理

#### 情况1：获取位置失败

**原因**：
- 手机GPS未开启
- 位置权限未授予
- 信号不好

**解决方法**：
1. 检查手机GPS是否开启
2. 检查小程序位置权限
3. 到室外或窗边重试
4. 重启小程序

#### 情况2：超出打卡范围

**原因**：
- 不在仓库附近
- 仓库范围设置过小
- GPS定位偏差

**解决方法**：
1. 确认是否在仓库附近
2. 查看距离最近仓库的距离
3. 到仓库更近的位置重试
4. 联系管理员调整范围

#### 情况3：无可用仓库

**原因**：
- 管理员未设置仓库
- 所有仓库都已禁用

**解决方法**：
- 联系管理员添加或启用仓库

---

## 📊 考勤统计

### 查看考勤记录

1. 在司机工作台点击"当月考勤"
2. 选择要查看的年份和月份
3. 查看统计数据和详细记录

### 统计数据说明

| 数据项 | 说明 |
|--------|------|
| 出勤天数 | 本月总共打卡的天数 |
| 正常天数 | 按时打卡的天数 |
| 迟到次数 | 迟到的次数 |
| 工作时长 | 本月累计工作时长（小时） |

### 记录详情

每条考勤记录包含：
- 日期和星期
- 上班打卡时间和地点
- 下班打卡时间和地点
- 工作时长
- 考勤状态（带颜色标识）
- 备注信息

---

## 🔧 常见问题

### Q1: 如何获取仓库的GPS坐标？

**A:** 有以下几种方法：
1. 使用高德地图或百度地图搜索地址，长按获取坐标
2. 使用在线工具：https://lbs.amap.com/tools/picker
3. 到仓库现场，使用手机GPS获取当前位置坐标

### Q2: 打卡范围设置多少合适？

**A:** 建议根据仓库大小设置：
- 小型仓库：100-300米
- 中型仓库：300-500米
- 大型仓库：500-1000米
- 可以根据实际情况调整

### Q3: 司机反馈无法打卡怎么办？

**A:** 按以下步骤排查：
1. 检查仓库是否已启用
2. 检查打卡范围是否合理
3. 确认司机是否在仓库附近
4. 检查司机手机GPS是否正常
5. 查看错误提示信息

### Q4: 可以修改已有的考勤规则吗？

**A:** 目前编辑仓库时不能修改考勤规则。如需修改，请：
1. 记录原有规则
2. 删除旧仓库
3. 重新创建仓库并设置新规则

**注意**：删除仓库会影响历史考勤记录的关联，请谨慎操作。

### Q5: 司机打卡时会选择哪个仓库？

**A:** 系统会自动选择距离司机最近的仓库。如果司机不在任何仓库的打卡范围内，将无法打卡。

### Q6: 迟到阈值是什么意思？

**A:** 迟到阈值是允许的迟到时间。例如：
- 上班时间：09:00
- 迟到阈值：15分钟
- 09:00-09:15打卡：正常
- 09:15之后打卡：迟到

### Q7: GPS定位不准确怎么办？

**A:** GPS定位可能存在10-50米的误差，这是正常现象。建议：
1. 在室外或窗边打卡，信号更好
2. 适当增加打卡范围
3. 避免在高楼密集区域打卡

### Q8: 可以删除考勤记录吗？

**A:** 
- 司机和普通管理员：不能删除考勤记录
- 超级管理员：可以删除考勤记录
- 建议：不要随意删除考勤记录，以保证数据完整性

---

## 💡 最佳实践

### 仓库设置建议

1. **合理设置打卡范围**
   - 不要设置过小，避免司机无法打卡
   - 不要设置过大，失去定位打卡的意义
   - 建议实地测试后再确定

2. **清晰的仓库命名**
   - 使用易于识别的名称
   - 包含位置信息，如"总部仓库"、"东区仓库"
   - 避免使用编号或代码

3. **准确的GPS坐标**
   - 使用专业工具获取坐标
   - 多次确认坐标准确性
   - 实地测试打卡功能

### 考勤规则建议

1. **合理的时间设置**
   - 根据公司制度设置上下班时间
   - 考虑实际情况，留有余地
   - 定期评估和调整

2. **适当的阈值设置**
   - 迟到阈值：10-15分钟较为合理
   - 早退阈值：10-15分钟较为合理
   - 可根据公司文化调整

3. **定期检查和维护**
   - 定期检查仓库状态
   - 及时处理司机反馈
   - 根据实际情况调整规则

### 司机打卡建议

1. **养成良好习惯**
   - 到达仓库后立即打卡
   - 下班前记得打卡
   - 检查打卡记录是否正确

2. **注意事项**
   - 确保手机GPS已开启
   - 在室外或窗边打卡
   - 遇到问题及时反馈

3. **定期查看考勤**
   - 每周查看考勤记录
   - 发现问题及时处理
   - 保持良好的考勤记录

---

## 📞 技术支持

如有任何问题或建议，请联系：
- 技术支持：请联系系统管理员
- 功能建议：欢迎提出改进建议

---

## 📝 更新日志

### v1.2.0 (2025-11-05)
- ✅ 新增仓库管理功能
- ✅ 新增GPS定位范围限制
- ✅ 新增考勤规则配置
- ✅ 新增自动选择最近仓库
- ✅ 新增考勤状态自动判定
- ✅ 优化打卡流程和用户体验
