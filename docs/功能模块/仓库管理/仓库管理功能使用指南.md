# ä»“åº“ç®¡ç†åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»äº†è½¦é˜Ÿç®¡å®¶å°ç¨‹åºä¸­ä»“åº“ç®¡ç†åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬æƒé™è®¾è®¡ã€API ä½¿ç”¨å’Œå‰ç«¯é›†æˆã€‚

---

## ğŸ” æƒé™è®¾è®¡

### è§’è‰²æƒé™çŸ©é˜µ

| æ“ä½œ | BOSS | MANAGER | DRIVER |
|-----|------|---------|--------|
| æŸ¥çœ‹æ‰€æœ‰ä»“åº“ | âœ… | âœ… | âŒ |
| æŸ¥çœ‹è‡ªå·±çš„ä»“åº“ | âœ… | âœ… | âœ… |
| åˆ›å»ºä»“åº“ | âœ… | âœ… | âŒ |
| æ›´æ–°ä»“åº“ | âœ… | âœ… | âŒ |
| åˆ é™¤ä»“åº“ | âœ… | âœ… | âŒ |
| åˆ†é…ç”¨æˆ·åˆ°ä»“åº“ | âœ… | âœ… | âŒ |
| å–æ¶ˆç”¨æˆ·åˆ†é… | âœ… | âœ… | âŒ |

### RLS ç­–ç•¥è¯´æ˜

#### warehouses è¡¨ç­–ç•¥

1. **new_admins_view_all_warehouses** (SELECT)
   - ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»“åº“
   - è§„åˆ™: `is_admin(auth.uid())`

2. **new_drivers_view_assigned_warehouses** (SELECT)
   - å¸æœºå¯ä»¥æŸ¥çœ‹è‡ªå·±è¢«åˆ†é…çš„ä»“åº“
   - è§„åˆ™: `EXISTS (SELECT 1 FROM warehouse_assignments WHERE warehouse_id = warehouses.id AND user_id = auth.uid())`

3. **new_admins_insert_warehouses** (INSERT)
   - ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºä»“åº“
   - è§„åˆ™: `is_admin(auth.uid())`

4. **new_admins_update_all_warehouses** (UPDATE)
   - ç®¡ç†å‘˜å¯ä»¥æ›´æ–°æ‰€æœ‰ä»“åº“
   - è§„åˆ™: `is_admin(auth.uid())`

5. **new_admins_delete_warehouses** (DELETE)
   - ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ä»“åº“
   - è§„åˆ™: `is_admin(auth.uid())`

#### warehouse_assignments è¡¨ç­–ç•¥

1. **new_admins_view_all_warehouse_assignments** (SELECT)
   - ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»“åº“åˆ†é…
   - è§„åˆ™: `is_admin(auth.uid())`

2. **new_users_view_own_warehouse_assignments** (SELECT)
   - ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ä»“åº“åˆ†é…
   - è§„åˆ™: `user_id = auth.uid()`

3. **new_admins_insert_warehouse_assignments** (INSERT)
   - ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºä»“åº“åˆ†é…
   - è§„åˆ™: `is_admin(auth.uid())`

4. **new_admins_update_all_warehouse_assignments** (UPDATE)
   - ç®¡ç†å‘˜å¯ä»¥æ›´æ–°æ‰€æœ‰ä»“åº“åˆ†é…
   - è§„åˆ™: `is_admin(auth.uid())`

5. **new_admins_delete_warehouse_assignments** (DELETE)
   - ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ä»“åº“åˆ†é…
   - è§„åˆ™: `is_admin(auth.uid())`

---

## ğŸ› ï¸ æ•°æ®åº“å‡½æ•°

### 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®ä»“åº“

```sql
can_user_access_warehouse(p_user_id uuid, p_warehouse_id uuid) RETURNS boolean
```

**åŠŸèƒ½**: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®æŸä¸ªä»“åº“

**å‚æ•°**:
- `p_user_id`: ç”¨æˆ· ID
- `p_warehouse_id`: ä»“åº“ ID

**è¿”å›**: å¸ƒå°”å€¼ï¼Œtrue è¡¨ç¤ºå¯ä»¥è®¿é—®

**ç¤ºä¾‹**:
```sql
SELECT can_user_access_warehouse(
  'ç”¨æˆ·ID',
  'ä»“åº“ID'
);
```

### 2. è·å–ç”¨æˆ·å¯è®¿é—®çš„ä»“åº“åˆ—è¡¨

```sql
get_user_accessible_warehouses(p_user_id uuid) 
RETURNS TABLE (warehouse_id uuid, warehouse_name text, is_active boolean)
```

**åŠŸèƒ½**: è·å–ç”¨æˆ·å¯è®¿é—®çš„æ‰€æœ‰ä»“åº“

**å‚æ•°**:
- `p_user_id`: ç”¨æˆ· ID

**è¿”å›**: ä»“åº“åˆ—è¡¨ï¼ˆIDã€åç§°ã€æ˜¯å¦æ¿€æ´»ï¼‰

**ç¤ºä¾‹**:
```sql
SELECT * FROM get_user_accessible_warehouses('ç”¨æˆ·ID');
```

### 3. è·å–ä»“åº“çš„ç”¨æˆ·åˆ—è¡¨

```sql
get_warehouse_users(p_warehouse_id uuid)
RETURNS TABLE (user_id uuid, user_name text, user_email text, assigned_at timestamptz)
```

**åŠŸèƒ½**: è·å–åˆ†é…åˆ°æŸä¸ªä»“åº“çš„æ‰€æœ‰ç”¨æˆ·

**å‚æ•°**:
- `p_warehouse_id`: ä»“åº“ ID

**è¿”å›**: ç”¨æˆ·åˆ—è¡¨ï¼ˆIDã€å§“åã€é‚®ç®±ã€åˆ†é…æ—¶é—´ï¼‰

**ç¤ºä¾‹**:
```sql
SELECT * FROM get_warehouse_users('ä»“åº“ID');
```

### 4. ä¸ºç”¨æˆ·åˆ†é…ä»“åº“

```sql
assign_user_to_warehouse(p_user_id uuid, p_warehouse_id uuid, p_assigned_by uuid)
RETURNS uuid
```

**åŠŸèƒ½**: ä¸ºç”¨æˆ·åˆ†é…ä»“åº“

**å‚æ•°**:
- `p_user_id`: ç”¨æˆ· ID
- `p_warehouse_id`: ä»“åº“ ID
- `p_assigned_by`: åˆ†é…è€… IDï¼ˆå¿…é¡»æ˜¯ç®¡ç†å‘˜ï¼‰

**è¿”å›**: åˆ†é…è®°å½• ID

**å¼‚å¸¸**:
- åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ†é…ä»“åº“
- ç”¨æˆ·ä¸å­˜åœ¨
- ä»“åº“ä¸å­˜åœ¨
- ç”¨æˆ·å·²ç»è¢«åˆ†é…åˆ°è¯¥ä»“åº“

**ç¤ºä¾‹**:
```sql
SELECT assign_user_to_warehouse(
  'ç”¨æˆ·ID',
  'ä»“åº“ID',
  'ç®¡ç†å‘˜ID'
);
```

### 5. å–æ¶ˆç”¨æˆ·çš„ä»“åº“åˆ†é…

```sql
unassign_user_from_warehouse(p_user_id uuid, p_warehouse_id uuid, p_unassigned_by uuid)
RETURNS boolean
```

**åŠŸèƒ½**: å–æ¶ˆç”¨æˆ·çš„ä»“åº“åˆ†é…

**å‚æ•°**:
- `p_user_id`: ç”¨æˆ· ID
- `p_warehouse_id`: ä»“åº“ ID
- `p_unassigned_by`: å–æ¶ˆåˆ†é…è€… IDï¼ˆå¿…é¡»æ˜¯ç®¡ç†å‘˜ï¼‰

**è¿”å›**: å¸ƒå°”å€¼ï¼Œtrue è¡¨ç¤ºæˆåŠŸ

**å¼‚å¸¸**:
- åªæœ‰ç®¡ç†å‘˜å¯ä»¥å–æ¶ˆä»“åº“åˆ†é…
- åˆ†é…è®°å½•ä¸å­˜åœ¨

**ç¤ºä¾‹**:
```sql
SELECT unassign_user_from_warehouse(
  'ç”¨æˆ·ID',
  'ä»“åº“ID',
  'ç®¡ç†å‘˜ID'
);
```

### 6. æ‰¹é‡åˆ†é…ç”¨æˆ·åˆ°ä»“åº“

```sql
batch_assign_users_to_warehouse(p_user_ids uuid[], p_warehouse_id uuid, p_assigned_by uuid)
RETURNS TABLE (user_id uuid, success boolean, error_message text)
```

**åŠŸèƒ½**: æ‰¹é‡ä¸ºå¤šä¸ªç”¨æˆ·åˆ†é…åŒä¸€ä¸ªä»“åº“

**å‚æ•°**:
- `p_user_ids`: ç”¨æˆ· ID æ•°ç»„
- `p_warehouse_id`: ä»“åº“ ID
- `p_assigned_by`: åˆ†é…è€… IDï¼ˆå¿…é¡»æ˜¯ç®¡ç†å‘˜ï¼‰

**è¿”å›**: æ¯ä¸ªç”¨æˆ·çš„åˆ†é…ç»“æœï¼ˆç”¨æˆ· IDã€æ˜¯å¦æˆåŠŸã€é”™è¯¯ä¿¡æ¯ï¼‰

**ç¤ºä¾‹**:
```sql
SELECT * FROM batch_assign_users_to_warehouse(
  ARRAY['ç”¨æˆ·ID1', 'ç”¨æˆ·ID2', 'ç”¨æˆ·ID3'],
  'ä»“åº“ID',
  'ç®¡ç†å‘˜ID'
);
```

---

## ğŸ’» å‰ç«¯é›†æˆ

### 1. è·å–ç”¨æˆ·å¯è®¿é—®çš„ä»“åº“åˆ—è¡¨

```typescript
import { supabase } from '@/client/supabase';

async function getUserWarehouses() {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    console.error('ç”¨æˆ·æœªç™»å½•');
    return [];
  }
  
  const { data, error } = await supabase
    .rpc('get_user_accessible_warehouses', {
      p_user_id: user.id
    });
  
  if (error) {
    console.error('è·å–ä»“åº“åˆ—è¡¨å¤±è´¥:', error);
    return [];
  }
  
  return data;
}

// ä½¿ç”¨ç¤ºä¾‹
const warehouses = await getUserWarehouses();
console.log('å¯è®¿é—®çš„ä»“åº“:', warehouses);
```

### 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®ä»“åº“

```typescript
async function checkWarehouseAccess(warehouseId: string) {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    return false;
  }
  
  const { data, error } = await supabase
    .rpc('can_user_access_warehouse', {
      p_user_id: user.id,
      p_warehouse_id: warehouseId
    });
  
  if (error) {
    console.error('æ£€æŸ¥ä»“åº“è®¿é—®æƒé™å¤±è´¥:', error);
    return false;
  }
  
  return data;
}

// ä½¿ç”¨ç¤ºä¾‹
const canAccess = await checkWarehouseAccess('ä»“åº“ID');
if (canAccess) {
  console.log('å¯ä»¥è®¿é—®è¯¥ä»“åº“');
} else {
  console.log('æ— æƒè®¿é—®è¯¥ä»“åº“');
}
```

### 3. è·å–ä»“åº“çš„ç”¨æˆ·åˆ—è¡¨

```typescript
async function getWarehouseUsers(warehouseId: string) {
  const { data, error } = await supabase
    .rpc('get_warehouse_users', {
      p_warehouse_id: warehouseId
    });
  
  if (error) {
    console.error('è·å–ä»“åº“ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
    return [];
  }
  
  return data;
}

// ä½¿ç”¨ç¤ºä¾‹
const users = await getWarehouseUsers('ä»“åº“ID');
console.log('ä»“åº“ç”¨æˆ·åˆ—è¡¨:', users);
```

### 4. ä¸ºç”¨æˆ·åˆ†é…ä»“åº“

```typescript
async function assignUserToWarehouse(userId: string, warehouseId: string) {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    throw new Error('ç”¨æˆ·æœªç™»å½•');
  }
  
  const { data, error } = await supabase
    .rpc('assign_user_to_warehouse', {
      p_user_id: userId,
      p_warehouse_id: warehouseId,
      p_assigned_by: user.id
    });
  
  if (error) {
    throw new Error(`åˆ†é…ä»“åº“å¤±è´¥: ${error.message}`);
  }
  
  return data;
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  const assignmentId = await assignUserToWarehouse('ç”¨æˆ·ID', 'ä»“åº“ID');
  console.log('åˆ†é…æˆåŠŸï¼Œè®°å½•ID:', assignmentId);
  Taro.showToast({
    title: 'åˆ†é…æˆåŠŸ',
    icon: 'success'
  });
} catch (error) {
  console.error(error);
  Taro.showToast({
    title: error.message,
    icon: 'none'
  });
}
```

### 5. å–æ¶ˆç”¨æˆ·çš„ä»“åº“åˆ†é…

```typescript
async function unassignUserFromWarehouse(userId: string, warehouseId: string) {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    throw new Error('ç”¨æˆ·æœªç™»å½•');
  }
  
  const { data, error } = await supabase
    .rpc('unassign_user_from_warehouse', {
      p_user_id: userId,
      p_warehouse_id: warehouseId,
      p_unassigned_by: user.id
    });
  
  if (error) {
    throw new Error(`å–æ¶ˆåˆ†é…å¤±è´¥: ${error.message}`);
  }
  
  return data;
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  await unassignUserFromWarehouse('ç”¨æˆ·ID', 'ä»“åº“ID');
  console.log('å–æ¶ˆåˆ†é…æˆåŠŸ');
  Taro.showToast({
    title: 'å–æ¶ˆåˆ†é…æˆåŠŸ',
    icon: 'success'
  });
} catch (error) {
  console.error(error);
  Taro.showToast({
    title: error.message,
    icon: 'none'
  });
}
```

### 6. æ‰¹é‡åˆ†é…ç”¨æˆ·åˆ°ä»“åº“

```typescript
async function batchAssignUsersToWarehouse(userIds: string[], warehouseId: string) {
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    throw new Error('ç”¨æˆ·æœªç™»å½•');
  }
  
  const { data, error } = await supabase
    .rpc('batch_assign_users_to_warehouse', {
      p_user_ids: userIds,
      p_warehouse_id: warehouseId,
      p_assigned_by: user.id
    });
  
  if (error) {
    throw new Error(`æ‰¹é‡åˆ†é…å¤±è´¥: ${error.message}`);
  }
  
  return data;
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  const results = await batchAssignUsersToWarehouse(
    ['ç”¨æˆ·ID1', 'ç”¨æˆ·ID2', 'ç”¨æˆ·ID3'],
    'ä»“åº“ID'
  );
  
  const successCount = results.filter(r => r.success).length;
  const failCount = results.filter(r => !r.success).length;
  
  console.log(`æ‰¹é‡åˆ†é…å®Œæˆ: æˆåŠŸ ${successCount} ä¸ªï¼Œå¤±è´¥ ${failCount} ä¸ª`);
  
  // æ˜¾ç¤ºå¤±è´¥çš„è®°å½•
  results.filter(r => !r.success).forEach(r => {
    console.error(`ç”¨æˆ· ${r.user_id} åˆ†é…å¤±è´¥: ${r.error_message}`);
  });
  
  Taro.showToast({
    title: `æˆåŠŸåˆ†é… ${successCount} ä¸ªç”¨æˆ·`,
    icon: 'success'
  });
} catch (error) {
  console.error(error);
  Taro.showToast({
    title: error.message,
    icon: 'none'
  });
}
```

---

## ğŸ“± å®Œæ•´çš„ä»“åº“ç®¡ç†é¡µé¢ç¤ºä¾‹

### ä»“åº“åˆ—è¡¨é¡µé¢

```typescript
import React, { useEffect, useState } from 'react';
import { View, Text, Button } from '@tarojs/components';
import Taro from '@tarojs/taro';
import { supabase } from '@/client/supabase';

interface Warehouse {
  warehouse_id: string;
  warehouse_name: string;
  is_active: boolean;
}

const WarehouseList: React.FC = () => {
  const [warehouses, setWarehouses] = useState<Warehouse[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    loadWarehouses();
  }, []);
  
  const loadWarehouses = async () => {
    try {
      setLoading(true);
      const { data: { user } } = await supabase.auth.getUser();
      
      if (!user) {
        Taro.showToast({
          title: 'è¯·å…ˆç™»å½•',
          icon: 'none'
        });
        return;
      }
      
      const { data, error } = await supabase
        .rpc('get_user_accessible_warehouses', {
          p_user_id: user.id
        });
      
      if (error) throw error;
      
      setWarehouses(data || []);
    } catch (error) {
      console.error('åŠ è½½ä»“åº“åˆ—è¡¨å¤±è´¥:', error);
      Taro.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'none'
      });
    } finally {
      setLoading(false);
    }
  };
  
  const handleWarehouseClick = (warehouseId: string) => {
    Taro.navigateTo({
      url: `/pages/warehouse/detail/index?id=${warehouseId}`
    });
  };
  
  return (
    <View className="p-4">
      <Text className="text-2xl font-bold mb-4">ä»“åº“åˆ—è¡¨</Text>
      
      {loading ? (
        <Text>åŠ è½½ä¸­...</Text>
      ) : warehouses.length === 0 ? (
        <Text>æš‚æ— ä»“åº“</Text>
      ) : (
        warehouses.map(warehouse => (
          <View
            key={warehouse.warehouse_id}
            className="bg-card p-4 rounded-lg mb-2"
            onClick={() => handleWarehouseClick(warehouse.warehouse_id)}
          >
            <Text className="text-lg font-semibold">{warehouse.warehouse_name}</Text>
            <Text className={`text-sm ${warehouse.is_active ? 'text-primary' : 'text-muted'}`}>
              {warehouse.is_active ? 'æ¿€æ´»' : 'æœªæ¿€æ´»'}
            </Text>
          </View>
        ))
      )}
    </View>
  );
};

export default WarehouseList;
```

### ä»“åº“è¯¦æƒ…é¡µé¢

```typescript
import React, { useEffect, useState } from 'react';
import { View, Text, Button } from '@tarojs/components';
import Taro, { useRouter } from '@tarojs/taro';
import { supabase } from '@/client/supabase';

interface WarehouseUser {
  user_id: string;
  user_name: string;
  user_email: string;
  assigned_at: string;
}

const WarehouseDetail: React.FC = () => {
  const router = useRouter();
  const warehouseId = router.params.id;
  
  const [users, setUsers] = useState<WarehouseUser[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    if (warehouseId) {
      loadWarehouseUsers();
    }
  }, [warehouseId]);
  
  const loadWarehouseUsers = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .rpc('get_warehouse_users', {
          p_warehouse_id: warehouseId
        });
      
      if (error) throw error;
      
      setUsers(data || []);
    } catch (error) {
      console.error('åŠ è½½ä»“åº“ç”¨æˆ·å¤±è´¥:', error);
      Taro.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'none'
      });
    } finally {
      setLoading(false);
    }
  };
  
  const handleUnassignUser = async (userId: string) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      
      if (!user) {
        Taro.showToast({
          title: 'è¯·å…ˆç™»å½•',
          icon: 'none'
        });
        return;
      }
      
      const { error } = await supabase
        .rpc('unassign_user_from_warehouse', {
          p_user_id: userId,
          p_warehouse_id: warehouseId,
          p_unassigned_by: user.id
        });
      
      if (error) throw error;
      
      Taro.showToast({
        title: 'å–æ¶ˆåˆ†é…æˆåŠŸ',
        icon: 'success'
      });
      
      // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
      loadWarehouseUsers();
    } catch (error) {
      console.error('å–æ¶ˆåˆ†é…å¤±è´¥:', error);
      Taro.showToast({
        title: error.message || 'å–æ¶ˆåˆ†é…å¤±è´¥',
        icon: 'none'
      });
    }
  };
  
  return (
    <View className="p-4">
      <Text className="text-2xl font-bold mb-4">ä»“åº“ç”¨æˆ·</Text>
      
      {loading ? (
        <Text>åŠ è½½ä¸­...</Text>
      ) : users.length === 0 ? (
        <Text>æš‚æ— ç”¨æˆ·</Text>
      ) : (
        users.map(user => (
          <View key={user.user_id} className="bg-card p-4 rounded-lg mb-2">
            <Text className="text-lg font-semibold">{user.user_name}</Text>
            <Text className="text-sm text-muted">{user.user_email}</Text>
            <Text className="text-xs text-muted">
              åˆ†é…æ—¶é—´: {new Date(user.assigned_at).toLocaleString()}
            </Text>
            <Button
              className="mt-2"
              size="mini"
              onClick={() => handleUnassignUser(user.user_id)}
            >
              å–æ¶ˆåˆ†é…
            </Button>
          </View>
        ))
      )}
    </View>
  );
};

export default WarehouseDetail;
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1ï¼šç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰ä»“åº“

```sql
-- å‡è®¾ç®¡ç†å‘˜ ID ä¸º 'admin-uuid'
-- è®¾ç½®ä¼šè¯ç”¨æˆ·
SET LOCAL "request.jwt.claims" = '{"sub": "admin-uuid"}';

-- æŸ¥è¯¢æ‰€æœ‰ä»“åº“
SELECT * FROM warehouses;

-- é¢„æœŸç»“æœï¼šè¿”å›æ‰€æœ‰ä»“åº“
```

### æµ‹è¯• 2ï¼šå¸æœºæŸ¥çœ‹è‡ªå·±çš„ä»“åº“

```sql
-- å‡è®¾å¸æœº ID ä¸º 'driver-uuid'
-- è®¾ç½®ä¼šè¯ç”¨æˆ·
SET LOCAL "request.jwt.claims" = '{"sub": "driver-uuid"}';

-- æŸ¥è¯¢ä»“åº“
SELECT * FROM warehouses;

-- é¢„æœŸç»“æœï¼šåªè¿”å›è¯¥å¸æœºè¢«åˆ†é…çš„ä»“åº“
```

### æµ‹è¯• 3ï¼šä¸ºç”¨æˆ·åˆ†é…ä»“åº“

```sql
-- ç®¡ç†å‘˜ä¸ºå¸æœºåˆ†é…ä»“åº“
SELECT assign_user_to_warehouse(
  'driver-uuid',
  'warehouse-uuid',
  'admin-uuid'
);

-- é¢„æœŸç»“æœï¼šè¿”å›åˆ†é…è®°å½• ID
```

### æµ‹è¯• 4ï¼šå–æ¶ˆç”¨æˆ·çš„ä»“åº“åˆ†é…

```sql
-- ç®¡ç†å‘˜å–æ¶ˆå¸æœºçš„ä»“åº“åˆ†é…
SELECT unassign_user_from_warehouse(
  'driver-uuid',
  'warehouse-uuid',
  'admin-uuid'
);

-- é¢„æœŸç»“æœï¼šè¿”å› true
```

### æµ‹è¯• 5ï¼šæ‰¹é‡åˆ†é…ç”¨æˆ·åˆ°ä»“åº“

```sql
-- ç®¡ç†å‘˜æ‰¹é‡åˆ†é…å¤šä¸ªå¸æœºåˆ°ä»“åº“
SELECT * FROM batch_assign_users_to_warehouse(
  ARRAY['driver-uuid-1', 'driver-uuid-2', 'driver-uuid-3'],
  'warehouse-uuid',
  'admin-uuid'
);

-- é¢„æœŸç»“æœï¼šè¿”å›æ¯ä¸ªç”¨æˆ·çš„åˆ†é…ç»“æœ
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æƒé™æ£€æŸ¥

- æ‰€æœ‰ä»“åº“ç®¡ç†æ“ä½œéƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
- å¸æœºåªèƒ½æŸ¥çœ‹è‡ªå·±è¢«åˆ†é…çš„ä»“åº“
- åœ¨å‰ç«¯è°ƒç”¨å‡½æ•°å‰ï¼Œå»ºè®®å…ˆæ£€æŸ¥ç”¨æˆ·è§’è‰²

### 2. é”™è¯¯å¤„ç†

- æ‰€æœ‰æ•°æ®åº“å‡½æ•°éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦åœ¨å‰ç«¯æ•è·å¹¶å¤„ç†
- å»ºè®®ä½¿ç”¨ try-catch åŒ…è£¹æ‰€æœ‰æ•°æ®åº“è°ƒç”¨
- å‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯

### 3. æ€§èƒ½ä¼˜åŒ–

- ä»“åº“åˆ—è¡¨å»ºè®®æ·»åŠ åˆ†é¡µ
- ç”¨æˆ·åˆ—è¡¨å»ºè®®æ·»åŠ æœç´¢å’Œç­›é€‰åŠŸèƒ½
- è€ƒè™‘ç¼“å­˜å¸¸ç”¨çš„ä»“åº“åˆ—è¡¨

### 4. æ•°æ®ä¸€è‡´æ€§

- åˆ é™¤ä»“åº“å‰ï¼Œå»ºè®®å…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·åˆ†é…
- åˆ é™¤ç”¨æˆ·å‰ï¼Œå»ºè®®å…ˆå–æ¶ˆæ‰€æœ‰ä»“åº“åˆ†é…
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æƒé™ç³»ç»Ÿé‡æ„å®ŒæˆæŠ¥å‘Š](./æƒé™ç³»ç»Ÿé‡æ„å®ŒæˆæŠ¥å‘Š.md)
- [æƒé™ç³»ç»Ÿæµ‹è¯•æŒ‡å—](./æµ‹è¯•æƒé™ç³»ç»Ÿ.md)
- [æƒé™ç³»ç»Ÿé‡æ„è¯´æ˜](./æƒé™ç³»ç»Ÿé‡æ„è¯´æ˜.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¶é—´**: 2025-12-01  
**é€‚ç”¨èŒƒå›´**: è½¦é˜Ÿç®¡å®¶å°ç¨‹åºä»“åº“ç®¡ç†åŠŸèƒ½  
**çŠ¶æ€**: å·²å®Œæˆ
