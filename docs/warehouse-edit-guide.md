# 仓库编辑页面使用指南

## 概述

仓库编辑页面是超级管理员专用的仓库配置界面，提供了完整的仓库设置功能，包括基本信息、品类配置和管理员分配。通过这个页面，超级管理员可以全面管理仓库的各项设置。

## 访问方式

1. 登录超级管理员账号
2. 进入"超级管理员控制台"
3. 点击"仓库管理"
4. 在仓库列表中点击任意仓库的"编辑"按钮
5. 跳转到专用的仓库编辑页面

## 页面结构

### 1. 设置说明卡片

页面顶部显示蓝色的说明卡片，包含三个重要说明：

#### 品类设置
- **作用**：为仓库配置可用的计件品类和单价
- **必要性**：司机只能在配置了品类的仓库提交计件工作报告
- **影响**：未配置品类的仓库，司机无法进行计件录入

#### 管理员设置
- **要求**：必须为仓库指定至少一个管理员
- **权限**：管理员可以审批该仓库的请假申请和计件报告
- **必要性**：没有管理员的仓库无法保存

#### 超级管理员
- **特权**：超级管理员可以将自己设置为任何仓库的管理员
- **便利**：通过"快速添加"功能，一键将自己设为管理员
- **灵活性**：可以直接管理该仓库，无需额外配置

## 功能详解

### 一、基本信息设置

#### 1. 仓库名称（必填）
- **字段说明**：仓库的显示名称
- **验证规则**：不能为空
- **使用场景**：在所有仓库列表和选择器中显示

#### 2. 仓库状态
- **启用**：司机可以在该仓库打卡和提交计件
- **停用**：司机无法在该仓库进行任何操作
- **切换方式**：使用开关按钮快速切换
- **提示**：停用后，司机将无法在该仓库打卡和提交计件

#### 3. 最大请假天数
- **默认值**：7天
- **作用**：限制司机单次请假的最大天数
- **验证**：必须为正整数
- **影响**：司机提交请假申请时，系统会检查是否超过此限制

#### 4. 离职提前通知天数
- **默认值**：30天
- **作用**：规定司机离职需要提前通知的天数
- **验证**：必须为正整数
- **影响**：司机提交离职申请时，系统会根据此设置计算离职日期

### 二、品类配置

#### 功能说明
为仓库配置可用的计件品类，并设置不同类型司机的单价。

#### 操作步骤

1. **查看品类列表**
   - 显示系统中所有已创建的品类
   - 显示品类状态（启用中/已停用）
   - 已选择的品类会高亮显示

2. **选择品类**
   - 点击品类卡片左侧的复选框
   - 选中后，品类卡片变为蓝色高亮
   - 自动展开价格设置区域

3. **设置价格**
   
   每个品类需要设置两种单价：
   
   **纯司机单价（元/件）**
   - 适用于没有车辆的司机
   - 只计算基本的搬运工作费用
   - 必须为有效的数字（≥0）
   
   **带车司机单价（元/件）**
   - 适用于自带车辆的司机
   - 包含车辆使用成本
   - 通常高于纯司机单价
   - 必须为有效的数字（≥0）

4. **取消选择**
   - 再次点击复选框可以取消选择
   - 取消后，该品类的价格设置会被清除

#### 注意事项

- ✅ **必须设置价格**：选择品类后，必须为两种单价都设置有效值
- ✅ **价格验证**：保存时会验证所有选中品类的价格是否有效
- ⚠️ **影响范围**：未配置品类的仓库，司机无法提交计件工作报告
- 💡 **建议**：根据实际业务情况，合理设置两种单价的差异

#### 示例

假设有一个"搬运纸箱"品类：
- 纯司机单价：5元/件（只负责搬运）
- 带车司机单价：8元/件（包含车辆使用成本）

### 三、管理员分配

#### 功能说明
为仓库指定管理员，管理员可以审批该仓库的请假申请和计件报告。

#### 操作步骤

1. **查看管理员列表**
   - 显示所有管理员和超级管理员
   - 显示管理员角色（超级管理员/普通管理员）
   - 标识当前登录用户（显示"我"标签）
   - 已选择的管理员会高亮显示

2. **快速添加自己**
   - 如果当前用户未被选中，会显示"快速添加"卡片
   - 点击"添加自己"按钮，一键将自己设为管理员
   - 适用于超级管理员想要直接管理某个仓库的场景

3. **选择管理员**
   - 点击管理员卡片进行选择/取消选择
   - 选中后，管理员卡片变为绿色高亮
   - 可以选择多个管理员
   - 至少必须选择一个管理员

4. **管理员信息**
   - 显示管理员姓名（或手机号/邮箱）
   - 显示管理员角色
   - 标识是否为当前登录用户

#### 管理员权限

被分配到仓库的管理员拥有以下权限：

- ✅ 审批该仓库的请假申请
- ✅ 审批该仓库的离职申请
- ✅ 查看该仓库的计件报告
- ✅ 审批该仓库的计件报告
- ✅ 查看该仓库的考勤数据
- ✅ 查看该仓库的统计报表

#### 注意事项

- ⚠️ **必须选择**：至少必须选择一个管理员，否则无法保存
- 💡 **多管理员**：可以为一个仓库分配多个管理员，共同管理
- 🔐 **权限范围**：普通管理员只能管理被分配的仓库
- 🌟 **超级管理员**：超级管理员可以管理所有仓库，无需分配

#### 使用场景

**场景1：新建仓库**
- 超级管理员创建新仓库后
- 使用"快速添加"将自己设为管理员
- 可以立即开始管理该仓库

**场景2：委托管理**
- 超级管理员将仓库分配给普通管理员
- 普通管理员负责日常审批工作
- 超级管理员保留监督权限

**场景3：多人协作**
- 为大型仓库分配多个管理员
- 分担审批工作量
- 提高审批效率

## 保存设置

### 保存流程

1. **填写完整信息**
   - 确保仓库名称已填写
   - 确保至少选择了一个管理员
   - 确保所有选中品类的价格都已设置

2. **点击保存按钮**
   - 底部固定的"保存设置"按钮
   - 点击后会进行表单验证

3. **验证检查**
   - 验证仓库名称不为空
   - 验证至少选择了一个管理员
   - 验证所有品类价格都是有效数字
   - 验证纯司机单价和带车司机单价都已设置

4. **保存数据**
   - 更新仓库基本信息
   - 更新品类价格配置
   - 更新管理员分配
   - 清除相关缓存

5. **返回列表**
   - 保存成功后显示提示
   - 自动返回仓库管理页面
   - 数据实时更新

### 验证错误提示

如果保存时出现错误，系统会显示相应的提示：

- ❌ "请输入仓库名称" - 仓库名称为空
- ❌ "请至少选择一个管理员" - 未选择管理员
- ❌ "请为品类"XXX"设置有效的纯司机单价" - 纯司机单价无效
- ❌ "请为品类"XXX"设置有效的带车司机单价" - 带车司机单价无效

## 数据同步

### 缓存机制

保存成功后，系统会自动清除以下缓存：

- 仓库列表缓存
- 仓库品类缓存
- 仓库分配缓存
- 管理员仓库缓存
- 仪表板数据缓存

### 实时更新

- 所有相关页面会自动获取最新数据
- 管理员端会立即看到新的仓库配置
- 司机端会立即看到新的品类和价格
- 确保数据一致性

## 最佳实践

### 1. 品类配置建议

- ✅ **合理定价**：根据实际工作量和市场行情设置单价
- ✅ **区分类型**：带车司机单价应高于纯司机单价
- ✅ **定期调整**：根据业务变化及时调整价格
- ✅ **覆盖全面**：为仓库配置所有可能用到的品类

### 2. 管理员分配建议

- ✅ **明确责任**：为每个仓库指定明确的管理员
- ✅ **合理分工**：大型仓库可以分配多个管理员
- ✅ **及时调整**：管理员变动时及时更新分配
- ✅ **保留备份**：建议至少分配两个管理员，避免单点故障

### 3. 仓库设置建议

- ✅ **合理限制**：根据公司政策设置请假天数和离职通知期
- ✅ **灵活调整**：根据实际情况调整仓库状态
- ✅ **清晰命名**：使用易于识别的仓库名称
- ✅ **完整配置**：确保所有必要信息都已填写

## 常见问题

### Q1: 为什么必须设置管理员？

**A:** 管理员负责审批该仓库的请假申请和计件报告。没有管理员的仓库，司机的申请将无人审批，影响正常业务流程。

### Q2: 超级管理员需要将自己设为管理员吗？

**A:** 不是必须的。超级管理员默认拥有所有仓库的管理权限。但如果想要在管理员端看到该仓库，可以将自己设为管理员。

### Q3: 可以不配置品类吗？

**A:** 可以，但不建议。未配置品类的仓库，司机无法提交计件工作报告。如果该仓库需要计件功能，必须配置品类。

### Q4: 纯司机单价和带车司机单价有什么区别？

**A:** 
- **纯司机单价**：适用于没有车辆的司机，只计算基本的搬运工作费用
- **带车司机单价**：适用于自带车辆的司机，包含车辆使用成本，通常高于纯司机单价

### Q5: 修改品类价格会影响历史数据吗？

**A:** 不会。修改价格只影响新提交的计件报告。已提交的计件报告使用的是提交时的价格，不会被修改。

### Q6: 可以为同一个仓库分配多个管理员吗？

**A:** 可以。支持为一个仓库分配多个管理员，他们都可以审批该仓库的申请。

### Q7: 停用仓库后会发生什么？

**A:** 停用后：
- 司机无法在该仓库打卡
- 司机无法提交该仓库的计件报告
- 历史数据不受影响
- 管理员仍可以查看历史数据

### Q8: 如何快速将自己设为管理员？

**A:** 如果当前用户未被选中，页面会显示"快速添加"卡片。点击"添加自己"按钮即可一键将自己设为管理员。

## 技术说明

### 数据结构

#### 品类价格配置
```typescript
{
  warehouse_id: string,        // 仓库ID
  category_id: string,         // 品类ID
  driver_price: number,        // 纯司机单价
  driver_with_vehicle_price: number  // 带车司机单价
}
```

#### 管理员分配
```typescript
{
  manager_id: string,    // 管理员ID
  warehouse_id: string   // 仓库ID
}
```

### API 调用

- `updateWarehouse()` - 更新仓库基本信息
- `upsertCategoryPrice()` - 更新品类价格配置
- `addManagerWarehouse()` - 添加管理员分配
- `removeManagerWarehouse()` - 删除管理员分配
- `getWarehouseManagers()` - 获取仓库管理员列表
- `getAllCategories()` - 获取所有品类
- `getCategoryPricesByWarehouse()` - 获取仓库品类价格

### 缓存键

```typescript
CACHE_KEYS.ALL_WAREHOUSES           // 所有仓库
CACHE_KEYS.WAREHOUSE_CATEGORIES     // 仓库品类
CACHE_KEYS.WAREHOUSE_ASSIGNMENTS    // 仓库分配
CACHE_KEYS.MANAGER_WAREHOUSES       // 管理员仓库
CACHE_KEYS.DASHBOARD_DATA           // 仪表板数据
```

## 总结

仓库编辑页面是超级管理员管理仓库的核心工具，提供了完整的配置功能：

- 📝 **基本信息**：设置仓库名称、状态、请假规则等
- 📦 **品类配置**：为仓库配置可用的计件品类和单价
- 👥 **管理员分配**：为仓库指定管理员，明确管理责任
- 💡 **智能说明**：提供详细的设置说明和作用解释
- ✅ **表单验证**：确保所有必填项都已正确填写
- 🔄 **数据同步**：使用智能缓存机制确保数据实时更新

通过合理使用这个页面，超级管理员可以高效地管理所有仓库，确保业务流程顺畅运行。
