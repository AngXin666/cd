# 数据库结构查看器使用指南

## 功能概述

数据库结构查看器是一个用于查看和管理数据库表结构的工具，帮助开发者和管理员快速了解数据库的设计和结构。

## 访问路径

1. 登录老板端账号
2. 在首页找到"系统功能"板块
3. 点击"数据库结构"图标（青色背景，数据库图标）

或直接访问：`/pages/super-admin/database-schema/index`

## 主要功能

### 1. 表列表查看

- **功能**：显示数据库中所有的表
- **信息**：表名、模式名
- **操作**：点击任意表可查看详细信息

### 2. 搜索功能

- **功能**：快速搜索表名
- **使用**：在搜索框输入关键词，实时过滤表列表
- **支持**：不区分大小写的模糊搜索

### 3. 表详情查看

点击表后可查看：

#### 字段列表
- **字段名**：列的名称
- **数据类型**：字段的数据类型（如 uuid, text, integer 等）
- **是否可空**：显示字段是否允许为空（必填/可空）
- **默认值**：字段的默认值（如果有）
- **长度/精度**：字符类型的最大长度或数值类型的精度

#### 约束列表
- **约束名称**：约束的名称
- **约束类型**：
  - 主键（PRIMARY KEY）- 蓝色标签
  - 外键（FOREIGN KEY）- 绿色标签
  - 唯一（UNIQUE）- 紫色标签
  - 检查约束（CHECK）- 灰色标签
- **关联列**：约束作用的列名

## 使用场景

### 1. 数据库设计查看
快速了解数据库的表结构设计，包括字段类型、约束关系等。

### 2. 版本管理辅助
在进行数据库迁移或版本更新时，查看当前数据库的实际结构，确保迁移脚本的正确性。

### 3. 问题排查
当遇到数据相关问题时，可以快速查看表结构，确认字段类型、约束等是否符合预期。

### 4. 文档参考
作为数据库结构的实时文档，帮助团队成员了解数据模型。

## 技术实现

### 数据库函数

工具使用以下数据库函数查询结构信息：

1. **get_database_tables()**
   - 获取所有表的基本信息
   - 只返回 public 模式的表

2. **get_table_columns(table_name)**
   - 获取指定表的所有列信息
   - 包括数据类型、是否可空、默认值等

3. **get_table_constraints(table_name)**
   - 获取指定表的所有约束信息
   - 包括主键、外键、唯一约束等

### 安全性

- 所有函数使用 `SECURITY DEFINER` 权限执行
- 只有老板端用户可以访问此功能
- 只显示 public 模式的表，不暴露系统表

## 界面说明

### 表列表页面
```
┌─────────────────────────────┐
│  🔍 搜索表名...              │
├─────────────────────────────┤
│  📊 profiles                │
│     public                  │
├─────────────────────────────┤
│  📊 warehouses              │
│     public                  │
├─────────────────────────────┤
│  📊 vehicles                │
│     public                  │
└─────────────────────────────┘
```

### 表详情页面
```
┌─────────────────────────────┐
│  ← 返回表列表                │
├─────────────────────────────┤
│  📊 profiles                │
│  [5 个字段] [3 个约束]       │
├─────────────────────────────┤
│  字段列表                    │
│  🔑 id                      │
│     类型：uuid              │
│     必填                    │
│  🔑 name                    │
│     类型：text              │
│     可空                    │
├─────────────────────────────┤
│  约束列表                    │
│  profiles_pkey              │
│  [主键] 列：id              │
└─────────────────────────────┘
```

## 注意事项

1. **权限要求**：只有老板端用户可以访问此功能
2. **只读功能**：此工具仅用于查看，不支持修改数据库结构
3. **实时数据**：显示的是数据库的实时结构，不是缓存数据
4. **性能考虑**：查询大量表时可能需要一些时间加载

## 未来扩展

可能的功能扩展方向：

1. **导出功能**：导出表结构为 Markdown 或 JSON 格式
2. **关系图**：可视化显示表之间的关系
3. **数据预览**：查看表中的示例数据
4. **迁移历史**：显示数据库迁移的历史记录
5. **索引信息**：显示表的索引信息
6. **RLS 策略**：显示行级安全策略

## 相关文件

- 页面组件：`src/pages/super-admin/database-schema/index.tsx`
- API 函数：`src/db/api.ts`（DatabaseTable, DatabaseColumn, DatabaseConstraint 相关）
- 数据库迁移：`supabase/migrations/025_create_database_schema_functions.sql`
- 路由配置：`src/app.config.ts`

## 反馈与建议

如果您在使用过程中遇到问题或有改进建议，请通过以下方式反馈：

1. 在小程序中使用"意见反馈"功能
2. 联系技术支持团队
3. 提交 Issue 到项目仓库
