# 考勤打卡功能使用指南

## 功能概述

车队管家小程序为司机提供了完整的考勤打卡功能，支持GPS定位打卡，自动记录工作时长，方便管理员统计和管理。

---

## 功能特点

### 1. GPS定位打卡
- ✅ 自动获取GPS位置信息
- ✅ 记录打卡地点的经纬度
- ✅ 防止作弊，确保打卡真实性

### 2. 上下班打卡
- ✅ 支持上班打卡和下班打卡
- ✅ 自动计算工作时长
- ✅ 每天只能打卡一次

### 3. 考勤统计
- ✅ 查看当月考勤记录
- ✅ 统计出勤天数、正常天数、迟到次数
- ✅ 统计总工作时长

---

## 使用步骤

### 上下班打卡

#### 第一步：进入打卡页面
1. 登录司机账号
2. 在司机工作台点击"上下班打卡"功能卡片
3. 进入打卡页面

#### 第二步：上班打卡
1. 确保手机已开启位置权限
2. 点击"上班打卡"按钮
3. 系统会自动获取GPS位置
4. 打卡成功后显示打卡记录

#### 第三步：下班打卡
1. 下班时再次进入打卡页面
2. 点击"下班打卡"按钮
3. 系统会自动获取GPS位置
4. 自动计算工作时长
5. 打卡成功后显示完整记录

### 查看考勤记录

#### 第一步：进入考勤页面
1. 在司机工作台点击"当月考勤"功能卡片
2. 进入考勤统计页面

#### 第二步：选择月份
1. 点击年份选择器，选择要查看的年份
2. 点击月份选择器，选择要查看的月份
3. 系统会自动加载该月的考勤记录

#### 第三步：查看统计数据
页面会显示以下统计信息：
- **出勤天数**：本月总共打卡的天数
- **正常天数**：正常打卡的天数
- **迟到次数**：迟到的次数
- **工作时长**：本月总工作时长（小时）

#### 第四步：查看详细记录
在考勤记录列表中可以看到：
- 每天的打卡日期和星期
- 上班打卡时间
- 下班打卡时间
- 工作时长
- 考勤状态（正常/迟到/早退/缺勤）
- 备注信息

---

## 打卡页面说明

### 页面布局

```
┌─────────────────────────────┐
│     2025年11月05日 星期二     │
│         14:30:25            │
│      📍 GPS定位打卡          │
├─────────────────────────────┤
│  [上班打卡]    [下班打卡]    │
├─────────────────────────────┤
│      今日打卡记录             │
│  ✓ 上班打卡                  │
│    时间：08:30:15            │
│    位置：39.123456, 116.123456│
│  ✓ 下班打卡                  │
│    时间：17:30:20            │
│    位置：39.123456, 116.123456│
│    工作时长：9.0 小时         │
└─────────────────────────────┘
```

### 按钮状态

| 状态 | 上班打卡按钮 | 下班打卡按钮 |
|------|------------|------------|
| 未打卡 | ✅ 可点击 | ❌ 禁用 |
| 已上班打卡 | ❌ 禁用 | ✅ 可点击 |
| 已下班打卡 | ❌ 禁用 | ❌ 禁用 |

---

## 考勤页面说明

### 页面布局

```
┌─────────────────────────────┐
│      选择月份                │
│  [2025年] [11月]            │
├─────────────────────────────┤
│      本月统计                │
│  出勤天数: 20  正常天数: 18  │
│  迟到次数: 2   工作时长: 180h│
├─────────────────────────────┤
│      考勤记录                │
│  ┌─────────────────────┐   │
│  │ 11/05 周二    [正常] │   │
│  │ 上班：08:30          │   │
│  │ 下班：17:30          │   │
│  │ 工作时长：9.0 小时    │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 11/04 周一    [迟到] │   │
│  │ 上班：09:15          │   │
│  │ 下班：18:00          │   │
│  │ 工作时长：8.8 小时    │   │
│  └─────────────────────┘   │
└─────────────────────────────┘
```

### 考勤状态说明

| 状态 | 颜色 | 说明 |
|------|------|------|
| 正常 | 绿色 | 按时上下班打卡 |
| 迟到 | 橙色 | 上班打卡时间晚于规定时间 |
| 早退 | 黄色 | 下班打卡时间早于规定时间 |
| 缺勤 | 红色 | 未打卡或缺勤 |

---

## 权限说明

### 司机权限
- ✅ 可以进行上下班打卡
- ✅ 可以查看自己的考勤记录
- ✅ 可以查看自己的考勤统计
- ❌ 不能查看其他司机的考勤记录
- ❌ 不能修改考勤记录

### 管理员权限
- ✅ 可以查看所有司机的考勤记录
- ✅ 可以查看考勤统计
- ❌ 不能修改考勤记录

### 超级管理员权限
- ✅ 可以查看所有司机的考勤记录
- ✅ 可以查看考勤统计
- ✅ 可以修改考勤记录
- ✅ 可以删除考勤记录

---

## 注意事项

### 打卡前准备
1. ⚠️ 确保手机已开启位置权限
2. ⚠️ 确保GPS定位功能已开启
3. ⚠️ 确保网络连接正常

### 打卡规则
1. ⚠️ 每天只能打卡一次（上班+下班）
2. ⚠️ 必须先上班打卡，才能下班打卡
3. ⚠️ 打卡时会自动记录GPS位置
4. ⚠️ 打卡记录一旦提交无法修改（超级管理员除外）

### 常见问题

#### Q1: 打卡时提示"获取位置失败"怎么办？
**A:** 请检查以下几点：
- 确认已授予小程序位置权限
- 确认手机GPS定位功能已开启
- 尝试到室外或窗边重新打卡
- 检查网络连接是否正常

#### Q2: 忘记下班打卡怎么办？
**A:** 
- 司机无法自行补打卡
- 请联系超级管理员手动添加下班打卡记录
- 建议设置提醒，避免忘记打卡

#### Q3: 打卡位置不准确怎么办？
**A:**
- GPS定位可能存在一定误差（通常在10-50米）
- 建议在室外或窗边打卡，信号更好
- 如果位置严重偏差，请联系管理员

#### Q4: 可以修改打卡记录吗？
**A:**
- 司机和普通管理员无法修改打卡记录
- 只有超级管理员可以修改打卡记录
- 如需修改，请联系超级管理员

#### Q5: 考勤统计数据不对怎么办？
**A:**
- 检查选择的月份是否正确
- 刷新页面重新加载数据
- 如果问题持续，请联系技术支持

---

## 技术说明

### GPS定位
- 使用微信小程序的 `getLocation` API
- 坐标系统：GCJ-02（国测局坐标系）
- 精度：通常在10-50米范围内

### 数据存储
- 所有打卡记录存储在 Supabase 数据库
- 使用 Row Level Security (RLS) 保护数据安全
- 自动备份，数据不会丢失

### 隐私保护
- GPS位置信息仅用于考勤打卡
- 仅管理员和超级管理员可以查看位置信息
- 符合数据隐私保护规定

---

## 更新日志

### v1.0.0 (2025-11-05)
- ✅ 实现GPS定位打卡功能
- ✅ 实现上下班打卡
- ✅ 实现考勤记录查询
- ✅ 实现考勤统计功能
- ✅ 实现权限控制

---

## 联系支持

如有任何问题或建议，请联系：
- 技术支持：请联系系统管理员
- 功能建议：欢迎提出改进建议
