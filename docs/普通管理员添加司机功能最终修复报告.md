# æ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœºåŠŸèƒ½æœ€ç»ˆä¿®å¤æŠ¥å‘Š

## æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡ä¿®å¤è§£å†³äº†æ™®é€šç®¡ç†å‘˜åœ¨æ·»åŠ å¸æœºæ—¶é‡åˆ°çš„ RLSï¼ˆRow Level Securityï¼‰ç­–ç•¥é”™è¯¯ï¼Œå¹¶å®Œå–„äº†æ™®é€šç®¡ç†å‘˜å¯¹å¸æœºè´¦å·çš„å®Œæ•´ç®¡ç†æƒé™ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ã€‚

## é—®é¢˜å›é¡¾

### åŸå§‹é”™è¯¯

```
new row violates row-level security policy for table "profiles"
é”™è¯¯ä»£ç : 42501
```

### é—®é¢˜æ ¹æº

1. **ç­–ç•¥è®¾è®¡é—®é¢˜**ï¼šRLS ç­–ç•¥ä¸­ä½¿ç”¨äº† `is_manager(auth.uid())` å‡½æ•°è°ƒç”¨ï¼Œåœ¨ç­–ç•¥æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å¯èƒ½æ— æ³•æ­£ç¡®è§£æ
2. **æƒé™ä¸å®Œæ•´**ï¼šåªæœ‰ INSERT ç­–ç•¥ï¼Œç¼ºå°‘ UPDATE å’Œ DELETE ç­–ç•¥
3. **å‡½æ•°ä¾èµ–é—®é¢˜**ï¼šç­–ç•¥ä¾èµ–å¤–éƒ¨å‡½æ•°ï¼Œå¢åŠ äº†å¤æ‚æ€§å’Œå¤±è´¥é£é™©

## ä¿®å¤æ–¹æ¡ˆ

### 1. ç­–ç•¥é‡æ„

#### ä¿®å¤å‰

```sql
CREATE POLICY "Managers can insert driver profiles" ON profiles
  FOR INSERT TO authenticated
  WITH CHECK (
    is_manager(auth.uid()) AND role = 'driver'::user_role
  );
```

**é—®é¢˜**ï¼š
- ä¾èµ– `is_manager()` å‡½æ•°
- å‡½æ•°è°ƒç”¨å¯èƒ½åœ¨ç­–ç•¥ä¸Šä¸‹æ–‡ä¸­å¤±è´¥
- åªæœ‰ INSERT æƒé™

#### ä¿®å¤å

```sql
-- INSERT ç­–ç•¥
CREATE POLICY "Managers can insert driver profiles" ON profiles
  FOR INSERT TO authenticated
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.id = auth.uid() AND p.role = 'manager'::user_role
    )
    AND role = 'driver'::user_role
  );

-- UPDATE ç­–ç•¥
CREATE POLICY "Managers can update driver profiles" ON profiles
  FOR UPDATE TO authenticated
  USING (
    role = 'driver'::user_role
    AND EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.id = auth.uid() AND p.role = 'manager'::user_role
    )
  )
  WITH CHECK (
    role = 'driver'::user_role
  );

-- DELETE ç­–ç•¥
CREATE POLICY "Managers can delete driver profiles" ON profiles
  FOR DELETE TO authenticated
  USING (
    role = 'driver'::user_role
    AND EXISTS (
      SELECT 1 FROM profiles p
      WHERE p.id = auth.uid() AND p.role = 'manager'::user_role
    )
  );
```

**æ”¹è¿›**ï¼š
- âœ… ç›´æ¥ä½¿ç”¨ EXISTS å­æŸ¥è¯¢ï¼Œä¸ä¾èµ–å¤–éƒ¨å‡½æ•°
- âœ… æ·»åŠ äº†å®Œæ•´çš„ INSERTã€UPDATEã€DELETE æƒé™
- âœ… æ¸…æ™°çš„æƒé™è¾¹ç•Œï¼šåªèƒ½æ“ä½œ driver è§’è‰²çš„ç”¨æˆ·

### 2. ä»£ç å¯¹é½

ç¡®ä¿ `createDriver` å‡½æ•°ä¸ `createUser` å‡½æ•°ä¿æŒä¸€è‡´ï¼š

#### å…±åŒç‰¹ç‚¹

1. **åˆ›å»ºé¡ºåº**ï¼šå…ˆåˆ›å»º auth.usersï¼Œå†åˆ›å»º profiles
2. **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„é”™è¯¯æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†
3. **æ•°æ®éªŒè¯**ï¼šåˆ›å»ºå‰æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
4. **è¿”å›å€¼**ï¼šç»Ÿä¸€çš„è¿”å›æ ¼å¼

#### createDriver å‡½æ•°ï¼ˆæ™®é€šç®¡ç†å‘˜ä½¿ç”¨ï¼‰

```typescript
export async function createDriver(
  phone: string,
  name: string,
  driverType: 'pure' | 'with_vehicle' = 'pure'
): Promise<Profile | null> {
  // 1. æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
  const {data: existingProfiles} = await supabase
    .from('profiles')
    .select('*')
    .eq('phone', phone)
    .maybeSingle()

  if (existingProfiles) {
    return null
  }

  // 2. åˆ›å»º auth.users è®°å½•
  const {data: authResult} = await supabase.rpc('create_user_auth_account_first', {
    user_email: `${phone}@fleet.com`,
    user_phone: phone
  })

  if (!authResult || authResult.success === false) {
    return null
  }

  // 3. åˆ›å»º profiles è®°å½•
  const {data} = await supabase
    .from('profiles')
    .insert({
      id: authResult.user_id,
      phone,
      name,
      role: 'driver',
      email: `${phone}@fleet.com`,
      driver_type: driverType,
      join_date: new Date().toISOString().split('T')[0]
    })
    .select()
    .maybeSingle()

  return data
}
```

#### createUser å‡½æ•°ï¼ˆè¶…çº§ç®¡ç†å‘˜ä½¿ç”¨ï¼‰

```typescript
export async function createUser(
  phone: string,
  name: string,
  role: 'driver' | 'manager',
  driverType?: 'pure' | 'with_vehicle'
): Promise<Profile | null> {
  // å®ç°é€»è¾‘ä¸ createDriver å®Œå…¨ä¸€è‡´
  // å”¯ä¸€åŒºåˆ«ï¼šæ”¯æŒåˆ›å»º manager è§’è‰²
}
```

### 3. è¾…åŠ©åŠŸèƒ½

#### 3.1 public.uid() å‡½æ•°åˆ«å

```sql
CREATE OR REPLACE FUNCTION public.uid()
RETURNS uuid
LANGUAGE sql
STABLE
SECURITY DEFINER
SET search_path = auth, public
AS $$
  SELECT auth.uid();
$$;
```

**ä½œç”¨**ï¼š
- åœ¨ public schema ä¸­æä¾› uid() å‡½æ•°
- é¿å…ç­–ç•¥ä¸­æ‰¾ä¸åˆ° auth.uid() çš„é—®é¢˜

#### 3.2 å­¤ç«‹è®°å½•æ¸…ç†

```sql
CREATE OR REPLACE FUNCTION cleanup_orphaned_auth_users()
RETURNS jsonb
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public, auth
AS $$
DECLARE
  deleted_count int;
BEGIN
  WITH orphaned_users AS (
    SELECT au.id
    FROM auth.users au
    LEFT JOIN profiles p ON au.id = p.id
    WHERE p.id IS NULL
  )
  DELETE FROM auth.users
  WHERE id IN (SELECT id FROM orphaned_users);

  GET DIAGNOSTICS deleted_count = ROW_COUNT;

  RETURN jsonb_build_object(
    'success', true,
    'deleted_count', deleted_count
  );
END;
$$;
```

**ä½œç”¨**ï¼š
- æ¸…ç†æ²¡æœ‰å¯¹åº” profiles è®°å½•çš„ auth.users è®°å½•
- é¿å…é‚®ç®±é‡å¤é”™è¯¯

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰

| æ“ä½œ | æ™®é€šç®¡ç†å‘˜ | è¶…çº§ç®¡ç†å‘˜ |
|------|-----------|-----------|
| æ·»åŠ å¸æœº | âŒ RLS é”™è¯¯ | âœ… æˆåŠŸ |
| ä¿®æ”¹å¸æœº | âŒ æ— æƒé™ | âœ… æˆåŠŸ |
| åˆ é™¤å¸æœº | âŒ æ— æƒé™ | âœ… æˆåŠŸ |
| æ·»åŠ ç®¡ç†å‘˜ | âŒ æ— æƒé™ | âœ… æˆåŠŸ |

### ä¿®å¤å

| æ“ä½œ | æ™®é€šç®¡ç†å‘˜ | è¶…çº§ç®¡ç†å‘˜ |
|------|-----------|-----------|
| æ·»åŠ å¸æœº | âœ… æˆåŠŸ | âœ… æˆåŠŸ |
| ä¿®æ”¹å¸æœº | âœ… æˆåŠŸ | âœ… æˆåŠŸ |
| åˆ é™¤å¸æœº | âœ… æˆåŠŸ | âœ… æˆåŠŸ |
| æ·»åŠ ç®¡ç†å‘˜ | âŒ æ— æƒé™ï¼ˆé¢„æœŸï¼‰ | âœ… æˆåŠŸ |

## æƒé™çŸ©é˜µ

### æ™®é€šç®¡ç†å‘˜ï¼ˆmanagerï¼‰

| ç›®æ ‡è§’è‰² | INSERT | UPDATE | DELETE | SELECT |
|---------|--------|--------|--------|--------|
| driver | âœ… | âœ… | âœ… | âœ… |
| manager | âŒ | âŒ | âŒ | âœ… |
| super_admin | âŒ | âŒ | âŒ | âœ… |

### è¶…çº§ç®¡ç†å‘˜ï¼ˆsuper_adminï¼‰

| ç›®æ ‡è§’è‰² | INSERT | UPDATE | DELETE | SELECT |
|---------|--------|--------|--------|--------|
| driver | âœ… | âœ… | âœ… | âœ… |
| manager | âœ… | âœ… | âœ… | âœ… |
| super_admin | âœ… | âœ… | âœ… | âœ… |

## æµ‹è¯•éªŒè¯

### æµ‹è¯• 1ï¼šæ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœº

**æ­¥éª¤**ï¼š
1. ä½¿ç”¨æ™®é€šç®¡ç†å‘˜è´¦å·ç™»å½•
2. è¿›å…¥å¸æœºç®¡ç†é¡µé¢
3. æ·»åŠ æ–°å¸æœº

**ç»“æœ**ï¼šâœ… æˆåŠŸ

**æ—¥å¿—**ï¼š
```
ğŸš€ [createDriver] å‡½æ•°è°ƒç”¨å¼€å§‹
ğŸ“‹ [æ­¥éª¤1] æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
  âœ… æ‰‹æœºå·å¯ç”¨ï¼Œç»§ç»­åˆ›å»º
ğŸ“‹ [æ­¥éª¤2] åˆ›å»º auth.users è¡¨è®°å½•
  âœ… auth.users è®°å½•åˆ›å»ºæˆåŠŸ
ğŸ“‹ [æ­¥éª¤3] åˆ›å»º profiles è¡¨è®°å½•
  âœ… profiles è¡¨è®°å½•åˆ›å»ºæˆåŠŸ
âœ… [createDriver] å‡½æ•°æ‰§è¡Œå®Œæˆ
```

### æµ‹è¯• 2ï¼šæ™®é€šç®¡ç†å‘˜ä¿®æ”¹å¸æœºä¿¡æ¯

**æ­¥éª¤**ï¼š
1. ä½¿ç”¨æ™®é€šç®¡ç†å‘˜è´¦å·ç™»å½•
2. è¿›å…¥å¸æœºç®¡ç†é¡µé¢
3. ç¼–è¾‘å¸æœºä¿¡æ¯
4. ä¿å­˜

**ç»“æœ**ï¼šâœ… æˆåŠŸ

### æµ‹è¯• 3ï¼šæ™®é€šç®¡ç†å‘˜åˆ é™¤å¸æœº

**æ­¥éª¤**ï¼š
1. ä½¿ç”¨æ™®é€šç®¡ç†å‘˜è´¦å·ç™»å½•
2. è¿›å…¥å¸æœºç®¡ç†é¡µé¢
3. åˆ é™¤å¸æœº

**ç»“æœ**ï¼šâœ… æˆåŠŸ

### æµ‹è¯• 4ï¼šæƒé™è¾¹ç•Œæµ‹è¯•

**æµ‹è¯• 4.1**ï¼šæ™®é€šç®¡ç†å‘˜å°è¯•åˆ›å»ºç®¡ç†å‘˜
- **ç»“æœ**ï¼šâŒ å¤±è´¥ï¼ˆé¢„æœŸï¼‰
- **åŸå› **ï¼šRLS ç­–ç•¥è¦æ±‚ role = 'driver'

**æµ‹è¯• 4.2**ï¼šæ™®é€šç®¡ç†å‘˜å°è¯•ä¿®æ”¹ç®¡ç†å‘˜ä¿¡æ¯
- **ç»“æœ**ï¼šâŒ å¤±è´¥ï¼ˆé¢„æœŸï¼‰
- **åŸå› **ï¼šRLS ç­–ç•¥è¦æ±‚ role = 'driver'

**æµ‹è¯• 4.3**ï¼šæ™®é€šç®¡ç†å‘˜å°è¯•åˆ é™¤ç®¡ç†å‘˜
- **ç»“æœ**ï¼šâŒ å¤±è´¥ï¼ˆé¢„æœŸï¼‰
- **åŸå› **ï¼šRLS ç­–ç•¥è¦æ±‚ role = 'driver'

## æŠ€æœ¯ç»†èŠ‚

### 1. RLS ç­–ç•¥æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ Supabase å®¢æˆ·ç«¯ â†’ PostgreSQL
                                    â†“
                            æ£€æŸ¥ RLS ç­–ç•¥
                                    â†“
                            æ‰§è¡Œ EXISTS å­æŸ¥è¯¢
                                    â†“
                            æ£€æŸ¥å½“å‰ç”¨æˆ·è§’è‰²
                                    â†“
                            æ£€æŸ¥ç›®æ ‡è®°å½•è§’è‰²
                                    â†“
                            å…è®¸/æ‹’ç»æ“ä½œ
```

### 2. EXISTS å­æŸ¥è¯¢ä¼˜åŠ¿

**ä¼ ç»Ÿæ–¹å¼**ï¼ˆä½¿ç”¨å‡½æ•°ï¼‰ï¼š
```sql
is_manager(auth.uid())
```

**é—®é¢˜**ï¼š
- å‡½æ•°è°ƒç”¨å¼€é”€
- å¯èƒ½çš„ä¸Šä¸‹æ–‡é—®é¢˜
- ä¾èµ–å¤–éƒ¨å‡½æ•°

**æ–°æ–¹å¼**ï¼ˆä½¿ç”¨ EXISTSï¼‰ï¼š
```sql
EXISTS (
  SELECT 1 FROM profiles p
  WHERE p.id = auth.uid() AND p.role = 'manager'::user_role
)
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç›´æ¥æŸ¥è¯¢ï¼Œæ— å‡½æ•°è°ƒç”¨
- âœ… ä¸Šä¸‹æ–‡æ¸…æ™°
- âœ… æ€§èƒ½æ›´å¥½ï¼ˆPostgreSQL ä¼˜åŒ–ï¼‰
- âœ… æ›´å®¹æ˜“è°ƒè¯•

### 3. ç­–ç•¥ç»„åˆé€»è¾‘

**INSERT ç­–ç•¥**ï¼š
```sql
WITH CHECK (
  EXISTS (...) AND role = 'driver'::user_role
)
```

**é€»è¾‘**ï¼š
- æ¡ä»¶ 1ï¼šå½“å‰ç”¨æˆ·æ˜¯ manager
- æ¡ä»¶ 2ï¼šæ’å…¥çš„è®°å½•è§’è‰²æ˜¯ driver
- ç»“æœï¼šä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ‰å…è®¸æ’å…¥

**UPDATE ç­–ç•¥**ï¼š
```sql
USING (
  role = 'driver'::user_role AND EXISTS (...)
)
WITH CHECK (
  role = 'driver'::user_role
)
```

**é€»è¾‘**ï¼š
- USINGï¼šæ£€æŸ¥è¦æ›´æ–°çš„è®°å½•æ˜¯å¦æ˜¯ driver
- WITH CHECKï¼šæ£€æŸ¥æ›´æ–°åçš„è®°å½•æ˜¯å¦ä»ç„¶æ˜¯ driver
- ç»“æœï¼šåªèƒ½æ›´æ–° driver è®°å½•ï¼Œä¸”æ›´æ–°åä»ç„¶æ˜¯ driver

## ç›¸å…³æ–‡ä»¶

### æ•°æ®åº“ Migrations

1. `supabase/migrations/016_allow_managers_to_create_drivers.sql` - åˆå§‹ç­–ç•¥ï¼ˆå·²åºŸå¼ƒï¼‰
2. `supabase/migrations/017_handle_duplicate_auth_users.sql` - å¤„ç†é‡å¤è®°å½•
3. `supabase/migrations/018_fix_manager_insert_policy.sql` - ç­–ç•¥ä¿®å¤ï¼ˆå·²åºŸå¼ƒï¼‰
4. `supabase/migrations/019_fix_is_manager_search_path.sql` - å‡½æ•°ä¿®å¤
5. `supabase/migrations/020_fix_is_super_admin_search_path.sql` - å‡½æ•°ä¿®å¤
6. `supabase/migrations/021_create_public_uid_function.sql` - uid() åˆ«å
7. `supabase/migrations/022_fix_manager_insert_policy_v2.sql` - **æœ€ç»ˆç­–ç•¥ä¿®å¤**

### åº”ç”¨ä»£ç 

1. `src/db/api.ts` - createDriver å’Œ createUser å‡½æ•°

### æ–‡æ¡£

1. `docs/æ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœºåŠŸèƒ½æµ‹è¯•.md` - æµ‹è¯•æ–‡æ¡£
2. `docs/ä¿®å¤è®°å½•_æ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœº.md` - ä¿®å¤è®°å½•
3. `docs/ä¿®å¤é‚®ç®±é‡å¤é”™è¯¯.md` - é‚®ç®±é‡å¤é”™è¯¯ä¿®å¤
4. `docs/ä¿®å¤RLSç­–ç•¥é”™è¯¯.md` - RLS ç­–ç•¥é”™è¯¯ä¿®å¤
5. `docs/RLSç­–ç•¥è°ƒè¯•æŒ‡å—.md` - è°ƒè¯•æŒ‡å—
6. `docs/æ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœºåŠŸèƒ½å®Œæ•´ä¿®å¤æ€»ç»“.md` - å®Œæ•´æ€»ç»“
7. `docs/å¿«é€Ÿæµ‹è¯•æŒ‡å—_æ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœº.md` - å¿«é€Ÿæµ‹è¯•
8. `docs/æ™®é€šç®¡ç†å‘˜æƒé™ä¿®å¤éªŒè¯.md` - æƒé™éªŒè¯
9. `docs/æ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœºåŠŸèƒ½æœ€ç»ˆä¿®å¤æŠ¥å‘Š.md` - **æœ¬æ–‡æ¡£**

## ç»´æŠ¤å»ºè®®

### 1. å®šæœŸæ£€æŸ¥

```sql
-- æ£€æŸ¥å­¤ç«‹çš„ auth.users è®°å½•
SELECT COUNT(*) as orphaned_count
FROM auth.users au
LEFT JOIN profiles p ON au.id = p.id
WHERE p.id IS NULL;

-- å¦‚æœæœ‰å­¤ç«‹è®°å½•ï¼Œæ‰§è¡Œæ¸…ç†
SELECT * FROM cleanup_orphaned_auth_users();
```

### 2. ç›‘æ§ç­–ç•¥

```sql
-- ç›‘æ§ç­–ç•¥æ‰§è¡Œæƒ…å†µ
SELECT 
  schemaname,
  tablename,
  policyname,
  cmd
FROM pg_policies
WHERE tablename = 'profiles'
ORDER BY cmd, policyname;
```

### 3. å®¡è®¡æ—¥å¿—

å»ºè®®æ·»åŠ å®¡è®¡æ—¥å¿—è¡¨ï¼Œè®°å½•æ‰€æœ‰ç”¨æˆ·åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œï¼š

```sql
CREATE TABLE audit_logs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES profiles(id),
  action text NOT NULL,
  target_id uuid,
  target_role user_role,
  details jsonb,
  created_at timestamptz DEFAULT now()
);
```

## æ€»ç»“

### å…³é”®æˆæœ

1. âœ… **é—®é¢˜è§£å†³**ï¼šæ™®é€šç®¡ç†å‘˜å¯ä»¥æˆåŠŸæ·»åŠ å¸æœº
2. âœ… **æƒé™å®Œæ•´**ï¼šæ·»åŠ äº† INSERTã€UPDATEã€DELETE æƒé™
3. âœ… **å®‰å…¨è¾¹ç•Œ**ï¼šæ™®é€šç®¡ç†å‘˜åªèƒ½æ“ä½œå¸æœºè´¦å·
4. âœ… **ä»£ç å¯¹é½**ï¼šcreateDriver ä¸ createUser ä¿æŒä¸€è‡´
5. âœ… **æ–‡æ¡£å®Œå–„**ï¼šæä¾›äº†è¯¦ç»†çš„æµ‹è¯•å’Œè°ƒè¯•æ–‡æ¡£

### æŠ€æœ¯äº®ç‚¹

1. **ç­–ç•¥ä¼˜åŒ–**ï¼šä½¿ç”¨ EXISTS å­æŸ¥è¯¢æ›¿ä»£å‡½æ•°è°ƒç”¨
2. **æƒé™åˆ†å±‚**ï¼šæ¸…æ™°çš„æƒé™çŸ©é˜µå’Œè¾¹ç•Œ
3. **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†
4. **å¯ç»´æŠ¤æ€§**ï¼šè¯¦ç»†çš„æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹

### ç»éªŒæ•™è®­

1. **RLS ç­–ç•¥è®¾è®¡**ï¼š
   - ä¼˜å…ˆä½¿ç”¨ EXISTS å­æŸ¥è¯¢
   - é¿å…å¤æ‚çš„å‡½æ•°è°ƒç”¨
   - ä¿æŒç­–ç•¥ç®€å•æ˜äº†

2. **æƒé™è®¾è®¡**ï¼š
   - æ˜ç¡®æƒé™è¾¹ç•Œ
   - æä¾›å®Œæ•´çš„ CRUD æƒé™
   - å®šæœŸå®¡è®¡å’Œç›‘æ§

3. **ä»£ç ä¸€è‡´æ€§**ï¼š
   - ä¿æŒç›¸ä¼¼åŠŸèƒ½çš„ä»£ç ç»“æ„ä¸€è‡´
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—æ ¼å¼
   - å®Œå–„çš„æ–‡æ¡£å’Œæ³¨é‡Š

### åç»­ä¼˜åŒ–

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä¸º profiles.role æ·»åŠ ç´¢å¼•
   - ç›‘æ§ç­–ç•¥æ‰§è¡Œæ€§èƒ½

2. **åŠŸèƒ½å¢å¼º**ï¼š
   - æ·»åŠ æ‰¹é‡æ“ä½œæ”¯æŒ
   - æ·»åŠ æ“ä½œå®¡è®¡æ—¥å¿—
   - æ·»åŠ æƒé™å˜æ›´é€šçŸ¥

3. **ç”¨æˆ·ä½“éªŒ**ï¼š
   - ä¼˜åŒ–é”™è¯¯æç¤ºä¿¡æ¯
   - æ·»åŠ æ“ä½œç¡®è®¤å¯¹è¯æ¡†
   - æä¾›æ“ä½œå†å²è®°å½•

## ç»“è®º

é€šè¿‡æœ¬æ¬¡ä¿®å¤ï¼Œæ™®é€šç®¡ç†å‘˜æ·»åŠ å¸æœºåŠŸèƒ½å·²ç»å®Œå…¨æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”å…·å¤‡äº†å®Œæ•´çš„å¸æœºè´¦å·ç®¡ç†æƒé™ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ã€‚ä¿®å¤æ–¹æ¡ˆç®€æ´ã€é«˜æ•ˆã€å®‰å…¨ï¼Œç¬¦åˆæœ€ä½³å®è·µã€‚

æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å‡å·²é€šè¿‡ï¼Œæƒé™è¾¹ç•Œæ¸…æ™°ï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼Œæ–‡æ¡£å®Œå–„ã€‚ç³»ç»Ÿç°åœ¨å¯ä»¥ç¨³å®šè¿è¡Œï¼Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚
