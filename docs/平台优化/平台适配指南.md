# è½¦é˜Ÿç®¡å®¶ - å¹³å°é€‚é…æŒ‡å—

## ğŸ“± æ¦‚è¿°

æœ¬é¡¹ç›®å·²å®Œæˆé’ˆå¯¹**å¾®ä¿¡å°ç¨‹åº**å’Œ**å®‰å“APP**çš„å…¨é¢ä¼˜åŒ–ï¼Œå®ç°äº†ä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œçš„æ¶æ„ã€‚

## ğŸ¯ ä¼˜åŒ–å†…å®¹

### 1. Capacitoré…ç½®ä¼˜åŒ–

**æ–‡ä»¶**: `capacitor.config.ts`

**ä¼˜åŒ–å†…å®¹**:
- âœ… å¯åŠ¨å±é…ç½®ï¼ˆ2ç§’è‡ªåŠ¨éšè—ï¼‰
- âœ… æ¨é€é€šçŸ¥æ”¯æŒ
- âœ… çŠ¶æ€æ æ ·å¼é…ç½®
- âœ… é”®ç›˜è¡Œä¸ºä¼˜åŒ–
- âœ… ç›¸æœºå’Œåœ°ç†ä½ç½®æƒé™é…ç½®
- âœ… ç½‘ç»œçŠ¶æ€ç›‘å¬
- âœ… æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- âœ… ç¡¬ä»¶åŠ é€Ÿå¯ç”¨

### 2. å°ç¨‹åºåˆ†åŒ…ä¼˜åŒ–

**æ–‡ä»¶**: `src/app.config.ts`

**ä¼˜åŒ–å†…å®¹**:
- âœ… æŒ‰è§’è‰²åˆ†åŒ…ï¼ˆå¸æœºç«¯ã€è½¦é˜Ÿé•¿ç«¯ã€è€æ¿ç«¯ï¼‰
- âœ… æŒ‰åŠŸèƒ½åˆ†åŒ…ï¼ˆä¸ªäººä¸­å¿ƒã€å…±äº«åŠŸèƒ½ï¼‰
- âœ… é¢„ä¸‹è½½é…ç½®ï¼ˆæ ¹æ®è§’è‰²é¢„åŠ è½½ï¼‰
- âœ… å°ç¨‹åºæƒé™é…ç½®å®Œå–„
- âœ… ç½‘ç»œè¶…æ—¶é…ç½®ä¼˜åŒ–

**åˆ†åŒ…ç»“æ„**:
```
ä¸»åŒ… (pages/)
â”œâ”€â”€ ç™»å½•é¡µ
â”œâ”€â”€ é¦–é¡µ
â”œâ”€â”€ è§’è‰²é¦–é¡µ
â””â”€â”€ ä¸ªäººä¸­å¿ƒ

å¸æœºç«¯åˆ†åŒ… (packageDriver/)
â”œâ”€â”€ æ‰“å¡è€ƒå‹¤
â”œâ”€â”€ è®¡ä»¶å·¥ä½œ
â”œâ”€â”€ è¯·å‡ç”³è¯·
â””â”€â”€ è½¦è¾†ç®¡ç†

è½¦é˜Ÿé•¿åˆ†åŒ… (packageManager/)
â”œâ”€â”€ å¸æœºç®¡ç†
â”œâ”€â”€ å®¡æ‰¹ç®¡ç†
â””â”€â”€ æ•°æ®ç»Ÿè®¡

è€æ¿ç«¯åˆ†åŒ… (packageAdmin/)
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ ä»“åº“ç®¡ç†
â”œâ”€â”€ è½¦è¾†ç®¡ç†
â””â”€â”€ æƒé™é…ç½®

ä¸ªäººä¸­å¿ƒåˆ†åŒ… (packageProfile/)
â”œâ”€â”€ è®¾ç½®
â”œâ”€â”€ è´¦å·ç®¡ç†
â””â”€â”€ å¸®åŠ©ä¸­å¿ƒ

å…±äº«åŠŸèƒ½åˆ†åŒ… (packageShared/)
â””â”€â”€ é€šçŸ¥ç®¡ç†
```

### 3. å¹³å°å·®å¼‚å¤„ç†å·¥å…·

**æ–‡ä»¶**: `src/utils/platform.ts`

**åŠŸèƒ½**:
- âœ… å¹³å°è¯†åˆ«ï¼ˆå¾®ä¿¡å°ç¨‹åº/H5/å®‰å“APPï¼‰
- âœ… å¹³å°ç‰¹å®šé€»è¾‘æ‰§è¡Œå™¨
- âœ… UIé€‚é…ï¼ˆçŠ¶æ€æ é«˜åº¦ã€å®‰å…¨åŒºåŸŸï¼‰
- âœ… å­˜å‚¨é€‚é…ï¼ˆä¸åŒå¹³å°çš„å­˜å‚¨æ–¹æ¡ˆï¼‰
- âœ… ç½‘ç»œé…ç½®é€‚é…ï¼ˆè¶…æ—¶æ—¶é—´ç­‰ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { platform, platformExecute } from '@/utils/platform'

// åˆ¤æ–­å¹³å°
if (platform.isWeapp()) {
  // å¾®ä¿¡å°ç¨‹åºç‰¹å®šé€»è¾‘
}

// æ ¹æ®å¹³å°æ‰§è¡Œä¸åŒé€»è¾‘
platformExecute.byPlatform({
  weapp: () => console.log('å¾®ä¿¡å°ç¨‹åº'),
  android: () => console.log('å®‰å“APP'),
  h5: () => console.log('H5'),
  default: () => console.log('å…¶ä»–å¹³å°')
})
```

### 4. CapacitoråŸç”ŸåŠŸèƒ½å°è£…

**æ–‡ä»¶**: `src/utils/capacitor.ts`

**åŠŸèƒ½**:
- âœ… ç›¸æœºåŠŸèƒ½ï¼ˆæ‹ç…§ã€é€‰æ‹©å›¾ç‰‡ï¼‰
- âœ… åœ°ç†ä½ç½®ï¼ˆè·å–ä½ç½®ã€ç›‘å¬ä½ç½®å˜åŒ–ï¼‰
- âœ… è®¾å¤‡ä¿¡æ¯ï¼ˆè·å–è®¾å¤‡å‹å·ã€ç³»ç»Ÿç‰ˆæœ¬ï¼‰
- âœ… ç½‘ç»œçŠ¶æ€ï¼ˆè·å–ç½‘ç»œç±»å‹ã€ç›‘å¬ç½‘ç»œå˜åŒ–ï¼‰
- âœ… çŠ¶æ€æ æ§åˆ¶ï¼ˆæ ·å¼ã€é¢œè‰²ã€æ˜¾ç¤º/éšè—ï¼‰
- âœ… å¯åŠ¨å±æ§åˆ¶
- âœ… åº”ç”¨çŠ¶æ€ç›‘å¬

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { capacitorCamera, capacitorGeolocation } from '@/utils/capacitor'

// æ‹ç…§
const photo = await capacitorCamera.takePicture({
  quality: 90,
  source: 'camera'
})

// è·å–ä½ç½®
const position = await capacitorGeolocation.getCurrentPosition({
  enableHighAccuracy: true
})
```

### 5. å¹³å°é€‚é…çš„ç½‘ç»œè¯·æ±‚

**æ–‡ä»¶**: `src/utils/request.ts`

**åŠŸèƒ½**:
- âœ… ç»Ÿä¸€çš„è¯·æ±‚æ¥å£
- âœ… å¹³å°ç‰¹å®šçš„è¶…æ—¶é…ç½®
- âœ… æ–‡ä»¶ä¸Šä¼ é€‚é…
- âœ… æ–‡ä»¶ä¸‹è½½é€‚é…
- âœ… è¯·æ±‚æ‹¦æˆªå’Œé”™è¯¯å¤„ç†

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { get, post, uploadFile } from '@/utils/request'

// GETè¯·æ±‚
const data = await get('/api/users', { page: 1 })

// POSTè¯·æ±‚
const result = await post('/api/login', { phone, password })

// ä¸Šä¼ æ–‡ä»¶
const uploadResult = await uploadFile({
  url: '/api/upload',
  filePath: imagePath,
  name: 'file'
})
```

### 6. å¹³å°é€‚é…çš„UIç»„ä»¶

**æ–‡ä»¶**: `src/components/platform/`

**ç»„ä»¶åˆ—è¡¨**:
- âœ… `PlatformView` - å¹³å°é€‚é…çš„æ ¹è§†å›¾
- âœ… `PlatformNavBar` - å¹³å°é€‚é…çš„å¯¼èˆªæ 
- âœ… `PlatformSafeArea` - åº•éƒ¨å®‰å…¨åŒºåŸŸ
- âœ… `PlatformButton` - å¹³å°é€‚é…çš„æŒ‰é’®
- âœ… `PlatformImageUploader` - å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
- âœ… `PlatformLocation` - å®šä½ç»„ä»¶

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
import { PlatformView, PlatformButton } from '@/components/platform/PlatformView'

<PlatformView enableSafeArea enableStatusBar>
  <PlatformButton 
    type="primary" 
    size="large"
    onClick={handleClick}
  >
    æäº¤
  </PlatformButton>
</PlatformView>
```

### 7. åº”ç”¨å…¥å£ä¼˜åŒ–

**æ–‡ä»¶**: `src/app.tsx`

**ä¼˜åŒ–å†…å®¹**:
- âœ… å¹³å°ç‰¹å®šåˆå§‹åŒ–é€»è¾‘
- âœ… å®‰å“APPçŠ¶æ€æ é…ç½®
- âœ… å¯åŠ¨å±è‡ªåŠ¨éšè—
- âœ… åº”ç”¨çŠ¶æ€ç›‘å¬
- âœ… è®¤è¯çŠ¶æ€çš„å¹³å°ç‰¹å®šå¤„ç†

## ğŸš€ æ„å»ºå’Œéƒ¨ç½²

### å¾®ä¿¡å°ç¨‹åº

```bash
# å¼€å‘æ¨¡å¼
pnpm run dev:weapp

# ç”Ÿäº§æ„å»º
pnpm run build:weapp

# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€ dist/weapp ç›®å½•
```

**æ³¨æ„äº‹é¡¹**:
- ç¡®ä¿å·²é…ç½®å°ç¨‹åºAppID
- æ£€æŸ¥åŸŸåç™½åå•é…ç½®
- æµ‹è¯•åˆ†åŒ…åŠ è½½æ˜¯å¦æ­£å¸¸

### å®‰å“APP

```bash
# 1. æ„å»ºH5
pnpm run build:h5

# 2. åŒæ­¥åˆ°å®‰å“é¡¹ç›®
npx cap sync android

# 3. æ„å»ºAPKï¼ˆæ–¹å¼ä¸€ï¼šè‡ªåŠ¨è„šæœ¬ï¼‰
.\build-apk.ps1

# 3. æ„å»ºAPKï¼ˆæ–¹å¼äºŒï¼šæ‰‹åŠ¨ï¼‰
cd android
.\gradlew assembleDebug

# 4. APKä½ç½®
# android/app/build/outputs/apk/debug/app-debug.apk
```

**æ³¨æ„äº‹é¡¹**:
- ç¡®ä¿å·²å®‰è£…Java JDK 17
- é¦–æ¬¡æ„å»ºéœ€è¦ä¸‹è½½Gradleä¾èµ–ï¼ˆ5-10åˆ†é’Ÿï¼‰
- æ£€æŸ¥Capacitoræ’ä»¶æ˜¯å¦æ­£ç¡®å®‰è£…

### H5éƒ¨ç½²

```bash
# æ„å»ºH5
pnpm run build:h5

# éƒ¨ç½² dist/h5 ç›®å½•åˆ°WebæœåŠ¡å™¨
```

## ğŸ“‹ å¼€å‘æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å¹³å°åˆ¤æ–­

```typescript
import { platform } from '@/utils/platform'

// âœ… æ¨è
if (platform.isWeapp()) {
  // å¾®ä¿¡å°ç¨‹åºç‰¹å®šé€»è¾‘
}

// âŒ ä¸æ¨è
if (process.env.TARO_ENV === 'weapp') {
  // ç›´æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡
}
```

### 2. ä½¿ç”¨å¹³å°é€‚é…ç»„ä»¶

```tsx
// âœ… æ¨è
import { PlatformView } from '@/components/platform/PlatformView'

<PlatformView enableSafeArea>
  {/* å†…å®¹ */}
</PlatformView>

// âŒ ä¸æ¨è
<View style={{ paddingTop: '44px' }}>
  {/* ç¡¬ç¼–ç çš„é€‚é… */}
</View>
```

### 3. ä½¿ç”¨ç»Ÿä¸€çš„ç½‘ç»œè¯·æ±‚

```typescript
// âœ… æ¨è
import { get } from '@/utils/request'
const data = await get('/api/users')

// âŒ ä¸æ¨è
import Taro from '@tarojs/taro'
const data = await Taro.request({ url: '/api/users' })
```

### 4. ä½¿ç”¨åŸç”ŸåŠŸèƒ½å°è£…

```typescript
// âœ… æ¨èï¼ˆå®‰å“APPï¼‰
import { capacitorCamera } from '@/utils/capacitor'
const photo = await capacitorCamera.takePicture()

// âœ… æ¨èï¼ˆå¾®ä¿¡å°ç¨‹åºï¼‰
import Taro from '@tarojs/taro'
const res = await Taro.chooseImage()

// âœ… æœ€ä½³ï¼ˆç»Ÿä¸€å¤„ç†ï¼‰
import { PlatformImageUploader } from '@/components/platform/PlatformImageUploader'
<PlatformImageUploader onChange={handleChange} />
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å°ç¨‹åºæ€§èƒ½ä¼˜åŒ–

- âœ… ä½¿ç”¨åˆ†åŒ…åŠ è½½ï¼Œå‡å°‘ä¸»åŒ…ä½“ç§¯
- âœ… å›¾ç‰‡ä½¿ç”¨CDNï¼Œé¿å…æ‰“åŒ…åˆ°ä»£ç åŒ…
- âœ… åˆç†ä½¿ç”¨setDataï¼Œé¿å…é¢‘ç¹æ›´æ–°
- âœ… ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨å¤„ç†é•¿åˆ—è¡¨
- âœ… åŠæ—¶æ¸…ç†å®šæ—¶å™¨å’Œç›‘å¬å™¨

### 2. å®‰å“APPæ€§èƒ½ä¼˜åŒ–

- âœ… å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
- âœ… å›¾ç‰‡å‹ç¼©å’Œæ‡’åŠ è½½
- âœ… ä½¿ç”¨Capacitoræ’ä»¶è€ŒéWebView API
- âœ… åˆç†ä½¿ç”¨ç¼“å­˜ç­–ç•¥
- âœ… é¿å…å†…å­˜æ³„æ¼

### 3. é€šç”¨æ€§èƒ½ä¼˜åŒ–

- âœ… ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½
- âœ… ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- âœ… é˜²æŠ–å’ŒèŠ‚æµå¤„ç†é«˜é¢‘æ“ä½œ
- âœ… ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§æ•°æ®
- âœ… ä¼˜åŒ–ç½‘ç»œè¯·æ±‚ï¼ˆåˆå¹¶ã€ç¼“å­˜ï¼‰

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å®‰å“APPæ— æ³•è·å–å®šä½

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥AndroidManifest.xmlä¸­çš„æƒé™é…ç½®
2. ç¡®ä¿Geolocationæ’ä»¶å·²å®‰è£…
3. åœ¨åº”ç”¨ä¸­è¯·æ±‚å®šä½æƒé™

### Q2: å°ç¨‹åºåˆ†åŒ…åŠ è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åˆ†åŒ…è·¯å¾„é…ç½®æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿åˆ†åŒ…å¤§å°ä¸è¶…è¿‡é™åˆ¶ï¼ˆ2MBï¼‰
3. æ£€æŸ¥é¡µé¢è·¯å¾„æ˜¯å¦æ­£ç¡®

### Q3: å›¾ç‰‡ä¸Šä¼ å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™
2. ç¡®è®¤æœåŠ¡å™¨æ¥å£æ˜¯å¦æ­£å¸¸
3. æ£€æŸ¥å¹³å°æƒé™é…ç½®

### Q4: å®‰å“APPç™½å±

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥H5æ„å»ºæ˜¯å¦æˆåŠŸ
2. ç¡®è®¤webDiré…ç½®æ­£ç¡®
3. æŸ¥çœ‹Android Studioæ—¥å¿—

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å¹³å°ç±»å‹ï¼ˆå¾®ä¿¡å°ç¨‹åº/å®‰å“APP/H5ï¼‰
2. é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
3. å¤ç°æ­¥éª¤
4. è®¾å¤‡ä¿¡æ¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-12  
**ç»´æŠ¤å›¢é˜Ÿ**: è½¦é˜Ÿç®¡å®¶å¼€å‘å›¢é˜Ÿ