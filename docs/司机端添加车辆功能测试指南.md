# 司机端添加车辆功能测试指南

## 测试目的
验证司机端添加车辆功能的数据验证和错误提示是否正常工作，确保用户在录入时就能发现问题。

## 测试环境准备

### 1. 登录司机账号
- 使用司机角色的账号登录小程序
- 进入"车辆管理"页面
- 点击"添加车辆"按钮

### 2. 测试数据准备
准备以下测试数据：
- ✅ 正确的车牌号：京A12345
- ❌ 错误的车牌号：ABC123（格式不正确）
- ✅ 正确的 VIN：12345678901234567（17位）
- ❌ 错误的 VIN：123456（少于17位）

## 测试用例

### 测试用例 1：车牌号格式验证

**测试步骤**：
1. 完成行驶证识别步骤
2. 手动修改车牌号为错误格式：`ABC123`
3. 完成所有其他步骤
4. 点击"提交审核"

**预期结果**：
- ✅ 立即显示错误提示对话框
- ✅ 标题："信息不完整"
- ✅ 内容包含："• 车牌号码格式不正确"
- ✅ 不会开始上传照片
- ✅ 用户可以返回修改

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 2：VIN 码长度验证

**测试步骤**：
1. 完成行驶证识别步骤
2. 手动修改 VIN 为少于17位：`123456`
3. 完成所有其他步骤
4. 点击"提交审核"

**预期结果**：
- ✅ 立即显示错误提示对话框
- ✅ 内容包含："• 车辆识别代号（VIN）应为17位"
- ✅ 不会开始上传照片

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 3：必填字段验证

**测试步骤**：
1. 完成行驶证识别步骤
2. 手动清空"品牌"字段
3. 完成所有其他步骤
4. 点击"提交审核"

**预期结果**：
- ✅ 立即显示错误提示对话框
- ✅ 内容包含："• 品牌"
- ✅ 不会开始上传照片

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 4：照片完整性验证

**测试步骤**：
1. 完成行驶证识别步骤
2. 在车辆照片步骤，只拍摄部分照片（例如只拍左前45°）
3. 点击"下一步"

**预期结果**：
- ✅ 显示错误提示："请拍摄所有角度的车辆照片"
- ✅ 不能进入下一步

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 5：照片上传失败提示

**测试步骤**：
1. 完成所有步骤，填写正确的信息
2. 在网络较差的环境下点击"提交审核"
3. 如果某张照片上传失败

**预期结果**：
- ✅ 显示错误对话框
- ✅ 标题："照片上传失败"
- ✅ 内容明确列出失败的照片名称，例如："以下照片上传失败：左前45°、右前45°。请检查网络连接后重试。"
- ✅ 不会继续提交到数据库

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 6：网络错误提示

**测试步骤**：
1. 完成所有步骤，填写正确的信息
2. 断开网络连接
3. 点击"提交审核"

**预期结果**：
- ✅ 显示错误对话框
- ✅ 标题："网络错误"
- ✅ 内容："网络连接失败，请检查网络后重试"

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 7：完整流程正常提交

**测试步骤**：
1. 完成行驶证识别步骤（三张照片）
2. 确保识别出所有必填字段：
   - 车牌号（正确格式）
   - 品牌
   - 型号
   - VIN（17位）
   - 车辆类型
   - 所有人
3. 完成车辆照片步骤（7张照片）
4. 完成驾驶员证件步骤（3张照片）
5. 点击"提交审核"

**预期结果**：
- ✅ 显示加载提示："提交审核中..."
- ✅ 所有照片上传成功
- ✅ 车辆信息保存成功
- ✅ 驾驶员证件信息保存成功
- ✅ 显示成功提示："提交审核成功"
- ✅ 自动返回车辆列表页面
- ✅ 在车辆列表中可以看到新添加的车辆
- ✅ 车辆状态为"待审核"

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

### 测试用例 8：数值字段类型验证

**测试步骤**：
1. 完成所有步骤
2. 在行驶证副页识别后，检查数值字段（总质量、核定载客等）
3. 提交审核

**预期结果**：
- ✅ 数值字段正确转换为数字类型
- ✅ 不会出现类型不匹配错误
- ✅ 成功保存到数据库

**实际结果**：
- [ ] 通过
- [ ] 失败（描述问题）：

---

## 测试结果汇总

### 通过的测试用例
- [ ] 测试用例 1：车牌号格式验证
- [ ] 测试用例 2：VIN 码长度验证
- [ ] 测试用例 3：必填字段验证
- [ ] 测试用例 4：照片完整性验证
- [ ] 测试用例 5：照片上传失败提示
- [ ] 测试用例 6：网络错误提示
- [ ] 测试用例 7：完整流程正常提交
- [ ] 测试用例 8：数值字段类型验证

### 失败的测试用例
（记录失败的测试用例和问题描述）

---

## 性能测试

### 照片上传性能
- [ ] 测试7张车辆照片 + 3张行驶证照片 + 3张证件照片的上传时间
- [ ] 预期：在良好网络环境下，总上传时间应在 30 秒内
- [ ] 实际上传时间：______ 秒

### 识别性能
- [ ] 测试行驶证识别的响应时间
- [ ] 预期：识别时间应在 5 秒内
- [ ] 实际识别时间：______ 秒

---

## 用户体验评估

### 错误提示清晰度
- [ ] 错误提示是否明确告知问题所在？
- [ ] 用户是否能快速定位并修复问题？
- [ ] 错误提示的语言是否友好？

### 操作流畅度
- [ ] 步骤切换是否流畅？
- [ ] 照片拍摄是否方便？
- [ ] 识别结果是否准确？

### 整体满意度
- [ ] 非常满意
- [ ] 满意
- [ ] 一般
- [ ] 不满意
- [ ] 非常不满意

---

## 问题反馈

### 发现的问题
1. 
2. 
3. 

### 改进建议
1. 
2. 
3. 

---

## 测试结论

### 功能完整性
- [ ] 所有功能正常工作
- [ ] 部分功能存在问题（详见问题反馈）
- [ ] 功能无法使用

### 用户体验
- [ ] 用户体验良好，错误提示明确
- [ ] 用户体验一般，部分提示不够清晰
- [ ] 用户体验较差，需要改进

### 是否可以上线
- [ ] 可以上线
- [ ] 需要修复部分问题后上线
- [ ] 不建议上线

---

## 测试人员信息

- 测试人员：__________
- 测试日期：__________
- 测试环境：__________
- 测试版本：__________

---

## 附录：常见问题排查

### 问题 1：提交时没有显示验证错误
**可能原因**：
- 代码未正确部署
- 浏览器缓存问题

**解决方法**：
1. 清除浏览器缓存
2. 重新加载页面
3. 检查控制台是否有错误

### 问题 2：照片上传失败但没有提示
**可能原因**：
- 网络问题
- 存储桶权限问题

**解决方法**：
1. 检查网络连接
2. 检查 Supabase 存储桶配置
3. 查看控制台错误日志

### 问题 3：数据保存失败
**可能原因**：
- 数据库字段缺失
- RLS 策略问题
- 数据类型不匹配

**解决方法**：
1. 检查数据库表结构
2. 检查 RLS 策略
3. 查看数据库错误日志
