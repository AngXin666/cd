# 👥 用户管理功能说明

## 功能概述

超级管理员可以通过用户管理功能，对系统中的所有用户进行全面管理，包括编辑用户信息、修改用户角色、重置密码等操作。

---

## 🎯 核心功能

### 1. 用户列表管理

**功能特点**：
- 📋 查看所有用户信息
- 🔍 搜索用户（姓名、手机号、邮箱）
- 🏷️ 按角色筛选用户
- 🎨 角色标签彩色显示

**显示信息**：
- 用户姓名
- 用户角色（超级管理员/管理员/司机）
- 手机号码
- 邮箱地址

### 2. 编辑用户信息

**可编辑字段**：
- ✏️ 姓名
- 📱 手机号
- 📧 邮箱
- 👤 用户角色

**表单验证**：
- 姓名：必填
- 手机号：必填，11位数字，格式验证
- 邮箱：可选，格式验证
- 角色：必选

### 3. 重置用户密码

**功能说明**：
- 🔑 一键重置密码为 123456
- ⚠️ 确认对话框防止误操作
- ✅ 成功提示显示新密码
- 📝 建议用户登录后立即修改密码

### 4. 修改用户角色

**角色类型**：
- 🔴 超级管理员（super_admin）
- 🔵 管理员（manager）
- 🟢 司机（driver）

**权限说明**：
- 超级管理员：最高权限，不可修改
- 管理员：可升级为超级管理员或降级为司机
- 司机：可升级为管理员

### 5. 配置管理员权限

**功能说明**：
- 仅针对管理员角色
- 配置仓库访问权限
- 配置功能模块权限

---

## 🔐 权限要求

### 访问权限

- **仅限超级管理员**：只有超级管理员可以访问用户管理功能
- **路径**：超级管理员工作台 → 用户管理

### 操作权限

| 操作 | 超级管理员 | 管理员 | 司机 |
|------|-----------|--------|------|
| 查看用户列表 | ✅ | ❌ | ❌ |
| 编辑用户信息 | ✅ | ❌ | ❌ |
| 重置用户密码 | ✅ | ❌ | ❌ |
| 修改用户角色 | ✅ | ❌ | ❌ |
| 配置管理员权限 | ✅ | ❌ | ❌ |

---

## 📝 使用指南

### 1. 查看用户列表

**步骤**：
1. 登录超级管理员账号
2. 进入超级管理员工作台
3. 点击"用户管理"卡片
4. 查看所有用户列表

**功能**：
- 滚动查看所有用户
- 查看用户基本信息
- 查看用户角色标签

### 2. 搜索用户

**步骤**：
1. 在搜索框中输入关键词
2. 支持搜索：姓名、手机号、邮箱
3. 支持拼音搜索（姓名）
4. 实时过滤显示结果

**示例**：
- 搜索 "张三" 或 "zhangsan"
- 搜索 "15766121960"
- 搜索 "admin@fleet.com"

### 3. 筛选用户

**步骤**：
1. 点击"角色筛选"下拉框
2. 选择角色类型
3. 自动过滤显示结果

**筛选选项**：
- 全部角色
- 超级管理员
- 管理员
- 司机

### 4. 编辑用户信息

**步骤**：
1. 找到要编辑的用户
2. 点击"编辑信息"按钮（绿色）
3. 修改用户信息
4. 点击"保存修改"按钮

**注意事项**：
- 手机号必须是11位数字
- 邮箱格式必须正确
- 修改后用户需要重新登录

### 5. 重置用户密码

**步骤**：
1. 找到要重置密码的用户
2. 点击"重置密码"按钮（黄色）
3. 确认重置操作
4. 密码重置为 123456

**注意事项**：
- 重置后立即生效
- 用户可以使用新密码登录
- 建议用户登录后立即修改密码

### 6. 修改用户角色

**步骤**：
1. 找到要修改角色的用户
2. 点击"升级为管理员"或"降级为司机"按钮（蓝色）
3. 确认修改操作
4. 角色修改成功

**注意事项**：
- 超级管理员角色不可修改
- 角色修改后立即生效
- 用户权限会相应变化

### 7. 配置管理员权限

**步骤**：
1. 找到管理员用户
2. 点击"配置权限"按钮（橙色）
3. 选择可访问的仓库
4. 保存权限配置

**注意事项**：
- 仅针对管理员角色
- 司机和超级管理员不需要配置
- 权限配置后立即生效

---

## 🎨 界面说明

### 1. 用户卡片

**布局**：
```
┌─────────────────────────────────────┐
│ 张三 [超级管理员]                    │
│ 手机：15766121960                    │
│ 邮箱：admin@fleet.com                │
│                                      │
│ [编辑信息] [重置密码] [配置权限]     │
└─────────────────────────────────────┘
```

**颜色标识**：
- 🔴 超级管理员：红色标签
- 🔵 管理员：蓝色标签
- 🟢 司机：绿色标签

### 2. 操作按钮

**按钮类型**：
- 🟢 编辑信息：绿色按钮，所有用户可见
- 🟡 重置密码：黄色按钮，所有用户可见
- 🔵 修改角色：蓝色按钮，非超级管理员可见
- 🟠 配置权限：橙色按钮，仅管理员可见

### 3. 编辑页面

**表单字段**：
```
┌─────────────────────────────────────┐
│ 姓名 *                               │
│ [输入框]                             │
│                                      │
│ 手机号 *                             │
│ [输入框]                             │
│                                      │
│ 邮箱                                 │
│ [输入框]                             │
│                                      │
│ 角色 *                               │
│ [下拉选择]                           │
│                                      │
│ 用户ID                               │
│ [只读显示]                           │
│                                      │
│ 创建时间                             │
│ [只读显示]                           │
│                                      │
│ [保存修改]                           │
│ [重置密码为 123456]                  │
│ [取消]                               │
└─────────────────────────────────────┘
```

---

## ⚠️ 注意事项

### 1. 安全提示

- ⚠️ 重置密码后，用户可以使用新密码 123456 登录
- ⚠️ 建议用户登录后立即修改密码
- ⚠️ 不要将重置后的密码告知无关人员

### 2. 操作提示

- ⚠️ 修改用户信息后，用户需要重新登录
- ⚠️ 修改角色后，用户权限会立即变化
- ⚠️ 超级管理员角色不可修改，防止误操作

### 3. 数据验证

- ⚠️ 手机号必须是11位数字，格式：1[3-9]xxxxxxxxx
- ⚠️ 邮箱必须符合标准格式：xxx@xxx.xxx
- ⚠️ 姓名不能为空

---

## 🔧 技术实现

### 1. API 接口

```typescript
// 获取所有用户
getAllUsers(): Promise<Profile[]>

// 根据ID获取用户
getUserById(userId: string): Promise<Profile | null>

// 更新用户信息
updateUserInfo(userId: string, updates: {
  name?: string
  phone?: string
  email?: string
  role?: UserRole
}): Promise<boolean>

// 重置用户密码
resetUserPassword(userId: string): Promise<boolean>

// 修改用户角色
updateUserRole(userId: string, role: UserRole): Promise<boolean>
```

### 2. 数据库表

**profiles 表**：
```sql
CREATE TABLE profiles (
  id uuid PRIMARY KEY,
  name text,
  phone text UNIQUE,
  email text UNIQUE,
  role user_role NOT NULL,
  created_at timestamptz DEFAULT now()
);
```

### 3. 权限控制

**RLS 策略**：
- 超级管理员：可以查看和修改所有用户
- 管理员：只能查看自己的信息
- 司机：只能查看自己的信息

---

## 📊 功能对比

| 功能 | 超级管理员 | 管理员 | 司机 |
|------|-----------|--------|------|
| 查看所有用户 | ✅ | ❌ | ❌ |
| 搜索用户 | ✅ | ❌ | ❌ |
| 筛选用户 | ✅ | ❌ | ❌ |
| 编辑用户信息 | ✅ | ❌ | ❌ |
| 重置用户密码 | ✅ | ❌ | ❌ |
| 修改用户角色 | ✅ | ❌ | ❌ |
| 配置管理员权限 | ✅ | ❌ | ❌ |
| 查看自己信息 | ✅ | ✅ | ✅ |
| 修改自己信息 | ✅ | ✅ | ✅ |

---

## 🚀 使用场景

### 场景一：新员工入职

1. 新员工注册账号（自动成为司机）
2. 超级管理员进入用户管理
3. 找到新员工账号
4. 根据职位修改角色（司机/管理员）
5. 配置相应权限

### 场景二：员工忘记密码

1. 员工联系超级管理员
2. 超级管理员进入用户管理
3. 找到员工账号
4. 点击"重置密码"
5. 告知员工新密码 123456
6. 员工登录后修改密码

### 场景三：员工信息变更

1. 员工信息发生变化（手机号、邮箱等）
2. 超级管理员进入用户管理
3. 找到员工账号
4. 点击"编辑信息"
5. 修改相应信息
6. 保存修改

### 场景四：员工离职

1. 员工提交离职申请
2. 超级管理员进入用户管理
3. 找到员工账号
4. 重置密码（防止继续使用）
5. 或修改角色为司机（降低权限）

---

## 📞 常见问题

### Q1：为什么我看不到用户管理功能？

**A**：用户管理功能仅对超级管理员开放，请确认您的账号角色。

### Q2：重置密码后，用户能立即使用新密码登录吗？

**A**：是的，重置密码后立即生效，用户可以使用新密码 123456 登录。

### Q3：修改用户角色后，用户需要重新登录吗？

**A**：不需要，角色修改后立即生效，但建议用户刷新页面以获取最新权限。

### Q4：可以修改超级管理员的角色吗？

**A**：不可以，超级管理员角色不可修改，防止误操作导致系统无管理员。

### Q5：如何批量重置密码？

**A**：目前不支持批量操作，需要逐个用户进行重置。

---

## 📈 未来规划

### 计划功能

- [ ] 批量操作（批量重置密码、批量修改角色）
- [ ] 用户导入导出
- [ ] 用户活动日志
- [ ] 用户登录历史
- [ ] 用户权限详情
- [ ] 用户分组管理

---

**最后更新时间**：2025-11-05
**文档版本**：v1.0
