# 🧪 快速测试指南 - 工作台加载问题修复

## 测试前准备

1. **清除缓存**
   ```bash
   # 浏览器中按 F12 打开开发者工具
   # 右键点击刷新按钮 → 选择"清空缓存并硬性重新加载"
   ```

2. **打开开发者工具**
   - 按 F12 或 Ctrl+Shift+I
   - 切换到 Console 标签查看日志
   - 切换到 Network 标签查看网络请求

## 核心测试场景

### ✅ 场景1：司机登录测试

**步骤：**
1. 访问应用首页
2. 使用司机账号登录
3. 观察页面跳转和加载过程

**预期结果：**
- [ ] 登录成功后，显示"加载中..."（< 1秒）
- [ ] 自动跳转到司机工作台
- [ ] 显示"加载用户信息中..."（< 1秒）
- [ ] 工作台内容正常显示
- [ ] 统计数据正常显示（今日件数、今日收入等）
- [ ] 底部导航栏正常显示

**如果失败：**
- 检查 Console 是否有错误信息
- 检查 Network 中的 API 请求是否成功
- 截图并记录错误信息

---

### ✅ 场景2：管理员登录测试

**步骤：**
1. 退出登录
2. 使用管理员账号登录
3. 观察页面跳转和加载过程

**预期结果：**
- [ ] 登录成功后自动跳转到管理员工作台
- [ ] 工作台内容正常显示
- [ ] 仓库列表正常显示
- [ ] 统计数据正常显示
- [ ] 底部导航栏正常显示

---

### ✅ 场景3：超级管理员登录测试

**步骤：**
1. 退出登录
2. 使用超级管理员账号登录
3. 观察页面跳转和加载过程

**预期结果：**
- [ ] 登录成功后自动跳转到超级管理员工作台
- [ ] 工作台内容正常显示
- [ ] 用户统计正常显示（司机数、管理员数等）
- [ ] 仓库列表正常显示
- [ ] 底部导航栏正常显示

---

### ✅ 场景4：页面刷新测试

**步骤：**
1. 登录后进入任意工作台
2. 按 F5 刷新页面
3. 观察页面加载过程

**预期结果：**
- [ ] 显示"加载用户信息中..."（< 1秒）
- [ ] 工作台内容重新加载并正常显示
- [ ] 不会跳转到登录页
- [ ] 数据正常显示

---

### ✅ 场景5：网络慢速测试

**步骤：**
1. 打开开发者工具 → Network 标签
2. 选择网络限速：Slow 3G
3. 刷新页面或重新登录
4. 观察加载过程

**预期结果：**
- [ ] 显示加载状态（加载图标旋转）
- [ ] 最终能够成功加载内容
- [ ] 不会出现白屏或卡死
- [ ] 有清晰的加载提示

---

## 检查点清单

### 🔍 Console 日志检查

**正常日志示例：**
```
[useDriverDashboard] 开始加载统计数据，用户ID: xxx
[useDriverDashboard] 计件记录数量: 10
[useDriverDashboard] 数据已缓存
```

**异常日志示例：**
```
❌ 加载用户档案失败: Error: ...
❌ [useDriverDashboard] 加载统计数据失败: Error: ...
```

### 🌐 Network 请求检查

**必须成功的请求：**
- [ ] `/auth/v1/user` - 状态码 200
- [ ] `/rest/v1/profiles` - 状态码 200
- [ ] `/rest/v1/warehouses` - 状态码 200
- [ ] `/rest/v1/piece_work_records` - 状态码 200

### 🎨 UI 显示检查

**司机工作台：**
- [ ] 欢迎卡片显示用户名或手机号
- [ ] 数据仪表盘显示 6 个统计卡片
- [ ] 统计数字不是 `undefined` 或 `NaN`
- [ ] 快捷功能区显示 4 个功能按钮
- [ ] 底部导航栏显示并可点击

**管理员工作台：**
- [ ] 欢迎卡片显示用户名或手机号
- [ ] 仓库切换器正常显示
- [ ] 数据仪表盘显示统计数据
- [ ] 管理功能区显示功能按钮
- [ ] 底部导航栏显示并可点击

**超级管理员工作台：**
- [ ] 欢迎卡片显示用户名或手机号
- [ ] 系统概览显示用户统计
- [ ] 仓库切换器正常显示
- [ ] 数据仪表盘显示统计数据
- [ ] 系统管理功能区显示功能按钮
- [ ] 底部导航栏显示并可点击

---

## 常见问题排查

### ❌ 问题1：页面一直显示"加载中..."

**可能原因：**
- 网络请求失败
- 数据库查询超时
- 用户档案不存在

**排查步骤：**
1. 检查 Console 是否有错误
2. 检查 Network 中的请求状态
3. 检查数据库中是否有该用户的 profile 记录

---

### ❌ 问题2：登录后跳转到错误的工作台

**可能原因：**
- 用户角色设置错误
- 跳转逻辑有问题

**排查步骤：**
1. 检查数据库中用户的 `role` 字段
2. 检查 Console 中的日志
3. 确认 `pages/index/index.tsx` 的跳转逻辑

---

### ❌ 问题3：统计数据显示 undefined 或 NaN

**可能原因：**
- 数据加载失败
- 数据格式错误
- Hook 返回值为空

**排查步骤：**
1. 检查 Console 中的数据加载日志
2. 检查 Network 中的 API 响应数据
3. 确认 Hook 的默认值设置

---

### ❌ 问题4：底部导航栏不显示

**可能原因：**
- 当前页面不在 tabBar 配置中
- 使用了错误的跳转方法

**排查步骤：**
1. 检查 `app.config.ts` 中的 tabBar 配置
2. 确认当前页面路径是否在 tabBar.list 中
3. 检查是否使用了 `reLaunch` 跳转到非 tabBar 页面

---

## 测试报告模板

```markdown
## 测试结果

**测试时间：** YYYY-MM-DD HH:mm

**测试环境：**
- 浏览器：Chrome / Firefox / Safari
- 网络：正常 / 慢速 / 离线

**测试结果：**

### 司机登录
- [ ] 通过 / [ ] 失败
- 问题描述：___________

### 管理员登录
- [ ] 通过 / [ ] 失败
- 问题描述：___________

### 超级管理员登录
- [ ] 通过 / [ ] 失败
- 问题描述：___________

### 页面刷新
- [ ] 通过 / [ ] 失败
- 问题描述：___________

### 网络慢速
- [ ] 通过 / [ ] 失败
- 问题描述：___________

**Console 错误日志：**
```
[粘贴错误日志]
```

**Network 请求截图：**
[上传截图]

**其他问题：**
___________
```

---

## 联系支持

如果测试中遇到问题：
1. 记录详细的错误信息和截图
2. 导出 Console 日志
3. 导出 Network HAR 文件
4. 联系技术支持团队

---

**文档版本：** 1.0  
**最后更新：** 2025-11-05
