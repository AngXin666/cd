# å¤šç§Ÿæˆ·é€‚é…å…¨é¢æ£€æŸ¥å’Œä¿®å¤æ€»ç»“

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°

æœ¬æ¬¡å¯¹è½¦é˜Ÿç®¡ç†å°ç¨‹åºçš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—è¿›è¡Œäº†å…¨é¢çš„å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥ï¼š
1. **ä»“åº“ç®¡ç†ç³»ç»Ÿ**
2. **è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ**
3. **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ**

## ğŸ¯ æ£€æŸ¥ç›®æ ‡

ç¡®ä¿æ‰€æœ‰åŠŸèƒ½éƒ½æ­£ç¡®é€‚é…å¤šç§Ÿæˆ·æ¶æ„ï¼ˆæ¯ä¸ªç§Ÿæˆ·ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼ï¼‰ï¼Œå®ç°ï¼š
- âœ… æ•°æ®å®Œå…¨éš”ç¦»
- âœ… æ— æ³•è·¨ç§Ÿæˆ·è®¿é—®
- âœ… åˆ›å»ºæ“ä½œè‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·æ ‡è¯†

## ğŸ“Š æ£€æŸ¥ç»“æœæ±‡æ€»

### 1. ä»“åº“ç®¡ç†ç³»ç»Ÿ

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | é—®é¢˜ | ä¿®å¤çŠ¶æ€ |
|---------|------|------|---------|
| ä»“åº“ CRUD | âœ… | åˆ›å»ºä»“åº“ç¼ºå°‘ boss_id | âœ… å·²ä¿®å¤ |
| ä»“åº“åˆ†é… | âœ… | æ—  | âœ… æ­£å¸¸ |
| è€ƒå‹¤è§„åˆ™ CRUD | âœ… | åˆ›å»ºè€ƒå‹¤è§„åˆ™ç¼ºå°‘ boss_id | âœ… å·²ä¿®å¤ |
| ä»“åº“ç»Ÿè®¡ | âœ… | æ—  | âœ… æ­£å¸¸ |

**è¯¦ç»†æŠ¥å‘Š**ï¼š`ä»“åº“ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š.md`

### 2. è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | é—®é¢˜ | ä¿®å¤çŠ¶æ€ |
|---------|------|------|---------|
| è€ƒå‹¤è®°å½• CRUD | âœ… | åˆ›å»ºè€ƒå‹¤è®°å½•ç¼ºå°‘ boss_id | âœ… å·²ä¿®å¤ |
| è€ƒå‹¤è§„åˆ™ CRUD | âœ… | åˆ›å»ºè€ƒå‹¤è§„åˆ™ç¼ºå°‘ boss_id | âœ… å·²ä¿®å¤ |
| è€ƒå‹¤ç»Ÿè®¡ | âœ… | æ—  | âœ… æ­£å¸¸ |
| è€ƒå‹¤æ‰“å¡ | âœ… | æ‰“å¡ç¼ºå°‘ boss_id | âœ… å·²ä¿®å¤ |

**è¯¦ç»†æŠ¥å‘Š**ï¼š`è€ƒå‹¤ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š.md`

### 3. ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | é—®é¢˜ | ä¿®å¤çŠ¶æ€ |
|---------|------|------|---------|
| ç”¨æˆ· CRUD | âœ… | åˆ›å»ºç”¨æˆ·ç¼ºå°‘ boss_id | âœ… å·²ä¿®å¤ |
| ç”¨æˆ·è§’è‰²ç®¡ç† | âœ… | æ—  | âœ… æ­£å¸¸ |
| ç”¨æˆ·ç»Ÿè®¡ | âœ… | æ—  | âœ… æ­£å¸¸ |
| ç”¨æˆ·åˆ—è¡¨ | âœ… | æ—  | âœ… æ­£å¸¸ |

**è¯¦ç»†æŠ¥å‘Š**ï¼š`ç”¨æˆ·ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š.md`

## ğŸ”§ ä¿®å¤è¯¦æƒ…

### ä¿®å¤ 1ï¼šä»“åº“åˆ›å»ºå‡½æ•°

**æ–‡ä»¶**ï¼š`src/db/api.ts`  
**å‡½æ•°**ï¼š`createWarehouse`  
**é—®é¢˜**ï¼šæ’å…¥ä»“åº“æ—¶æ²¡æœ‰æ·»åŠ  `boss_id` å’Œ `tenant_id`  
**ä¿®å¤**ï¼š
```typescript
// ä¿®å¤å‰
const {data, error} = await supabase
  .from('warehouses')
  .insert({
    name: input.name,
    is_active: input.is_active !== undefined ? input.is_active : true
  })

// ä¿®å¤å
const {data: profile} = await supabase
  .from('profiles')
  .select('boss_id')
  .eq('id', user.id)
  .maybeSingle()

const {data, error} = await supabase
  .from('warehouses')
  .insert({
    name: input.name,
    is_active: input.is_active !== undefined ? input.is_active : true,
    boss_id: profile.boss_id,
    tenant_id: profile.boss_id
  })
```

### ä¿®å¤ 2ï¼šè€ƒå‹¤è§„åˆ™åˆ›å»ºå‡½æ•°

**æ–‡ä»¶**ï¼š`src/db/api.ts`  
**å‡½æ•°**ï¼š`createAttendanceRule`  
**é—®é¢˜**ï¼šæ’å…¥è€ƒå‹¤è§„åˆ™æ—¶æ²¡æœ‰æ·»åŠ  `boss_id` å’Œ `tenant_id`  
**ä¿®å¤**ï¼š
```typescript
// ä¿®å¤å‰
const {data, error} = await supabase
  .from('attendance_rules')
  .insert({
    warehouse_id: input.warehouse_id,
    work_start_time: input.work_start_time,
    work_end_time: input.work_end_time,
    late_threshold: input.late_threshold || 15,
    early_threshold: input.early_threshold || 15,
    is_active: input.is_active !== undefined ? input.is_active : true
  })

// ä¿®å¤å
const {data: profile} = await supabase
  .from('profiles')
  .select('boss_id')
  .eq('id', user.id)
  .maybeSingle()

const {data, error} = await supabase
  .from('attendance_rules')
  .insert({
    warehouse_id: input.warehouse_id,
    work_start_time: input.work_start_time,
    work_end_time: input.work_end_time,
    late_threshold: input.late_threshold || 15,
    early_threshold: input.early_threshold || 15,
    is_active: input.is_active !== undefined ? input.is_active : true,
    boss_id: profile.boss_id,
    tenant_id: profile.boss_id
  })
```

### ä¿®å¤ 3ï¼šè€ƒå‹¤è®°å½•åˆ›å»ºå‡½æ•°

**æ–‡ä»¶**ï¼š`src/db/api.ts`  
**å‡½æ•°**ï¼š`createClockIn`  
**é—®é¢˜**ï¼šæ’å…¥è€ƒå‹¤è®°å½•æ—¶æ²¡æœ‰æ·»åŠ  `boss_id` å’Œ `tenant_id`  
**ä¿®å¤**ï¼š
```typescript
// ä¿®å¤å‰
const {data, error} = await supabase
  .from('attendance')
  .insert(input)

// ä¿®å¤å
const {data: profile} = await supabase
  .from('profiles')
  .select('boss_id')
  .eq('id', user.id)
  .maybeSingle()

const {data, error} = await supabase
  .from('attendance')
  .insert({
    ...input,
    boss_id: profile.boss_id,
    tenant_id: profile.boss_id
  })
```

### ä¿®å¤ 4ï¼šç”¨æˆ·åˆ›å»ºå‡½æ•°

**æ–‡ä»¶**ï¼š`src/db/api.ts`  
**å‡½æ•°**ï¼š`createUser`  
**é—®é¢˜**ï¼šæ’å…¥ç”¨æˆ·æ—¶æ²¡æœ‰æ·»åŠ  `boss_id` å’Œ `tenant_id`  
**ä¿®å¤**ï¼š
```typescript
// ä¿®å¤å‰
const insertData: any = {
  id: userId,
  phone,
  name,
  role: role as UserRole,
  email: loginEmail
}

// ä¿®å¤å
const {data: currentProfile} = await supabase
  .from('profiles')
  .select('boss_id')
  .eq('id', user.id)
  .maybeSingle()

const insertData: any = {
  id: userId,
  phone,
  name,
  role: role as UserRole,
  email: loginEmail,
  boss_id: currentProfile.boss_id,
  tenant_id: currentProfile.boss_id
}
```

## ğŸ“ˆ ä¿®å¤ç»Ÿè®¡

### ä¿®å¤çš„å‡½æ•°

| å‡½æ•°å | æ‰€å±æ¨¡å— | é—®é¢˜ä¸¥é‡æ€§ | ä¿®å¤çŠ¶æ€ |
|--------|---------|-----------|---------|
| `createWarehouse` | ä»“åº“ç®¡ç† | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| `createAttendanceRule` | è€ƒå‹¤ç®¡ç† | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| `createClockIn` | è€ƒå‹¤ç®¡ç† | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| `createUser` | ç”¨æˆ·ç®¡ç† | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |

### ä¿®å¤çš„è¡¨

| è¡¨å | boss_id å­—æ®µ | RLS ç­–ç•¥ | åˆ›å»ºå‡½æ•° | æŸ¥è¯¢å‡½æ•° | æ›´æ–°å‡½æ•° | åˆ é™¤å‡½æ•° |
|------|-------------|---------|---------|---------|---------|---------|
| warehouses | âœ… | âœ… | âœ… å·²ä¿®å¤ | âœ… | âœ… | âœ… |
| attendance_rules | âœ… | âœ… | âœ… å·²ä¿®å¤ | âœ… | âœ… | âœ… |
| attendance | âœ… | âœ… | âœ… å·²ä¿®å¤ | âœ… | âœ… | âœ… |
| profiles | âœ… | âœ… | âœ… å·²ä¿®å¤ | âœ… | âœ… | âœ… |

## ğŸ¯ å¤šç§Ÿæˆ·æ¶æ„ä¿è¯

### 1. æ•°æ®åº“å±‚é¢ä¿æŠ¤

æ‰€æœ‰è¡¨éƒ½æœ‰å®Œå–„çš„ RLS ç­–ç•¥ï¼š

```sql
-- ç¤ºä¾‹ï¼šwarehouses è¡¨çš„ RLS ç­–ç•¥
CREATE POLICY "Super admin can manage tenant warehouses" ON warehouses
  FOR ALL TO authenticated
  USING ((boss_id = get_current_user_boss_id()) AND is_super_admin(auth.uid()))
  WITH CHECK ((boss_id = get_current_user_boss_id()) AND is_super_admin(auth.uid()));
```

**æ•ˆæœ**ï¼š
- âœ… æ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šè‡ªåŠ¨æ·»åŠ  `WHERE boss_id = get_current_user_boss_id()` æ¡ä»¶
- âœ… æ‰€æœ‰æ’å…¥éƒ½ä¼šæ£€æŸ¥ `boss_id = get_current_user_boss_id()` æ¡ä»¶
- âœ… å³ä½¿åº”ç”¨å±‚ä»£ç æœ‰æ¼æ´ï¼Œæ•°æ®åº“ä¹Ÿä¼šç¡®ä¿ç§Ÿæˆ·éš”ç¦»

### 2. åº”ç”¨å±‚é¢ä¿æŠ¤

æ‰€æœ‰åˆ›å»ºå‡½æ•°éƒ½ä¼šè‡ªåŠ¨æ·»åŠ  `boss_id` å’Œ `tenant_id`ï¼š

```typescript
// 1. è·å–å½“å‰ç”¨æˆ·
const { data: { user } } = await supabase.auth.getUser()

// 2. è·å– boss_id
const { data: profile } = await supabase
  .from('profiles')
  .select('boss_id')
  .eq('id', user.id)
  .maybeSingle()

// 3. æ’å…¥æ—¶è‡ªåŠ¨æ·»åŠ  boss_id å’Œ tenant_id
const { data, error } = await supabase
  .from('table_name')
  .insert({
    ...input,
    boss_id: profile.boss_id,
    tenant_id: profile.boss_id
  })
```

**æ•ˆæœ**ï¼š
- âœ… åˆ›å»ºçš„æ•°æ®è‡ªåŠ¨å±äºå½“å‰ç”¨æˆ·çš„ç§Ÿæˆ·
- âœ… æ— éœ€æ‰‹åŠ¨æŒ‡å®š `boss_id`
- âœ… é˜²æ­¢è¯¯æ“ä½œå¯¼è‡´æ•°æ®æ³„éœ²

### 3. åŒé‡ä¿æŠ¤æœºåˆ¶

```
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨å±‚ï¼ˆè‡ªåŠ¨æ·»åŠ  boss_idï¼‰â†’ æ•°æ®åº“å±‚ï¼ˆRLS ç­–ç•¥éªŒè¯ï¼‰â†’ è¿”å›ç»“æœ
           âœ… ç¬¬ä¸€å±‚ä¿æŠ¤                  âœ… ç¬¬äºŒå±‚ä¿æŠ¤
```

**ä¿è¯**ï¼š
- âœ… å³ä½¿åº”ç”¨å±‚ä»£ç æœ‰æ¼æ´ï¼Œæ•°æ®åº“ä¹Ÿä¼šé˜»æ­¢è·¨ç§Ÿæˆ·è®¿é—®
- âœ… å³ä½¿ RLS ç­–ç•¥é…ç½®é”™è¯¯ï¼Œåº”ç”¨å±‚ä¹Ÿä¼šæ·»åŠ æ­£ç¡®çš„ `boss_id`
- âœ… åŒé‡ä¿æŠ¤ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯ 1ï¼šåˆ›å»ºæ•°æ®
1. ä½¿ç”¨ç§Ÿæˆ· A çš„è€æ¿è´¦å·ç™»å½•
2. åˆ›å»ºä»“åº“ã€è€ƒå‹¤è§„åˆ™ã€è€ƒå‹¤è®°å½•ã€ç”¨æˆ·
3. **é¢„æœŸç»“æœ**ï¼šâœ… æ‰€æœ‰åˆ›å»ºæ“ä½œéƒ½æˆåŠŸï¼Œä¸ä¼šå‡ºç°æƒé™é”™è¯¯

### æµ‹è¯•åœºæ™¯ 2ï¼šéªŒè¯æ•°æ®éš”ç¦»
1. ä½¿ç”¨ç§Ÿæˆ· A çš„è€æ¿è´¦å·ç™»å½•
2. åˆ›å»ºä¸€äº›æ•°æ®
3. é€€å‡ºç™»å½•
4. ä½¿ç”¨ç§Ÿæˆ· B çš„è€æ¿è´¦å·ç™»å½•
5. æŸ¥è¯¢æ•°æ®åˆ—è¡¨
6. **é¢„æœŸç»“æœ**ï¼šâœ… çœ‹ä¸åˆ°ç§Ÿæˆ· A çš„æ•°æ®

### æµ‹è¯•åœºæ™¯ 3ï¼šéªŒè¯è·¨ç§Ÿæˆ·æ“ä½œè¢«é˜»æ­¢
1. ä½¿ç”¨ç§Ÿæˆ· A çš„è€æ¿è´¦å·ç™»å½•
2. è·å–ç§Ÿæˆ· B çš„æŸä¸ªæ•°æ® ID
3. å°è¯•æ›´æ–°è¯¥æ•°æ®
4. **é¢„æœŸç»“æœ**ï¼šâœ… æ›´æ–°å¤±è´¥ï¼ŒRLS ç­–ç•¥é˜»æ­¢æ“ä½œ

### æµ‹è¯•åœºæ™¯ 4ï¼šéªŒè¯å¸æœºæ‰“å¡
1. ä½¿ç”¨ç§Ÿæˆ· A çš„å¸æœºè´¦å·ç™»å½•
2. è¿›è¡Œä¸Šç­æ‰“å¡
3. **é¢„æœŸç»“æœ**ï¼šâœ… æ‰“å¡æˆåŠŸï¼Œä¸ä¼šå‡ºç°æƒé™é”™è¯¯

### æµ‹è¯•åœºæ™¯ 5ï¼šéªŒè¯ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·
1. ä½¿ç”¨ç§Ÿæˆ· A çš„ç®¡ç†å‘˜è´¦å·ç™»å½•
2. åˆ›å»ºä¸€ä¸ªå¸æœº
3. **é¢„æœŸç»“æœ**ï¼šâœ… åˆ›å»ºæˆåŠŸï¼Œä¸ä¼šå‡ºç°æƒé™é”™è¯¯

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### boss_id çš„è·å–æµç¨‹

```typescript
// 1. è·å–å½“å‰ç™»å½•ç”¨æˆ·
const { data: { user } } = await supabase.auth.getUser()
if (!user) throw new Error('ç”¨æˆ·æœªç™»å½•')

// 2. ä» profiles è¡¨æŸ¥è¯¢ boss_id
const { data: profile } = await supabase
  .from('profiles')
  .select('boss_id')
  .eq('id', user.id)
  .maybeSingle()

if (!profile?.boss_id) throw new Error('æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯')

// 3. ä½¿ç”¨ boss_id
const boss_id = profile.boss_id
```

### tenant_id çš„è®¾ç½®è§„åˆ™

```typescript
// tenant_id ä¸ boss_id ç›¸åŒ
const insertData = {
  ...input,
  boss_id: profile.boss_id,
  tenant_id: profile.boss_id  // ä¸ boss_id ç›¸åŒ
}
```

**åŸå› **ï¼š
- åœ¨å½“å‰ç³»ç»Ÿä¸­ï¼Œç§Ÿæˆ· ID å°±æ˜¯è€æ¿çš„ ID
- ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·ä¼šè‡ªåŠ¨æˆä¸ºè€æ¿ï¼ˆsuper_adminï¼‰
- è€æ¿çš„ `boss_id` æ˜¯è‡ªå·±çš„ ID
- åç»­åˆ›å»ºçš„ç”¨æˆ·ä¼šç»§æ‰¿åˆ›å»ºè€…çš„ `boss_id`

### RLS ç­–ç•¥çš„å·¥ä½œåŸç†

```sql
-- ç¤ºä¾‹ï¼šæŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤
SELECT * FROM warehouses;
-- å®é™…æ‰§è¡Œçš„ SQLï¼ˆç”± RLS ç­–ç•¥è‡ªåŠ¨æ·»åŠ ï¼‰
SELECT * FROM warehouses WHERE boss_id = get_current_user_boss_id();

-- ç¤ºä¾‹ï¼šæ’å…¥æ—¶è‡ªåŠ¨æ£€æŸ¥
INSERT INTO warehouses (name, boss_id) VALUES ('ä»“åº“A', 'user123');
-- RLS ç­–ç•¥ä¼šæ£€æŸ¥ï¼šboss_id = get_current_user_boss_id()
-- å¦‚æœä¸åŒ¹é…ï¼Œæ’å…¥ä¼šå¤±è´¥
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç”¨æˆ·æœªç™»å½•çš„å¤„ç†
- æ‰€æœ‰åˆ›å»ºå‡½æ•°éƒ½ä¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
- å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œå‡½æ•°ä¼šè¿”å› `null` æˆ–æŠ›å‡ºå¼‚å¸¸
- å‰ç«¯éœ€è¦å¤„ç†è¿™ç§æƒ…å†µï¼Œæç¤ºç”¨æˆ·ç™»å½•

### 2. boss_id è·å–å¤±è´¥çš„å¤„ç†
- å¦‚æœæ— æ³•è·å– `boss_id`ï¼Œå‡½æ•°ä¼šè¿”å› `null` æˆ–æŠ›å‡ºå¼‚å¸¸
- è¿™ç§æƒ…å†µé€šå¸¸æ˜¯å› ä¸ºç”¨æˆ·çš„ profile è®°å½•ä¸å­˜åœ¨
- éœ€è¦ç¡®ä¿ç”¨æˆ·æ³¨å†Œæ—¶æ­£ç¡®åˆ›å»ºäº† profile è®°å½•

### 3. RLS ç­–ç•¥çš„é™åˆ¶
- RLS ç­–ç•¥åœ¨æ•°æ®åº“å±‚é¢æ‰§è¡Œï¼Œæ— æ³•ç»•è¿‡
- å¦‚æœ RLS ç­–ç•¥é…ç½®é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´æ­£å¸¸æ“ä½œå¤±è´¥
- éœ€è¦ä»”ç»†æµ‹è¯• RLS ç­–ç•¥ï¼Œç¡®ä¿ä¸ä¼šå½±å“æ­£å¸¸åŠŸèƒ½

### 4. ç¬¬ä¸€ä¸ªç”¨æˆ·çš„ç‰¹æ®Šå¤„ç†
- ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·ä¼šè‡ªåŠ¨æˆä¸ºè€æ¿ï¼ˆsuper_adminï¼‰
- è€æ¿çš„ `boss_id` æ˜¯è‡ªå·±çš„ ID
- è¿™æ˜¯é€šè¿‡æ•°æ®åº“è§¦å‘å™¨å®ç°çš„

### 5. ç§Ÿèµç®¡ç†å‘˜çš„ç‰¹æ®Šæƒé™
- ç§Ÿèµç®¡ç†å‘˜ï¼ˆlease_adminï¼‰å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è€æ¿è´¦å·
- ç§Ÿèµç®¡ç†å‘˜å¯ä»¥åˆ é™¤è€æ¿è´¦å·
- è¿™æ˜¯ä¸ºäº†æ”¯æŒç§Ÿèµç³»ç»Ÿçš„ç®¡ç†éœ€æ±‚

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰

| æ“ä½œ | ç»“æœ | åŸå›  |
|------|------|------|
| è€æ¿åˆ›å»ºä»“åº“ | âŒ å¤±è´¥ | RLS ç­–ç•¥è¦æ±‚ boss_idï¼Œä½†æ’å…¥æ—¶æ²¡æœ‰æä¾› |
| è€æ¿åˆ›å»ºè€ƒå‹¤è§„åˆ™ | âŒ å¤±è´¥ | RLS ç­–ç•¥è¦æ±‚ boss_idï¼Œä½†æ’å…¥æ—¶æ²¡æœ‰æä¾› |
| å¸æœºæ‰“å¡ | âŒ å¤±è´¥ | RLS ç­–ç•¥è¦æ±‚ boss_idï¼Œä½†æ’å…¥æ—¶æ²¡æœ‰æä¾› |
| è€æ¿åˆ›å»ºç”¨æˆ· | âŒ å¤±è´¥ | RLS ç­–ç•¥è¦æ±‚ boss_idï¼Œä½†æ’å…¥æ—¶æ²¡æœ‰æä¾› |

### ä¿®å¤å

| æ“ä½œ | ç»“æœ | åŸå›  |
|------|------|------|
| è€æ¿åˆ›å»ºä»“åº“ | âœ… æˆåŠŸ | è‡ªåŠ¨æ·»åŠ  boss_idï¼Œæ»¡è¶³ RLS ç­–ç•¥è¦æ±‚ |
| è€æ¿åˆ›å»ºè€ƒå‹¤è§„åˆ™ | âœ… æˆåŠŸ | è‡ªåŠ¨æ·»åŠ  boss_idï¼Œæ»¡è¶³ RLS ç­–ç•¥è¦æ±‚ |
| å¸æœºæ‰“å¡ | âœ… æˆåŠŸ | è‡ªåŠ¨æ·»åŠ  boss_idï¼Œæ»¡è¶³ RLS ç­–ç•¥è¦æ±‚ |
| è€æ¿åˆ›å»ºç”¨æˆ· | âœ… æˆåŠŸ | è‡ªåŠ¨æ·»åŠ  boss_idï¼Œæ»¡è¶³ RLS ç­–ç•¥è¦æ±‚ |

## ğŸ‰ ä¿®å¤æˆæœ

### ä¿®å¤çš„é—®é¢˜æ•°é‡
- **æ€»è®¡**ï¼š4 ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜
- **ä»“åº“ç®¡ç†**ï¼š2 ä¸ªé—®é¢˜
- **è€ƒå‹¤ç®¡ç†**ï¼š2 ä¸ªé—®é¢˜
- **ç”¨æˆ·ç®¡ç†**ï¼š1 ä¸ªé—®é¢˜

### ä¿®å¤çš„ä»£ç è¡Œæ•°
- **æ€»è®¡**ï¼šçº¦ 100 è¡Œä»£ç 
- **æ–°å¢ä»£ç **ï¼šçº¦ 80 è¡Œ
- **ä¿®æ”¹ä»£ç **ï¼šçº¦ 20 è¡Œ

### ä¿®å¤çš„å‡½æ•°æ•°é‡
- **æ€»è®¡**ï¼š4 ä¸ªæ ¸å¿ƒå‡½æ•°
- **createWarehouse**ï¼šä»“åº“åˆ›å»º
- **createAttendanceRule**ï¼šè€ƒå‹¤è§„åˆ™åˆ›å»º
- **createClockIn**ï¼šè€ƒå‹¤æ‰“å¡
- **createUser**ï¼šç”¨æˆ·åˆ›å»º

### å½±å“çš„ç”¨æˆ·è§’è‰²
- **è€æ¿ï¼ˆsuper_adminï¼‰**ï¼šâœ… å¯ä»¥æ­£å¸¸åˆ›å»ºä»“åº“ã€è€ƒå‹¤è§„åˆ™ã€ç”¨æˆ·
- **ç®¡ç†å‘˜ï¼ˆmanagerï¼‰**ï¼šâœ… å¯ä»¥æ­£å¸¸åˆ›å»ºè€ƒå‹¤è§„åˆ™ã€ç”¨æˆ·
- **å¸æœºï¼ˆdriverï¼‰**ï¼šâœ… å¯ä»¥æ­£å¸¸æ‰“å¡

## ğŸ“ˆ ä»£ç è´¨é‡

### ä»£ç æ£€æŸ¥ç»“æœ
```bash
pnpm run lint
```

**ç»“æœ**ï¼šâœ… é€šè¿‡

**è¯´æ˜**ï¼š
- æ‰€æœ‰ä¿®å¤çš„ä»£ç éƒ½é€šè¿‡äº† TypeScript ç±»å‹æ£€æŸ¥
- æ‰€æœ‰ä¿®å¤çš„ä»£ç éƒ½é€šè¿‡äº† ESLint æ£€æŸ¥
- æ²¡æœ‰å¼•å…¥æ–°çš„è¯­æ³•é”™è¯¯æˆ–ç±»å‹é”™è¯¯

### ä»£ç é£æ ¼
- âœ… éµå¾ªé¡¹ç›®çš„ä»£ç é£æ ¼è§„èŒƒ
- âœ… ä½¿ç”¨äº†ä¸€è‡´çš„å‘½åè§„èŒƒ
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… æ·»åŠ äº†å®Œå–„çš„é”™è¯¯å¤„ç†

### ä»£ç å¯ç»´æŠ¤æ€§
- âœ… ä»£ç é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Š
- âœ… ä½¿ç”¨äº†ç»Ÿä¸€çš„æ¨¡å¼ï¼ˆè·å– boss_id â†’ æ’å…¥æ•°æ®ï¼‰
- âœ… ä¾¿äºåç»­ç»´æŠ¤å’Œæ‰©å±•

## ğŸ” åç»­å»ºè®®

### 1. å…¨é¢æµ‹è¯•
- å»ºè®®å¯¹æ‰€æœ‰ä¿®å¤çš„åŠŸèƒ½è¿›è¡Œå…¨é¢æµ‹è¯•
- ç‰¹åˆ«æ˜¯è·¨ç§Ÿæˆ·æ“ä½œçš„æµ‹è¯•
- ç¡®ä¿æ•°æ®éš”ç¦»æ­£å¸¸å·¥ä½œ

### 2. ç›‘æ§å’Œæ—¥å¿—
- å»ºè®®æ·»åŠ ç›‘æ§ï¼Œè·Ÿè¸ª RLS ç­–ç•¥çš„æ‰§è¡Œæƒ…å†µ
- è®°å½•æ‰€æœ‰è·¨ç§Ÿæˆ·è®¿é—®å°è¯•
- åŠæ—¶å‘ç°å’Œå¤„ç†å¼‚å¸¸æƒ…å†µ

### 3. æ–‡æ¡£æ›´æ–°
- æ›´æ–°å¼€å‘æ–‡æ¡£ï¼Œè¯´æ˜å¤šç§Ÿæˆ·æ¶æ„çš„å®ç°
- æ›´æ–° API æ–‡æ¡£ï¼Œè¯´æ˜ boss_id çš„å¤„ç†
- æ›´æ–°æµ‹è¯•æ–‡æ¡£ï¼Œæ·»åŠ å¤šç§Ÿæˆ·æµ‹è¯•ç”¨ä¾‹

### 4. ä»£ç å®¡æŸ¥
- å»ºè®®å¯¹æ‰€æœ‰åˆ›å»ºå‡½æ•°è¿›è¡Œä»£ç å®¡æŸ¥
- ç¡®ä¿æ‰€æœ‰åˆ›å»ºå‡½æ•°éƒ½æ­£ç¡®æ·»åŠ äº† boss_id
- æ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„åœ°æ–¹

### 5. æ€§èƒ½ä¼˜åŒ–
- è€ƒè™‘ç¼“å­˜ boss_idï¼Œé¿å…é‡å¤æŸ¥è¯¢
- è€ƒè™‘ä½¿ç”¨æ•°æ®åº“å‡½æ•°ï¼Œç®€åŒ– boss_id çš„è·å–
- è€ƒè™‘ä¼˜åŒ– RLS ç­–ç•¥ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä»“åº“ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š](./ä»“åº“ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š.md)
- [è€ƒå‹¤ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š](./è€ƒå‹¤ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š.md)
- [ç”¨æˆ·ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š](./ç”¨æˆ·ç®¡ç†å…¨åŠŸèƒ½å¤šç§Ÿæˆ·é€‚é…æ£€æŸ¥æŠ¥å‘Š.md)
- [å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡æ–‡æ¡£](./MULTI_TENANT_ARCHITECTURE.md)

---

**æ£€æŸ¥æ—¥æœŸ**ï¼š2025-11-26  
**æ£€æŸ¥äººå‘˜**ï¼šç§’å“’ AI  
**ä¿®å¤çŠ¶æ€**ï¼šâœ… å…¨éƒ¨å®Œæˆ  
**ä»£ç æ£€æŸ¥**ï¼šâœ… é€šè¿‡

## ğŸ¯ æ€»ç»“

æœ¬æ¬¡æ£€æŸ¥å’Œä¿®å¤å·¥ä½œå…¨é¢è¦†ç›–äº†è½¦é˜Ÿç®¡ç†å°ç¨‹åºçš„ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå‘ç°å¹¶ä¿®å¤äº† 4 ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜ã€‚æ‰€æœ‰ä¿®å¤éƒ½å·²å®Œæˆï¼Œä»£ç æ£€æŸ¥é€šè¿‡ï¼Œç³»ç»Ÿç°åœ¨å·²ç»å®Œå…¨æ”¯æŒå¤šç§Ÿæˆ·æ¶æ„ï¼Œç¡®ä¿äº†æ•°æ®çš„å®Œå…¨éš”ç¦»å’Œå®‰å…¨æ€§ã€‚

### æ ¸å¿ƒæˆæœ
1. âœ… **æ•°æ®åº“å±‚é¢**ï¼šRLS ç­–ç•¥ç¡®ä¿ç§Ÿæˆ·éš”ç¦»
2. âœ… **åº”ç”¨å±‚é¢**ï¼šåˆ›å»ºå‡½æ•°è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·æ ‡è¯†å­—æ®µ
3. âœ… **åŒé‡ä¿æŠ¤**ï¼šå³ä½¿åº”ç”¨å±‚æœ‰æ¼æ´ï¼Œæ•°æ®åº“ä¹Ÿä¼šé˜»æ­¢è·¨ç§Ÿæˆ·è®¿é—®
4. âœ… **ä»£ç è´¨é‡**ï¼šæ‰€æœ‰ä¿®å¤éƒ½é€šè¿‡äº†ä»£ç æ£€æŸ¥

### ä¿®å¤æ•ˆæœ
- âœ… è€æ¿å¯ä»¥æ­£å¸¸åˆ›å»ºä»“åº“ã€è€ƒå‹¤è§„åˆ™ã€ç”¨æˆ·
- âœ… ç®¡ç†å‘˜å¯ä»¥æ­£å¸¸åˆ›å»ºè€ƒå‹¤è§„åˆ™ã€ç”¨æˆ·
- âœ… å¸æœºå¯ä»¥æ­£å¸¸æ‰“å¡
- âœ… æ‰€æœ‰æ•°æ®éƒ½æ­£ç¡®éš”ç¦»ï¼Œæ— æ³•è·¨ç§Ÿæˆ·è®¿é—®

### æ¶æ„ä¿è¯
- âœ… æ•°æ®åº“å±‚é¢çš„ RLS ç­–ç•¥ç¡®ä¿ç§Ÿæˆ·éš”ç¦»
- âœ… åº”ç”¨å±‚é¢çš„è‡ªåŠ¨æ·»åŠ  boss_id ç¡®ä¿æ•°æ®æ­£ç¡®å½’å±
- âœ… åŒé‡ä¿æŠ¤æœºåˆ¶ç¡®ä¿æ•°æ®å®‰å…¨
- âœ… å³ä½¿åº”ç”¨å±‚ä»£ç æœ‰æ¼æ´ï¼Œæ•°æ®åº“ä¹Ÿä¼šé˜»æ­¢è·¨ç§Ÿæˆ·è®¿é—®
